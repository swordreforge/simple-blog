<!DOCTYPE html><html lang="zh-CN"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,viewport-fit=cover"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)"><meta name="description" content="{{ summary | default(value='é˜…è¯»æŠ€æœ¯æ–‡ç« ã€åˆ†äº«ç¼–ç¨‹ç»éªŒã€æ¢ç´¢æŠ€æœ¯è¾¹ç•Œ - ' ~ title) }}"><meta name="keywords" content="{{ tags | default(value='æŠ€æœ¯åšå®¢,ç¼–ç¨‹,å¼€å‘') }}"><title>{{ title }} - æ–‡ç« é˜…è¯»</title><link rel="icon" href="data:,"><link rel="stylesheet" href="/css/tokyo-night-dark.min.css"><link rel="stylesheet" href="/css/passage-base.css"><style>@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes slideInLeft{from{transform:translateX(-100%)}to{transform:translateX(0)}}@keyframes slideInRight{from{transform:translateX(100%)}to{transform:translateX(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.fade-in{animation:fadeIn .3s ease}.slide-in{animation:slideIn .3s ease}.spin{animation:spin .8s linear infinite}.pulse{animation:pulse 1.5s ease-in-out infinite}</style><link rel="stylesheet" href="/css/katex.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/floating-text.css" media="print" onload='this.media="all"'><style>*{margin:0;padding:0;box-sizing:border-box}:root{--sidebar-width:280px;--header-height:60px;--tagbar-height:50px;--primary-color:#007bff;--secondary-color:#00b894;--accent-color:#6c5ce7;--bg-light:rgba(255, 255, 255, 0.85);--text-dark:#222;--text-light:#666;--border-color:rgba(0, 0, 0, 0.1)}body,html{height:100%;width:100%;overflow:hidden;font-family:'Segoe UI','Helvetica Neue','PingFang SC','Microsoft YaHei',sans-serif}body{display:flex;flex-direction:column;background-image:url('{{ settings.background_image | safe }}');background-size: {{ settings.background_size }};background-position: {{ settings.background_position }};background-repeat: {{ settings.background_repeat }};background-attachment: {{ settings.background_attachment }};position:relative;--global-opacity: {{ settings.global_opacity }}}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.3);backdrop-filter:blur(5px);z-index:-1}nav{display:flex;justify-content:space-between;align-items:center;height:var(--header-height);padding:0 5px;background:var(--navbar-glass-color,rgba(255,255,255,.85));backdrop-filter:blur(10px) saturate(180%);-webkit-backdrop-filter:blur(10px) saturate(180%);border-bottom:1px solid rgba(255,255,255,.1);z-index:100;box-shadow:0 8px 32px 0 rgba(31,38,135,.15);transition:transform .4s cubic-bezier(.25, .46, .45, .94),opacity .4s ease;transform:translateY(0);opacity:1}.nav-left,.nav-right{display:flex;align-items:center;gap:4px}.nav-left a[href="/about"],.nav-left a[href="/admin"]{display:none}nav a{color:var(--navbar-text-color,rgba(255,255,255,.9));text-decoration:none;padding:4px 8px;background:rgba(255,255,255,.1);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);border-radius:25px;border:1px solid rgba(255,255,255,.3);text-shadow:0 2px 4px rgba(0,0,0,.1)}nav button{color:var(--navbar-text-color,rgba(255,255,255,.9));text-decoration:none;padding:4px 8px;background:rgba(255,255,255,.1);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);border-radius:25px;border:1px solid rgba(255,255,255,.3);cursor:pointer}nav a:hover{color:#fff;background:rgba(0,0,0,0);transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.2)}nav a::after{display:none}nav a.current{color:#fff;background:rgba(255,255,255,.3);box-shadow:0 4px 12px rgba(0,0,0,.15)}.sidebar-toggle{display:flex;align-items:center;justify-content:center;width:40px;height:40px;padding:8px;background:rgba(255,255,255,.1);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);border:1px solid rgba(255,255,255,.3);border-radius:8px;cursor:pointer;transition:all .3s ease;color:rgba(255,255,255,.9)}.sidebar-toggle:hover{background:rgba(255,255,255,.2);border-color:rgba(255,255,255,.5);transform:scale(1.05)}.sidebar-toggle:active{transform:scale(.95)}.main-container{display:flex;flex:1;height:calc(100vh - var(--header-height));overflow:hidden;position:relative}.sidebar{width:var(--sidebar-width);background-color:rgba(30,30,35,.95)!important;border-right:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;transition:all .4s cubic-bezier(.25, .46, .45, .94);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);z-index:10;transform:translateX(0)}.sidebar.hidden{width:0!important;min-width:0!important;overflow:hidden;opacity:0;transform:translateX(-100%)}.sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.1);display:flex;justify-content:space-between;align-items:center}.sidebar-header h2{font-size:1.4em;color:#f0f0f0;font-weight:600}.sidebar-controls{display:flex;gap:10px}.sidebar-controls button{background:0 0;border:1px solid rgba(255,255,255,.2);border-radius:4px;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#aaa;transition:all .2s ease}.sidebar-controls button:hover{background-color:rgba(255,255,255,.1);color:#007bff}.file-tree{flex:1;overflow-y:auto;padding:15px}.toc-container{flex:1;overflow-y:auto;padding:15px;display:none}.toc-container.active{display:block}.toc-list{list-style:none;padding:0;margin:0}.toc-item{margin-bottom:4px}.toc-link{display:block;padding:6px 10px;color:#f0f0f0;text-decoration:none;border-radius:6px;transition:all .2s ease;font-size:.9em;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.toc-link:hover{background-color:rgba(0,123,255,.1);color:var(--primary-color)}.toc-link.active{background-color:rgba(0,123,255,.15);color:var(--primary-color);font-weight:500}.toc-level-1{padding-left:0;font-weight:600;font-size:1em}.toc-level-2{padding-left:20px;font-size:.95em}.toc-level-3{padding-left:35px;font-size:.9em}.toc-level-4{padding-left:50px;font-size:.85em}.toc-level-5{padding-left:65px;font-size:.8em}.toc-level-6{padding-left:80px;font-size:.75em}.toc-empty{text-align:center;color:#aaa;padding:40px 20px;font-size:.9em}.toc-empty svg{width:48px;height:48px;margin-bottom:10px;opacity:.5}.file-tree ul{list-style:none}.file-tree li{margin-bottom:2px;position:relative}.file-tree .folder>.folder-header{display:flex;align-items:center;padding:8px 10px;cursor:pointer;border-radius:6px;transition:background-color .2s ease}.file-tree .folder>.folder-header:hover{background-color:rgba(255,255,255,.05)}.file-tree .folder>.folder-header .folder-icon{margin-right:8px;color:var(--accent-color);font-size:.9em;transition:transform .3s ease}.file-tree .folder.open>.folder-header .folder-icon{transform:rotate(90deg)}.file-tree .folder>.folder-header .folder-name{flex:1;font-weight:500;color:#f0f0f0}.file-tree .folder>.folder-header .file-count{background-color:rgba(255,255,255,.1);color:#aaa;font-size:.8em;padding:2px 8px;border-radius:10px}.file-tree .folder-content{margin-left:15px;padding-left:15px;border-left:1px dashed rgba(255,255,255,.1);display:none}.file-tree .folder.open>.folder-content{display:block}.file-tree .file-item{display:flex;align-items:center;padding:8px 10px;cursor:pointer;border-radius:6px;transition:all .2s ease;margin-bottom:2px}.file-tree .file-item:hover{background-color:rgba(255,255,255,.05)}.file-tree .file-item.active{background-color:rgba(0,123,255,.1);color:var(--primary-color);font-weight:500}.file-tree .file-item .file-icon{margin-right:8px;color:var(--primary-color);font-size:.9em}.file-tree .file-item .file-name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff!important;font-size:.95em;font-weight:400;opacity:1!important;visibility:visible!important;display:inline-block!important}.file-tree .file-item .file-date{font-size:.8em;color:#aaa;margin-left:8px}.file-tree .file-item.file-unpublished{opacity:.7}.file-tree .file-item.file-unpublished .file-name{color:#ff9800!important;font-style:italic}.file-tree .file-item.file-unpublished .file-icon{color:#ff9800}.file-tree .file-item .file-status{font-size:.75em;padding:2px 6px;border-radius:3px;margin-left:8px;background:rgba(255,152,0,.2);color:#ff9800;font-weight:500}.content-area{flex:1;display:flex;flex-direction:column;overflow:hidden}.tab-bar{display:flex;height:var(--tagbar-height);background-color:rgba(255,255,255,.75);border-bottom:1px solid rgba(255,255,255,.3);overflow-x:auto;overflow-y:hidden;backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);z-index:5}.tab{display:flex;align-items:center;padding:0 20px;border-right:1px solid var(--border-color);cursor:pointer;transition:all .2s ease;white-space:nowrap;position:relative;min-width:120px;max-width:200px}.tab:hover{background-color:rgba(0,0,0,.05)}.tab.active{background-color:#fff;color:var(--primary-color);font-weight:500}.tab.active::after{content:'';position:absolute;bottom:0;left:0;width:100%;height:3px;background-color:var(--primary-color)}.tab .tab-title{flex:1;overflow:hidden;text-overflow:ellipsis;font-size:.95em}.tab .tab-close{margin-left:10px;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8em;transition:background-color .2s ease}.tab .tab-close:hover{background-color:rgba(0,0,0,.1)}.article-container{flex:1;overflow-y:auto;padding:30px;background-color:rgba(255,255,255,.75);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%)}.unpublished-notice{max-width:600px;margin:40px auto;padding:30px;background:rgba(255,193,7,.1);border:2px solid rgba(255,193,7,.3);border-radius:12px;backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%)}.notice-content{display:flex;align-items:flex-start;gap:20px}.notice-icon{font-size:48px;flex-shrink:0}.notice-text h3{margin:0 0 10px 0;color:#d68910;font-size:1.5em}.notice-text p{margin:8px 0;color:#666;line-height:1.6}.notice-text #scheduledTime{font-weight:700;color:#d68910}.article{max-width:900px;margin:0 auto;display:none}.article.active{display:block;animation:fadeIn .5s ease}.article-header{margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid var(--primary-color)}.article-title{font-size:2.5em;color:var(--text-dark);margin-bottom:15px;font-weight:700;line-height:1.2}.article-meta{display:flex;flex-wrap:wrap;gap:15px;color:var(--text-light);font-size:.95em}.article-meta .meta-item{display:flex;align-items:center;gap:5px}.article-meta .meta-item i{font-size:.9em}.article-category{background-color:rgba(0,184,148,.1);color:var(--secondary-color);padding:2px 10px;border-radius:12px;font-size:.85em;font-weight:500;transition:all .2s ease}.article-category:hover{background-color:rgba(0,184,148,.2);transform:translateY(-1px)}.article-tags-inline{display:flex;gap:5px;flex-wrap:wrap}.article-tags-inline .inline-tag{background-color:rgba(108,92,231,.1);color:var(--accent-color);padding:2px 8px;border-radius:10px;font-size:.8em;transition:all .2s ease}.article-tags-inline .inline-tag:hover{background-color:rgba(108,92,231,.2);transform:translateY(-1px)}.article-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:15px}.article-tags .tag{background-color:rgba(0,123,255,.1);color:var(--primary-color);padding:4px 12px;border-radius:20px;font-size:.85em;transition:all .2s ease}.article-tags .tag:hover{background-color:rgba(0,123,255,.2);transform:translateY(-2px)}.article-content{line-height:1.7;color:var(--text-dark);font-size:1.05em}.article-content h1{font-size:2em;margin:30px 0 15px;padding-bottom:10px;border-bottom:2px solid var(--primary-color);color:var(--text-dark)}.article-content h2{font-size:1.8em;margin:30px 0 15px;padding-bottom:10px;border-bottom:1px solid var(--border-color);color:var(--text-dark)}.article-content h3{font-size:1.4em;margin:25px 0 12px;color:var(--text-dark)}.article-content h4{font-size:1.2em;margin:20px 0 10px;color:var(--text-dark);font-weight:600}.article-content h5{font-size:1.1em;margin:18px 0 8px;color:var(--text-dark);font-weight:600}.article-content h6{font-size:1em;margin:15px 0 8px;color:var(--text-light);font-weight:600;text-transform:uppercase;letter-spacing:.5px}.article-content video{max-width:100%;height:auto;border-radius:8px;margin:20px 0;box-shadow:0 4px 12px rgba(0,0,0,.1)}.article-content iframe{max-width:100%;height:auto;border-radius:8px;margin:20px 0;border:none;box-shadow:0 4px 12px rgba(0,0,0,.1)}.article-content p{margin-bottom:18px}.article-content blockquote{border-left:4px solid var(--primary-color);padding-left:20px;margin:20px 0;font-style:italic;color:var(--text-light)}.article-content pre{background-color:rgba(0,0,0,.05);padding:15px;border-radius:8px;overflow-x:auto;margin:20px 0;font-family:'Courier New',monospace;font-size:.9em;position:relative}.code-block-wrapper{position:relative;margin:20px 0;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px rgba(0,0,0,.12);border:1px solid rgba(0,0,0,.1)}.code-block-toolbar{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:10px 16px;background:linear-gradient(180deg,rgba(255,255,255,.98) 0,rgba(245,245,245,.98) 100%);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid rgba(0,0,0,.12)}.code-block-toolbar .code-language{font-size:.75em;color:#1a1a1a;font-weight:700;text-transform:uppercase;letter-spacing:.5px;padding:4px 10px;background-color:rgba(0,0,0,.08);border-radius:6px}.code-block-toolbar .toolbar-actions{display:flex;gap:6px}.code-block-toolbar button{display:flex;align-items:center;gap:5px;padding:6px 12px;background-color:rgba(255,255,255,.95);border:1px solid rgba(0,0,0,.15);border-radius:6px;font-size:.75em;font-weight:600;color:#1a1a1a;cursor:pointer;transition:all .2s cubic-bezier(.4, 0, .2, 1);box-shadow:0 2px 4px rgba(0,0,0,.08)}.code-block-toolbar button:hover{background-color:#007aff;color:#fff;border-color:#007aff;transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,122,255,.35)}.code-block-toolbar button:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,122,255,.25)}.code-block-toolbar button svg{width:13px;height:13px}.code-block-wrapper pre{margin:0;border-radius:0 0 12px 12px;background-color:#fff8e7;border:none;padding:16px;display:flex;align-items:flex-start}.code-block-wrapper pre code{background-color:transparent;padding:0;font-family:-apple-system,BlinkMacSystemFont,'SF Mono',Monaco,'Courier New',monospace;font-size:.9em;line-height:1.6;color:#2d2d2d;font-weight:500;flex:1;margin-left:16px}.code-line-numbers{display:flex;flex-direction:column;align-items:flex-end;padding-right:12px;user-select:none;color:#999;font-size:.85em;line-height:1.6;min-width:30px}.code-line-numbers span{display:block}.copy-toast{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:rgba(0,0,0,.75);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);color:#fff;padding:10px 20px;border-radius:8px;font-size:.85em;font-weight:500;opacity:0;pointer-events:none;transition:opacity .3s cubic-bezier(.4, 0, .2, 1);z-index:10;box-shadow:0 4px 12px rgba(0,0,0,.15)}.copy-toast.show{opacity:1}.code-viewer{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:10000;padding:0;box-sizing:border-box;overflow:hidden}.code-viewer.active{display:flex;flex-direction:column}.code-viewer-header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:linear-gradient(180deg,rgba(255,255,255,.15) 0,rgba(255,255,255,.1) 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.15)}.code-viewer-title{color:#fff;font-size:1em;font-weight:700;letter-spacing:.3px}.code-viewer-close,.code-viewer-copy{display:flex;align-items:center;gap:8px;padding:8px 16px;background-color:rgba(255,255,255,.2);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.3);border-radius:8px;color:#fff;font-size:.85em;font-weight:600;cursor:pointer;transition:all .2s cubic-bezier(.4, 0, .2, 1)}.code-viewer-close:hover,.code-viewer-copy:hover{background-color:rgba(255,255,255,.3);border-color:rgba(255,255,255,.4);transform:scale(1.02)}.code-viewer-close:active,.code-viewer-copy:active{transform:scale(.98)}.code-viewer-close svg,.code-viewer-copy svg{width:14px;height:14px}.code-viewer-content{flex:1;overflow:auto;padding:24px;background-color:#fff8e7}.code-viewer-content pre{margin:0;padding:0;background-color:transparent;border-radius:0;font-size:1em;line-height:1.7}.code-viewer-content code{background-color:transparent;padding:0;color:#2d2d2d;font-family:-apple-system,BlinkMacSystemFont,'SF Mono',Monaco,'Courier New',monospace;font-weight:500}.code-viewer-toast{position:fixed;bottom:40px;left:50%;transform:translateX(-50%) translateY(100px);background:rgba(0,0,0,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);color:#fff;padding:16px 32px;border-radius:12px;font-size:.9em;font-weight:500;opacity:0;transition:all .4s cubic-bezier(.175, .885, .32, 1.275);z-index:10001;box-shadow:0 10px 30px rgba(0,0,0,.3);pointer-events:none}.code-viewer-toast.show{transform:translateX(-50%) translateY(0);opacity:1}.article-content code{background-color:rgba(0,0,0,.05);padding:2px 6px;border-radius:4px;font-family:'Courier New',monospace;font-size:.9em}.article-content ol,.article-content ul{margin-left:20px;margin-bottom:18px}.article-content li{margin-bottom:8px}.article-content table{width:auto;max-width:100%;border-collapse:collapse;margin:20px 0;font-size:.95em;border:1px solid rgba(255,255,255,.3);border-radius:8px;overflow:hidden}.article-content thead{background:linear-gradient(180deg,rgba(0,0,0,.05) 0,rgba(0,0,0,.03) 100%)}.article-content th{padding:12px 16px;text-align:left;font-weight:600;color:var(--text-dark);border-bottom:2px solid rgba(255,255,255,.4);border-right:1px solid rgba(255,255,255,.2)}.article-content th:last-child{border-right:none}.article-content td{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.2);border-right:1px solid rgba(255,255,255,.15);color:var(--text-dark)}.article-content td:last-child{border-right:none}.article-content tr:hover{background-color:rgba(0,0,0,.03)}.article-content tr:last-child td{border-bottom:none}html.dark-mode .article-content table{border-color:rgba(255,255,255,.15)}html.dark-mode .article-content thead{background:linear-gradient(180deg,rgba(255,255,255,.08) 0,rgba(255,255,255,.05) 100%)}html.dark-mode .article-content th{border-bottom-color:rgba(255,255,255,.2);border-right-color:rgba(255,255,255,.1);color:#e0e0e0}html.dark-mode .article-content td{border-bottom-color:rgba(255,255,255,.1);border-right-color:rgba(255,255,255,.08);color:#d0d0d0}html.dark-mode .article-content tr:hover{background-color:rgba(255,255,255,.05)}.article-content img{max-width:100%;height:auto;border-radius:8px;margin:20px 0;box-shadow:0 4px 12px rgba(0,0,0,.1);cursor:zoom-in;transition:transform .2s ease}.article-content img:hover{transform:scale(1.02)}.image-viewer{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.95);z-index:2000;justify-content:center;align-items:center;animation:fadeIn .3s ease}.image-viewer.active{display:flex}.image-viewer img{max-width:90%;max-height:90%;object-fit:contain;cursor:zoom-out;border-radius:4px;box-shadow:0 0 50px rgba(0,0,0,.5)}.image-viewer-close{position:absolute;top:20px;right:30px;color:#fff;font-size:40px;cursor:pointer;transition:all .2s ease;z-index:2001;width:50px;height:50px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:rgba(255,255,255,.1)}.image-viewer-close:hover{background:rgba(255,255,255,.2);transform:rotate(90deg)}.comments-section{margin-top:40px;padding-top:30px;border-top:2px solid var(--border-color)}.attachments-section{margin-top:30px;padding:20px;background-color:rgba(255,255,255,.5);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px}.attachments-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.attachments-header h3{font-size:1.3em;color:var(--text-dark);font-weight:600;display:flex;align-items:center;gap:8px}.attachments-count{color:var(--text-light);font-size:.9em}.attachments-list{display:flex;flex-direction:column;gap:12px}.attachment-item{display:flex;align-items:center;padding:12px 16px;background-color:rgba(255,255,255,.6);backdrop-filter:blur(10px) saturate(150%);-webkit-backdrop-filter:blur(10px) saturate(150%);border:1px solid rgba(255,255,255,.3);border-radius:8px;transition:all .3s ease;cursor:pointer;text-decoration:none;color:var(--text-dark)}.attachment-item:hover{background-color:rgba(255,255,255,.8);border-color:var(--primary-color);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,123,255,.15)}.attachment-item:active{transform:translateY(0)}.attachment-icon{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;margin-right:12px;flex-shrink:0;font-size:20px}.attachment-icon.image{background-color:rgba(0,123,255,.1);color:var(--primary-color)}.attachment-icon.video{background-color:rgba(220,53,69,.1);color:#dc3545}.attachment-icon.document{background-color:rgba(255,193,7,.1);color:#ffc107}.attachment-icon.audio{background-color:rgba(108,92,231,.1);color:var(--accent-color)}.attachment-icon.archive{background-color:rgba(40,167,69,.1);color:#28a745}.attachment-icon.default{background-color:rgba(108,117,125,.1);color:#6c757d}.attachment-info{flex:1;min-width:0}.attachment-name{font-weight:500;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.attachment-meta{display:flex;align-items:center;gap:12px;font-size:.85em;color:var(--text-light)}.attachment-size{display:flex;align-items:center;gap:4px}.attachment-type{display:flex;align-items:center;gap:4px}.attachment-download{width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;background-color:rgba(0,123,255,.1);color:var(--primary-color);transition:all .2s ease;flex-shrink:0}.attachment-item:hover .attachment-download{background-color:var(--primary-color);color:#fff}.empty-attachments{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px;color:var(--text-light);text-align:center}.empty-attachments svg{margin-bottom:12px;opacity:.5}.empty-attachments p{font-size:.95em}.comments-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}.comments-header h3{font-size:1.5em;color:var(--text-dark);font-weight:600}.comments-count{color:var(--text-light);font-size:.95em}.github-comment-form{display:flex;gap:12px;margin-top:20px;padding:20px;background-color:rgba(255,255,255,.5);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px}.comment-user-avatar{flex-shrink:0;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-top:4px;overflow:hidden}.comment-input-wrapper{flex:1;display:flex;flex-direction:column;gap:12px}.comment-username-input{width:100%;padding:10px 14px;border:1px solid #d0d7de;border-radius:6px;font-size:14px;background-color:rgba(255,255,255,.9);transition:all .2s ease;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif}.comment-username-input:focus{outline:0;border-color:#0969da;box-shadow:0 0 0 3px rgba(9,105,218,.1)}.comment-textarea{width:100%;padding:12px 14px;border:1px solid #d0d7de;border-radius:6px;font-size:14px;background-color:rgba(255,255,255,.9);transition:all .2s ease;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;line-height:1.6;resize:vertical;min-height:100px}.comment-textarea:focus{outline:0;border-color:#0969da;box-shadow:0 0 0 3px rgba(9,105,218,.1)}.comment-actions{display:flex;justify-content:space-between;align-items:center;margin-top:4px}.comment-tips{display:flex;align-items:center;gap:8px;color:#6e7781;font-size:12px}.submit-comment-btn{background:#2da44e;color:#fff;border:none;padding:8px 16px;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s ease;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif}.submit-comment-btn:hover{background:#2c974b}.submit-comment-btn:active{background:#298e46}html.dark-mode .comment-textarea,html.dark-mode .comment-username-input{background-color:rgba(30,30,30,.9);border-color:#30363d;color:#c9d1d9}html.dark-mode .comment-textarea:focus,html.dark-mode .comment-username-input:focus{border-color:#58a6ff;box-shadow:0 0 0 3px rgba(88,166,255,.1)}html.dark-mode .comment-tips{color:#8b949e}html.dark-mode .submit-comment-btn{background:#238636}html.dark-mode .submit-comment-btn:hover{background:#2ea043}@media (max-width:768px){.github-comment-form{flex-direction:column}.comment-user-avatar{width:32px;height:32px}.comment-actions{flex-direction:column;gap:12px;align-items:stretch}.comment-tips{justify-content:center}}.comments-list{display:flex;flex-direction:column;gap:20px}.comment-item{background-color:rgba(255,255,255,.5);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px;padding:20px;transition:all .3s ease;animation:slideIn .3s ease}.comment-item:hover{box-shadow:0 4px 12px rgba(0,0,0,.1)}.comment-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.comment-user{display:flex;align-items:center;gap:10px}.comment-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;overflow:hidden}.comment-username{font-weight:600;color:var(--text-dark)}.comment-date{color:var(--text-light);font-size:.85em}.comment-content{color:var(--text-dark);line-height:1.6;white-space:pre-wrap;word-wrap:break-word}.loading-state{display:flex;align-items:center;justify-content:center;gap:10px;padding:30px;color:var(--text-light)}.spinner{width:24px;height:24px;border:3px solid rgba(0,123,255,.1);border-top-color:var(--primary-color);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.empty-comments{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:var(--text-light);text-align:center}.empty-comments svg{margin-bottom:15px;opacity:.5}.empty-comments p{font-size:1em}body.fullscreen .sidebar{position:fixed;left:0;top:var(--header-height);bottom:0;z-index:100;box-shadow:5px 0 15px rgba(0,0,0,.1)}body.fullscreen .content-area{margin-left:0}@media (max-width:1200px){:root{--sidebar-width:240px}}@media (max-width:992px){.sidebar{position:fixed;left:0;top:var(--header-height);bottom:0;transform:translateX(-100%);z-index:100;box-shadow:5px 0 15px rgba(0,0,0,.1)}.sidebar.open{transform:translateX(0)}.content-area{margin-left:0}.article-title{font-size:2em}}@media (max-width:768px){.article-container{padding:20px}.article-title{font-size:1.8em}.tab{min-width:80px;max-width:120px;padding:0 12px}.tab .tab-title{font-size:.85em;max-width:3em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tab .tab-close{margin-left:5px;width:16px;height:16px}nav{padding:10px 15px}.nav-left a,.nav-right button{font-size:0;margin:0 4px;padding:10px;min-width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%}.nav-left a span:not(.shortcut-hint),.nav-right button span:not(.shortcut-hint){display:none}.shortcuts-help-btn{display:none!important}.shortcut-hint{display:none!important}.nav-left a svg,.nav-right button svg{display:block;font-size:initial}.nav-left a[href="/"]::before{content:'ğŸ ';font-size:18px}.nav-left a[href="/passage"]::before{content:'ğŸ“';font-size:18px}.nav-left a[href="/collect"]::before{content:'ğŸ“';font-size:18px}.nav-left a[href="/about"]::before{content:'â„¹ï¸';font-size:18px}.nav-left a[href="/friends"]::before{content:'ğŸ”—';font-size:18px}.nav-left a[href="/markdown-editor"]::before{content:'âœï¸';font-size:18px}.nav-left a[href="/admin"]::before{content:'âš™ï¸';font-size:18px}.sidebar-toggle{padding:10px;min-width:40px;height:40px;border-radius:50%}.sidebar-toggle svg{display:block}.sidebar-toggle{display:none!important}#articleFilterToggle{display:flex!important}.article-filter-modal .modal-content{background:rgba(30,30,35,.98);max-height:80vh;display:flex;flex-direction:column;transform:translate(30px,30px)}.article-filter-modal.active .modal-content{transform:translate(30px,30px)}.article-filter-modal .modal-body{padding:20px;overflow-y:auto}.article-filter-modal .filter-tabs{display:flex;gap:10px;margin-bottom:15px}.article-filter-modal .filter-tab{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:8px;color:#aaa;font-size:14px;cursor:pointer;transition:all .2s ease}.article-filter-modal .filter-tab.active{background:rgba(89,89,156,.5);border-color:rgba(89,89,156,.8);color:#fff}.article-filter-modal .filter-tab svg{width:16px;height:16px}.article-filter-modal .filter-search{margin-bottom:15px}.article-filter-modal .filter-search input{width:100%;padding:10px 15px;background:rgba(50,50,55,.8);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#f0f0f0;font-size:14px;outline:0;transition:all .2s ease}.article-filter-modal .filter-search input:focus{border-color:rgba(89,89,156,.8);background:rgba(60,60,65,.9)}.article-filter-modal .filter-search input::placeholder{color:#666}.article-filter-modal .filter-content{max-height:300px;overflow-y:auto}.article-filter-modal .filter-content::-webkit-scrollbar{width:6px}.article-filter-modal .filter-content::-webkit-scrollbar-track{background:rgba(50,50,55,.5);border-radius:3px}.article-filter-modal .filter-content::-webkit-scrollbar-thumb{background:rgba(89,89,156,.5);border-radius:3px}.article-filter-modal .filter-content::-webkit-scrollbar-thumb:hover{background:rgba(89,89,156,.7)}.article-filter-item{display:flex;align-items:center;padding:12px 15px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:8px;margin-bottom:8px;cursor:pointer;transition:all .2s ease}.article-filter-item:hover{background:rgba(255,255,255,.1);transform:translateX(5px)}.article-filter-item.active{background:rgba(89,89,156,.3);border-color:rgba(89,89,156,.6)}.article-filter-item-icon{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(89,89,156,.3);border-radius:6px;margin-right:12px;font-size:16px}.article-filter-item-info{flex:1}.article-filter-item-title{color:#f0f0f0;font-size:14px;font-weight:500;margin-bottom:4px}.article-filter-item-meta{color:#888;font-size:12px}.filter-empty{text-align:center;padding:40px 20px;color:#666;font-size:14px}.modal-overlay{display:block;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:1999;opacity:0;pointer-events:none;transition:opacity .3s ease}.modal-overlay.active{opacity:1;pointer-events:auto}#articleFilterToggle{display:none}.article-filter-modal,.modal-overlay{display:none}.article-filter-modal.active,.modal-overlay.active{display:flex}}.tab .tab-title{font-size:.9em}.toolbar button{background:0 0;border:1px solid var(--border-color);border-radius:4px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-light);transition:all .2s ease}.toolbar button:hover{background-color:rgba(0,0,0,.05);color:var(--primary-color)}.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--text-light);text-align:center;padding:40px}.empty-state i{font-size:3em;margin-bottom:20px;opacity:.5}.empty-state h3{font-size:1.5em;margin-bottom:10px;color:var(--text-dark)}.resizer{width:5px;background-color:transparent;cursor:col-resize;transition:background-color .2s ease;z-index:20;position:relative}.resizer.active,.resizer:hover{background-color:var(--primary-color)}#readingModeToggle:hover{background:rgba(0,0,0,0);transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.2)}#readingModeToggle:active{transform:translateY(0)}@media (prefers-color-scheme:dark){:root{--bg-light:rgba(30, 30, 35, 0.85);--text-dark:#f0f0f0;--text-light:#aaa;--border-color:rgba(255, 255, 255, 0.1)}body::before{background:rgba(0,0,0,.3)}nav{background-color:rgba(30,30,35,.95)}nav a{color:#f0f0f0}.tab-bar{background-color:rgba(30,30,35,.9)}.tab.active{background-color:rgba(40,40,45,.95)}.article-container{background-color:rgba(30,30,35,.85)}.file-tree .file-item:hover{background-color:rgba(255,255,255,.05)}.file-tree .folder>.folder-header:hover{background-color:rgba(255,255,255,.05)}.comment-form{background-color:rgba(40,40,45,.8);border-color:rgba(255,255,255,.1)}.comment-form label{color:#f0f0f0}.comment-form .form-input,.comment-form .form-textarea{background-color:rgba(50,50,55,.8);border-color:rgba(255,255,255,.1);color:#f0f0f0}.comment-form .form-input:focus,.comment-form .form-textarea:focus{background-color:rgba(60,60,65,.9);border-color:var(--primary-color)}.comment-item{background-color:rgba(40,40,45,.8);border-color:rgba(255,255,255,.1)}.comment-username{color:#f0f0f0}.comment-content{color:#e0e0e0}.comments-header h3{color:#f0f0f0}.comments-count{color:#aaa}}.admin-only{display:none!important}body.focus-mode .sidebar{box-shadow:0 0 0 3px var(--primary-color)}body.focus-mode .content-area{box-shadow:0 0 0 3px var(--primary-color)}body.focus-mode-left .sidebar{box-shadow:0 0 0 3px var(--primary-color)}body.focus-mode-left .content-area{box-shadow:none}body.focus-mode-right .content-area{box-shadow:0 0 0 3px var(--primary-color)}body.focus-mode-right .sidebar{box-shadow:none}.focus-selected{border:2px solid var(--primary-color)!important;border-radius:6px!important;background-color:rgba(0,123,255,.1)!important}.focus-mode-toast{position:fixed;top:80px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.85);color:#fff;padding:12px 24px;border-radius:8px;font-size:.95em;z-index:10001;opacity:0;transition:opacity .3s ease;box-shadow:0 4px 12px rgba(0,0,0,.2)}.focus-mode-toast.show{opacity:1}.toast-container{position:fixed;top:20px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;max-width:400px;width:100%}.toast{background:rgba(255,255,255,.95);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px;padding:16px 20px;box-shadow:0 8px 32px rgba(0,0,0,.15);display:flex;align-items:center;gap:12px;animation:slideIn .3s ease,fadeOut .3s ease 2.7s forwards;min-width:280px;max-width:100%}.toast.success{border-left:4px solid #10b981}.toast.error{border-left:4px solid #ef4444}.toast.warning{border-left:4px solid #f59e0b}.toast-icon{font-size:24px;flex-shrink:0;width:28px;height:28px;display:flex;align-items:center;justify-content:center}.toast-message{flex:1;color:#1f2937;font-size:14px;line-height:1.4;word-wrap:break-word}.toast-close{background:0 0;border:none;color:#9ca3af;cursor:pointer;font-size:18px;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:color .2s ease;flex-shrink:0}.toast-close:hover{color:#4b5563}@media (max-width:768px){.toast-container{top:10px;right:10px;left:10px;max-width:none}.toast{padding:14px 16px;min-width:auto}.toast-message{font-size:13px}}.katex-display{overflow-x:auto;overflow-y:hidden;padding:10px 0}.katex{font-size:1.1em}.article-content .katex-display{margin:20px 0}.mermaid{margin:20px 0;text-align:center;background-color:rgba(26,26,46,.95);border-radius:12px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.15);border:1px solid rgba(89,89,156,.4)}.mermaid svg{max-width:100%;height:auto}.mermaid .label,.mermaid .nodeLabel{fill:#808080!important}.mermaid foreignObject .nodeLabel,.mermaid foreignObject div,.mermaid foreignObject span{color:grey!important}.mermaid text:not(.nodeLabel):not(.label){fill:#808080!important}.mermaid .node circle,.mermaid .node path,.mermaid .node polygon,.mermaid .node rect{fill:#f5f5dc!important;stroke:#7aa2f7!important;stroke-width:2px!important}.mermaid .edgePath path{stroke:#7aa2f7!important;stroke-width:2px!important}.mermaid .arrowheadPath{fill:#7aa2f7!important}</style><link rel="stylesheet" href="/css/dark-mode.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/glass-effect.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/modal-animations.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/keyboard-shortcuts.css" media="print" onload='this.media="all"'><div class="toast-container" id="toastContainer"></div><nav><div class="nav-left"><button id="articleFilterToggle" aria-label="æ‰“å¼€æ–‡ç« ç­›é€‰" style="display:none;align-items:center;justify-content:center;width:40px;height:40px;padding:8px;background:rgba(255,255,255,.1);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);border:1px solid rgba(255,255,255,.3);border-radius:8px;cursor:pointer;transition:all .3s ease;color:var(--navbar-text-color,rgba(255,255,255,.9));margin-right:4px"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button> <button id="sidebarToggle" class="sidebar-toggle" aria-label="åˆ‡æ¢ä¾§è¾¹æ "><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button> <a href="/">ä¸»é¡µ</a> <a href="/passage" class="current">æ–‡ç« </a> <a href="/collect">å½’æ¡£</a> <a href="/about">å…³äº</a> <a href="/friends">å‹é“¾<span class="shortcut-hint">f</span></a> <a href="/markdown-editor">ç¼–è¾‘å™¨<span class="shortcut-hint">6</span></a> <a href="/admin" class="admin-only">ç®¡ç†å‘˜è®¾ç½®</a></div><div class="nav-right"><button id="readingModeToggle" aria-label="åˆ‡æ¢é˜…è¯»æ¨¡å¼" style="display:flex;align-items:center;gap:8px;color:var(--navbar-text-color,rgba(255,255,255,.9));font-weight:500;transition:all .3s ease;padding:8px 16px;background:rgba(255,255,255,.1);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);border-radius:25px;border:1px solid rgba(255,255,255,.3);cursor:pointer;text-shadow:0 2px 4px rgba(0,0,0,.1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> <span id="readingModeText">æ—¶é—´æˆ³</span></button></div></nav><div class="modal article-filter-modal" id="articleFilterModal"><div class="modal-content"><div class="modal-header"><h3>æ–‡ç« ç´¢å¼•</h3><button class="modal-close" data-modal="articleFilterModal"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div><div class="modal-body"><div class="filter-tabs"><button class="filter-tab active" data-mode="timestamp"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> æ–‡ç« ç´¢å¼•</button> <button class="filter-tab" data-mode="outline"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg> æœ¬æ–‡ç›®å½•</button></div><div class="filter-search"><input id="articleFilterSearch" placeholder="æœç´¢æ–‡ç« ..."></div><div class="filter-content" id="filterContent"></div></div></div></div><main class="main-container" role="main"><div class="sidebar" id="sidebar"><div class="sidebar-header"><h2 id="sidebarTitle">æ–‡ç« ç´¢å¼•</h2><div class="sidebar-controls" id="fileTreeControls"><button id="collapseAll" title="å…¨éƒ¨æŠ˜å "><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg></button> <button id="expandAll" title="å…¨éƒ¨å±•å¼€"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button></div></div><div class="file-tree" id="fileTree"></div><div class="toc-container" id="tocContainer"></div></div><div class="resizer" id="resizer"></div><div class="content-area"><div class="tab-bar" id="tabBar"></div><div class="article-container" id="articleContainer">{% if is_unpublished %}<div class="unpublished-notice" id="unpublishedNotice" style="display:block"><div class="notice-content"><div class="notice-icon">ğŸ”’</div><div class="notice-text"><h3>æ–‡ç« å°šæœªå‘å¸ƒ</h3>{% if passage_status == "draft" %}<p>æ­¤æ–‡ç« æ˜¯è‰ç¨¿ï¼Œæ­£åœ¨ç¼–è¾‘ä¸­ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚</p>{% elif passage_status == "pending" %}<p>æ­¤æ–‡ç« æ­£åœ¨ç­‰å¾…å®¡æ ¸ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚</p>{% else %}<p>æ­¤æ–‡ç« å°šæœªå‘å¸ƒï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚</p>{% endif %} {% if is_scheduled %}<p>é¢„è®¡å‘å¸ƒæ—¶é—´ï¼š<span id="scheduledTime">{{ published_at }}</span></p>{% endif %}</div></div></div>{% else %}<div class="unpublished-notice" id="unpublishedNotice" style="display:none"><div class="notice-content"><div class="notice-icon">ğŸ”’</div><div class="notice-text"><h3>æ–‡ç« å°šæœªå‘å¸ƒ</h3><p id="unpublishedMessage">æ­¤æ–‡ç« æ­£åœ¨ç¼–è¾‘ä¸­ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚<p id="scheduledMessage" style="display:none">é¢„è®¡å‘å¸ƒæ—¶é—´ï¼š<span id="scheduledTime"></span></div></div></div>{% endif %} {% if content %}<div class="article active" id="articleContent" {% if is_unpublished %} style="display:none" {% endif %}><div class="article-header"><div class="article-meta"><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <span class="article-date">{{ date }}</span></div><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg> <span class="article-category" id="articleCategory">åŠ è½½ä¸­...</span></div><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg> <span class="article-tags-inline" id="articleTagsInline">åŠ è½½ä¸­...</span></div><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg> <span class="article-readtime" id="articleReadTime">é¢„è®¡ {{ read_time }} åˆ†é’Ÿè¯»å®Œ</span></div></div></div><div class="article-content">{{ content }}</div><div class="attachments-section" id="attachmentsSection" style="display:none"><div class="attachments-header"><h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> é™„ä»¶</h3><span class="attachments-count" id="attachmentsCount">0 ä¸ªé™„ä»¶</span></div><div class="attachments-list" id="attachmentsList"><div class="loading-state" id="attachmentsLoading" style="display:none"><div class="spinner"></div><span>åŠ è½½é™„ä»¶ä¸­...</span></div><div class="empty-attachments" id="emptyAttachments" style="display:none"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg><p>æš‚æ— é™„ä»¶</div></div></div>{% if sponsor_enabled %}<div class="sponsor-section"><div class="sponsor-card"><div class="sponsor-header"><div class="sponsor-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div><div class="sponsor-title"><h3>æ„Ÿè°¢æ‚¨çš„æ”¯æŒ</h3><p>{{ sponsor_description }}</div></div><div class="sponsor-options"><button class="sponsor-option-btn" data-amount="5"><span class="amount">Â¥5</span> <span class="label">å’–å•¡</span></button> <button class="sponsor-option-btn" data-amount="10"><span class="amount">Â¥10</span> <span class="label">å¥¶èŒ¶</span></button> <button class="sponsor-option-btn" data-amount="20"><span class="amount">Â¥20</span> <span class="label">åˆé¤</span></button> <button class="sponsor-option-btn custom-amount"><span class="amount">è‡ªå®šä¹‰</span></button></div><button class="sponsor-submit-btn" id="sponsorSubmitBtn">æ”¯æŒä½œè€…</button></div></div>{% endif %}<div class="comments-section" id="commentsSection" {% if is_unpublished %} style="display:none" {% endif %}><div class="comments-header"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> è¯„è®º</h3><span class="comments-count" id="commentsCount">0 æ¡è¯„è®º</span></div><div class="github-comment-form"><div class="comment-user-avatar"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div><div class="comment-input-wrapper"><input id="commentUsername" class="comment-username-input" placeholder="ç”¨æˆ·å" required> <textarea id="commentContent" class="comment-textarea" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." rows="3" required></textarea><div class="comment-actions"><div class="comment-tips"><span class="tip">æ”¯æŒ Markdown è¯­æ³•</span> <span class="tip">â€¢</span> <span class="tip">Ctrl+Enter æäº¤</span></div><button type="button" class="submit-comment-btn" id="submitCommentBtn">å‘è¡¨è¯„è®º</button></div></div></div><div class="comments-list" id="commentsList"></div><div class="loading-state" id="commentsLoading" style="display:none"><div class="spinner"></div><span>åŠ è½½è¯„è®ºä¸­...</span></div><div class="empty-comments" id="emptyComments" style="display:none"><svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg><p>è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</div></div></div>{% else %}<div class="empty-state" id="emptyState"><svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg><h3>é€‰æ‹©æ–‡ç« å¼€å§‹é˜…è¯»</h3><p>ä»å·¦ä¾§æ–‡ä»¶æ ‘ä¸­é€‰æ‹©ä¸€ç¯‡æ–‡ç« ï¼Œæˆ–åŒå‡»æ–‡ç« ä»¥åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€</div>{% endif %}<div class="article" id="articleTemplate" style="display:none"><div class="article-header"><h1 class="article-title">æ–‡ç« æ ‡é¢˜</h1><div class="article-meta"><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <span class="article-date">2024-01-01</span></div><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg> <span class="article-category">æœªåˆ†ç±»</span></div><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg> <span class="article-tags-inline">æ— æ ‡ç­¾</span></div><div class="meta-item"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg> <span class="article-readtime">é¢„è®¡ 10 åˆ†é’Ÿè¯»å®Œ</span></div></div><div class="article-tags"></div></div><div class="article-content"></div><div class="attachments-section attachments-section-template" style="display:none"><div class="attachments-header"><h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg> é™„ä»¶</h3><span class="attachments-count" id="attachmentsCount">0 ä¸ªé™„ä»¶</span></div><div class="attachments-list" id="attachmentsList"><div class="loading-state" id="attachmentsLoading" style="display:none"><div class="spinner"></div><span>åŠ è½½é™„ä»¶ä¸­...</span></div><div class="empty-attachments" id="emptyAttachments" style="display:none"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg><p>æš‚æ— é™„ä»¶</div></div></div><div class="sponsor-section sponsor-section-template" style="display:none"><button class="sponsor-btn" id="sponsorBtn">{{ sponsor_button_text }}</button></div><div class="article-comments" data-article-id=""><div class="comments-section"><div class="comments-header"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> è¯„è®º</h3><span class="comments-count">0 æ¡è¯„è®º</span></div><div class="github-comment-form"><div class="comment-user-avatar"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div><div class="comment-input-wrapper"><input class="comment-username-input" placeholder="ç”¨æˆ·å" required> <textarea class="comment-textarea" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." rows="3" required></textarea><div class="comment-actions"><div class="comment-tips"><span class="tip">æ”¯æŒ Markdown è¯­æ³•</span> <span class="tip">â€¢</span> <span class="tip">Ctrl+Enter æäº¤</span></div><button type="button" class="submit-comment-btn">å‘è¡¨è¯„è®º</button></div></div></div><div class="comments-list"></div><div class="loading-state" style="display:none"><div class="spinner"></div><span>åŠ è½½è¯„è®ºä¸­...</span></div><div class="empty-comments" style="display:none"><svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg><p>è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</div></div></div></div></div></div></main><footer style="text-align:center;padding:12px 20px;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-top:1px solid rgba(255,255,255,.2);margin-top:auto;position:relative;z-index:1;color:rgba(255,255,255,.9);font-size:.9em"><div style="margin-bottom:4px">&copy; {{ year }} {{ foodes }}</div>{% if beian_enabled %}<div style="font-size:.85em">{% if icp_number %}<a href="http://beian.miit.gov.cn/" target="_blank" style="color:inherit;text-decoration:none">{{ icp_number }}</a>{% endif %} {% if police_record_code %}<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode={{ police_record_code }}" target="_blank" style="color:inherit;text-decoration:none;margin-left:8px">{{ police_record_content }}</a>{% endif %}</div>{% endif %}</footer><div class="toolbar" id="toolbar" style="position:fixed;bottom:20px;right:20px;z-index:9999;pointer-events:auto"><button id="fullscreenToggle" title="åˆ‡æ¢å…¨å±"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg></button> <button id="sidebarToggleFixed" title="åˆ‡æ¢å¯¼èˆªæ "><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div><script src="/js/npm/katex-0.16.27/dist/katex.min.js" defer></script><script src="/js/npm/katex-0.16.27/dist/contrib/auto-render.min.js" defer></script><script src="/js/npm/mermaid@11.12.2/dist/mermaid.min.js" defer></script><script>async function renderMathAndDiagrams(e){if(!e)return;e.querySelectorAll("pre code").forEach((e,t)=>{if(e.classList.contains("language-mermaid")||e.className.includes("mermaid")){const t=e.parentElement,n=document.createElement("div");n.className="mermaid";let a=e.textContent.trim();a.startsWith("mermaid")&&(a=a.replace(/^mermaid\n?/,"")),n.textContent=a,t.replaceWith(n)}});e.querySelectorAll("p").forEach(e=>{e.innerHTML=e.innerHTML.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}),renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1,strict:!1});const t=e.querySelectorAll(".mermaid");if(t.length>0)try{if("undefined"==typeof mermaid)return console.warn("Mermaid å°šæœªåŠ è½½ï¼Œè·³è¿‡æ¸²æŸ“"),void t.forEach(e=>{e.innerHTML='<div style="color: #666; padding: 10px;">æµç¨‹å›¾åŠ è½½ä¸­...</div>'});await mermaid.run({nodes:[...t]}),fixMermaidTextColor()}catch(e){console.error("Mermaid æ¸²æŸ“å¤±è´¥:",e),t.forEach(t=>{t.innerHTML=`<div style="color: red; padding: 10px;">æµç¨‹å›¾æ¸²æŸ“å¤±è´¥: ${e.message}</div>`})}}function fixMermaidTextColor(){document.querySelectorAll(".mermaid").forEach(e=>{e.querySelectorAll("foreignObject").forEach(e=>{e.querySelectorAll("span.nodeLabel").forEach(e=>{e.style.color="#808080",e.style.fill="#808080"})});e.querySelectorAll("text.nodeLabel, text.label").forEach(e=>{e.setAttribute("fill","#808080"),e.style.fill="#808080"})})}document.addEventListener("DOMContentLoaded",function(){const e=setInterval(()=>{"undefined"!=typeof mermaid&&(clearInterval(e),mermaid.initialize({startOnLoad:!1,theme:"base",themeVariables:{primaryColor:"#f5f5dc",primaryTextColor:"#808080",primaryBorderColor:"#7aa2f7",lineColor:"#7aa2f7",secondaryColor:"#ebebd0",tertiaryColor:"#e0e0c0",background:"#1a1b26",mainBkg:"#f5f5dc",nodeBorder:"#7aa2f7",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif',fontSize:"14px",tertiaryBorderColor:"#7aa2f7",arrowheadColor:"#7aa2f7",flowchartNodeBkg:"#f5f5dc",flowchartNodeBorder:"#7aa2f7",flowchartNodeText:"#808080",flowchartLinkColor:"#7aa2f7",actorBkg:"#f5f5dc",actorBorder:"#7aa2f7",actorTextColor:"#808080",actorLineColor:"#7aa2f7",signalColor:"#7aa2f7",signalTextColor:"#808080",labelBoxBkgColor:"#f5f5dc",labelBoxBorderColor:"#7aa2f7",labelTextColor:"#808080",classText:"#808080",classBorderColor:"#7aa2f7",classBkg:"#f5f5dc",stateBkg:"#f5f5dc",stateBorder:"#7aa2f7",stateLabelColor:"#808080",entityBkg:"#f5f5dc",entityBorder:"#7aa2f7",entityTextColor:"#808080",sectionBkgColor:"#f5f5dc",altSectionBkgColor:"#ebebd0",gridColor:"#7aa2f7",taskBorderColor:"#7aa2f7",taskBkgColor:"#f5f5dc",taskTextColor:"#808080"},securityLevel:"loose"}))},100)});let articlesData={folders:[]};async function initApp(){const e=window.location.pathname.split("/");if(6===e.length&&"passage"===e[1]?await loadCurrentArticleFromPath():3!==e.length||"passage"!==e[1]||isNaN(e[2])||(currentPassageID=parseInt(e[2])),await fetchArticlesData(),setupEventListeners(),window.location.hash){const e=window.location.hash.substring(1).split(",");for(const t of e){const e=decodeURIComponent(t.trim());if(e){const t=findArticleByTitle(e);t?await openArticle(t.id):console.warn("æœªæ‰¾åˆ°æ–‡ç« :",e)}}}else if(currentPassageID){const e=`article-${currentPassageID}`;findArticleById(e)?openArticle(e):console.warn("æœªæ‰¾åˆ°æ–‡ç« :",currentPassageID)}updateUI(),initComments()}function findArticleByTitle(e){console.log("æŸ¥æ‰¾æ–‡ç« ï¼Œè¾“å…¥æ ‡é¢˜:",e),console.log("å½“å‰æ–‡ç« æ•°æ®:",articlesData);const t=e=>e.toLowerCase().trim().replace(/\s+/g," ").replace(/[\/\?#\[\]@!$&'()*+,;=]/g,""),n=t(e);console.log("æ ‡å‡†åŒ–åçš„è¾“å…¥æ ‡é¢˜:",n);const a=function a(l){if(!l||0===l.length)return null;for(const o of l){if(console.log("æ£€æŸ¥æ–‡ä»¶å¤¹:",o.name),o.files&&o.files.length>0){console.log("  æ–‡ä»¶å¤¹ä¸­çš„æ–‡ç« :",o.files.map(e=>e.title));let a=o.files.find(t=>t.title===e);if(a?console.log("  é€šè¿‡ç²¾ç¡®åŒ¹é…æ‰¾åˆ°:",a.title):(a=o.files.find(e=>t(e.title)===n),a&&console.log("  é€šè¿‡æ ‡å‡†åŒ–åŒ¹é…æ‰¾åˆ°:",a.title)),a)return a}if(o.subfolders){const e=a(Object.values(o.subfolders));if(e)return e}}return null}(articlesData.folders||Object.values(articlesData));return console.log("æŸ¥æ‰¾ç»“æœ:",a),a}async function loadCurrentArticleFromPath(){try{const e=window.location.pathname.split("/"),t=decodeURIComponent(e[4]),n=await fetch("/api/passages"),a=await n.json();if(a.success&&a.data){const e=e=>e.toLowerCase().replace(/\s+/g,"-").replace(/[\/\?#\[\]@!$&'()*+,;=]/g,"").replace(/-+/g,"-"),n=a.data.find(n=>e(n.title)===e(t));if(n){currentPassageID=n.id;const e=await fetch(`/api/passages/${n.id}`),t=await e.json();if(t.success&&t.data){const e=t.data.html_content||t.data.content;renderArticle({id:`article-${n.id}`,title:n.title,date:n.created_at||"2024-01-01",readtime:"5åˆ†é’Ÿ",tags:n.tags||"[]",category:n.category||"æœªåˆ†ç±»",content:e||"",show_title:!0,status:n.status||"published",isScheduled:n.is_scheduled||!1,publishedAt:n.published_at||null}),appState.activeArticleId=`article-${n.id}`,appState.openTabs.includes(`article-${n.id}`)||appState.openTabs.push(`article-${n.id}`)}else console.error("è·å–æ–‡ç« è¯¦æƒ…å¤±è´¥:",t.message);appState.activeArticleId=`article-${n.id}`,appState.openTabs.includes(`article-${n.id}`)||appState.openTabs.push(`article-${n.id}`)}else console.warn("æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡ç« :",t)}}catch(e){console.error("åŠ è½½å½“å‰æ–‡ç« å¤±è´¥:",e)}}let currentPage=1;const pageSize=10;let hasMoreArticles=!0,isLoadingArticles=!1;const articleContentCache=new Map,commentsLoadedCache=new Set;async function fetchArticlesData(){if(!isLoadingArticles&&hasMoreArticles)try{isLoadingArticles=!0;const e=await fetch(`/api/passages?page=${currentPage}&limit=${pageSize}`),t=await e.json();if(t.success&&t.data){if(1===currentPage)articlesData=organizeArticlesByFolder(t.data),renderFileTree();else{const e=organizeArticlesByFolder(t.data);articlesData=mergeArticlesData(articlesData,e),renderFileTree()}t.pagination&&(hasMoreArticles=t.pagination.has_more),currentPage++}}catch(e){console.error("è·å–æ–‡ç« æ•°æ®å¤±è´¥:",e),1===currentPage&&(articlesData=getDefaultArticlesData(),renderFileTree())}finally{isLoadingArticles=!1}}function mergeArticlesData(e,t){return organizeArticlesByFolder([...getAllArticlesFromData(e),...getAllArticlesFromData(t)])}function getAllArticlesFromData(e){const t=[];return Object.values(e).forEach(e=>{Object.values(e.subfolders).forEach(e=>{Object.values(e.subfolders).forEach(e=>{e.files&&t.push(...e.files)})})}),t}function setupInfiniteScroll(){const e=document.querySelector(".file-tree");e&&e.addEventListener("scroll",()=>{const t=e.scrollTop,n=e.scrollHeight;t+e.clientHeight>=n-100&&fetchArticlesData()})}function initPagination(){currentPage=1,hasMoreArticles=!0,isLoadingArticles=!1,articleContentCache.clear(),fetchArticlesData(),setupInfiniteScroll(),setInterval(()=>{clearExpiredCache(18e5)},3e5)}function organizeArticlesByFolder(e){const t={};e.forEach(e=>{const n=e.created_at.split(" ")[0].split("-"),a=n[0],l=n[1],o=n[2];t[a]||(t[a]={name:`${a}å¹´`,id:`year-${a}`,open:!0,subfolders:{}});const i=`${a}-${l}`;t[a].subfolders[i]||(t[a].subfolders[i]={name:`${l}æœˆ`,id:i,open:!0,subfolders:{}});const r=`${a}-${l}-${o}`;t[a].subfolders[i].subfolders[r]||(t[a].subfolders[i].subfolders[r]={name:`${o}æ—¥`,id:r,open:!0,files:[]});const s=`${a}/${l}/${o}/${sanitizeTitle(e.title)}`,c=e.summary||"",d=Math.ceil(c.length/400)||1,u=(e.created_at||"2024-01-01").split(" ")[0];t[a].subfolders[i].subfolders[r].files.push({id:`article-${e.id}`,title:e.title,date:u,readtime:`${d}åˆ†é’Ÿ`,tags:e.tags||[],category:e.category||"æœªåˆ†ç±»",content:"",summary:c,show_title:!0,markdownPath:s,status:e.status||"published",isScheduled:e.is_scheduled||!1,publishedAt:e.published_at||null})});return{folders:Object.values(t).map(e=>(e.subfolders=Object.values(e.subfolders).map(e=>(e.subfolders=Object.values(e.subfolders).map(e=>({name:e.name,id:e.id,open:e.open,files:e.files})),{name:e.name,id:e.id,open:e.open,subfolders:e.subfolders})),e))}}function sanitizeUTF8(e){if(!e)return"";try{const t=new TextEncoder,n=new TextDecoder({fatal:!1}),a=t.encode(e);return n.decode(a)}catch(t){return e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"")}}function sanitizeTitle(e){return e.toLowerCase().replace(/\s+/g,"-").replace(/[\/\?#\[\]@!$&'()*+,;=]/g,"").replace(/-+/g,"-")}function calculateReadTime(e){const t=document.createElement("div");t.innerHTML=e;const n=(t.textContent||t.innerText||"").trim();let a=0;for(let e=0;e<n.length;e++){const t=n[e];(/[\u4e00-\u9fa5]/.test(t)||/\s/.test(t))&&a++}let l=Math.floor(a/200);return 0===l&&(l=1),l}function getDefaultArticlesData(){return{folders:[{name:"æŠ€æœ¯æ–‡ç« ",id:"tech",open:!0,files:[{id:"article-1",title:"å“åº”å¼è®¾è®¡çš„æœ€ä½³å®è·µä¸è¶‹åŠ¿",date:"2024-03-15",author:"å‰ç«¯è®¾è®¡å¸ˆ",readtime:"12åˆ†é’Ÿ",tags:["å‰ç«¯å¼€å‘","CSS","å“åº”å¼è®¾è®¡","ç”¨æˆ·ä½“éªŒ"],category:"æŠ€æœ¯",content:"\n              <h2>å“åº”å¼è®¾è®¡çš„é‡è¦æ€§</h2>\n              <p>éšç€ç§»åŠ¨è®¾å¤‡çš„æ™®åŠï¼Œå“åº”å¼è®¾è®¡å·²æˆä¸ºç°ä»£Webå¼€å‘çš„æ ¸å¿ƒã€‚æœ¬æ–‡å°†æ¢è®¨æœ€æ–°çš„å“åº”å¼è®¾è®¡æ¨¡å¼ã€CSS Gridä¸Flexboxçš„é«˜çº§ç”¨æ³•ï¼Œä»¥åŠå¦‚ä½•åœ¨å¤æ‚å¸ƒå±€ä¸­ä¿æŒç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ã€‚</p>\n              \n              <h2>ç§»åŠ¨ä¼˜å…ˆç­–ç•¥</h2>\n              <p>ç§»åŠ¨ä¼˜å…ˆçš„è®¾è®¡ç†å¿µå·²æˆä¸ºè¡Œä¸šæ ‡å‡†ã€‚è¿™ç§ç­–ç•¥è¦æ±‚æˆ‘ä»¬å…ˆä¸ºç§»åŠ¨è®¾å¤‡è®¾è®¡ï¼Œç„¶åé€æ­¥å¢å¼ºä»¥é€‚åº”æ›´å¤§çš„å±å¹•ã€‚</p>\n              \n              <blockquote>\n                ç§»åŠ¨ä¼˜å…ˆä¸ä»…æ˜¯ä¸€ç§è®¾è®¡ç­–ç•¥ï¼Œæ›´æ˜¯ä¸€ç§æ€ç»´æ–¹å¼ã€‚å®ƒè¿«ä½¿æˆ‘ä»¬å…³æ³¨å†…å®¹çš„æœ¬è´¨ï¼Œå»é™¤ä¸å¿…è¦çš„è£…é¥°ã€‚\n              </blockquote>\n              \n              <h2>CSS Gridä¸Flexboxçš„é…åˆ</h2>\n              <p>CSS Gridå’ŒFlexboxæ˜¯ç°ä»£å“åº”å¼å¸ƒå±€çš„ä¸¤å¤§æ”¯æŸ±ã€‚Gridæ“…é•¿äºŒç»´å¸ƒå±€ï¼Œè€ŒFlexboxåˆ™åœ¨ä¸€ç»´å¸ƒå±€ä¸Šè¡¨ç°å‡ºè‰²ã€‚</p>\n              \n              <pre><code>.container {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n  gap: 20px;\n}\n\n.card {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}</code></pre>\n              \n              <h2>æ€§èƒ½ä¼˜åŒ–è€ƒè™‘</h2>\n              <p>å“åº”å¼è®¾è®¡ä¸ä»…ä»…æ˜¯è§†è§‰ä¸Šçš„é€‚åº”ï¼Œè¿˜éœ€è¦è€ƒè™‘æ€§èƒ½ã€‚å›¾ç‰‡å“åº”å¼ã€æ¡ä»¶åŠ è½½å’Œä»£ç åˆ†å‰²éƒ½æ˜¯é‡è¦çš„ä¼˜åŒ–æ‰‹æ®µã€‚</p>\n              \n              <h2>æœªæ¥è¶‹åŠ¿</h2>\n              <p>å®¹å™¨æŸ¥è¯¢ã€å±‚å æ ·å¼å±‚å’Œæ–°çš„è§†å£å•ä½å°†è¿›ä¸€æ­¥æå‡å“åº”å¼è®¾è®¡çš„èƒ½åŠ›å’Œçµæ´»æ€§ã€‚</p>\n            "},{id:"article-2",title:"JavaScript ES2024 æ–°ç‰¹æ€§è§£æ",date:"2024-02-28",author:"JavaScriptå¼€å‘è€…",readtime:"15åˆ†é’Ÿ",tags:["JavaScript","ES2024","å‰ç«¯","ç¼–ç¨‹"],category:"æŠ€æœ¯",content:'\n              <h2>ES2024æ¦‚è§ˆ</h2>\n              <p>ECMAScript 2024å³å°†å¸¦æ¥ä¸€ç³»åˆ—ä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬Recordå’ŒTupleæ•°æ®ç±»å‹ã€ç®¡é“è¿ç®—ç¬¦ç­‰ã€‚æœ¬æ–‡æ·±å…¥è§£æè¿™äº›æ–°ç‰¹æ€§çš„ç”¨æ³•ã€é€‚ç”¨åœºæ™¯ä»¥åŠå®ƒä»¬å¦‚ä½•æ”¹å˜æˆ‘ä»¬çš„ç¼–ç¨‹æ–¹å¼ã€‚</p>\n              \n              <h2>Recordå’ŒTupleæ•°æ®ç±»å‹</h2>\n              <p>Recordå’ŒTupleæ˜¯ä¸¤ç§æ–°çš„ä¸å¯å˜æ•°æ®ç»“æ„ï¼Œå®ƒä»¬å¯ä»¥æ˜¾è‘—æé«˜ä»£ç çš„å¯é¢„æµ‹æ€§å’Œå®‰å…¨æ€§ã€‚</p>\n              \n              <pre><code>// Recordç¤ºä¾‹\nconst person = #{\n  name: "å¼ ä¸‰",\n  age: 30\n};\n\n// Tupleç¤ºä¾‹\nconst coordinates = #[10, 20, 30];</code></pre>\n              \n              <h2>ç®¡é“è¿ç®—ç¬¦</h2>\n              <p>ç®¡é“è¿ç®—ç¬¦(|>)å…è®¸æˆ‘ä»¬ä»¥æ›´ç›´è§‚çš„æ–¹å¼é“¾å¼è°ƒç”¨å‡½æ•°ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p>\n              \n              <pre><code>// ä¼ ç»Ÿæ–¹å¼\nconst result = capitalize(filterEven(square([1, 2, 3, 4, 5])));\n\n// ä½¿ç”¨ç®¡é“è¿ç®—ç¬¦\nconst result = [1, 2, 3, 4, 5]\n  |> square\n  |> filterEven\n  |> capitalize;</code></pre>\n              \n              <h2>å…¶ä»–é‡è¦ç‰¹æ€§</h2>\n              <ul>\n                <li><strong>æ•°ç»„åˆ†ç»„æ–¹æ³•</strong>ï¼šåŸç”Ÿçš„æ•°ç»„åˆ†ç»„æ–¹æ³•ï¼Œæ— éœ€ä¾èµ–Lodashç­‰åº“</li>\n                <li><strong>è£…é¥°å™¨æ”¹è¿›</strong>ï¼šæ›´å¼ºå¤§å’Œæ ‡å‡†çš„è£…é¥°å™¨è¯­æ³•</li>\n                <li><strong>é”™è¯¯åŸå› </strong>ï¼šErroræ„é€ å‡½æ•°ç°åœ¨å¯ä»¥æ¥å—causeå‚æ•°</li>\n              </ul>\n              \n              <h2>è¿ç§»å»ºè®®</h2>\n              <p>å¯¹äºç°æœ‰é¡¹ç›®ï¼Œå»ºè®®é€æ­¥å¼•å…¥è¿™äº›æ–°ç‰¹æ€§ï¼Œå…ˆä»ä¸ä¼šç ´åç°æœ‰ä»£ç çš„åŠŸèƒ½å¼€å§‹ã€‚</p>\n            '}]},{name:"è®¾è®¡ç›¸å…³",id:"design",open:!1,files:[{id:"article-3",title:"æš—è‰²æ¨¡å¼è®¾è®¡çš„å¿ƒç†å­¦ä¸å®ç°",date:"2024-01-10",author:"UIè®¾è®¡å¸ˆ",readtime:"10åˆ†é’Ÿ",tags:["è®¾è®¡","æš—è‰²æ¨¡å¼","CSS","ç”¨æˆ·ä½“éªŒ"],category:"è®¾è®¡",content:"\n              <h2>æš—è‰²æ¨¡å¼çš„å…´èµ·</h2>\n              <p>æš—è‰²æ¨¡å¼ä¸ä»…æ˜¯æ—¶å°šæ½®æµï¼Œæ›´æ˜¯å¯¹ç”¨æˆ·è§†åŠ›ä¿æŠ¤å’Œç”µæ± å¯¿å‘½çš„å…³æ€€ã€‚æœ¬æ–‡ä»å¿ƒç†å­¦è§’åº¦åˆ†ææš—è‰²æ¨¡å¼çš„ç›Šå¤„ï¼Œå¹¶æä¾›å®ç”¨çš„CSSå’ŒJavaScriptå®ç°æ–¹æ¡ˆã€‚</p>\n              \n              <h2>å¿ƒç†å­¦åŸºç¡€</h2>\n              <p>æš—è‰²æ¨¡å¼å¯ä»¥å‡å°‘çœ¼ç›ç–²åŠ³ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½å…‰ç¯å¢ƒä¸‹ã€‚ç ”ç©¶è¡¨æ˜ï¼Œé€‚å½“çš„å¯¹æ¯”åº¦å¯ä»¥æé«˜é˜…è¯»èˆ’é€‚åº¦ï¼Œå‡å°‘è§†è§‰å‹åŠ›ã€‚</p>\n              \n              <h2>CSSå®ç°æ–¹æ¡ˆ</h2>\n              <p>ä½¿ç”¨CSSè‡ªå®šä¹‰å±æ€§å’Œåª’ä½“æŸ¥è¯¢å¯ä»¥è½»æ¾å®ç°æš—è‰²æ¨¡å¼ã€‚</p>\n              \n              <pre><code>:root {\n  --bg-color: #ffffff;\n  --text-color: #333333;\n  --primary-color: #007bff;\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --bg-color: #1a1a1a;\n    --text-color: #f0f0f0;\n    --primary-color: #3399ff;\n  }\n}\n\nbody {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}</code></pre>\n              \n              <h2>JavaScriptåˆ‡æ¢åŠŸèƒ½</h2>\n              <p>é™¤äº†ç³»ç»Ÿåå¥½ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥å…è®¸ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢ä¸»é¢˜ã€‚</p>\n              \n              <pre><code>const themeToggle = document.getElementById('themeToggle');\nconst currentTheme = localStorage.getItem('theme');\n\nif (currentTheme) {\n  document.documentElement.setAttribute('data-theme', currentTheme);\n}\n\nthemeToggle.addEventListener('click', () => {\n  const currentTheme = document.documentElement.getAttribute('data-theme');\n  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n  \n  document.documentElement.setAttribute('data-theme', newTheme);\n  localStorage.setItem('theme', newTheme);\n});</code></pre>\n              \n              <h2>è®¾è®¡æ³¨æ„äº‹é¡¹</h2>\n              <ul>\n                <li>é¿å…çº¯é»‘è‰²èƒŒæ™¯ï¼Œä½¿ç”¨æ·±ç°è‰²</li>\n                <li>è°ƒæ•´é¢œè‰²é¥±å’Œåº¦å’Œå¯¹æ¯”åº¦</li>\n                <li>ä¸ºé˜´å½±å’Œå±‚æ¬¡æ„Ÿä½¿ç”¨ä¸åŒçš„ç°åº¦</li>\n                <li>æµ‹è¯•ä¸åŒç¯å¢ƒä¸‹çš„å¯è¯»æ€§</li>\n              </ul>\n            "}]},{name:"ç”Ÿæ´»éšç¬”",id:"life",open:!1,files:[{id:"article-4",title:"è¿œç¨‹å·¥ä½œç¯å¢ƒä¸‹çš„å›¢é˜Ÿåä½œå·¥å…·æ¯”è¾ƒ",date:"2023-04-14",author:"è¿œç¨‹å·¥ä½œè€…",readtime:"8åˆ†é’Ÿ",tags:["è¿œç¨‹å·¥ä½œ","å›¢é˜Ÿåä½œ","å·¥å…·æ¯”è¾ƒ"],category:"ç”Ÿæ´»",content:"\n              <h2>è¿œç¨‹å·¥ä½œçš„æ–°å¸¸æ€</h2>\n              <p>è¿œç¨‹å·¥ä½œå·²æˆä¸ºæ–°å¸¸æ€ï¼Œé€‰æ‹©åˆé€‚çš„åä½œå·¥å…·è‡³å…³é‡è¦ã€‚æœ¬æ–‡æ¯”è¾ƒäº†Slackã€Teamsã€Notionã€Figmaç­‰ä¸»æµå·¥å…·çš„ä¼˜ç¼ºç‚¹ï¼Œå¸®åŠ©å›¢é˜Ÿåšå‡ºæ˜æ™ºé€‰æ‹©ã€‚</p>\n              \n              <h2>æ²Ÿé€šå·¥å…·</h2>\n              <h3>Slack</h3>\n              <p>Slackä»¥å…¶å¼ºå¤§çš„é¢‘é“åŠŸèƒ½å’Œä¸°å¯Œçš„é›†æˆç”Ÿæ€ç³»ç»Ÿè‘—ç§°ï¼Œé€‚åˆéœ€è¦é¢‘ç¹æ²Ÿé€šå’Œé›†æˆçš„å›¢é˜Ÿã€‚</p>\n              \n              <h3>Microsoft Teams</h3>\n              <p>Teamsæ·±åº¦é›†æˆOffice 365å¥—ä»¶ï¼Œé€‚åˆå·²ç»ä½¿ç”¨å¾®è½¯ç”Ÿæ€ç³»ç»Ÿçš„ä¼ä¸šï¼Œä½†å­¦ä¹ æ›²çº¿è¾ƒé™¡å³­ã€‚</p>\n              \n              <h2>æ–‡æ¡£ä¸é¡¹ç›®ç®¡ç†</h2>\n              <h3>Notion</h3>\n              <p>Notionæ˜¯ä¸€æ¬¾å…¨èƒ½å‹å·¥å…·ï¼Œç»“åˆäº†æ–‡æ¡£ã€æ•°æ®åº“ã€çœ‹æ¿å’Œç»´åŸºåŠŸèƒ½ï¼Œçµæ´»æ€§æé«˜ã€‚</p>\n              \n              <h3>Confluence</h3>\n              <p>Confluenceæ˜¯ä¼ä¸šçº§çš„çŸ¥è¯†ç®¡ç†å’Œæ–‡æ¡£åä½œå¹³å°ï¼Œä¸Jiraé›†æˆè‰¯å¥½ï¼Œé€‚åˆè½¯ä»¶å¼€å‘å›¢é˜Ÿã€‚</p>\n              \n              <h2>è®¾è®¡åä½œ</h2>\n              <h3>Figma</h3>\n              <p>Figmaæ”¹å˜äº†è®¾è®¡åä½œçš„æ–¹å¼ï¼Œæ”¯æŒå®æ—¶åä½œå’Œè®¾è®¡ç³»ç»Ÿç®¡ç†ï¼Œå·²æˆä¸ºè¡Œä¸šæ ‡å‡†ã€‚</p>\n              \n              <h3>Miro</h3>\n              <p>Miroæ˜¯æ•°å­—ç™½æ¿å·¥å…·ï¼Œé€‚åˆå¤´è„‘é£æš´ã€å·¥ä½œåŠå’Œæ•æ·ä»ªå¼ï¼Œæ”¯æŒå¤šç§æ¨¡æ¿å’Œæ¡†æ¶ã€‚</p>\n              \n              <h2>é€‰æ‹©å»ºè®®</h2>\n              <p>é€‰æ‹©å·¥å…·æ—¶éœ€è¦è€ƒè™‘å›¢é˜Ÿè§„æ¨¡ã€å·¥ä½œæµç¨‹ã€ç°æœ‰ç”Ÿæ€ç³»ç»Ÿå’Œé¢„ç®—ã€‚å»ºè®®å…ˆè¿›è¡Œå°è§„æ¨¡è¯•ç”¨ï¼Œæ”¶é›†åé¦ˆåå†åšå†³å®šã€‚</p>\n            "}]}]}}const appState={activeArticleId:null,openTabs:[],sidebarOpen:!0,fullscreen:!1,sidebarWidth:280,isResizing:!1,readingMode:"timestamp"},sidebar=document.getElementById("sidebar"),fileTree=document.getElementById("fileTree"),tabBar=document.getElementById("tabBar"),articleContainer=document.getElementById("articleContainer"),emptyState=document.getElementById("emptyState"),sidebarToggle=document.getElementById("sidebarToggle"),sidebarToggleFixed=document.getElementById("sidebarToggleFixed"),fullscreenToggle=document.getElementById("fullscreenToggle"),collapseAllBtn=document.getElementById("collapseAll"),expandAllBtn=document.getElementById("expandAll"),resizer=document.getElementById("resizer"),readingModeToggle=document.getElementById("readingModeToggle"),readingModeText=document.getElementById("readingModeText"),tocContainer=document.getElementById("tocContainer"),sidebarTitle=document.getElementById("sidebarTitle"),fileTreeControls=document.getElementById("fileTreeControls");async function loadAttachments(e,t){if(t||(t=document.querySelector(".article.active")),!t)return void console.warn("loadAttachments: æœªæ‰¾åˆ°æ–‡ç« å…ƒç´ ");const n=t.querySelector(".attachments-section"),a=t.querySelector(".attachments-list"),l=t.querySelector(".loading-state"),o=t.querySelector(".empty-attachments"),i=t.querySelector(".attachments-count");if(n&&a){l&&(l.style.display="flex"),o&&(o.style.display="none");try{let t;if(currentPassageUUID)t=`/api/attachments?passage_id=${currentPassageUUID}`;else{const n=e.split("-"),a=n[0],l=n[1];t=`/api/attachments/by-date?year=${a}&month=${l}&day=${n[2]}`}const l=await fetch(t),r=await l.json();a.innerHTML="",r.success&&r.data&&r.data.length>0?(n.style.display="block",i&&(i.textContent=`${r.data.length} ä¸ªé™„ä»¶`),r.data.forEach(e=>{const t=createAttachmentElement(e);a.appendChild(t)})):(n.style.display="block",i&&(i.textContent="0 ä¸ªé™„ä»¶"),o&&(o.style.display="flex",a.appendChild(o)))}catch(e){console.error("åŠ è½½é™„ä»¶å¤±è´¥:",e),n.style.display="block",i&&(i.textContent="0 ä¸ªé™„ä»¶"),o&&(o.style.display="flex",a.appendChild(o))}finally{l&&(l.style.display="none")}}}function createAttachmentElement(e){const t=document.createElement("a");t.className="attachment-item";const n=e.url||`/api/attachments/${e.id}/download`,a=e.fileName||e.file_name,l=e.fileSize||e.file_size,o=e.fileType||e.file_type;t.href=n,t.target="_blank",t.rel="noopener noreferrer";const i=getFileIconType(o),r=getFileIconClass(o);return t.innerHTML=`\n    <div class="attachment-icon ${r}">\n      ${getFileIconSVG(i)}\n    </div>\n    <div class="attachment-info">\n      <div class="attachment-name" title="${a}">${a}</div>\n      <div class="attachment-meta">\n        <span class="attachment-size">\n          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n            <polyline points="7 10 12 15 17 10"></polyline>\n            <line x1="12" y1="15" x2="12" y2="3"></line>\n          </svg>\n          ${formatFileSize(l)}\n        </span>\n        <span class="attachment-type">\n          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <circle cx="12" cy="12" r="10"></circle>\n            <line x1="12" y1="16" x2="12" y2="12"></line>\n            <line x1="12" y1="8" x2="12.01" y2="8"></line>\n          </svg>\n          ${o||"æ–‡ä»¶"}\n        </span>\n      </div>\n    </div>\n    <div class="attachment-download">\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n        <polyline points="7 10 12 15 17 10"></polyline>\n        <line x1="12" y1="15" x2="12" y2="3"></line>\n      </svg>\n    </div>\n  `,t}function getFileIconType(e){return{image:"image",video:"video",document:"document",audio:"audio",archive:"archive"}[e]||"default"}function getFileIconClass(e){return{image:"image",video:"video",document:"document",audio:"audio",archive:"archive"}[e]||"default"}function getFileIconSVG(e){const t={image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n      <circle cx="8.5" cy="8.5" r="1.5"></circle>\n      <polyline points="21 15 16 10 5 21"></polyline>\n    </svg>',video:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <polygon points="23 7 16 12 23 17 23 7"></polygon>\n      <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>\n    </svg>',document:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n      <polyline points="14 2 14 8 20 8"></polyline>\n      <line x1="16" y1="13" x2="8" y2="13"></line>\n      <line x1="16" y1="17" x2="8" y2="17"></line>\n      <polyline points="10 9 9 9 8 9"></polyline>\n    </svg>',audio:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="M9 18V5l12-2v13"></path>\n      <circle cx="6" cy="18" r="3"></circle>\n      <circle cx="18" cy="16" r="3"></circle>\n    </svg>',archive:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>\n      <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>\n      <line x1="12" y1="22.08" x2="12" y2="12"></line>\n    </svg>',default:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n      <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>\n      <polyline points="13 2 13 9 20 9"></polyline>\n    </svg>'};return t[e]||t.default}function formatFileSize(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","KB","MB","GB","TB"][t]}function renderFileTree(){fileTree.innerHTML="",articlesData.folders.forEach((e,t)=>{const n=createFolderElement(e);fileTree.appendChild(n)})}function createFolderElement(e){const t=document.createElement("div");t.className="folder "+(e.open?"open":""),t.dataset.folderId=e.id;const n=countFilesInFolder(e),a=document.createElement("div");a.className="folder-header",a.innerHTML=`\n\n    <span class="folder-icon">\n\n      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\n        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>\n\n      </svg>\n\n    </span>\n\n    <span class="folder-name">${e.name}</span>\n\n    <span class="file-count">${n}</span>\n\n  `,t.appendChild(a);const l=document.createElement("div");return l.className="folder-content",e.subfolders&&e.subfolders.forEach(e=>{const t=createFolderElement(e);l.appendChild(t)}),e.files&&e.files.forEach((e,t)=>{const n=document.createElement("div");n.className="file-item"+("published"!==e.status?" file-unpublished":""),n.dataset.fileId=e.id,n.dataset.status=e.status,n.dataset.scheduled=e.isScheduled,n.dataset.publishedAt=e.publishedAt||"";const a=document.createElement("span");a.className="file-icon","published"!==e.status?a.innerHTML='\n\n  \n\n            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\n  \n\n              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>\n\n  \n\n              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>\n\n  \n\n            </svg>\n\n  \n\n          ':a.innerHTML='\n\n  \n\n            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\n  \n\n              <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>\n\n  \n\n              <polyline points="13 2 13 9 20 9"></polyline>\n\n  \n\n            </svg>\n\n  \n\n          ',n.appendChild(a);const o=document.createElement("span");o.className="file-name",o.textContent=e.title,n.appendChild(o);const i=document.createElement("span");i.className="file-date";const r=e.date?e.date.split(" ")[0]:"";if(i.textContent=r,n.appendChild(i),"published"!==e.status){const t=document.createElement("span");t.className="file-status","draft"===e.status?t.textContent="è‰ç¨¿":"pending"===e.status?t.textContent="å¾…å®¡æ ¸":t.textContent="å®šæ—¶å‘å¸ƒ",n.appendChild(t)}n.addEventListener("click",()=>{openArticle(e.id)}),n.addEventListener("dblclick",()=>{openArticleInNewTab(e.id)}),n.addEventListener("contextmenu",e=>{e.preventDefault()}),l.appendChild(n)}),t.appendChild(l),a.addEventListener("click",()=>{e.open=!e.open,t.classList.toggle("open")}),e.subfolders&&t.querySelectorAll(".folder").forEach(t=>{const n=t.dataset.folderId,a=findFolderById(e,n);if(a){t.querySelector(".folder-header").addEventListener("click",()=>{a.open=!a.open,t.classList.toggle("open")})}}),t}function countFilesInFolder(e){let t=e.files?e.files.length:0;return e.subfolders&&e.subfolders.forEach(e=>{t+=countFilesInFolder(e)}),t}function findFolderById(e,t){if(e.id===t)return e;if(e.subfolders)for(const n of e.subfolders){const e=findFolderById(n,t);if(e)return e}return null}async function openArticle(e){const t=findArticleById(e);if(!t)return;appState.activeArticleId=e,appState.openTabs.includes(e)||appState.openTabs.push(e),updatePageTitle(t),updateUI();const n=document.getElementById(`article-${e}`);n?(document.querySelectorAll(".article").forEach(e=>{"articleTemplate"!==e.id&&(e.classList.remove("active"),e.style.display="none")}),n.classList.add("active"),n.style.display="block"):t.content?renderArticle(t):await loadArticleContent(e),emptyState.style.display="none",window.innerWidth<992&&(appState.sidebarOpen=!1,sidebar.classList.add("hidden"))}async function loadArticleContent(e){try{if(articleContentCache.has(e)){const t=articleContentCache.get(e),n=findArticleById(e);return void(n&&(n.content=t.content,renderArticle(n)))}const t=e.replace("article-",""),n=await fetch(`/api/passages/${t}`),a=await n.json();if(a.success&&a.data){currentPassageUUID=a.data.uuid,currentPassageID=a.data.id;const t=a.data.html_content||a.data.content;articleContentCache.set(e,{content:t,timestamp:Date.now()});const n=findArticleById(e);n&&(n.content=t,n.uuid=a.data.uuid,n.status=a.data.status,renderArticle(n))}else console.error("åŠ è½½æ–‡ç« å†…å®¹å¤±è´¥:",a.message),renderLoadingError()}catch(e){console.error("åŠ è½½æ–‡ç« å†…å®¹å¤±è´¥:",e),renderLoadingError()}}function clearExpiredCache(e=18e5){const t=Date.now();for(const[n,a]of articleContentCache.entries())t-a.timestamp>e&&articleContentCache.delete(n)}function clearAllCache(){articleContentCache.clear()}function getCacheStats(){return{size:articleContentCache.size,keys:Array.from(articleContentCache.keys())}}function logCacheStats(){getCacheStats()}function renderLoadingError(){const e=document.getElementById("articleContent");e&&(e.innerHTML='<div class="error">åŠ è½½æ–‡ç« å†…å®¹å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>')}function findArticleById(e){for(const t of articlesData.folders){const n=findArticleInFolder(t,e);if(n)return n}return null}function findArticleInFolder(e,t){if(e.files){const n=e.files.find(e=>e.id===t);if(n)return n}if(e.subfolders)for(const n of e.subfolders){const e=findArticleInFolder(n,t);if(e)return e}return null}async function openArticleInNewTab(e){const t=findArticleById(e);if(t){if(appState.openTabs.includes(e))return appState.activeArticleId=e,void updateUI();appState.openTabs.push(e),appState.activeArticleId=e,updateUI(),t.content?renderArticle(t):await loadArticleContent(e)}}function renderArticle(e){const t=document.getElementById("articleContent");t&&(t.style.display="none");const n=document.getElementById("emptyState");n&&(n.style.display="none"),document.querySelectorAll(".article").forEach(e=>{"articleTemplate"!==e.id&&e.remove()});const a=document.getElementById("articleTemplate").cloneNode(!0);a.id=`article-${e.id}`,a.classList.add("active"),a.style.display="block";const l="published"!==e.status,o=document.getElementById("unpublishedNotice");if(l){o.style.display="block";const t=document.getElementById("unpublishedMessage"),n=document.getElementById("scheduledMessage"),a=document.getElementById("scheduledTime");"draft"===e.status?(t.textContent="æ­¤æ–‡ç« æ­£åœ¨ç¼–è¾‘ä¸­ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚",n.style.display="none"):"pending"===e.status?(t.textContent="æ­¤æ–‡ç« æ­£åœ¨ç­‰å¾…å®¡æ ¸ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚",n.style.display="none"):e.isScheduled&&e.publishedAt?(t.textContent="æ­¤æ–‡ç« å·²å®‰æ’å®šæ—¶å‘å¸ƒï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚",n.style.display="block",a.textContent=e.publishedAt):(t.textContent="æ­¤æ–‡ç« å°šæœªå‘å¸ƒï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚",n.style.display="none"),tocContainer.classList.remove("active"),fileTree.style.display="block",sidebarTitle.textContent="æ–‡ç« ç´¢å¼•"}else o.style.display="none";a.querySelector(".article-title").textContent=e.title;const i=e.date.split(" ")[0];a.querySelector(".article-date").textContent=i,a.querySelector(".article-readtime").textContent=`é¢„è®¡ ${e.readtime} åˆ†é’Ÿè¯»å®Œ`;const r=a.querySelector(".article-category");r&&(r.textContent=e.category||"æœªåˆ†ç±»");const s=a.querySelector(".article-tags-inline");if(s){s.innerHTML="";const t="string"==typeof e.tags?JSON.parse(e.tags):e.tags;t&&t.length>0?t.forEach(e=>{const t=document.createElement("span");t.className="inline-tag",t.textContent=e,s.appendChild(t)}):s.textContent="æ— æ ‡ç­¾"}!1===e.show_title?a.querySelector(".article-title").style.display="none":a.querySelector(".article-title").style.display="block";a.querySelector(".article-tags").style.display="none";let c=e.content;c=c.replace(/^\s*<h1[^>]*>.*?<\/h1>\s*/i,""),a.querySelector(".article-content").innerHTML=c,articleContainer.appendChild(a);renderMathAndDiagrams(a.querySelector(".article-content")),loadAttachments(e.date,a);const d=a.querySelector(".sponsor-section-template");if(d)if(window.sponsorEnabled){d.style.display="block";const e=d.querySelector("#sponsorBtn");if(e&&window.sponsorButtonText){e.textContent=window.sponsorButtonText;const t=document.getElementById("sponsorModal");t&&e.addEventListener("click",function(e){e.stopPropagation(),t.classList.add("active")})}}else d.style.display="none";initArticleComments(a,e.id,e),"toc"===appState.readingMode&&generateTableOfContents()}function initArticleComments(e,t,n){const a=e.querySelector(".article-comments");if(!a)return void console.warn("æœªæ‰¾åˆ°è¯„è®ºåŒºåŸŸ .article-comments");const l="string"==typeof t?parseInt(t.replace("article-",""),10):t;if(a.dataset.articleId=l,a.style.display="block",n&&"published"!==n.status)return void(a.style.display="none");a.querySelector(".comment-username-input");const o=a.querySelector(".comment-textarea"),i=a.querySelector(".submit-comment-btn"),r=a.querySelector(".comments-list"),s=a.querySelector(".loading-state"),c=a.querySelector(".empty-comments"),d=a.querySelector(".comments-count"),u=n&&n.uuid?n.uuid:l.toString();if(loadArticleComments(u,r,s,c,d),i){const e=i.cloneNode(!0);i.parentNode.replaceChild(e,i),e.addEventListener("click",function(){const e=a.querySelector(".comment-username-input"),t=a.querySelector(".comment-textarea");submitArticleComment(u,e,t,r,d)})}if(o){const e=o.cloneNode(!0);o.parentNode.replaceChild(e,o),e.addEventListener("keydown",function(e){if(e.ctrlKey&&"Enter"===e.key){e.preventDefault();const t=a.querySelector(".comment-username-input"),n=a.querySelector(".comment-textarea");submitArticleComment(u,t,n,r,d)}})}}async function loadArticleComments(e,t,n,a,l){if(!commentsLoadedCache.has(e)){n&&(n.style.display="flex"),t&&(t.style.display="none"),a&&(a.style.display="none");try{const o=await fetch(`/api/comments?passage_uuid=${e}`),i=await o.json();i.success&&i.data?(commentsLoadedCache.add(e),l&&(l.textContent=`${i.data.length} æ¡è¯„è®º`),n&&(n.style.display="none"),i.data.length>0?t&&(t.style.display="flex",renderArticleComments(i.data,t)):a&&(a.style.display="flex")):(console.error("åŠ è½½è¯„è®ºå¤±è´¥:",i),n&&(n.style.display="none"),a&&(a.style.display="flex"))}catch(e){console.error("åŠ è½½è¯„è®ºæ—¶å‡ºé”™:",e),n&&(n.style.display="none"),a&&(a.style.display="flex")}}}function renderArticleComments(e,t){t.innerHTML="",e.forEach(e=>{const n=document.createElement("div");n.className="comment-item";const a=generateIdenticon(e.username||"anonymous",40);n.innerHTML=`\n      <div class="comment-header">\n        <div class="comment-user">\n          <div class="comment-avatar">\n            <img src="${a}" alt="${e.username||"åŒ¿åç”¨æˆ·"}" style="width: 100%; height: 100%; border-radius: 50%;"/>\n          </div>\n          <span class="comment-username">${e.username||"åŒ¿åç”¨æˆ·"}</span>\n        </div>\n        <span class="comment-date">${formatDate(e.created_at)}</span>\n      </div>\n      <div class="comment-content">${e.content}</div>\n    `,t.appendChild(n)})}async function submitArticleComment(e,t,n,a,l){const o=t.value.trim(),i=n.value.trim();if(o&&i)try{const a=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({passage_uuid:e,username:o,content:i})}),l=await a.json();if(l.success){showToast("è¯„è®ºå‘è¡¨æˆåŠŸï¼","success"),t.value="",n.value="",commentsLoadedCache.delete(e);const a=t.closest(".article-comments");loadArticleComments(e,a.querySelector(".comments-list"),a.querySelector(".loading-state"),a.querySelector(".empty-comments"),a.querySelector(".comments-count"))}else showToast("è¯„è®ºå‘è¡¨å¤±è´¥ï¼š"+(l.message||"æœªçŸ¥é”™è¯¯"),"error")}catch(e){console.error("æäº¤è¯„è®ºæ—¶å‡ºé”™:",e),showToast("è¯„è®ºå‘è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error")}else showToast("è¯·å¡«å†™ç”¨æˆ·åå’Œè¯„è®ºå†…å®¹","warning")}function updateUI(){document.querySelectorAll(".file-item").forEach(e=>{e.classList.remove("active"),e.dataset.fileId===appState.activeArticleId&&e.classList.add("active")}),updateTabBar(),sidebar.style.width=`${appState.sidebarWidth}px`}function updateTabBar(){tabBar.innerHTML="",appState.openTabs.forEach(e=>{const t=findArticleById(e);if(!t)return;const n=document.createElement("div");n.className="tab "+(e===appState.activeArticleId?"active":""),n.dataset.articleId=e,n.innerHTML=`\n      <span class="tab-title">${t.title}</span>\n      <span class="tab-close">\n        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">\n          <line x1="18" y1="6" x2="6" y2="18"></line>\n          <line x1="6" y1="6" x2="18" y2="18"></line>\n        </svg>\n      </span>\n    `,n.addEventListener("click",t=>{t.target.closest(".tab-close")?(closeTab(e),t.stopPropagation()):e!==appState.activeArticleId&&switchToTab(e)}),tabBar.appendChild(n)})}function switchToTab(e){appState.activeArticleId=e;const t=findArticleById(e);if(!t)return;updatePageTitle(t);const n=document.getElementById(`article-${e}`);n?(document.querySelectorAll(".article").forEach(e=>{"articleTemplate"!==e.id&&(e.classList.remove("active"),e.style.display="none")}),n.classList.add("active"),n.style.display="block"):renderArticle(t),updateUI()}function closeTab(e){const t=appState.openTabs.indexOf(e);t>-1&&appState.openTabs.splice(t,1),appState.activeArticleId===e&&(appState.openTabs.length>0?(appState.activeArticleId=appState.openTabs[0],switchToTab(appState.activeArticleId)):(appState.activeArticleId=null,document.querySelectorAll(".article").forEach(e=>{"articleTemplate"!==e.id&&e.remove()}),emptyState.style.display="flex",updatePageTitle(null))),updateUI()}function toggleReadingMode(){appState.readingMode="timestamp"===appState.readingMode?"toc":"timestamp",updateReadingModeUI()}function updateReadingModeUI(){const e="timestamp"===appState.readingMode;readingModeText.textContent=e?"æ—¶é—´æˆ³":"æœ¬æ–‡ç´¢å¼•",sidebarTitle.textContent=e?"æ–‡ç« ç´¢å¼•":"æœ¬æ–‡ç›®å½•";const t=appState.activeArticleId?findArticleById(appState.activeArticleId):null,n=t&&"published"!==t.status;e?(fileTree.style.display="block",tocContainer.classList.remove("active"),fileTreeControls.style.display="flex"):(n?tocContainer.innerHTML='\n        <div class="toc-empty">\n          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>\n            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>\n          </svg>\n          <p>æ­¤æ–‡ç« å°šæœªå‘å¸ƒ,æš‚æ— ç›®å½•</p>\n        </div>\n      ':generateTableOfContents(),fileTree.style.display="none",tocContainer.classList.add("active"),fileTreeControls.style.display="none")}function generateTableOfContents(){const e=document.querySelector(".article.active .article-content");if(!e)return void(tocContainer.innerHTML='\n      <div class="toc-empty">\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n          <polyline points="14 2 14 8 20 8"></polyline>\n          <line x1="16" y1="13" x2="8" y2="13"></line>\n          <line x1="16" y1="17" x2="8" y2="17"></line>\n          <polyline points="10 9 9 9 8 9"></polyline>\n        </svg>\n        <p>è¯·å…ˆé€‰æ‹©ä¸€ç¯‡æ–‡ç« </p>\n      </div>\n    ');const t=e.querySelectorAll("h1, h2, h3, h4, h5, h6");if(0===t.length)return void(tocContainer.innerHTML='\n      <div class="toc-empty">\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n          <circle cx="12" cy="12" r="10"></circle>\n          <line x1="12" y1="8" x2="12" y2="12"></line>\n          <line x1="12" y1="16" x2="12.01" y2="16"></line>\n        </svg>\n        <p>æœ¬æ–‡æš‚æ— ç›®å½•</p>\n      </div>\n    ');t.forEach((e,t)=>{e.id||(e.id=`heading-${t}`)});let n='<ul class="toc-list">';t.forEach((e,t)=>{const a=parseInt(e.tagName.substring(1)),l=e.textContent.trim(),o=e.id;n+=`\n      <li class="toc-item">\n        <a href="#${o}" class="toc-link toc-level-${a}" data-target="${o}">\n          ${l}\n        </a>\n      </li>\n    `}),n+="</ul>",tocContainer.innerHTML=n,tocContainer.querySelectorAll(".toc-link").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("data-target"),a=document.getElementById(n);a&&(a.scrollIntoView({behavior:"smooth",block:"start"}),tocContainer.querySelectorAll(".toc-link").forEach(e=>e.classList.remove("active")),e.classList.add("active"))})}),setupScrollSpy()}function setupScrollSpy(){window.scrollSpyHandler&&window.removeEventListener("scroll",window.scrollSpyHandler),window.scrollSpyHandler=()=>{if("toc"!==appState.readingMode)return;const e=document.querySelectorAll(".article.active .article-content h1, .article.active .article-content h2, .article.active .article-content h3, .article.active .article-content h4, .article.active .article-content h5, .article.active .article-content h6"),t=tocContainer.querySelectorAll(".toc-link");let n=null;e.forEach(e=>{e.getBoundingClientRect().top<=100&&(n=e.id)}),n&&t.forEach(e=>{e.classList.remove("active"),e.getAttribute("data-target")===n&&e.classList.add("active")})},window.addEventListener("scroll",window.scrollSpyHandler)}function setupEventListeners(){readingModeToggle.addEventListener("click",toggleReadingMode),sidebarToggle.addEventListener("click",e=>{e.stopPropagation(),appState.sidebarOpen=!appState.sidebarOpen,sidebar.classList.toggle("hidden"),appState.sidebarOpen?sidebar.style.width=`${appState.sidebarWidth}px`:sidebar.style.width="0"}),sidebarToggleFixed.addEventListener("click",e=>{e.stopPropagation();const t=document.querySelector("nav"),n=document.querySelector("footer"),a=document.querySelector(".main-container");"none"===t.style.display?(t.style.display="flex",n&&(n.style.display=""),a.style.height="calc(100vh - var(--header-height))"):(t.style.display="none",n&&(n.style.display="none"),a.style.height="100vh")}),fullscreenToggle.addEventListener("click",toggleFullscreen),collapseAllBtn.addEventListener("click",()=>{articlesData.folders.forEach(e=>{e.open=!1}),renderFileTree()}),expandAllBtn.addEventListener("click",()=>{articlesData.folders.forEach(e=>{e.open=!0}),renderFileTree()}),resizer.addEventListener("mousedown",startResize),document.addEventListener("mousemove",handleResize),document.addEventListener("mouseup",stopResize),document.addEventListener("fullscreenchange",handleFullscreenChange),document.addEventListener("webkitfullscreenchange",handleFullscreenChange),document.addEventListener("mozfullscreenchange",handleFullscreenChange),document.addEventListener("MSFullscreenChange",handleFullscreenChange),window.addEventListener("resize",handleWindowResize)}function startResize(e){appState.isResizing=!0,document.body.style.cursor="col-resize",resizer.classList.add("active")}function handleResize(e){if(!appState.isResizing)return;const t=e.clientX;t>=200&&t<=500&&(appState.sidebarWidth=t,sidebar.style.width=`${t}px`)}function stopResize(){appState.isResizing=!1,document.body.style.cursor="",resizer.classList.remove("active")}function toggleFullscreen(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),appState.fullscreen=!1,document.body.classList.remove("fullscreen")):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),appState.fullscreen=!0,document.body.classList.add("fullscreen"))}function handleFullscreenChange(){const e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);appState.fullscreen=e,document.body.classList.toggle("fullscreen",e)}function handleWindowResize(){window.innerWidth>=992&&!appState.sidebarOpen&&(appState.sidebarOpen=!0,sidebar.classList.remove("hidden"))}document.addEventListener("DOMContentLoaded",()=>initApp())</script><div class="image-viewer" id="imageViewer"><div class="image-viewer-close" id="imageViewerClose">Ã—</div><img id="imageViewerImg" src="" alt="æ”¾å¤§æŸ¥çœ‹"></div><div class="code-viewer" id="codeViewer"><div class="code-viewer-header"><span class="code-viewer-title" id="codeViewerTitle">ä»£ç æŸ¥çœ‹</span><div style="display:flex;gap:8px"><button class="code-viewer-copy" id="codeViewerCopy" title="å¤åˆ¶ä»£ç "><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> å¤åˆ¶</button> <button class="code-viewer-close" id="codeViewerClose"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> å…³é—­</button></div></div><div class="code-viewer-content" id="codeViewerContent"></div><div class="code-viewer-toast" id="codeViewerToast">å¤åˆ¶æˆåŠŸï¼</div></div><div class="modal" id="loginModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1000;justify-content:center;align-items:center;padding:20px;animation:fadeIn .3s ease"><div class="modal-content" style="background:rgba(0,0,0,0);backdrop-filter:blur(40px) saturate(200%);-webkit-backdrop-filter:blur(40px) saturate(200%);border:1px solid rgba(255,255,255,.5);border-radius:20px;box-shadow:0 20px 50px rgba(0,0,0,.2);max-width:500px;width:100%;animation:slideIn .3s ease;position:relative;overflow:hidden"><div class="modal-header" style="background:linear-gradient(90deg,#007bff,#00b894);padding:20px 30px;color:#fff;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center"><h3 style="font-size:1.5em;font-weight:600">ç”¨æˆ·ç™»å½•</h3><button class="modal-close" data-modal="loginModal" style="background:0 0;border:none;color:#fff;font-size:1.5em;cursor:pointer;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .3s">Ã—</button></div><div class="modal-body" style="padding:30px"><form id="loginForm"><div class="form-group" style="margin-bottom:20px"><label for="loginUsername" style="display:block;margin-bottom:8px;color:#333;font-weight:500">ç”¨æˆ·å</label> <input id="loginUsername" class="form-control" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required autocomplete="username" style="width:100%;padding:12px 15px;border:1px solid rgba(0,0,0,.1);border-radius:8px;font-size:1em;background:rgba(255,255,255,.9);transition:all .3s ease"></div><div class="form-group" style="margin-bottom:20px"><label for="loginPassword" style="display:block;margin-bottom:8px;color:#333;font-weight:500">å¯†ç </label> <input type="password" id="loginPassword" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç " required autocomplete="current-password" style="width:100%;padding:12px 15px;border:1px solid rgba(0,0,0,.1);border-radius:8px;font-size:1em;background:rgba(255,255,255,.9);transition:all .3s ease"></div><div class="form-group" id="loginError" style="display:none;color:#e74c3c;font-size:.9em"></div><button type="submit" id="loginSubmitBtn" class="btn-primary" style="width:100%;background:rgba(255,183,122,.8);color:#fff;padding:12px 30px;border-radius:8px;border:none;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease">ç™»å½•</button></form><div style="margin-top:20px;text-align:center;font-size:.9em"><a href="#" id="openRegisterModal" style="color:#007bff;text-decoration:none">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç«‹å³æ³¨å†Œ</a></div></div></div></div><div class="modal" id="externalLinkModal"><div class="modal-content"><div class="modal-header"><h3>âš ï¸ å¤–éƒ¨é“¾æ¥è­¦å‘Š</h3><button class="modal-close" data-modal="externalLinkModal">Ã—</button></div><div class="modal-body"><p style="color:rgba(255,255,255,.9);margin-bottom:20px">{{ external_link_warning_text }}<div style="background:rgba(0,0,0,.2);padding:15px;border-radius:8px;margin-bottom:20px;word-break:break-all"><p style="font-size:.9em;color:rgba(255,255,255,.7);margin-bottom:5px">ç›®æ ‡é“¾æ¥ï¼š<p id="externalLinkUrl" style="color:#007bff;font-weight:500"></div><div style="display:flex;gap:10px"><button type="button" class="btn-secondary" id="cancelExternalLinkBtn" style="flex:1">ä¸è·³è½¬</button> <button type="button" class="btn-primary" id="proceedExternalLinkBtn" style="flex:1">è·³è½¬</button></div></div></div></div><style>@keyframes fadeIn{from{opacity:0}to{opacity:1}}.modal-content::after{content:'';position:absolute;bottom:0;left:0;height:3px;background:linear-gradient(90deg,#007bff,#00b894);width:0%;transition:width 3s linear}.modal.active .modal-content::after{width:100%}.modal.active{display:flex}.form-control:focus{outline:0;border-color:#007bff;box-shadow:0 0 0 3px rgba(0,123,255,.1)}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,123,255,.3)}.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}.btn-secondary{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);padding:12px 30px;border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease}.btn-secondary:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}#userCenter.active{display:block}.user-center-menu a:hover{background:rgba(0,123,255,.1);color:#007bff}#logoutBtn:hover{background:rgba(231,76,60,.1);color:#c0392b}</style><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script><script>function showToast(e,t="success"){const n=document.getElementById("toastContainer");if(!n)return void console.error("Toast container not found");const o=document.createElement("div");o.className=`toast ${t}`;let c="";switch(t){case"success":default:c="â­•";break;case"error":c="âŒ";break;case"warning":c="âš ï¸"}o.innerHTML=`\n    <div class="toast-icon">${c}</div>\n    <div class="toast-message">${e}</div>\n    <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>\n  `,n.appendChild(o),setTimeout(()=>{o.parentElement&&o.remove()},3e3)}document.addEventListener("DOMContentLoaded",async function(){const e=document.querySelector(".article.active .article-content");if(e)try{await renderMathAndDiagrams(e)}catch(e){console.error("æ¸²æŸ“å¤±è´¥:",e)}const t=document.querySelector(".article.active .article-date");if(t&&t.textContent){const e=document.querySelector(".article.active");loadAttachments(t.textContent.trim(),e)}fetch("/api/settings/appearance").then(e=>e.json()).then(e=>{function t(){const t=window.innerWidth<=768&&e.mobile_background_image?e.mobile_background_image:e.background_image;t&&(document.body.style.backgroundImage=`url('${t}')`)}localStorage.setItem("appearanceSettings",JSON.stringify(e)),!0===e.dark_mode_enabled?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode"),(e.navbar_glass_color||e.card_glass_color||e.footer_glass_color||e.navbar_text_color)&&(document.documentElement.style.setProperty("--navbar-glass-color",e.navbar_glass_color||"rgba(255, 255, 255, 0.85)"),document.documentElement.style.setProperty("--navbar-text-color",e.navbar_text_color||"rgba(255, 255, 255, 0.9)"),document.documentElement.style.setProperty("--card-glass-color",e.card_glass_color||"rgba(255, 255, 255, 0.75)"),document.documentElement.style.setProperty("--footer-glass-color",e.footer_glass_color||"rgba(255, 255, 255, 0.9)")),t(),window.addEventListener("resize",t)}).catch(e=>{console.error("åŠ è½½å¤–è§‚è®¾ç½®å¤±è´¥:",e),document.documentElement.classList.remove("dark-mode")}),initImageViewer(),initCodeBlocks();const n=document.getElementById("codeViewerClose");n&&n.addEventListener("click",closeCodeViewer);const o=document.getElementById("codeViewerCopy");o&&o.addEventListener("click",()=>{const e=document.querySelector("#codeViewerContent code");if(e){const t=e.textContent;navigator.clipboard.writeText(t).then(()=>{showCodeViewerToast("å¤åˆ¶æˆåŠŸï¼")}).catch(e=>{console.error("å¤åˆ¶å¤±è´¥:",e),showCodeViewerToast("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")})}}),document.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e)});new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){if(1===e.nodeType){if("codeViewerContent"===e.id||e.closest("#codeViewerContent"))return;e.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e)});e.querySelectorAll("pre code").forEach(e=>{if(!e.closest(".code-block-wrapper")&&!e.closest("#codeViewerContent")){const t=e.parentElement,n=detectLanguage(e.className),o=document.createElement("div");o.className="code-block-wrapper",t.parentNode.insertBefore(o,t),o.appendChild(t);const c=document.createElement("div");c.className="code-block-toolbar",c.innerHTML=`\n                <span class="code-language">${n}</span>\n                <button class="copy-code-btn" title="å¤åˆ¶ä»£ç ">\n                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n                  </svg>\n                  å¤åˆ¶\n                </button>\n                <button class="fullscreen-code-btn" title="å…¨å±æŸ¥çœ‹">\n                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>\n                  </svg>\n                  å…¨å±\n                </button>\n              `,o.insertBefore(c,t);const s=e.textContent.split("\n"),a=document.createElement("div");a.className="code-line-numbers",s.forEach((e,t)=>{const n=document.createElement("span");n.textContent=t+1,a.appendChild(n)}),t.style.position="relative",t.insertBefore(a,e);c.querySelector(".copy-code-btn").addEventListener("click",()=>copyCode(e,o));c.querySelector(".fullscreen-code-btn").addEventListener("click",()=>{openCodeViewer("CODE"===e.tagName?e:e.querySelector("code"),n)})}})}})})}).observe(document.body,{childList:!0,subtree:!0}),loadCurrentArticleCategoryAndTags()});let currentPassageID=null,currentPassageUUID=null;function initImageViewer(){const e=document.getElementById("imageViewer"),t=document.getElementById("imageViewerImg"),n=document.getElementById("imageViewerClose");e&&t&&n&&(document.addEventListener("click",function(e){const t=e.target.closest(".article-content img");t&&(e.preventDefault(),openImageViewer(t.src))}),n.addEventListener("click",closeImageViewer),e.addEventListener("click",function(t){t.target===e&&closeImageViewer()}),document.addEventListener("keydown",function(t){if("Escape"===t.key){e.classList.contains("active")&&closeImageViewer();const t=document.getElementById("codeViewer");t&&t.classList.contains("active")&&closeCodeViewer()}}))}function openImageViewer(e){const t=document.getElementById("imageViewer"),n=document.getElementById("imageViewerImg");t&&n&&(n.src=e,t.classList.add("active"),document.body.style.overflow="hidden")}function closeImageViewer(){const e=document.getElementById("imageViewer"),t=document.getElementById("imageViewerImg");e&&t&&(e.classList.remove("active"),t.src="",document.body.style.overflow="")}function initCodeBlocks(){const e=document.querySelector(".article-content");if(!e)return;e.querySelectorAll("pre code").forEach(e=>{const t=e.parentElement,n=detectLanguage(e.className),o=document.createElement("div");o.className="code-block-wrapper",t.parentNode.insertBefore(o,t),o.appendChild(t);const c=document.createElement("div");c.className="code-block-toolbar",c.innerHTML=`\n      <span class="code-language">${n}</span>\n      <button class="copy-code-btn" title="å¤åˆ¶ä»£ç ">\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n        </svg>\n        å¤åˆ¶\n      </button>\n      <button class="fullscreen-code-btn" title="å…¨å±æŸ¥çœ‹">\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>\n        </svg>\n        å…¨å±\n      </button>\n    `,o.insertBefore(c,t);const s=e.textContent.split("\n"),a=document.createElement("div");a.className="code-line-numbers",s.forEach((e,t)=>{const n=document.createElement("span");n.textContent=t+1,a.appendChild(n)}),t.style.position="relative",t.insertBefore(a,e);c.querySelector(".copy-code-btn").addEventListener("click",()=>copyCode(e,o));c.querySelector(".fullscreen-code-btn").addEventListener("click",()=>{openCodeViewer("CODE"===e.tagName?e:e.querySelector("code"),n)})})}function detectLanguage(e){const t=e.match(/language-(\w+)/);return t?t[1]:"Code"}function copyCode(e,t){const n=e.textContent;navigator.clipboard.writeText(n).then(()=>{showCopyToast(t,"å¤åˆ¶æˆåŠŸï¼")}).catch(e=>{console.error("å¤åˆ¶å¤±è´¥:",e),showCopyToast(t,"å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")})}function showCopyToast(e,t){let n=e.querySelector(".copy-toast");n||(n=document.createElement("div"),n.className="copy-toast",e.appendChild(n)),n.textContent=t,n.classList.add("show"),setTimeout(()=>{n.classList.remove("show")},2e3)}function openCodeViewer(e,t){const n=document.getElementById("codeViewer"),o=document.getElementById("codeViewerContent"),c=document.getElementById("codeViewerTitle");if(!n||!o||!c)return;c.textContent=`${t} ä»£ç `,o.innerHTML="";const s=document.createElement("div");s.style.cssText="display: flex; align-items: flex-start; background: #1a1b26; padding: 20px; height: 100%; overflow: auto;";const a=e.cloneNode(!0);a.querySelectorAll(".code-line-numbers").forEach(e=>e.remove());const r=a.textContent,i=r.split("\n"),l=document.createElement("div");l.style.cssText="display: flex; flex-direction: column; align-items: flex-end; padding-right: 16px; user-select: none; color: #565f89; font-size: 0.9em; line-height: 1.6; min-width: 40px;",i.forEach((e,t)=>{const n=document.createElement("span");n.textContent=t+1,l.appendChild(n)}),s.appendChild(l);const d=document.createElement("pre");d.style.cssText="margin: 0; padding: 0; background: transparent; border: none; flex: 1;";const m=document.createElement("code");m.className=e.className,m.textContent=r,m.style.cssText='background: transparent; padding: 0; font-family: "JetBrains Mono", "Fira Code", Consolas, Monaco, monospace; font-size: 0.95em; line-height: 1.6; color: #a9b1d6;',d.appendChild(m),s.appendChild(d),o.appendChild(s),"undefined"!=typeof hljs&&hljs.highlightElement(m),n.classList.add("active"),document.body.style.overflow="hidden"}function closeCodeViewer(){const e=document.getElementById("codeViewer");e&&(e.classList.remove("active"),document.body.style.overflow="")}function showCodeViewerToast(e){const t=document.getElementById("codeViewerToast");t&&(t.textContent=e,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},2e3))}async function loadCurrentArticleCategoryAndTags(){if(currentPassageID)try{const e=await fetch(`/api/passages/${currentPassageID}`);if(423===e.status){return void showUnpublishedNotice(await e.json())}const t=await e.json();if(t.success&&t.data){const e=t.data,n=document.getElementById("articleCategory");n&&(n.textContent=e.category||"æœªåˆ†ç±»");const o=document.getElementById("articleTagsInline");if(o){o.innerHTML="";const t="string"==typeof e.tags?JSON.parse(e.tags):e.tags;t&&t.length>0?t.forEach(e=>{const t=document.createElement("span");t.className="inline-tag",t.textContent=e,o.appendChild(t)}):o.textContent="æ— æ ‡ç­¾"}const c=document.getElementById("articleReadTime");if(c&&e.content){const t=calculateReadTime(e.content);c.textContent=`é¢„è®¡ ${t} åˆ†é’Ÿè¯»å®Œ`}}}catch(e){console.error("åŠ è½½æ–‡ç« åˆ†ç±»å’Œæ ‡ç­¾å¤±è´¥:",e)}}function showUnpublishedNotice(e){const t=document.getElementById("unpublishedNotice"),n=document.getElementById("unpublishedMessage"),o=document.getElementById("scheduledMessage"),c=document.getElementById("scheduledTime");if(document.querySelector(".article-container").querySelectorAll(".article").forEach(e=>e.style.display="none"),t.style.display="block","draft"===e.status?n.textContent="æ­¤æ–‡ç« æ˜¯è‰ç¨¿ï¼Œæ­£åœ¨ç¼–è¾‘ä¸­ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚":"pending"===e.status?n.textContent="æ­¤æ–‡ç« æ­£åœ¨ç­‰å¾…å®¡æ ¸ï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚":n.textContent="æ­¤æ–‡ç« å°šæœªå‘å¸ƒï¼Œæš‚æ—¶æ— æ³•è®¿é—®ã€‚",e.is_scheduled&&e.published_at){o.style.display="block";const t=new Date(e.published_at);c.textContent=t.toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}else o.style.display="none"}function initComments(){if(!currentPassageID)return;loadComments();const e=document.getElementById("submitCommentBtn");e&&e.addEventListener("click",submitComment);const t=document.getElementById("commentContent");t&&t.addEventListener("keydown",function(e){e.ctrlKey&&"Enter"===e.key&&(e.preventDefault(),submitComment())});const n=document.getElementById("commentUsername"),o=document.querySelector(".comment-user-avatar");if(n&&o){n.addEventListener("input",function(){const e=this.value.trim()||"anonymous",t=generateIdenticon(e,40);o.innerHTML=`<img src="${t}" alt="${e}" style="width: 100%; height: 100%; border-radius: 50%;"/>`});const e=generateIdenticon("anonymous",40);o.innerHTML=`<img src="${e}" alt="anonymous" style="width: 100%; height: 100%; border-radius: 50%;"/>`}}async function loadComments(){const e=document.getElementById("commentsList"),t=document.getElementById("commentsLoading"),n=document.getElementById("emptyComments"),o=document.getElementById("commentsCount");t&&(t.style.display="flex"),e&&(e.style.display="none"),n&&(n.style.display="none");try{const c=await fetch(`/api/comments?passage_uuid=${currentPassageUUID}`),s=await c.json();s.success&&s.data?(o&&(o.textContent=`${s.data.length} æ¡è¯„è®º`),t&&(t.style.display="none"),s.data.length>0?e&&(e.style.display="flex",renderComments(s.data)):n&&(n.style.display="flex")):(console.error("åŠ è½½è¯„è®ºå¤±è´¥:",s),t&&(t.style.display="none"),n&&(n.style.display="flex"))}catch(e){console.error("åŠ è½½è¯„è®ºæ—¶å‡ºé”™:",e),t&&(t.style.display="none"),n&&(n.style.display="flex")}}function renderComments(e){const t=document.getElementById("commentsList");t&&(t.innerHTML="",e.forEach(e=>{const n=createCommentElement(e);t.appendChild(n)}))}function generateIdenticon(e,t=40){const n=simpleHash(e),o=n%360,c=65+n%15,s=55+n%10,a=`hsl(${o}, ${c}%, ${s}%)`,r=`hsl(${o}, ${c}%, ${s-25}%)`;let i="";for(let e=0;e<5;e++)for(let t=0;t<Math.ceil(2.5);t++){n>>5*e+t&1&&(i+=`<rect x="${t}" y="${e}" width="1" height="1" fill="${a}"/>`,i+=`<rect x="${4-t}" y="${e}" width="1" height="1" fill="${a}"/>`)}const l=e?e.charAt(0).toUpperCase():"?";return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(`\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 5 5" width="${t}" height="${t}">\n      <rect width="5" height="5" fill="#f0f0f0"/>\n      ${i}\n      <text x="2.5" y="2.85" \n            text-anchor="middle" \n            font-size="2.5" \n            font-weight="bold" \n            fill="${r}"\n            font-family="system-ui, -apple-system, sans-serif">${l}</text>\n    </svg>\n  `)))}function simpleHash(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t)}function createCommentElement(e){const t=document.createElement("div");t.className="comment-item";const n=generateIdenticon(e.username||"anonymous",40);return t.innerHTML=`\n    <div class="comment-header">\n      <div class="comment-user">\n        <div class="comment-avatar">\n          <img src="${n}" alt="${e.username||"åŒ¿åç”¨æˆ·"}" style="width: 100%; height: 100%; border-radius: 50%;"/>\n        </div>\n        <span class="comment-username">${e.username}</span>\n      </div>\n      <span class="comment-date">${formatDate(e.created_at)}</span>\n    </div>\n    <div class="comment-content">${e.content}</div>\n  `,t}async function submitComment(){const e=document.getElementById("commentUsername"),t=document.getElementById("commentContent"),n=document.getElementById("submitCommentBtn"),o=e.value.trim(),c=t.value.trim();if(!o)return showToast("è¯·è¾“å…¥ç”¨æˆ·å","warning"),void e.focus();if(!c)return showToast("è¯·è¾“å…¥è¯„è®ºå†…å®¹","warning"),void t.focus();n&&(n.disabled=!0);try{const n=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,content:c,passage_uuid:currentPassageUUID})}),s=await n.json();s.success?(e.value="",t.value="",loadComments(),showToast("è¯„è®ºå‘è¡¨æˆåŠŸï¼","success")):showToast("è¯„è®ºå‘è¡¨å¤±è´¥ï¼š"+(s.message||"æœªçŸ¥é”™è¯¯"),"error")}catch(e){console.error("æäº¤è¯„è®ºæ—¶å‡ºé”™:",e),showToast("è¯„è®ºå‘è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error")}finally{n&&(n.disabled=!1)}}function formatDate(e){const t=new Date(e),n=new Date-t,o=Math.floor(n/1e3),c=Math.floor(o/60),s=Math.floor(c/60),a=Math.floor(s/24);return o<60?"åˆšåˆš":c<60?`${c} åˆ†é’Ÿå‰`:s<24?`${s} å°æ—¶å‰`:a<7?`${a} å¤©å‰`:t.toLocaleDateString("zh-CN")}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function updatePageTitle(e){e&&e.title?document.title=`${e.title} - æ–‡ç« é˜…è¯»`:document.title="RustBlog - æ–‡ç« é˜…è¯»",originalTitle=document.title}</script><script src="/js/modal-animations.js" defer></script><script src="/js/markdown-preview-modal.js?v=2" defer></script><script>let originalTitle=document.title;const switchNoticeText="{{ switch_notice_text }}",isNoticeEnabled= {{ switch_notice }};document.addEventListener("visibilitychange",function(){isNoticeEnabled&&(document.hidden?document.title=switchNoticeText:document.title=originalTitle)}),window.addEventListener("focus",function(){isNoticeEnabled&&(document.title=originalTitle)});const isExternalLinkWarningEnabled= {{ external_link_warning }},externalLinkWhitelist="{{ external_link_whitelist }}";let currentExternalLink="";function showExternalLinkWarning(t){currentExternalLink=t;const e=document.getElementById("externalLinkModal"),n=document.getElementById("externalLinkUrl");e&&n&&(n.textContent=t,e.classList.add("active"))}function hideExternalLinkWarning(){const t=document.getElementById("externalLinkModal");t&&t.classList.remove("active")}function proceedToExternalLink(){currentExternalLink&&window.open(currentExternalLink,"_blank"),hideExternalLinkWarning()}function isWhitelistedDomain(t,e){try{if(t.startsWith("/"))return!0;t.startsWith("//")&&(t=window.location.protocol+t);const n=new URL(t).hostname.toLowerCase();if(n===window.location.hostname)return!0;return e.split(",").map(t=>t.trim().toLowerCase()).some(t=>n===t||n.endsWith("."+t)||n==="www."+t||n.startsWith("www.")&&n.slice(4)===t)}catch(t){return!0}}document.addEventListener("click",function(t){const e=t.target.closest("a");if(!e)return;const n=e.getAttribute("href");n&&(n.startsWith("#")||n.startsWith("mailto:")||n.startsWith("tel:")||n.startsWith("javascript:")||isExternalLinkWarningEnabled&&(isWhitelistedDomain(n,externalLinkWhitelist)||(t.preventDefault(),showExternalLinkWarning(n))))}),document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("cancelExternalLinkBtn"),e=document.getElementById("proceedExternalLinkBtn"),n=document.getElementById("externalLinkModal"),i=n?n.querySelector(".modal-close"):null;t&&t.addEventListener("click",hideExternalLinkWarning),e&&e.addEventListener("click",proceedToExternalLink),i&&i.addEventListener("click",hideExternalLinkWarning),n&&n.addEventListener("click",function(t){t.target===n&&hideExternalLinkWarning()})})</script><style>#waifu{position:fixed!important;left:0!important;bottom:0!important;z-index:9999!important;pointer-events:auto!important}#waifu-tool{display:none!important;position:fixed!important;left:0!important;bottom:0!important;z-index:9999!important}.waifu-tips{position:fixed!important;z-index:9999!important}.waifu{position:fixed!important;left:0!important;bottom:0!important;z-index:9999!important}</style><script>!function(){const t= {{ live2d_enabled }},i= {{ live2d_show_on_passage }};if(!t||!i)return;const e={waifuPath:"https://fastly.jsdelivr.net/npm/live2d-widget@1.0.0/dist/waifu-tips.json",cdnPath:"{{ live2d_cdn_path }}",cubism2Path:"https://fastly.jsdelivr.net/npm/live2d-widget@1.0.0/dist/live2d.min.js",cubism5Path:"https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js",modelId: {{ live2d_model_id }},modelPath:"{{ live2d_model_path }}",tools:["switch-model","switch-texture","photo","info","quit"],drag:!0,logLevel:"error",position:"{{ live2d_position }}",width:"{{ live2d_width }}",height:"{{ live2d_height }}"};window.addEventListener("load",function(){setTimeout(function(){try{if(document.querySelector('script[src*="autoload.js"]'))return;const t=document.createElement("script");t.src="https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js",t.async=!0,t.onload=function(){if("function"==typeof initWidget)try{initWidget(e)}catch(t){console.warn("Live2D çœ‹æ¿å¨˜åˆå§‹åŒ–å¤±è´¥:",t)}},t.onerror=function(){console.warn("Live2D çœ‹æ¿å¨˜åŠ è½½å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ– CDN ä¸å¯ç”¨")},document.body.appendChild(t)}catch(t){console.warn("Live2D çœ‹æ¿å¨˜åˆå§‹åŒ–é”™è¯¯:",t)}},1e3)})}()</script>{% if sponsor_enabled %}<div class="modal" id="sponsorModal"><div class="modal-content" style="max-width:500px"><div class="modal-header"><h3>{{ sponsor_title }}</h3><button class="modal-close" data-modal="sponsorModal">Ã—</button></div><div class="modal-body" style="text-align:center"><img src="{{ sponsor_image }}" alt="èµåŠ©äºŒç»´ç " style="max-width:100%;height:auto;border-radius:8px;margin-bottom:20px"><p style="color:#666;line-height:1.6">{{ sponsor_description }}</div></div></div><style>.sponsor-section{text-align:right;margin:30px 0;padding:20px}.sponsor-btn{background:#007bff;color:#fff;border:none;padding:12px 30px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .3s ease;border-radius:8px;box-shadow:0 2px 8px rgba(0,123,255,.3)}.sponsor-btn:hover{background:#0056b3;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,123,255,.4)}.sponsor-btn:active{transform:translateY(0)}html.dark-mode .sponsor-btn{background:#4a9eff;color:#fff}html.dark-mode .sponsor-btn:hover{background:#3395ff}</style><script>document.addEventListener("DOMContentLoaded",function(){window.sponsorEnabled= {{ sponsor_enabled }},window.sponsorButtonText="{{ sponsor_button_text }}";const t=document.getElementById("sponsorBtn"),e=document.getElementById("sponsorModal"),n=e?e.querySelector(".modal-close"):null;t&&e&&(t.addEventListener("click",function(t){t.stopPropagation(),e.classList.add("active")}),n&&n.addEventListener("click",function(t){t.stopPropagation(),e.classList.remove("active")}),e.addEventListener("click",function(t){t.target===e&&e.classList.remove("active")}))})</script>{% endif %}<script src="/js/keyboard-shortcuts.js" defer></script><script src="/js/passage-shortcuts.js" defer></script><script src="/js/passage-focus-mode.js" defer></script><link rel="stylesheet" href="/css/music-player.css" media="print" onload='this.media="all"'><script src="/js/music-player.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("articleFilterToggle"),e=document.getElementById("articleFilterModal"),n=document.querySelectorAll(".filter-tab"),i=document.getElementById("articleFilterSearch"),c=document.getElementById("filterContent");let a="timestamp";function l(){closeModalWithAnimation(e)}t&&t.addEventListener("click",function(){e.classList.add("active"),o()});const r=e?e.querySelector(".modal-content"):null;function o(t=""){c&&(c.innerHTML="","timestamp"===a?function(t=""){if(!articlesData||!articlesData.folders||0===articlesData.folders.length)return void(c.innerHTML='<div class="filter-empty">æš‚æ— æ–‡ç« æ•°æ®</div>');const e=[];function n(t){t.files&&t.files.forEach(t=>{e.push(t)}),t.subfolders&&t.subfolders.forEach(t=>{n(t)})}articlesData.folders.forEach(t=>{n(t)});const i=e.filter(function(e){return!t||e.title.toLowerCase().includes(t.toLowerCase())});if(0===i.length)return void(c.innerHTML='<div class="filter-empty">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </div>');i.sort(function(t,e){return new Date(e.date)-new Date(t.date)}),i.forEach(function(t){const e=function(t){const e=document.createElement("div");e.className="article-filter-item";const n=document.createElement("div");n.className="article-filter-item-icon","published"!==t.status?(n.textContent="ğŸ”’",n.title="draft"===t.status?"è‰ç¨¿":"pending"===t.status?"å¾…å®¡æ ¸":"å®šæ—¶å‘å¸ƒ"):n.textContent="ğŸ“„";const i=document.createElement("div");i.className="article-filter-item-info";const c=document.createElement("div");c.className="article-filter-item-title",c.textContent=t.title;const a=document.createElement("div");return a.className="article-filter-item-meta",a.textContent=function(t){if(!t)return"";return new Date(t).toLocaleDateString("zh-CN")}(t.date),i.appendChild(c),i.appendChild(a),e.appendChild(n),e.appendChild(i),e.addEventListener("click",function(){l(),t.id&&openArticleInNewTab(t.id)}),e}(t);c.appendChild(e)})}(t):function(t=""){const e=document.querySelector(".article.active .article-content");if(!e)return void(c.innerHTML='<div class="filter-empty">è¯·å…ˆé€‰æ‹©ä¸€ç¯‡æ–‡ç« </div>');const n=e.querySelectorAll("h1, h2, h3, h4, h5, h6");if(0===n.length)return void(c.innerHTML='<div class="filter-empty">æœ¬æ–‡æš‚æ— ç›®å½•</div>');n.forEach((t,e)=>{t.id||(t.id=`heading-${e}`)});let i=Array.from(n);t&&(i=i.filter(function(e){return e.textContent.toLowerCase().includes(t.toLowerCase())}));if(0===i.length)return void(c.innerHTML='<div class="filter-empty">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç›®å½•é¡¹</div>');i.forEach(function(t){const e=function(t){const e=document.createElement("div");e.className="article-filter-item";const n=document.createElement("div");n.className="article-filter-item-icon";const i=parseInt(t.tagName.substring(1)),c=["ğŸ“Œ","ğŸ“","ğŸ“","ğŸ”–","ğŸ·ï¸","ğŸ“"];n.textContent=c[i-1]||"ğŸ“Œ";const a=document.createElement("div");a.className="article-filter-item-info";const r=document.createElement("div");r.className="article-filter-item-title",r.textContent=t.textContent.trim();const o=document.createElement("div");return o.className="article-filter-item-meta",o.textContent=`H${i}`,a.appendChild(r),a.appendChild(o),e.appendChild(n),e.appendChild(a),e.addEventListener("click",function(){t.scrollIntoView({behavior:"smooth",block:"start"}),l()}),e}(t);c.appendChild(e)})}(t))}r&&r.addEventListener("click",function(t){t.stopPropagation()}),e&&e.addEventListener("click",l),n.forEach(function(t){t.addEventListener("click",function(){n.forEach(function(t){t.classList.remove("active")}),this.classList.add("active"),a=this.dataset.mode,o()})}),i&&i.addEventListener("input",function(){o(this.value)})})</script>{% if settings.floating_text_enabled %}<script src="/js/floating-text.js" defer></script>{% endif %}