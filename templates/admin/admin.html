<!DOCTYPE html><html lang="zh-CN"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,viewport-fit=cover"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)"><meta name="description" content="{{ title }} - ÁÆ°ÁêÜÂëòÂêéÂè∞„ÄÇÁÆ°ÁêÜÊñáÁ´†„ÄÅÂàÜÁ±ª„ÄÅÊ†áÁ≠æ„ÄÅËØÑËÆ∫ÔºåÈÖçÁΩÆÁΩëÁ´ôËÆæÁΩÆÔºåÁÆ°ÁêÜÁî®Êà∑ÊùÉÈôêÂíåÈôÑ‰ª∂ËµÑÊ∫ê„ÄÇ"><title>{{ title }} - ÁÆ°ÁêÜÂëò</title><style>:root{--navbar-glass-color: {{ settings.navbar_glass_color }};--card-glass-color: {{ settings.card_glass_color }};--footer-glass-color: {{ settings.footer_glass_color }}}*{margin:0;padding:0;box-sizing:border-box}a{color:rgba(255,255,255,.9);text-decoration:none}a:hover{color:#fff}body,html{height:100%;width:100%;overflow-x:hidden}body{display:flex;flex-direction:column;min-height:100vh;min-height:-webkit-fill-available;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);position:relative;background-image:url('{{ settings.background_image | safe }}');background-size: {{ settings.background_size }};background-position: {{ settings.background_position }};background-repeat: {{ settings.background_repeat }};background-attachment: {{ settings.background_attachment }};--global-opacity: {{ settings.global_opacity }}}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.3);backdrop-filter:blur(5px);z-index:-1}nav{display:flex;justify-content:flex-end;align-items:center;position:fixed;top:env(safe-area-inset-top);right:0;padding:15px env(safe-area-inset-right) 15px env(safe-area-inset-left);width:100%;background:var(--navbar-glass-color,rgba(255,255,255,.85));backdrop-filter:blur(10px) saturate(180%);-webkit-backdrop-filter:blur(10px) saturate(180%);border-bottom:1px solid rgba(255,255,255,.1);z-index:100;transition:transform .4s cubic-bezier(.25, .46, .45, .94),opacity .4s ease;transform:translateY(0);opacity:1}nav.hidden{transform:translateY(-100%);opacity:0}nav a{color:var(--navbar-text-color,rgba(255,255,255,.9));text-decoration:none;margin:0 15px;font-weight:500;transition:all .3s ease;position:relative;padding:8px 16px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:25px}nav a:hover{color:#fff;background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}nav a::after{display:none}nav a.current{color:#fff;background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.6)}#loginBtn{display:flex;align-items:center;gap:8px;color:var(--navbar-text-color,rgba(255,255,255,.9));text-decoration:none;margin:0 15px;font-weight:500;transition:all .3s ease;padding:8px 16px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:25px;cursor:pointer}#loginBtn:hover{color:#fff;background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}#userCenterToggle{display:none;align-items:center;gap:8px;color:var(--navbar-text-color,rgba(255,255,255,.9));text-decoration:none;margin:0 15px;font-weight:500;transition:all .3s ease;padding:8px 16px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:25px;cursor:pointer}#userCenterToggle:hover{color:#fff;background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.user-avatar{width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;color:#333;font-weight:700;font-size:14px}#userCenter{display:none;position:fixed;top:calc(env(safe-area-inset-top) + 70px);left:20px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px;z-index:101;min-width:200px;overflow:hidden;animation:slideDown .3s ease}#userCenter.active{display:block}@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.user-center-header{padding:20px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.user-center-header h3{font-size:1.2em;margin-bottom:5px}.user-center-header p{font-size:.9em;opacity:.7;color:rgba(255,255,255,.9)}.user-center-menu{padding:10px 0}.user-center-menu a{display:block;padding:12px 20px;color:#333;text-decoration:none;transition:all .3s ease;background:0 0;border:none;border-radius:0;text-shadow:none;margin:0}.user-center-menu a:hover{background:rgba(0,123,255,.1);color:#007bff;transform:none;box-shadow:none}.user-center-menu .divider{height:1px;background:rgba(0,0,0,.1);margin:10px 20px}#logoutBtn{display:block;padding:12px 20px;color:#e74c3c;text-decoration:none;transition:all .3s ease;background:0 0;border:none;border-radius:0;text-shadow:none;margin:0;cursor:pointer;width:100%;text-align:left;font-size:1em}#logoutBtn:hover{background:rgba(231,76,60,.1);color:#c0392b;transform:none;box-shadow:none}main{flex:1;padding:120px 20px 60px;position:relative;z-index:1}.title-container{position:relative;display:inline-block;margin:30px 0 40px;text-align:center;width:100%}.h1{text-align:center;color:#222;font-size:3.5em;font-weight:800;text-shadow:3px 3px 6px rgba(0,0,0,.1),0 0 15px rgba(255,255,255,.8);letter-spacing:1.5px;line-height:1.1;position:relative;padding-bottom:20px;font-family:'Segoe UI','Helvetica Neue',sans-serif;display:inline-block}.h1::after{content:'';position:absolute;right:-15px;top:50%;transform:translateY(-50%);width:8px;height:1.2em;background-color:#222;opacity:.9;box-shadow:0 0 8px rgba(0,123,255,.7);animation:blink 1s step-end infinite;border-radius:2px}.title-container::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:150px;height:4px;background:rgba(255,255,255,.5);border-radius:3px;box-shadow:0 2px 8px rgba(0,0,0,.1)}@keyframes blink{0%,50%{opacity:1}100%,51%{opacity:0}}.admin-container{max-width:1400px;margin:0 auto;display:flex;flex-direction:column;gap:30px}.welcome-card{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);padding:30px;border-radius:20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}.welcome-text h2{color:#222;font-size:2em;margin-bottom:10px}.welcome-text p{color:#666;font-size:1.1em}.admin-avatar{width:80px;height:80px;border-radius:50%;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;overflow:hidden;color:#333;font-size:2em;font-weight:700}.admin-avatar .avatar-image{width:100%;height:100%;object-fit:cover;border-radius:50%}.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px}.stat-card{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);padding:25px;border-radius:15px;transition:all .3s ease;position:relative;overflow:hidden}.stat-card:hover{transform:translateY(-5px);border-color:rgba(255,255,255,.5)}.stat-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:4px;background:rgba(255,255,255,.5)}.stat-card:nth-child(2)::before{background:rgba(255,255,255,.5)}.stat-card:nth-child(3)::before{background:rgba(255,255,255,.5)}.stat-card:nth-child(4)::before{background:rgba(255,255,255,.5)}.stat-header{display:flex;justify-content:space-between;align-items:center}.analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:25px;margin-top:25px}.analytics-card{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);padding:25px;border-radius:15px;transition:all .3s ease}.analytics-card:hover{transform:translateY(-3px);border-color:rgba(255,255,255,.5)}.analytics-card.full-width{grid-column:1/-1}.analytics-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid rgba(255,255,255,.2)}.analytics-header h4{margin:0;font-size:1.2em;color:rgba(255,255,255,.95)}.analytics-content{min-height:200px}.analytics-content table{width:100%;border-collapse:collapse}.analytics-content table td,.analytics-content table th{padding:12px;text-align:left;border-bottom:1px solid rgba(255,255,255,.1)}.analytics-content table th{color:rgba(255,255,255,.8);font-weight:600;font-size:.9em}.analytics-content table td{color:rgba(255,255,255,.9);font-size:.95em}.analytics-content table tr:hover{background:rgba(255,255,255,.05)}.stat-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.stat-icon{width:50px;height:50px;border-radius:12px;background:rgba(0,123,255,.1);display:flex;align-items:center;justify-content:center;font-size:1.5em;color:#007bff}.stat-card:nth-child(2) .stat-icon{background:rgba(0,184,148,.1);color:#00b894}.stat-card:nth-child(3) .stat-icon{background:rgba(108,92,231,.1);color:#6c5ce7}.stat-card:nth-child(4) .stat-icon{background:rgba(253,126,20,.1);color:#fd7e14}.stat-title{font-size:1.1em;color:#666;font-weight:500}.stat-value{font-size:2.5em;font-weight:700;color:#222;line-height:1;margin-bottom:10px}.stat-change{display:flex;align-items:center;font-size:.9em}.stat-change.positive{color:#00b894}.stat-change.negative{color:#e74c3c}.stat-change.neutral{color:#6c757d}.admin-panel{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:20px;overflow:hidden;margin-top:20px}.panel-header{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid rgba(255,255,255,.3);padding:20px 30px;color:#333}.panel-header h2{font-size:1.8em;font-weight:600}.tab-nav{display:flex;background:rgba(255,255,255,.9);border-bottom:1px solid rgba(0,0,0,.05);flex-wrap:wrap}.tab-btn{padding:18px 30px;background:0 0;border:none;font-size:1.1em;font-weight:500;color:#666;cursor:pointer;transition:all .3s ease;position:relative}.tab-btn:hover{color:#007bff;background:rgba(0,123,255,.05)}.tab-btn.active{color:#007bff;font-weight:600}.tab-btn.active::after{content:'';position:absolute;bottom:0;left:0;width:100%;height:3px;background:rgba(255,255,255,.6)}.quick-actions{display:flex;gap:15px;padding:10px 30px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid rgba(255,255,255,.3)}.action-btn{display:flex;align-items:center;gap:8px;padding:10px 20px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease}.action-btn:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.action-btn.secondary{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.action-btn.secondary:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.tab-content{padding:30px}.tab-pane{display:none}.tab-pane.active{display:block;animation:fadeIn .5s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.data-table{width:100%;border-collapse:collapse;margin-top:20px}.data-table th{text-align:left;padding:15px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);color:rgba(255,255,255,.9);font-weight:600;border-bottom:2px solid rgba(255,255,255,.3)}.data-table td{padding:15px;border-bottom:1px solid rgba(0,0,0,.05)}.data-table tr:hover{background:rgba(255,255,255,.2)}.data-table tr.selected{background:rgba(0,123,255,.15)}.batch-actions-bar{display:flex;justify-content:space-between;align-items:center;margin-top:15px;padding:15px 20px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px;animation:slideDown .3s ease}.batch-actions-info{display:flex;align-items:center;gap:10px;color:rgba(255,255,255,.9);font-weight:500}.batch-actions-info svg{width:20px;height:20px;color:#007bff}.batch-actions-buttons{display:flex;gap:10px}.article-checkbox,.select-all-checkbox{width:18px;height:18px;cursor:pointer;accent-color:#007bff;transition:all .3s ease}.article-checkbox:hover,.select-all-checkbox:hover{transform:scale(1.1)}.data-table td:first-child,.data-table th:first-child{width:50px;text-align:center;padding:15px 10px}.data-table .status{padding:5px 12px;border-radius:20px;font-size:.85em;font-weight:500}.status.published{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.status.draft{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.status.pending{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.status.scheduled{background:rgba(255,193,7,.2);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,193,7,.4);color:rgba(255,193,7,.9);font-size:.85em;margin-left:5px}.visibility{display:inline-block;padding:4px 12px;border-radius:12px;font-size:.85em;font-weight:500;backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%)}.visibility-public{background:rgba(0,184,148,.2);border:1px solid rgba(0,184,148,.4);color:rgba(0,184,148,.9)}.visibility-private{background:rgba(253,203,110,.2);border:1px solid rgba(253,203,110,.4);color:rgba(253,203,110,.9)}.action-buttons{display:flex;gap:8px}.btn{padding:8px 16px;border:none;border-radius:6px;font-size:.9em;font-weight:500;cursor:pointer;transition:all .3s ease}.btn-sm{padding:5px 12px;font-size:.85em}.btn-edit{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.btn-edit:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.btn-delete{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.btn-delete:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.btn-view{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.btn-view:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.btn-upload{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9)}.btn-upload:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.btn-group{display:flex;gap:15px;margin-top:30px}.pagination-container{display:flex;justify-content:space-between;align-items:center;margin-top:20px;padding:15px 20px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px}.pagination-info{color:#333;font-size:.95em}.pagination-controls{display:flex;align-items:center;gap:10px}.pagination-btn{display:flex;align-items:center;gap:6px;padding:8px 16px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);border-radius:8px;font-size:.9em;font-weight:500;cursor:pointer;transition:all .3s ease}.pagination-btn:hover:not(:disabled){background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.pagination-btn:disabled{opacity:.5;cursor:not-allowed}.pagination-pages{display:flex;gap:5px}.pagination-page{min-width:36px;height:36px;padding:0 12px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);border-radius:8px;font-size:.9em;font-weight:500;cursor:pointer;transition:all .3s ease}.pagination-page:hover:not(.active):not(.ellipsis){background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.pagination-page.active{background:rgba(255,255,255,.35);border-color:rgba(255,255,255,.7);font-weight:600}.pagination-page.ellipsis{background:0 0;border:none;cursor:default;color:rgba(255,255,255,.9)}.btn-primary{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);padding:12px 30px;border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease}.btn-primary:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}.btn-primary:disabled:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.3);transform:none}.btn-danger{background:rgba(231,76,60,.2);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(231,76,60,.4);color:rgba(255,255,255,.95);padding:12px 30px;border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 15px rgba(231,76,60,.2)}.btn-danger:hover{background:rgba(231,76,60,.35);border-color:rgba(231,76,60,.6);transform:translateY(-2px);box-shadow:0 8px 25px rgba(231,76,60,.3)}.btn-danger:active{transform:translateY(0);box-shadow:0 2px 10px rgba(231,76,60,.2)}.btn-danger:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.btn-danger:disabled:hover{background:rgba(231,76,60,.2);border-color:rgba(231,76,60,.4);transform:none;box-shadow:none}.btn-secondary{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);padding:12px 30px;border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease}.btn-secondary:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1000;justify-content:center;align-items:center;padding:20px;animation:fadeIn .3s ease}.modal.active{display:flex}.modal-content{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:20px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;animation:slideIn .3s ease;position:relative}@keyframes slideIn{from{transform:translateY(-50px) scale(.9);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}@keyframes slideOutFade{from{transform:translateY(0) scale(1);opacity:1}to{transform:translateY(-50px) scale(.9);opacity:0}}.modal.closing .modal-content{animation:slideOutFade .3s ease forwards}.modal-header{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-bottom:1px solid rgba(255,255,255,.3);padding:20px 30px;color:rgba(255,255,255,.9);border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}.modal-header h3{font-size:1.5em;font-weight:600}.modal-close{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);font-size:1.5em;cursor:pointer;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.modal-close:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:rotate(90deg)}.modal-body{padding:30px}.form-group{margin-bottom:25px}.form-group label{display:block;margin-bottom:8px;color:#333;font-weight:500}.form-control{width:100%;padding:12px 15px;border:1px solid rgba(255,255,255,.5);border-radius:8px;font-size:1em;background:rgba(255,255,255,.1);backdrop-filter:blur(30px) saturate(200%);-webkit-backdrop-filter:blur(30px) saturate(200%);color:#333;transition:all .3s ease}.form-control:focus{outline:0;border-color:#007bff;background:rgba(255,255,255,.2);box-shadow:0 0 0 3px rgba(0,123,255,.2)}textarea.form-control{min-height:150px;resize:vertical}.upload-area{border:2px dashed rgba(255,255,255,.3);border-radius:12px;padding:40px 20px;text-align:center;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);cursor:pointer;transition:all .3s ease;margin-bottom:20px}.upload-area:hover{border-color:rgba(255,255,255,.5);background:rgba(0,0,0,0)}.upload-area.dragover{border-color:rgba(255,255,255,.7);background:rgba(255,255,255,.35)}.upload-icon{font-size:3em;color:rgba(255,255,255,.9);margin-bottom:15px}.upload-text h4{color:rgba(255,255,255,.9);margin-bottom:10px}.upload-text p{color:rgba(255,255,255,.7);font-size:.95em}.upload-preview{display:flex;flex-wrap:wrap;gap:15px;margin-top:20px}.upload-item{position:relative;width:120px;height:120px;border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.1)}.upload-item img{width:100%;height:100%;object-fit:cover}.upload-remove{position:absolute;top:5px;right:5px;width:25px;height:25px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);border-radius:50%;font-size:.8em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.upload-remove:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.tag-selector{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}.tag-option{padding:8px 16px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:20px;color:rgba(255,255,255,.9);font-size:.9em;cursor:pointer;transition:all .3s ease}.tag-option:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5)}.tag-option.selected{background:rgba(255,255,255,.35);color:rgba(255,255,255,.9);border-color:rgba(255,255,255,.7)}.tag-option.selected::after{content:'‚úì';position:absolute;right:8px;font-size:.8em;color:#fff;font-weight:700;margin-left:8px}.tag-input-container{display:flex;gap:10px;margin-top:15px}.tag-input{flex:1}.category-selector{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}.category-option{padding:8px 16px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:20px;color:rgba(255,255,255,.9);font-size:.9em;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;position:relative;overflow:hidden}.category-option:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}.category-option.selected{background:linear-gradient(135deg,rgba(0,123,255,.4),rgba(0,184,148,.4));backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);color:#fff;border-color:rgba(0,123,255,.8);font-weight:600;box-shadow:0 4px 15px rgba(0,123,255,.3);transform:translateY(-2px)}.category-option.selected::before{content:'‚úì';position:absolute;right:8px;font-size:.8em;color:#fff;font-weight:700}.category-input-container{display:flex;gap:10px;margin-top:15px}.category-input{flex:1}footer{text-align:center;padding:30px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-top:1px solid rgba(255,255,255,.3);margin-top:auto;position:relative;z-index:1}footer p{color:#666;font-size:1.1em;margin-top:10px}.scroll-indicator{position:fixed;top:calc(env(safe-area-inset-top) + 70px);right:20px;width:4px;height:60px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:2px;z-index:99;overflow:hidden;opacity:0;transition:opacity .3s ease}.scroll-indicator.active{opacity:1}.scroll-progress{position:absolute;top:0;left:0;width:100%;height:0%;background:rgba(255,255,255,.6);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-radius:2px;transition:height .1s ease}.music-drop-zone{border:2px dashed rgba(255,255,255,.3);border-radius:12px;padding:50px 30px;text-align:center;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);cursor:pointer;transition:all .3s ease;margin-bottom:20px;position:relative}.music-drop-zone:hover{border-color:rgba(255,255,255,.5);background:rgba(255,255,255,.05);transform:translateY(-2px)}.music-drop-zone.dragover{border-color:rgba(255,255,255,.7);background:rgba(255,255,255,.15);transform:scale(1.02)}.drop-zone-content{pointer-events:none}.drop-zone-icon{color:rgba(255,255,255,.9);margin-bottom:20px;transition:all .3s ease}.music-drop-zone:hover .drop-zone-icon{transform:translateY(-5px)}.music-drop-zone h4{color:rgba(255,255,255,.9);font-size:1.3em;margin-bottom:10px;font-weight:600}.music-drop-zone p{color:rgba(255,255,255,.7);font-size:.95em;margin:5px 0}.browse-link{color:rgba(255,255,255,.9);text-decoration:underline;cursor:pointer;font-weight:500}.browse-link:hover{color:#fff}.upload-hint{font-size:.85em;color:rgba(255,255,255,.5);margin-top:15px}.hidden-input{display:none}.music-upload-list{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px;overflow:hidden;margin-bottom:20px}.upload-list-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:rgba(255,255,255,.05);border-bottom:1px solid rgba(255,255,255,.2)}.upload-list-title{color:rgba(255,255,255,.9);font-weight:600;font-size:1.1em}.clear-upload-btn{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);padding:6px 16px;border-radius:6px;font-size:.9em;cursor:pointer;transition:all .3s ease}.clear-upload-btn:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-1px)}.upload-items{max-height:400px;overflow-y:auto;padding:10px}.upload-item{display:flex;align-items:center;gap:15px;padding:15px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.15);border-radius:8px;margin-bottom:10px;transition:all .3s ease}.upload-item:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.3)}.upload-item-icon{width:50px;height:50px;background:rgba(255,255,255,.1);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:rgba(255,255,255,.9);font-size:1.5em}.upload-item-info{flex:1;min-width:0}.upload-item-name{color:rgba(255,255,255,.9);font-weight:500;margin-bottom:5px;word-break:break-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.upload-item-meta{display:flex;gap:15px;font-size:.85em;color:rgba(255,255,255,.6)}.upload-item-progress{width:150px;flex-shrink:0}.progress-bar{height:6px;background:rgba(255,255,255,.1);border-radius:3px;overflow:hidden;margin-bottom:5px}.progress-fill{height:100%;background:linear-gradient(90deg,rgba(255,255,255,.6),rgba(255,255,255,.8));border-radius:3px;transition:width .3s ease;width:0%}.progress-text{font-size:.8em;color:rgba(255,255,255,.7);text-align:right}.upload-item-status{font-size:.85em;padding:4px 10px;border-radius:12px;font-weight:500;flex-shrink:0}.upload-item-status.pending{background:rgba(255,255,255,.1);color:rgba(255,255,255,.8)}.upload-item-status.uploading{background:rgba(0,123,255,.2);color:#007bff}.upload-item-status.success{background:rgba(0,184,148,.2);color:#00b894}.upload-item-status.error{background:rgba(231,76,60,.2);color:#e74c3c}.upload-item-action{flex-shrink:0}.remove-upload-btn{width:32px;height:32px;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:6px;color:rgba(255,255,255,.9);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;font-size:1.1em}.remove-upload-btn:hover{background:rgba(231,76,60,.3);border-color:rgba(231,76,60,.5);color:#e74c3c}.remove-upload-btn:disabled{opacity:.5;cursor:not-allowed}.upload-actions{display:flex;gap:15px;padding:15px 20px;background:rgba(255,255,255,.05);border-top:1px solid rgba(255,255,255,.2)}.upload-actions .btn-primary,.upload-actions .btn-secondary{flex:1}.upload-items::-webkit-scrollbar{width:6px}.upload-items::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:3px}.upload-items::-webkit-scrollbar-thumb{background:rgba(255,255,255,.2);border-radius:3px}.upload-items::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.3)}.upload-item-cover{width:60px;height:60px;flex-shrink:0;position:relative}.cover-preview{width:60px;height:60px;border-radius:8px;background:rgba(255,255,255,.1);border:2px dashed rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;overflow:hidden;position:relative}.cover-preview:hover{border-color:rgba(255,255,255,.6);background:rgba(255,255,255,.15)}.cover-preview img{width:100%;height:100%;object-fit:cover;border-radius:6px}.cover-preview.has-cover{border-style:solid}.cover-preview .cover-placeholder{color:rgba(255,255,255,.5);font-size:1.5em}.cover-preview .cover-upload-hint{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;color:#fff;font-size:.8em;opacity:0;transition:opacity .3s ease;border-radius:6px;text-align:center;padding:5px}.cover-preview:hover .cover-upload-hint{opacity:1}.cover-input{display:none}.cover-remove-btn{position:absolute;top:-8px;right:-8px;width:20px;height:20px;background:rgba(231,76,60,.9);border:2px solid #fff;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;font-weight:700;opacity:0;transition:all .3s ease;z-index:10}.cover-preview.has-cover:hover .cover-remove-btn{opacity:1}.cover-remove-btn:hover{background:#e74c3c;transform:scale(1.1)}@media (max-width:1024px){.dashboard-grid{grid-template-columns:repeat(2,1fr)}.modal-content{max-width:90%}}@media (max-width:768px){.h1{font-size:2.5em}.welcome-card{flex-direction:column;text-align:center;gap:20px}.dashboard-grid{grid-template-columns:1fr}.quick-actions,.tab-nav{flex-wrap:wrap}.tab-btn{flex:1;min-width:120px;text-align:center;padding:15px 10px}.data-table{display:block;overflow-x:auto}.action-buttons{flex-wrap:wrap}nav{padding:12px 15px}nav a,nav button{font-size:0;margin:0 4px;padding:10px;min-width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%}#loginBtn span:not(:has(svg)),nav a span:not(.shortcut-hint),nav button span:not(.shortcut-hint){display:none}.shortcut-hint{display:none!important}nav a svg,nav button svg{display:block;font-size:initial}nav a[href="/"]::before{content:'üè†';font-size:18px}nav a[href="/passage"]::before{content:'üìù';font-size:18px}nav a[href="/collect"]::before{content:'üìÅ';font-size:18px}nav a[href="/about"]::before{content:'‚ÑπÔ∏è';font-size:18px}nav a[href="/markdown-editor"]::before{content:'‚úèÔ∏è';font-size:18px}nav a[href="/admin"]::before{content:'‚öôÔ∏è';font-size:18px}#loginBtn svg{width:20px;height:20px}.modal-content{max-width:95%;margin:10px}.modal-body{padding:20px}}@media (max-width:480px){main{padding:100px 15px 40px}.tab-content{padding:20px}.btn-group,.tag-input-container{flex-direction:column}.btn-primary,.btn-secondary{width:100%}}.settings-section{margin-bottom:30px}.settings-section h4{font-size:1.3em;color:#333;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid rgba(255,255,255,.3)}.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px}.settings-grid .form-group{margin-bottom:0}input[type=range].form-control{width:100%;padding:10px 0;background:0 0}input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:8px;background:rgba(255,255,255,.3);border-radius:4px;outline:0}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;background:rgba(255,255,255,.6);border-radius:50%;cursor:pointer;transition:all .3s ease}input[type=range]::-webkit-slider-thumb:hover{background:rgba(255,255,255,.9);transform:scale(1.1)}input[type=range]::-moz-range-thumb{width:20px;height:20px;background:rgba(255,255,255,.6);border-radius:50%;cursor:pointer;border:none;transition:all .3s ease}input[type=range]::-moz-range-thumb:hover{background:rgba(255,255,255,.9);transform:scale(1.1)}.settings-preview{margin-top:30px;padding:20px;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:12px;border:1px solid rgba(255,255,255,.2)}.settings-preview h5{font-size:1.1em;color:#333;margin-bottom:15px}.preview-box{min-height:150px;padding:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,.9);font-size:1.1em;text-align:center;transition:all .3s ease;position:relative;overflow:hidden}.preview-box::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-image:url('/img/test.webp');background-size:cover;background-position:center;background-repeat:no-repeat;background-attachment:fixed;z-index:-1}.preview-box p{position:relative;z-index:1;text-shadow:0 2px 4px rgba(0,0,0,.3)}.toast-container{position:fixed;top:20px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;max-width:400px;width:100%}.toast{background:rgba(255,255,255,.95);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:12px;padding:16px 20px;box-shadow:0 8px 32px rgba(0,0,0,.15);display:flex;align-items:center;gap:12px;animation:slideIn .3s ease,fadeOut .3s ease 2.7s forwards;min-width:280px;max-width:100%}.toast.success{border-left:4px solid #10b981}.toast.error{border-left:4px solid #ef4444}.toast.warning{border-left:4px solid #f59e0b}.toast-icon{font-size:24px;flex-shrink:0;width:28px;height:28px;display:flex;align-items:center;justify-content:center}.toast-message{flex:1;color:#1f2937;font-size:14px;line-height:1.4;word-wrap:break-word}.toast-close{background:0 0;border:none;color:#9ca3af;cursor:pointer;font-size:18px;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:color .2s ease;flex-shrink:0}.toast-close:hover{color:#4b5563}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@media (max-width:768px){.toast-container{top:10px;right:10px;left:10px;max-width:none}.toast{padding:14px 16px;min-width:auto}.toast-message{font-size:13px}}.fm-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.fm-header h3{margin:0;color:#333}.fm-actions{display:flex;gap:10px}.fm-container{display:flex;background:rgba(255,255,255,.95);border-radius:15px;overflow:hidden;height:600px;border:1px solid rgba(0,0,0,.1)}.fm-sidebar{width:280px;background:rgba(248,249,250,.95);border-right:1px solid rgba(0,0,0,.1);display:flex;flex-direction:column}.fm-sidebar-header{padding:15px 20px;background:rgba(0,0,0,.02);border-bottom:1px solid rgba(0,0,0,.1);font-weight:600;color:#333}.fm-tree{flex:1;overflow-y:auto;padding:10px}.fm-tree-item{padding:8px 12px;cursor:pointer;border-radius:6px;display:flex;align-items:center;gap:8px;transition:all .2s ease;color:#555;font-size:.95em}.fm-tree-item:hover{background:rgba(0,123,255,.1);color:#007bff}.fm-tree-item.active{background:rgba(0,123,255,.15);color:#007bff;font-weight:500}.fm-tree-item .fm-tree-icon{font-size:1.1em}.fm-tree-children{margin-left:20px;display:none}.fm-tree-children.expanded{display:block}.fm-main{flex:1;display:flex;flex-direction:column}.fm-toolbar{display:flex;align-items:center;gap:15px;padding:12px 20px;background:rgba(0,0,0,.02);border-bottom:1px solid rgba(0,0,0,.1)}.fm-tool-btn{display:flex;align-items:center;justify-content:center;width:36px;height:36px;background:rgba(255,255,255,.9);border:1px solid rgba(0,0,0,.15);border-radius:6px;cursor:pointer;transition:all .2s ease;font-size:1.2em;color:#555}.fm-tool-btn:hover:not(:disabled){background:rgba(0,123,255,.1);border-color:rgba(0,123,255,.3);color:#007bff}.fm-tool-btn:disabled{opacity:.5;cursor:not-allowed}.fm-breadcrumb{flex:1;font-size:.95em;color:#555;font-weight:500}.fm-info{font-size:.9em;color:#888}.fm-file-list{flex:1;overflow-y:auto;padding:15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:15px;align-content:start}.fm-file-item{display:flex;flex-direction:column;align-items:center;padding:15px 10px;background:rgba(255,255,255,.9);border:1px solid rgba(0,0,0,.1);border-radius:10px;cursor:pointer;transition:all .2s ease;position:relative}.fm-file-item:hover{background:rgba(0,123,255,.05);border-color:rgba(0,123,255,.3);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}.fm-file-icon{font-size:3em;margin-bottom:8px}.fm-file-icon img{width:60px;height:60px;object-fit:cover;border-radius:6px}.fm-file-name{font-size:.9em;color:#333;text-align:center;word-break:break-all;line-height:1.3;max-width:100%;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.fm-file-meta{font-size:.8em;color:#888;margin-top:5px}.fm-empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#888}.fm-empty-icon{font-size:4em;margin-bottom:15px;opacity:.5}.fm-context-menu{position:fixed;background:rgba(255,255,255,.98);border:1px solid rgba(0,0,0,.15);border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.15);z-index:1000;min-width:180px;display:none}.fm-context-menu.active{display:block}.fm-context-menu-item{padding:10px 15px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all .2s ease;color:#333;font-size:.95em}.fm-context-menu-item:hover{background:rgba(0,123,255,.1);color:#007bff}.fm-context-menu-item.danger{color:#e74c3c}.fm-context-menu-item.danger:hover{background:rgba(231,76,60,.1)}.fm-context-menu-divider{height:1px;background:rgba(0,0,0,.1);margin:5px 0}@media (max-width:1024px){.fm-container{flex-direction:column;height:auto}.fm-sidebar{width:100%;max-height:200px}.fm-main{min-height:400px}}.am-header{margin-bottom:20px}.am-header h3{margin:0 0 10px 0;color:#333}.am-header p{margin:0;color:#666;font-size:.95em}.am-filter-section{background:rgba(255,255,255,.95);border:1px solid rgba(0,0,0,.1);border-radius:12px;padding:20px;margin-bottom:20px}.am-filter-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;align-items:end}.am-filter-row .form-group{margin-bottom:0}.am-filter-row label{display:block;margin-bottom:5px;font-size:.9em;font-weight:500;color:#555}.am-stats{display:flex;gap:20px;padding:15px 20px;background:rgba(255,255,255,.95);border:1px solid rgba(0,0,0,.1);border-radius:12px;margin-bottom:20px;flex-wrap:wrap}.am-stat-item{display:flex;align-items:center;gap:8px;font-size:.95em}.am-stat-label{color:#666}.am-stat-value{font-weight:600;color:#333}.am-list-container{background:rgba(255,255,255,.95);border:1px solid rgba(0,0,0,.1);border-radius:12px;overflow:hidden;margin-bottom:20px}.am-list-container table{margin:0;border-collapse:collapse;width:100%}.am-list-container thead{background:rgba(0,123,255,.1)}.am-list-container th{padding:12px 15px;text-align:left;font-weight:600;color:#333;font-size:.9em;border-bottom:2px solid rgba(0,123,255,.2)}.am-list-container td{padding:12px 15px;border-bottom:1px solid rgba(0,0,0,.05);vertical-align:middle}.am-list-container tr:hover{background:rgba(0,123,255,.05)}.am-list-container tr.selected{background:rgba(0,123,255,.15)}.am-list-container input[type=checkbox]{width:18px;height:18px;cursor:pointer}.am-empty-state{text-align:center;padding:60px 20px;color:#888}.am-empty-icon{font-size:4em;margin-bottom:15px;opacity:.5}.am-empty-state p{font-size:1.1em;margin-bottom:20px}.am-batch-actions{display:flex;align-items:center;gap:15px;padding:15px 20px;background:rgba(255,255,255,.95);border:1px solid rgba(0,123,255,.3);border-radius:12px;margin-bottom:20px;flex-wrap:wrap;animation:slideDown .3s ease}.am-batch-actions strong{color:#007bff;font-size:1.1em}.upload-area{border:2px dashed rgba(0,123,255,.3);border-radius:12px;padding:40px 20px;text-align:center;background:rgba(0,123,255,.02);cursor:pointer;transition:all .3s ease;margin-bottom:20px}.upload-area:hover{border-color:rgba(0,123,255,.6);background:rgba(0,123,255,.05)}.upload-area.dragover{border-color:rgba(0,123,255,.8);background:rgba(0,123,255,.1);transform:scale(1.02)}.upload-icon{font-size:3em;color:#007bff;margin-bottom:15px}.upload-text h4{color:#333;margin-bottom:8px;font-size:1.1em}.upload-text p{color:#666;font-size:.9em}.upload-preview{display:flex;flex-wrap:wrap;gap:15px;margin-top:20px;min-height:0}.upload-item{position:relative;width:120px;height:120px;border-radius:10px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.15);border:2px solid rgba(0,123,255,.2);transition:all .3s ease}.upload-item:hover{transform:translateY(-3px);box-shadow:0 6px 16px rgba(0,0,0,.2);border-color:rgba(0,123,255,.4)}.upload-item img{width:100%;height:100%;object-fit:cover}.upload-remove{position:absolute;top:5px;right:5px;width:28px;height:28px;background:rgba(231,76,60,.9);color:#fff;border-radius:50%;font-size:1.2em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease;border:2px solid #fff;z-index:10}.upload-remove:hover{background:#e74c3c;transform:scale(1.1)}@media (max-width:768px){.am-filter-row{grid-template-columns:1fr}.am-stats{flex-direction:column;gap:10px}.am-list-container{overflow-x:auto}.am-list-container table{min-width:800px}.am-batch-actions{flex-direction:column;align-items:stretch}.am-batch-actions button{width:100%}.shortcuts-help-btn{display:none!important}.shortcut-hint{display:none!important}}body.admin-focus-mode{outline:3px solid rgba(255,183,122,.8);outline-offset:-3px;transition:outline .3s ease}body.admin-focus-mode::before{background:rgba(255,183,122,.15);transition:background .3s ease}body.admin-focus-mode .tab-btn.active{background:rgba(255,183,122,.35);border-color:rgba(255,183,122,.8);color:rgba(255,255,255,.95);box-shadow:0 0 15px rgba(255,183,122,.3)}body.admin-focus-mode .tab-btn:hover{background:rgba(255,183,122,.2);border-color:rgba(255,183,122,.6)}body.admin-focus-mode .data-table tr.selected{background:rgba(255,183,122,.15);border-left:4px solid rgba(255,183,122,.8);transition:all .2s ease}body.admin-focus-mode .data-table tr.selected td{color:rgba(255,255,255,.95);font-weight:500}body.admin-focus-mode .data-table tr:hover{background:rgba(255,183,122,.2)}.data-table tr.selected{background:rgba(255,183,122,.1);border-left:3px solid rgba(255,183,122,.6);transition:all .2s ease}.shortcut-hint{display:inline-block;margin-left:8px;padding:2px 8px;background:rgba(255,183,122,.25);border:1px solid rgba(255,183,122,.5);border-radius:4px;font-size:.75em;font-weight:600;color:rgba(255,183,122,.95);transition:all .3s ease}.shortcut-hint:hover{background:rgba(255,183,122,.35);border-color:rgba(255,183,122,.7)}#adminShortcutsHelpBtn{display:flex;align-items:center;gap:6px;padding:8px 16px;margin-left:15px;background:rgba(0,0,0,.05);border:1px solid rgba(0,0,0,.1);border-radius:20px;color:#666;font-size:.9em;font-weight:500;cursor:pointer;transition:all .3s ease}#adminShortcutsHelpBtn:hover{color:#007bff;background:rgba(0,123,255,.05);border-color:rgba(0,123,255,.2);transform:translateY(-1px)}#adminShortcutsHelpBtn svg{width:16px;height:16px}.focus-mode-indicator{position:fixed;top:calc(env(safe-area-inset-top) + 80px);right:20px;padding:10px 20px;background:rgba(255,183,122,.9);color:#fff;border-radius:25px;font-size:.9em;font-weight:600;z-index:999;box-shadow:0 4px 15px rgba(255,183,122,.4);animation:slideInRight .3s ease;display:none}body.admin-focus-mode .focus-mode-indicator{display:block}@keyframes slideInRight{from{transform:translateX(100px);opacity:0}to{transform:translateX(0);opacity:1}}body.admin-focus-mode .action-btn:hover,body.admin-focus-mode .btn-primary:hover,body.admin-focus-mode .btn-secondary:hover{border-color:rgba(255,183,122,.7);box-shadow:0 0 10px rgba(255,183,122,.3)}body.admin-focus-mode .form-control:focus{border-color:rgba(255,183,122,.8);box-shadow:0 0 0 3px rgba(255,183,122,.2)}body.admin-focus-mode .modal.active{border-color:rgba(255,183,122,.6)}body.admin-focus-mode .modal-header{border-bottom-color:rgba(255,183,122,.3)}.shortcuts-help-modal .modal-body kbd{background:rgba(255,183,122,.2);border:1px solid rgba(255,183,122,.5);border-radius:4px;padding:2px 8px;font-family:monospace;font-size:.9em;color:rgba(255,183,122,.95);display:inline-block;min-width:24px;text-align:center}.shortcuts-help-modal .modal-body h4{color:rgba(255,183,122,.9);margin-top:20px;margin-bottom:10px;font-size:1.1em}.shortcuts-help-modal .modal-body ul{list-style:none;padding:0}.shortcuts-help-modal .modal-body li{padding:5px 0;display:flex;align-items:center;gap:10px}.toast-container{position:fixed;top:calc(env(safe-area-inset-top) + 80px);left:50%;transform:translateX(-50%);z-index:10000;display:flex;flex-direction:column;gap:10px}.toast{display:flex;align-items:center;gap:12px;padding:12px 20px;background:rgba(0,0,0,.85);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.2);border-radius:25px;color:rgba(255,255,255,.95);font-size:.95em;box-shadow:0 4px 15px rgba(0,0,0,.3);animation:slideInDown .3s ease;min-width:200px}.toast.success{border-color:rgba(0,184,148,.6)}.toast.error{border-color:rgba(231,76,60,.6)}.toast.warning{border-color:rgba(253,203,110,.6)}.toast.info{border-color:rgba(0,123,255,.6)}.toast-icon{font-size:1.2em;font-weight:700}.toast-message{flex:1}.toast-close{background:0 0;border:none;color:rgba(255,255,255,.7);font-size:1.2em;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.toast-close:hover{color:rgba(255,255,255,.9)}.toast.closing{animation:slideOutUp .3s ease forwards}@keyframes slideInDown{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes slideOutUp{from{transform:translateY(0);opacity:1}to{transform:translateY(-20px);opacity:0}}.action-btn:focus,.btn-danger:focus,.btn-primary:focus,.btn-secondary:focus{outline:0;border-color:rgba(255,183,122,.8);box-shadow:0 0 0 3px rgba(255,183,122,.3)}.modal .btn-primary:focus,.modal .btn-secondary:focus{background:rgba(255,183,122,.2);border-color:rgba(255,183,122,.8);box-shadow:0 0 0 3px rgba(255,183,122,.3)}</style><link rel="stylesheet" href="/css/keyboard-shortcuts.css" media="print" onload='this.media="all"'><div class="toast-container" id="toastContainer"></div><nav id="mainNav"><a href="/">‰∏ªÈ°µ</a> <a href="/passage">ÊñáÁ´†</a> <a href="/collect">ÂΩíÊ°£</a> <a href="/about">ÂÖ≥‰∫é</a> <a href="/markdown-editor">ÁºñËæëÂô®<span class="shortcut-hint">6</span></a> <a class="navbtn current" href="/admin">ÁÆ°ÁêÜÂëòËÆæÁΩÆ</a> <button id="loginBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg> ÁôªÂΩï</button></nav><div class="scroll-indicator" id="scrollIndicator"><div class="scroll-progress" id="scrollProgress"></div></div><main><div class="title-container"><h1 class="h1" id="main-title">ÁÆ°ÁêÜÂëòÊéßÂà∂Âè∞</h1></div><div class="admin-container"><div class="welcome-card"><div class="welcome-text"><h2>Ê¨¢ËøéÂõûÊù•ÔºåÁÆ°ÁêÜÂëò</h2></div><div class="admin-avatar">AD</div></div><div class="dashboard-grid"><div class="stat-card"><div class="stat-header"><div class="stat-title">ÊÄªÊñáÁ´†Êï∞</div><div class="stat-icon">üìù</div></div><div class="stat-value" id="totalArticles">0</div><div class="stat-change positive">Êú¨ÊúàÊñ∞Â¢û</div></div><div class="stat-card"><div class="stat-header"><div class="stat-title">ÊÄªÁî®Êà∑Êï∞</div><div class="stat-icon">üë•</div></div><div class="stat-value" id="totalUsers">0</div><div class="stat-change positive">Êú¨Âë®Êñ∞Â¢û</div></div><div class="stat-card"><div class="stat-header"><div class="stat-title">‰ªäÊó•ËÆøÈóÆÈáè</div><div class="stat-icon">üìä</div></div><div class="stat-value" id="todayVisits">0</div><div class="stat-change">ËæÉÊò®Êó•</div></div></div><div class="admin-panel"><div class="panel-header"><h2>ÁÆ°ÁêÜÊéßÂà∂Âè∞</h2></div><div class="quick-actions"><button class="action-btn" id="uploadArticleBtn"><span>üì§</span> ‰∏ä‰º†ÊñáÁ´†</button> <button class="action-btn" id="newArticleBtn"><span>üìù</span> Êñ∞Âª∫ÊñáÁ´†</button></div><div class="tab-nav"><button class="tab-btn active" data-tab="articles">ÊñáÁ´†ÁÆ°ÁêÜ<span class="shortcut-hint">1</span></button> <button class="tab-btn" data-tab="users">Áî®Êà∑ÁÆ°ÁêÜ<span class="shortcut-hint">2</span></button> <button class="tab-btn" data-tab="comments">ËØÑËÆ∫ÁÆ°ÁêÜ<span class="shortcut-hint">3</span></button> <button class="tab-btn" data-tab="categories">ÂàÜÁ±ªÁÆ°ÁêÜ<span class="shortcut-hint">4</span></button> <button class="tab-btn" data-tab="tags">Ê†áÁ≠æÁÆ°ÁêÜ<span class="shortcut-hint">5</span></button> <button class="tab-btn" data-tab="analytics">ÁªüËÆ°ÂàÜÊûê<span class="shortcut-hint">6</span></button> <button class="tab-btn" data-tab="about">Âç°ÁâáÁÆ°ÁêÜ<span class="shortcut-hint">7</span></button> <button class="tab-btn" data-tab="filemanager">Êñá‰ª∂ÁÆ°ÁêÜ<span class="shortcut-hint">8</span></button> <button class="tab-btn" data-tab="attachments">ÈôÑ‰ª∂ÁÆ°ÁêÜ<span class="shortcut-hint">9</span></button> <button class="tab-btn" data-tab="settings">Á≥ªÁªüËÆæÁΩÆ<span class="shortcut-hint">0</span></button> <button class="shortcuts-help-btn" id="adminShortcutsHelpBtn" title="Âø´Êç∑ÈîÆÂ∏ÆÂä©"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> Âø´Êç∑ÈîÆ</button></div><div class="tab-content"><div class="tab-pane active" id="articles"><h3>ÊñáÁ´†ÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÂ∑≤ÂèëÂ∏ÉÁöÑÊñáÁ´†ÔºåÂèØ‰ª•ÁºñËæë„ÄÅÂà†Èô§ÊàñÊõ¥ÊîπÁä∂ÊÄÅ„ÄÇ<div class="batch-actions-bar" id="batchActionsBar" style="display:none"><div class="batch-actions-info"><span id="selectedCount">Â∑≤ÈÄâÊã© 0 ÁØáÊñáÁ´†</span></div><div class="batch-actions-buttons"><button class="btn btn-danger btn-sm" id="batchDeleteBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> ÊâπÈáèÂà†Èô§</button> <button class="btn btn-secondary btn-sm" id="clearSelectionBtn">ÂèñÊ∂àÈÄâÊã©</button></div></div><table class="data-table" id="articles"><thead><tr><th style="width:50px"><input type="checkbox" id="selectAllCheckbox" class="select-all-checkbox"><th>Ê†áÈ¢ò<th>‰ΩúËÄÖ<th>Êó•Êúü<th>Áä∂ÊÄÅ<th>ÂèØËßÅÊÄß<th>Êìç‰Ωú<tbody id="articlesTableBody"></table><div class="pagination-container" id="paginationContainer" style="display:none"><div class="pagination-info"><span id="paginationInfo">ÊòæÁ§∫ 1-10 Êù°ÔºåÂÖ± 0 Êù°</span></div><div class="pagination-controls"><button class="pagination-btn" id="prevPageBtn" disabled><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg> ‰∏ä‰∏ÄÈ°µ</button><div class="pagination-pages" id="paginationPages"></div><button class="pagination-btn" id="nextPageBtn" disabled>‰∏ã‰∏ÄÈ°µ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button></div></div><div class="btn-group"><button class="btn-secondary">ÂØºÂá∫Êï∞ÊçÆ</button> <button class="btn-primary" id="refreshArticlesBtn">Âà∑Êñ∞ÂàóË°®</button></div></div><div class="tab-pane" id="users"><h3>Áî®Êà∑ÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÊ≥®ÂÜåÁî®Êà∑ÔºåÂèØ‰ª•Êü•ÁúãÁî®Êà∑‰ø°ÊÅØ„ÄÅË∞ÉÊï¥ÊùÉÈôêÊàñÂà†Èô§Áî®Êà∑„ÄÇ<div class="batch-actions-bar" id="userBatchActionsBar" style="display:none"><div class="batch-actions-info"><span id="userSelectedCount">Â∑≤ÈÄâÊã© 0 ‰∏™Áî®Êà∑</span></div><div class="batch-actions-buttons"><button class="btn btn-danger btn-sm" id="batchDeleteUsersBtn"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> ÊâπÈáèÂà†Èô§</button> <button class="btn btn-secondary btn-sm" id="clearUserSelectionBtn">ÂèñÊ∂àÈÄâÊã©</button></div></div><table class="data-table" id="users"><thead><tr><th style="width:50px"><input type="checkbox" id="selectAllUsersCheckbox" class="select-all-checkbox"><th>Áî®Êà∑Âêç<th>ÈÇÆÁÆ±<th>Ê≥®ÂÜåÊó∂Èó¥<th>ËßíËâ≤<th>Áä∂ÊÄÅ<th>Êìç‰Ωú<tbody id="usersTableBody"></table><div class="pagination-container" id="userPaginationContainer" style="display:none"><div class="pagination-info"><span id="userPaginationInfo">ÊòæÁ§∫ 1-10 Êù°ÔºåÂÖ± 0 Êù°</span></div><div class="pagination-controls"><button class="pagination-btn" id="prevUserPageBtn" disabled><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg> ‰∏ä‰∏ÄÈ°µ</button><div class="pagination-pages" id="userPaginationPages"></div><button class="pagination-btn" id="nextUserPageBtn" disabled>‰∏ã‰∏ÄÈ°µ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button></div></div><div class="btn-group"><button class="btn-secondary">ÂØºÂá∫Áî®Êà∑ÂàóË°®</button> <button class="btn-primary" id="addUserBtn">Ê∑ªÂä†Êñ∞Áî®Êà∑</button></div></div><div class="tab-pane" id="comments"><h3>ËØÑËÆ∫ÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÊñáÁ´†ËØÑËÆ∫ÔºåÂèØ‰ª•ÂÆ°Ê†∏„ÄÅÁºñËæëÊàñÂà†Èô§ËØÑËÆ∫„ÄÇ<table class="data-table" id="comments"><thead><tr><th style="width:50px"><input type="checkbox" id="selectAllComments" class="select-all-checkbox"><th>ÂÜÖÂÆπ<th>ÊñáÁ´†<th>Áî®Êà∑<th>Êó∂Èó¥<th>Êìç‰Ωú<tbody id="commentsTableBody"></table><div class="pagination-container" id="commentsPaginationContainer" style="display:none"><div class="pagination-info"><span id="commentsPaginationInfo">ÊòæÁ§∫ 1-10 Êù°ÔºåÂÖ± 0 Êù°</span></div><div class="pagination-controls"><button class="pagination-btn" id="prevCommentsPageBtn" disabled><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg> ‰∏ä‰∏ÄÈ°µ</button><div class="pagination-pages" id="commentsPaginationPages"></div><button class="pagination-btn" id="nextCommentsPageBtn" disabled>‰∏ã‰∏ÄÈ°µ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button></div></div><div class="btn-group"><button class="btn-danger" id="batchDeleteCommentsBtn" style="display:none">ÊâπÈáèÂà†Èô§</button> <button class="btn-secondary">ÊâπÈáèÂÆ°Ê†∏</button> <button class="btn-primary" id="refreshCommentsBtn">Âà∑Êñ∞ËØÑËÆ∫</button></div></div><div class="tab-pane" id="categories"><h3>ÂàÜÁ±ªÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÊñáÁ´†ÂàÜÁ±ªÔºåÂèØ‰ª•ÂàõÂª∫„ÄÅÁºñËæë„ÄÅÂà†Èô§ÂàÜÁ±ª„ÄÇ<div class="quick-actions"><button class="btn-danger" id="batchDeleteCategoriesBtn" style="display:none">ÊâπÈáèÂà†Èô§</button> <button class="btn-primary" id="addCategoryBtn">Ê∑ªÂä†ÂàÜÁ±ª</button> <button class="btn-secondary" id="refreshCategoriesBtn">Âà∑Êñ∞</button></div><table class="data-table" id="categories"><thead><tr><th style="width:50px"><input type="checkbox" id="selectAllCategories" class="select-all-checkbox"><th>ÊéíÂ∫è<th>ÂõæÊ†á<th>ÂêçÁß∞<th>ÊèèËø∞<th>Áä∂ÊÄÅ<th>Êìç‰Ωú<tbody id="categoriesTableBody"></table></div><div class="tab-pane" id="tags"><h3>Ê†áÁ≠æÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÊñáÁ´†Ê†áÁ≠æÔºåÂèØ‰ª•ÂàõÂª∫„ÄÅÁºñËæë„ÄÅÂà†Èô§Ê†áÁ≠æ„ÄÇ<div class="quick-actions"><button class="btn-danger" id="batchDeleteTagsBtn" style="display:none">ÊâπÈáèÂà†Èô§</button> <button class="btn-primary" id="addTagBtn">Ê∑ªÂä†Ê†áÁ≠æ</button> <button class="btn-secondary" id="refreshTagsBtn">Âà∑Êñ∞</button></div><div class="form-group" style="margin-top:20px"><label for="tagCategoryFilter">Á≠õÈÄâÂàÜÁ±ª</label> <select id="tagCategoryFilter" class="form-control"><option value="">ÂÖ®ÈÉ®Ê†áÁ≠æ</select></div><table class="data-table" id="tags" style="margin-top:15px"><thead><tr><th style="width:50px"><input type="checkbox" id="selectAllTags" class="select-all-checkbox"><th>ÊéíÂ∫è<th>È¢úËâ≤<th>ÂêçÁß∞<th>ÊèèËø∞<th>ÊâÄÂ±ûÂàÜÁ±ª<th>Áä∂ÊÄÅ<th>Êìç‰Ωú<tbody id="tagsTableBody"></table></div><div class="tab-pane" id="about"><h3>ÂÖ≥‰∫éÈ°µÈù¢ÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÂÖ≥‰∫éÈ°µÈù¢ÁöÑ‰∏ªÂç°ÁâáÂíåÊ¨°Âç°ÁâáÂÜÖÂÆπ„ÄÇ<div class="quick-actions"><button class="btn-primary" id="addMainCardBtn">Ê∑ªÂä†‰∏ªÂç°Áâá</button> <button class="btn-secondary" id="refreshAboutCardsBtn">Âà∑Êñ∞</button></div><div style="margin-top:30px"><h4>‰∏ªÂç°ÁâáÂàóË°®</h4><table class="data-table" id="mainCards"><thead><tr><th>ÊéíÂ∫è<th>ÂõæÊ†á<th>Ê†áÈ¢ò<th>Â∏ÉÂ±ÄÁ±ªÂûã<th>Ê¨°Âç°ÁâáÊï∞<th>Áä∂ÊÄÅ<th>Êìç‰Ωú<tbody id="mainCardsTableBody"></table></div><div style="margin-top:30px"><h4>Ê¨°Âç°ÁâáÂàóË°®</h4><div class="form-group"><label for="subCardMainCardFilter">ÈÄâÊã©‰∏ªÂç°Áâá</label> <select id="subCardMainCardFilter" class="form-control"><option value="">ÂÖ®ÈÉ®‰∏ªÂç°Áâá</select></div><button class="btn-primary" id="addSubCardBtn" style="margin-top:10px">Ê∑ªÂä†Ê¨°Âç°Áâá</button><table class="data-table" id="subCards" style="margin-top:15px"><thead><tr><th>ÊéíÂ∫è<th>ÂõæÊ†á<th>Ê†áÈ¢ò<th>ÊèèËø∞<th>ÈìæÊé•<th>Áä∂ÊÄÅ<th>Êìç‰Ωú<tbody id="subCardsTableBody"></table></div><div style="margin-top:40px;padding-top:30px;border-top:1px solid rgba(255,255,255,.2)"><h4>ÂèãÊÉÖÈìæÊé•ÁÆ°ÁêÜ</h4><p style="color:rgba(255,255,255,.7);margin-bottom:20px">ÁÆ°ÁêÜÁΩëÁ´ôÂèãÊÉÖÈìæÊé•ÔºåÂåÖÊã¨Ê∑ªÂä†„ÄÅÁºñËæë„ÄÅÂà†Èô§ÂíåÂêØÁî®/Á¶ÅÁî®Êìç‰Ωú„ÄÇ<div class="quick-actions"><button class="btn-primary" id="addFriendLinkBtn"><span style="margin-right:5px">+</span>Ê∑ªÂä†ÂèãÈìæ</button> <button class="btn-secondary" id="refreshFriendLinksBtn"><span style="margin-right:5px">‚Üª</span>Âà∑Êñ∞</button> <button class="btn-danger" id="batchDeleteFriendLinksBtn" style="display:none"><span style="margin-right:5px">üóë</span>ÊâπÈáèÂà†Èô§ (<span id="friendLinkSelectedCount">0</span>)</button></div><div style="margin-top:20px"><table class="data-table" id="friendLinksTable"><thead><tr><th style="width:50px"><input type="checkbox" id="selectAllFriendLinks" style="width:auto"><th style="width:80px">Â§¥ÂÉè<th>ÊòµÁß∞<th>ÈìæÊé•<th>‰∏™ÊÄßÁ≠æÂêç<th style="width:80px">Áä∂ÊÄÅ<th style="width:180px">Êìç‰Ωú<tbody id="friendLinksTableBody"><tr><td colspan="7" style="text-align:center;padding:30px"><div style="opacity:.5">Âä†ËΩΩ‰∏≠...</div></table></div></div></div><div class="tab-pane" id="filemanager"><div class="fm-header"><h3>Êñá‰ª∂ÁÆ°ÁêÜ</h3><div class="fm-actions"><button class="btn-primary" id="fmUploadBtn"><span style="margin-right:5px">‚Üë</span>‰∏ä‰º†Êñá‰ª∂</button> <button class="btn-secondary" id="fmCreateDirBtn"><span style="margin-right:5px">+</span>Êñ∞Âª∫Êñá‰ª∂Â§π</button></div></div><div class="fm-container"><div class="fm-sidebar"><div class="fm-sidebar-header"><span>ÁõÆÂΩïÁªìÊûÑ</span></div><div class="fm-tree" id="fmTree"></div></div><div class="fm-main"><div class="fm-toolbar"><button class="fm-tool-btn" id="fmBackBtn" disabled><span>‚Üê</span></button><div class="fm-breadcrumb" id="fmBreadcrumb">img</div><div class="fm-info" id="fmInfo">0 ‰∏™È°πÁõÆ</div></div><div class="fm-file-list" id="fmFileList"></div><div class="fm-empty-state" id="fmEmptyState" style="display:none"><div class="fm-empty-icon">üì≠</div><p>Ê≠§Êñá‰ª∂Â§π‰∏∫Á©∫</div></div></div></div><div class="tab-pane" id="analytics"><h3>üìä ÁªüËÆ°ÂàÜÊûê</h3><p>Êü•ÁúãÊñáÁ´†ÈòÖËØªÁªüËÆ°„ÄÅÁÉ≠Èó®ÂàÜÊûêÂíåËÆøÈóÆÊù•Ê∫êÊï∞ÊçÆ„ÄÇ<div class="analytics-grid"><div class="analytics-card"><div class="analytics-header"><h4>üî• ÁÉ≠Èó®ÊñáÁ´†</h4><select id="mostViewedLimit" class="form-control" style="width:100px;padding:5px"><option value="5">Ââç5ÁØá<option value="10" selected>Ââç10ÁØá<option value="20">Ââç20ÁØá</select></div><div class="analytics-content"><table class="data-table" id="mostViewedTable"><thead><tr><th>ÊéíÂêç<th>ÊñáÁ´†Ê†áÈ¢ò<th>‰ΩúËÄÖ<th>ÈòÖËØªÊ¨°Êï∞<tbody id="mostViewedTableBody"><tr><td colspan="4" style="text-align:center">Âä†ËΩΩ‰∏≠...</table></div></div><div class="analytics-card"><div class="analytics-header"><h4>üåç ËÆøÈóÆÊù•Ê∫êÔºàÊåâÂõΩÂÆ∂Ôºâ</h4><select id="viewSourcesDays" class="form-control" style="width:100px;padding:5px"><option value="7">Ëøë7Â§©<option value="30" selected>Ëøë30Â§©<option value="90">Ëøë90Â§©</select></div><div class="analytics-content"><table class="data-table" id="viewSourcesTable"><thead><tr><th>ÊéíÂêç<th>ÂõΩÂÆ∂/Âú∞Âå∫<th>ËÆøÈóÆÊ¨°Êï∞<tbody id="viewSourcesTableBody"><tr><td colspan="3" style="text-align:center">Âä†ËΩΩ‰∏≠...</table></div></div><div class="analytics-card"><div class="analytics-header"><h4>üèôÔ∏è ËÆøÈóÆÊù•Ê∫êÔºàÊåâÂüéÂ∏ÇÔºâ</h4><select id="viewByCityDays" class="form-control" style="width:100px;padding:5px"><option value="7">Ëøë7Â§©<option value="30" selected>Ëøë30Â§©<option value="90">Ëøë90Â§©</select></div><div class="analytics-content"><table class="data-table" id="viewByCityTable"><thead><tr><th>ÊéíÂêç<th>ÂüéÂ∏Ç<th>Âú∞Âå∫<th>ËÆøÈóÆÊ¨°Êï∞<tbody id="viewByCityTableBody"><tr><td colspan="4" style="text-align:center">Âä†ËΩΩ‰∏≠...</table></div></div><div class="analytics-card full-width"><div class="analytics-header"><h4>üñ•Ô∏è ËÆøÈóÆÊù•Ê∫êÔºàÊåâIPÔºâ</h4><select id="viewByIPDays" class="form-control" style="width:100px;padding:5px"><option value="7">Ëøë7Â§©<option value="30" selected>Ëøë30Â§©<option value="90">Ëøë90Â§©</select></div><div class="analytics-content"><table class="data-table" id="viewByIPTable"><thead><tr><th>ÊéíÂêç<th>IPÂú∞ÂùÄ<th>ÂõΩÂÆ∂<th>ÂüéÂ∏Ç<th>Âú∞Âå∫<th>ËÆøÈóÆÊ¨°Êï∞<th>È¶ñÊ¨°ËÆøÈóÆ<th>ÊúÄÂêéËÆøÈóÆ<tbody id="viewByIPTableBody"><tr><td colspan="8" style="text-align:center">Âä†ËΩΩ‰∏≠...</table></div></div><div class="analytics-card full-width"><div class="analytics-header"><h4>üìà ÈòÖËØªË∂ãÂäø</h4><select id="viewTrendDays" class="form-control" style="width:100px;padding:5px"><option value="7">Ëøë7Â§©<option value="30" selected>Ëøë30Â§©<option value="90">Ëøë90Â§©</select></div><div class="analytics-content"><canvas id="viewTrendChart" style="width:100%;height:300px"></canvas></div></div></div></div><div class="tab-pane" id="attachments"><div class="am-header"><h3>üìé ÈôÑ‰ª∂ÁÆ°ÁêÜ</h3><p>ÁÆ°ÁêÜÊâÄÊúâ‰∏ä‰º†ÁöÑÈôÑ‰ª∂ÔºåÊîØÊåÅ‰∏ä‰º†„ÄÅÊü•Áúã„ÄÅ‰∏ãËΩΩ„ÄÅÂà†Èô§ÂíåÊùÉÈôêËÆæÁΩÆ„ÄÇ</div><div class="quick-actions"><button class="btn-primary" id="amUploadBtn"><span style="margin-right:5px">üì§</span>‰∏ä‰º†ÈôÑ‰ª∂</button> <button class="btn-secondary" id="amRefreshBtn"><span style="margin-right:5px">üîÑ</span>Âà∑Êñ∞ÂàóË°®</button></div><div class="am-filter-section"><div class="am-filter-row"><div class="form-group" style="margin-bottom:0"><label for="amFileTypeFilter">Êñá‰ª∂Á±ªÂûã</label> <select id="amFileTypeFilter" class="form-control"><option value="">ÂÖ®ÈÉ®Á±ªÂûã<option value="image">ÂõæÁâá<option value="document">ÊñáÊ°£<option value="video">ËßÜÈ¢ë<option value="audio">Èü≥È¢ë<option value="archive">ÂéãÁº©ÂåÖ</select></div><div class="form-group" style="margin-bottom:0"><label for="amVisibilityFilter">ÂèØËßÅÊÄß</label> <select id="amVisibilityFilter" class="form-control"><option value="">ÂÖ®ÈÉ®<option value="public">ÂÖ¨ÂºÄ<option value="private">ÁßÅÂØÜ<option value="protected">Âèó‰øùÊä§</select></div><div class="form-group" style="margin-bottom:0"><label for="amPassageFilter">ÂÖ≥ËÅîÊñáÁ´†</label> <select id="amPassageFilter" class="form-control"><option value="">ÂÖ®ÈÉ®ÊñáÁ´†</select></div><div class="form-group" style="margin-bottom:0"><label for="amSearchInput">ÊêúÁ¥¢</label> <input id="amSearchInput" class="form-control" placeholder="ÊêúÁ¥¢Êñá‰ª∂Âêç..."></div></div></div><div class="am-stats"><div class="am-stat-item"><span class="am-stat-label">ÊÄªÈôÑ‰ª∂Êï∞:</span> <span class="am-stat-value" id="amTotalCount">0</span></div><div class="am-stat-item"><span class="am-stat-label">ÊÄªÂ§ßÂ∞è:</span> <span class="am-stat-value" id="amTotalSize">0 KB</span></div><div class="am-stat-item"><span class="am-stat-label">ÂõæÁâá:</span> <span class="am-stat-value" id="amImageCount">0</span></div><div class="am-stat-item"><span class="am-stat-label">ÊñáÊ°£:</span> <span class="am-stat-value" id="amDocumentCount">0</span></div></div><div class="am-list-container"><table class="data-table" id="attachmentsTable"><thead><tr><th width="40"><input type="checkbox" id="amSelectAll"><th width="60">È¢ÑËßà<th>Êñá‰ª∂Âêç<th>Á±ªÂûã<th>Â§ßÂ∞è<th>ÂèØËßÅÊÄß<th>ÂÖ≥ËÅîÊñáÁ´†<th>‰∏ä‰º†Êó∂Èó¥<th width="150">Êìç‰Ωú<tbody id="attachmentsTableBody"><tr><td colspan="9" style="text-align:center;padding:40px"><div class="am-empty-state"><div class="am-empty-icon">üì≠</div><p>ÊöÇÊó†ÈôÑ‰ª∂</p><button class="btn-primary" id="amEmptyUploadBtn" style="margin-top:15px">‰∏ä‰º†Á¨¨‰∏Ä‰∏™ÈôÑ‰ª∂</button></div></table></div><div class="pagination-container" id="amPaginationContainer" style="display:none"><div class="pagination-info"><span id="amPaginationInfo">ÊòæÁ§∫ 1-10 Êù°ÔºåÂÖ± 0 Êù°</span></div><div class="pagination-controls"><button class="pagination-btn" id="amPrevPageBtn" disabled><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg> ‰∏ä‰∏ÄÈ°µ</button><div class="pagination-pages" id="amPaginationPages"></div><button class="pagination-btn" id="amNextPageBtn" disabled>‰∏ã‰∏ÄÈ°µ <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button></div></div><div class="am-batch-actions" id="amBatchActions" style="display:none"><span style="margin-right:15px">Â∑≤ÈÄâÊã© <strong id="amSelectedCount">0</strong> È°π</span> <button class="btn-danger" id="amBatchDeleteBtn"><span style="margin-right:5px">üóëÔ∏è</span>ÊâπÈáèÂà†Èô§</button> <button class="btn-secondary" id="amBatchSetPublicBtn">ËÆæ‰∏∫ÂÖ¨ÂºÄ</button> <button class="btn-secondary" id="amBatchSetPrivateBtn">ËÆæ‰∏∫ÁßÅÂØÜ</button> <button class="btn-secondary" id="amCancelSelectionBtn">ÂèñÊ∂àÈÄâÊã©</button></div></div><div class="tab-pane" id="settings"><h3>Á≥ªÁªüËÆæÁΩÆ</h3><p>ÈÖçÁΩÆÁΩëÁ´ôÂèÇÊï∞ÂíåÂäüËÉΩËÆæÁΩÆ„ÄÇ<div class="settings-section"><h4>üé® Â§ñËßÇËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="backgroundImage">ËÉåÊôØÂõæÁâáË∑ØÂæÑ</label> <input id="backgroundImage" class="form-control" placeholder="/img/test.webp"><p style="font-size:.85em;color:#666;margin-top:5px">ÊîØÊåÅÁõ∏ÂØπË∑ØÂæÑÊàñÁªùÂØπURLÔºàÊ°åÈù¢Á´ØÔºâ</div><div class="form-group"><label for="mobileBackgroundImage">ÁßªÂä®Á´ØËÉåÊôØÂõæÁâáË∑ØÂæÑ</label> <input id="mobileBackgroundImage" class="form-control" placeholder="/img/mobile-test.webp"><p style="font-size:.85em;color:#666;margin-top:5px">ÁßªÂä®Á´Ø‰∏ìÁî®ËÉåÊôØÂõæÁâáÔºàÁïôÁ©∫Âàô‰ΩøÁî®Ê°åÈù¢Á´ØËÉåÊôØÔºâ</div><div class="form-group"><label for="globalOpacity">ÂÖ®Â±ÄÈÄèÊòéÂ∫¶ (0-1)</label> <input type="range" id="globalOpacity" class="form-control" min="0" max="1" step="0.05" value="0.15"><div style="display:flex;justify-content:space-between;margin-top:5px;font-size:.85em;color:#666"><span>0 (‰∏çÈÄèÊòé)</span> <span id="opacityValue">0.15</span> <span>1 (ÂÆåÂÖ®ÈÄèÊòé)</span></div></div><div class="form-group"><label for="backgroundSize">ËÉåÊôØÂ∞∫ÂØ∏</label> <select id="backgroundSize" class="form-control"><option value="cover">cover (Ë¶ÜÁõñ)<option value="contain">contain (ÂåÖÂê´)<option value="auto">auto (Ëá™Âä®)<option value="100% 100%">100% 100% (Êãâ‰º∏)</select></div><div class="form-group"><label for="backgroundPosition">ËÉåÊôØ‰ΩçÁΩÆ</label> <select id="backgroundPosition" class="form-control"><option value="center">center (Â±Ö‰∏≠)<option value="top">top (È°∂ÈÉ®)<option value="bottom">bottom (Â∫ïÈÉ®)<option value="left">left (Â∑¶‰æß)<option value="right">right (Âè≥‰æß)<option value="top left">top left (Â∑¶‰∏ä)<option value="top right">top right (Âè≥‰∏ä)<option value="bottom left">bottom left (Â∑¶‰∏ã)<option value="bottom right">bottom right (Âè≥‰∏ã)</select></div><div class="form-group"><label for="backgroundRepeat">ËÉåÊôØÈáçÂ§ç</label> <select id="backgroundRepeat" class="form-control"><option value="no-repeat">no-repeat (‰∏çÈáçÂ§ç)<option value="repeat">repeat (ÈáçÂ§ç)<option value="repeat-x">repeat-x (Ê∞¥Âπ≥ÈáçÂ§ç)<option value="repeat-y">repeat-y (ÂûÇÁõ¥ÈáçÂ§ç)</select></div><div class="form-group"><label for="backgroundAttachment">ËÉåÊôØÊªöÂä®</label> <select id="backgroundAttachment" class="form-control"><option value="fixed">fixed (Âõ∫ÂÆö)<option value="scroll">scroll (ÊªöÂä®)<option value="local">local (Êú¨Âú∞)</select></div><div class="form-group"><label for="blurAmount">ËÉåÊôØÊ®°Á≥äÁ®ãÂ∫¶</label> <input id="blurAmount" class="form-control" placeholder="20px"><p style="font-size:.85em;color:#666;margin-top:5px">‰æãÂ¶Ç: 0px, 10px, 20px</div><div class="form-group"><label for="saturateAmount">ËÉåÊôØÈ•±ÂíåÂ∫¶</label> <input id="saturateAmount" class="form-control" placeholder="180%"><p style="font-size:.85em;color:#666;margin-top:5px">‰æãÂ¶Ç: 100%, 150%, 200%</div></div><div class="settings-preview"><h5>ÊïàÊûúÈ¢ÑËßà</h5><div id="previewBox" class="preview-box"><p>ËøôÊòØÈ¢ÑËßàÊïàÊûúÂå∫Âüü</div></div><div class="form-group"><label for="darkModeEnabled"><input type="checkbox" id="darkModeEnabled" style="margin-right:8px"> ÂêØÁî®ÊöóËâ≤Ê®°Âºè</label><p style="font-size:.85em;color:#666;margin-top:5px">‰∏∫Êï¥‰∏™ÁΩëÁ´ôÂêØÁî®ÊöóËâ≤‰∏ªÈ¢òÔºåÂáèÂ∞ëÁúºÈÉ®Áñ≤Âä≥</div><div class="form-group"><label for="navbarGlassColor">ÂØºËà™Ê†èÊØõÁéªÁíÉÈ¢úËâ≤</label><div style="display:flex;gap:10px;align-items:center"><input type="color" id="navbarGlassColorPicker" class="color-picker" style="width:50px;height:40px;border:none;cursor:pointer"> <input id="navbarGlassColor" class="form-control" placeholder="rgba(255, 255, 255, 0.85)"></div><p style="font-size:.85em;color:#666;margin-top:5px">ÂØºËà™Ê†èËÉåÊôØÊØõÁéªÁíÉÊïàÊûúÈ¢úËâ≤ÔºàÊîØÊåÅ rgba Ê†ºÂºèÔºâ</div><div class="form-group"><label for="navbarTextColor">ÂØºËà™Ê†èÊñáÂ≠óÈ¢úËâ≤</label><div style="display:flex;gap:10px;align-items:center"><input type="color" id="navbarTextColorPicker" class="color-picker" style="width:50px;height:40px;border:none;cursor:pointer"> <input id="navbarTextColor" class="form-control" placeholder="#333333"></div><p style="font-size:.85em;color:#666;margin-top:5px">ÂØºËà™Ê†èÊñáÂ≠óÈ¢úËâ≤ÔºàÊîØÊåÅ hex„ÄÅrgb Ê†ºÂºèÔºâ</div><div class="form-group"><label for="cardGlassColor">È°µÈù¢Âç°ÁâáÊØõÁéªÁíÉÈ¢úËâ≤</label><div style="display:flex;gap:10px;align-items:center"><input type="color" id="cardGlassColorPicker" class="color-picker" style="width:50px;height:40px;border:none;cursor:pointer"> <input id="cardGlassColor" class="form-control" placeholder="rgba(255, 255, 255, 0.75)"></div><p style="font-size:.85em;color:#666;margin-top:5px">È°µÈù¢Âç°ÁâáËÉåÊôØÊØõÁéªÁíÉÊïàÊûúÈ¢úËâ≤ÔºàÊîØÊåÅ rgba Ê†ºÂºèÔºâ</div><div class="form-group"><label for="footerGlassColor">Â∫ïÊ†èÊØõÁéªÁíÉÈ¢úËâ≤</label><div style="display:flex;gap:10px;align-items:center"><input type="color" id="footerGlassColorPicker" class="color-picker" style="width:50px;height:40px;border:none;cursor:pointer"> <input id="footerGlassColor" class="form-control" placeholder="rgba(255, 255, 255, 0.9)"></div><p style="font-size:.85em;color:#666;margin-top:5px">Â∫ïÊ†èËÉåÊôØÊØõÁéªÁíÉÊïàÊûúÈ¢úËâ≤ÔºàÊîØÊåÅ rgba Ê†ºÂºèÔºâ</div><div class="form-group"><label for="floatingTextEnabled"><input type="checkbox" id="floatingTextEnabled" style="margin-right:8px"> ÂêØÁî®È£òÂ≠óÊïàÊûú</label><p style="font-size:.85em;color:#666;margin-top:5px">Âú®ÊñáÁ´†È°µÈù¢ÊòæÁ§∫È£òÂä®ÁöÑÊñáÂ≠óÊïàÊûú</div><div class="form-group"><label for="floatingTexts">È£òÂ≠óÊñáÊú¨ÔºàÁî®ÈÄóÂè∑ÂàÜÈöîÔºâ</label> <textarea id="floatingTexts" class="form-control" rows="3" placeholder="perfect, good, excellent, extraordinary, legend"></textarea><p style="font-size:.85em;color:#666;margin-top:5px">Ëá™ÂÆö‰πâÈ£òÂ≠óÊïàÊûúÊòæÁ§∫ÁöÑÊñáÊú¨ÔºåÂ§ö‰∏™ÊñáÊú¨Áî®ÈÄóÂè∑ÂàÜÈöî</div></div><div class="settings-section"><h4>üéµ Èü≥‰πêËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="musicEnabled"><input type="checkbox" id="musicEnabled" style="margin-right:8px"> ÂêØÁî®Èü≥‰πêÊí≠ÊîæÂô®</label><p style="font-size:.85em;color:#666;margin-top:5px">Âú®È°µÈù¢ÊòæÁ§∫Èü≥‰πêÊí≠ÊîæÂô®Êéß‰ª∂</div><div class="form-group"><label for="musicAutoPlay"><input type="checkbox" id="musicAutoPlay" style="margin-right:8px"> Ëá™Âä®Êí≠Êîæ</label><p style="font-size:.85em;color:#666;margin-top:5px">È°µÈù¢Âä†ËΩΩÊó∂Ëá™Âä®Êí≠ÊîæÈü≥‰πê</div><div class="form-group"><label for="musicControlSize">Êéß‰ª∂Â§ßÂ∞è</label> <select id="musicControlSize" class="form-control"><option value="small">Â∞è<option value="medium">‰∏≠<option value="large">Â§ß</select><p style="font-size:.85em;color:#666;margin-top:5px">Èü≥‰πêÊí≠ÊîæÂô®Êéß‰ª∂ÁöÑÂ§ßÂ∞è</div><div class="form-group"><label for="musicPlayerColor">Êí≠ÊîæÂô®È¢úËâ≤</label><div style="display:flex;gap:10px;align-items:center"><input type="color" id="musicPlayerColorPicker" class="color-picker" style="width:50px;height:40px;border:none;cursor:pointer"> <input id="musicPlayerColor" class="form-control" placeholder="rgba(66, 133, 244, 0.9)"></div><p style="font-size:.85em;color:#666;margin-top:5px">Èü≥‰πêÊí≠ÊîæÂô®È¢úËâ≤ÔºàÊîØÊåÅ rgba Ê†ºÂºèÔºâ</div><div class="form-group"><label for="musicPosition">ÊòæÁ§∫‰ΩçÁΩÆ</label> <select id="musicPosition" class="form-control"><option value="top-left">Â∑¶‰∏äËßí<option value="top-right">Âè≥‰∏äËßí<option value="bottom-left">Â∑¶‰∏ãËßí<option value="bottom-right">Âè≥‰∏ãËßí</select><p style="font-size:.85em;color:#666;margin-top:5px">Èü≥‰πêÊí≠ÊîæÂô®Âú®È°µÈù¢‰∏≠ÁöÑÊòæÁ§∫‰ΩçÁΩÆ</div><div class="form-group"><label for="musicCustomCSS">Ëá™ÂÆö‰πâ CSS Ê†∑Âºè</label> <textarea id="musicCustomCSS" class="form-control" rows="4" placeholder="/* Ëá™ÂÆö‰πâÈü≥‰πêÊí≠ÊîæÂô®Ê†∑Âºè */"></textarea><p style="font-size:.85em;color:#666;margin-top:5px">‰∏∫Èü≥‰πêÊí≠ÊîæÂô®Ê∑ªÂä†Ëá™ÂÆö‰πâ CSS Ê†∑Âºè</div></div><div style="margin-top:30px;padding-top:20px;border-top:1px solid rgba(0,0,0,.1)"><h5>üìÅ Èü≥‰πêÊñá‰ª∂ÁÆ°ÁêÜ</h5><div id="musicDropZone" class="music-drop-zone"><div class="drop-zone-content"><div class="drop-zone-icon"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg></div><h4>ÊãñÊãΩÈü≥È¢ëÊñá‰ª∂Âà∞Ê≠§Â§Ñ‰∏ä‰º†</h4><p>ÊàñËÄÖ <span class="browse-link">ÁÇπÂáªÈÄâÊã©Êñá‰ª∂</span><p class="upload-hint">ÊîØÊåÅ MP3„ÄÅWAV„ÄÅOGG„ÄÅM4A Á≠âÈü≥È¢ëÊ†ºÂºèÔºåÊîØÊåÅÊâπÈáè‰∏ä‰º†</div><input type="file" id="musicFileUpload" accept="audio/*" multiple class="hidden-input"></div><div id="musicUploadList" class="music-upload-list" style="display:none"><div class="upload-list-header"><div class="upload-list-title">‰∏ä‰º†ÈòüÂàó</div><button class="clear-upload-btn" id="clearUploadBtn">Ê∏ÖÁ©∫ÂàóË°®</button></div><div id="musicUploadItems" class="upload-items"></div><div class="upload-actions"><button class="btn-primary" id="uploadAllMusicBtn">ÂºÄÂßã‰∏ä‰º†</button> <button class="btn-secondary" id="cancelUploadBtn">ÂèñÊ∂à‰∏ä‰º†</button></div></div><div style="margin-top:15px;padding:12px 15px;background:rgba(255,255,255,.05);border-radius:8px;border:1px solid rgba(255,255,255,.15)"><p style="font-size:.9em;color:rgba(255,255,255,.8);margin:0">üí° <strong>ÊèêÁ§∫Ôºö</strong>ÂèØ‰ª•Âú®‰∏ä‰º†ÈòüÂàó‰∏≠‰∏∫ÊØè‰∏™Èü≥‰πêÊñá‰ª∂ÂçïÁã¨Ê∑ªÂä†Â∞ÅÈù¢ÂõæÁâáÔºàÊîØÊåÅ JPG„ÄÅPNG„ÄÅGIF„ÄÅWebP Ê†ºÂºèÔºâ</div><div style="margin-top:20px"><h5>üéº Êí≠ÊîæÂàóË°®</h5><div id="musicPlaylistContainer" style="max-height:300px;overflow-y:auto;border:1px solid rgba(0,0,0,.1);border-radius:8px;padding:10px"><div style="text-align:center;color:#999;padding:20px">ÊöÇÊó†Èü≥‰πêÊñá‰ª∂</div></div></div></div></div><div class="settings-section"><h4>üìù Ê®°ÊùøËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="templateName">‰∏™‰∫∫‰∏ªÈ°µÊ†áÈ¢ò</label> <input id="templateName" class="form-control" placeholder="Ê¨¢ËøéÊù•Âà∞ÊàëÁöÑÂçöÂÆ¢"><p style="font-size:.85em;color:#666;margin-top:5px">ÊòæÁ§∫Âú®È¶ñÈ°µÁöÑÊ†áÈ¢òÊñáÂ≠ó</div><div class="form-group"><label for="templateGreting">Ê¨¢ËøéËØ≠</label> <textarea id="templateGreting" class="form-control" rows="3" placeholder="ËøôÊòØ‰∏Ä‰∏™‰ΩøÁî® Go ËØ≠Ë®ÄÊûÑÂª∫ÁöÑ‰∏™‰∫∫ÂçöÂÆ¢Á≥ªÁªü..."></textarea><p style="font-size:.85em;color:#666;margin-top:5px">ÊòæÁ§∫Âú®È¶ñÈ°µÁöÑÊ¨¢ËøéÊñáÂ≠ó</div><div class="form-group"><label for="templateYear">Âπ¥‰ªΩ</label> <input id="templateYear" class="form-control" placeholder="2026"><p style="font-size:.85em;color:#666;margin-top:5px">Áî®‰∫éÁâàÊùÉ‰ø°ÊÅØ</div><div class="form-group"><label for="templateFoodes">È°µËÑö‰ø°ÊÅØ</label> <input id="templateFoodes" class="form-control" placeholder="ÊàëÁöÑÂçöÂÆ¢"><p style="font-size:.85em;color:#666;margin-top:5px">ÊòæÁ§∫Âú®È°µËÑöÁöÑ‰ø°ÊÅØ</div><div class="form-group"><label for="globalAvatar">ÂÖ®Â±ÄÂ§¥ÂÉèË∑ØÂæÑ</label> <input id="globalAvatar" class="form-control" placeholder="/img/avatar.webp"><p style="font-size:.85em;color:#666;margin-top:5px">ÂÖ®Â±ÄÁî®Êà∑Â§¥ÂÉèÂõæÁâáË∑ØÂæÑÔºàÊîØÊåÅÁõ∏ÂØπË∑ØÂæÑÊàñÁªùÂØπURLÔºâ</div></div></div><div class="settings-section"><h4>üìÑ ÊñáÁ´†Ê†áÈ¢òËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="templateArticleTitle"><input type="checkbox" id="templateArticleTitle" style="margin-right:8px"> ÊòæÁ§∫ÊñáÁ´†Ê†áÈ¢ò</label><p style="font-size:.85em;color:#666;margin-top:5px">ÊòØÂê¶Âú®ÊñáÁ´†È°µÈù¢ÊòæÁ§∫Ê†áÈ¢ò</div><div class="form-group"><label for="templateArticleTitlePrefix">ÊñáÁ´†Ê†áÈ¢òÂâçÁºÄ</label> <input id="templateArticleTitlePrefix" class="form-control" placeholder="ÊñáÁ´†"><p style="font-size:.85em;color:#666;margin-top:5px">ÊòæÁ§∫Âú®ÊñáÁ´†Ê†áÈ¢òÂâçÁöÑÊñáÂ≠óÔºàÂ¶ÇÔºöÊñáÁ´†„ÄÅÈòÖËØªÁ≠âÔºâ</div></div></div><div class="settings-section"><h4>üí° ÂàáÊç¢ÁïåÈù¢ÊèêÁ§∫ËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="templateSwitchNotice"><input type="checkbox" id="templateSwitchNotice" style="margin-right:8px"> ÊòæÁ§∫ÂàáÊç¢Ê†áÁ≠æÈ°µÊèêÁ§∫</label><p style="font-size:.85em;color:#666;margin-top:5px">Áî®Êà∑ÂàáÊç¢Âà∞ÂÖ∂‰ªñÊ†áÁ≠æÈ°µÊó∂ÔºåÂú®Ê†áÁ≠æÈ°µÊ†áÈ¢òÊòæÁ§∫ÊèêÁ§∫ÊñáÂ≠ó</div><div class="form-group"><label for="templateSwitchNoticeText">ÊèêÁ§∫ÊñáÂ≠ó</label> <input id="templateSwitchNoticeText" class="form-control" placeholder="ÂõûÊù•ÁªßÁª≠ÈòÖËØª"><p style="font-size:.85em;color:#666;margin-top:5px">ÂàáÊç¢Ê†áÁ≠æÈ°µÊó∂Âú®Ê†áÈ¢òÊ†èÊòæÁ§∫ÁöÑÊñáÂ≠óÔºàÂ¶ÇÔºöÂõûÊù•ÁªßÁª≠ÈòÖËØª„ÄÅÂà´ÂøòËÆ∞ÂõûÊù•Âì¶Á≠âÔºâ</div></div></div><div class="settings-section"><h4>üîó Â§ñÈÉ®ÈìæÊé•ËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="externalLinkWarning"><input type="checkbox" id="externalLinkWarning" style="margin-right:8px"> ÂêØÁî®Â§ñÈÉ®ÈìæÊé•Ë∑≥ËΩ¨Ë≠¶Âëä</label><p style="font-size:.85em;color:#666;margin-top:5px">Áî®Êà∑ÁÇπÂáªÂ§ñÈÉ®ÈìæÊé•Êó∂ÔºåÊòæÁ§∫Ë≠¶ÂëäÊèêÁ§∫</div><div class="form-group"><label for="externalLinkWhitelist">ÁôΩÂêçÂçïÂüüÂêç</label> <input id="externalLinkWhitelist" class="form-control" placeholder="github.com,gitee.com,stackoverflow.com"><p style="font-size:.85em;color:#666;margin-top:5px">‰∏çÈúÄË¶ÅË≠¶ÂëäÁöÑÂüüÂêçÔºåÁî®ÈÄóÂè∑ÂàÜÈöîÔºàÂ¶ÇÔºögithub.com,gitee.comÔºâ</div><div class="form-group"><label for="externalLinkWarningText">Ë≠¶ÂëäÊèêÁ§∫ÊñáÂ≠ó</label> <input id="externalLinkWarningText" class="form-control" placeholder="ÊÇ®Âç≥Â∞ÜÁ¶ªÂºÄÊú¨Á´ôÔºåÂâçÂæÄÂ§ñÈÉ®ÈìæÊé•"><p style="font-size:.85em;color:#666;margin-top:5px">Â§ñÈÉ®ÈìæÊé•Ë≠¶ÂëäÊèêÁ§∫ÊñáÂ≠ó</div><div class="form-group"><label for="live2dEnabled"><input type="checkbox" id="live2dEnabled" style="margin-right:8px"> ÂêØÁî® Live2D ÁúãÊùøÂ®ò</label><p style="font-size:.85em;color:#666;margin-top:5px">Âú®È°µÈù¢ÊòæÁ§∫ Live2D ÁúãÊùøÂ®ò</div></div></div><div id="live2dConfig" class="settings-section" style="display:none"><div class="settings-grid"><div class="form-group"><label>ÊòæÁ§∫È°µÈù¢</label><div style="display:flex;flex-wrap:wrap;gap:15px;margin-top:5px"><label style="display:flex;align-items:center"><input type="checkbox" id="live2dShowOnIndex" style="margin-right:6px"> È¶ñÈ°µ</label> <label style="display:flex;align-items:center"><input type="checkbox" id="live2dShowOnPassage" style="margin-right:6px"> ÊñáÁ´†È°µ</label> <label style="display:flex;align-items:center"><input type="checkbox" id="live2dShowOnCollect" style="margin-right:6px"> ÂΩíÊ°£È°µ</label> <label style="display:flex;align-items:center"><input type="checkbox" id="live2dShowOnAbout" style="margin-right:6px"> ÂÖ≥‰∫éÈ°µ</label> <label style="display:flex;align-items:center"><input type="checkbox" id="live2dShowOnAdmin" style="margin-right:6px"> ÁÆ°ÁêÜÈ°µ</label></div></div><div class="form-group"><label for="live2dPosition">ÊòæÁ§∫‰ΩçÁΩÆ</label> <select id="live2dPosition" class="form-control"><option value="right">Âè≥‰∏ãËßí<option value="left">Â∑¶‰∏ãËßí</select></div><div class="form-group"><label for="live2dModelId">Ê®°Âûã ID</label> <input id="live2dModelId" class="form-control" placeholder="1"><p style="font-size:.85em;color:#666;margin-top:5px">CDN Ê®°ÂûãÁöÑ IDÔºàÂ¶ÇÔºö1, 2, 3 Á≠âÔºâ</div><div class="form-group"><label for="live2dModelPath">Ëá™ÂÆö‰πâÊ®°ÂûãË∑ØÂæÑ</label> <input id="live2dModelPath" class="form-control" placeholder="/live2d/model/"><p style="font-size:.85em;color:#666;margin-top:5px">ÁïôÁ©∫Âàô‰ΩøÁî® CDN Ê®°Âûã„ÄÇÂ°´ÂÜôÊó∂‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑÔºàÂ¶ÇÔºö/live2d/model/Ôºâ</div><div class="form-group"><label for="live2dCDNPath">CDN Ë∑ØÂæÑ</label> <input id="live2dCDNPath" class="form-control" placeholder="https://unpkg.com/live2d-widget-model@1.0.5/"><p style="font-size:.85em;color:#666;margin-top:5px">CDN Ê®°ÂûãÁöÑÂü∫Á°ÄË∑ØÂæÑ</div><div class="form-group"><label for="live2dWidth">ÂÆΩÂ∫¶</label> <input id="live2dWidth" class="form-control" placeholder="280px"></div><div class="form-group"><label for="live2dHeight">È´òÂ∫¶</label> <input id="live2dHeight" class="form-control" placeholder="250px"></div></div></div><div class="settings-section"><h4>üí∞ ËµûÂä©ËÆæÁΩÆ</h4><div class="settings-grid"><div class="form-group"><label for="sponsorEnabled"><input type="checkbox" id="sponsorEnabled" style="margin-right:8px"> ÂêØÁî®ËµûÂä©ÂäüËÉΩ</label><p style="font-size:.85em;color:#666;margin-top:5px">Âú®ÊñáÁ´†Êú´Â∞æÊòæÁ§∫ËµûÂä©ÊåâÈíÆ</div><div class="form-group"><label for="sponsorTitle">ËµûÂä©Ê†áÈ¢ò</label> <input id="sponsorTitle" class="form-control" placeholder="ÊÑüË∞¢ÊÇ®ÁöÑÊîØÊåÅ"><p style="font-size:.85em;color:#666;margin-top:5px">ËµûÂä©Ê®°ÊÄÅÊ°ÜÁöÑÊ†áÈ¢ò</div><div class="form-group"><label for="sponsorImage">ËµûÂä©ÂõæÁâáË∑ØÂæÑ</label> <input id="sponsorImage" class="form-control" placeholder="/img/avatar.webp"><p style="font-size:.85em;color:#666;margin-top:5px">ËµûÂä©‰∫åÁª¥Á†ÅÂõæÁâáÁöÑË∑ØÂæÑ</div><div class="form-group"><label for="sponsorDescription">ËµûÂä©ÊèèËø∞</label> <textarea id="sponsorDescription" class="form-control" rows="3" placeholder="Â¶ÇÊûúÊÇ®ËßâÂæóËøô‰∏™ÂçöÂÆ¢ÂØπÊÇ®ÊúâÂ∏ÆÂä©ÔºåÊ¨¢ËøéËµûÂä©ÊîØÊåÅÔºÅ"></textarea><p style="font-size:.85em;color:#666;margin-top:5px">ËµûÂä©ËØ¥ÊòéÊñáÂ≠ó</div><div class="form-group"><label for="sponsorButtonText">ËµûÂä©ÊåâÈíÆÊñáÂ≠ó</label> <input id="sponsorButtonText" class="form-control" placeholder="‚ù§Ô∏è ËµûÂä©ÊîØÊåÅ"><p style="font-size:.85em;color:#666;margin-top:5px">ÊòæÁ§∫Âú®ÊñáÁ´†‰∏≠ÁöÑËµûÂä©ÊåâÈíÆÊñáÂ≠ó</div></div></div><div class="settings-section"><h4>üìã Â§áÊ°à‰ø°ÊÅØÔºà‰∏≠ÂõΩÂÜÖÂú∞Ôºâ</h4><div class="settings-grid"><div class="form-group"><label for="beianEnabled"><input type="checkbox" id="beianEnabled" style="margin-right:8px"> ÂêØÁî®Â§áÊ°àÊòæÁ§∫</label><p style="font-size:.85em;color:#666;margin-top:5px">Âú®È°µËÑöÊòæÁ§∫Â§áÊ°à‰ø°ÊÅØÔºà‰ªÖÈíàÂØπ‰∏≠ÂõΩÂÜÖÂú∞ÁΩëÁ´ôÔºâ</div><div class="form-group"><label for="icpNumber">ICPÂ§áÊ°àÂè∑</label> <input id="icpNumber" class="form-control" placeholder="‰∫¨ICPÂ§á12345678Âè∑-1"><p style="font-size:.85em;color:#666;margin-top:5px">Â∑•‰ø°ÈÉ®Â§áÊ°àÂè∑ÔºåÂ∞ÜÊòæÁ§∫Âú®È°µËÑöÂπ∂ÂèØÁÇπÂáªË∑≥ËΩ¨Ëá≥Â∑•‰ø°ÈÉ®ÂÆòÁΩë</div><div class="form-group"><label for="policeRecordCode">ÂÖ¨ÂÆâÂ§áÊ°àÂè∑</label> <input id="policeRecordCode" class="form-control" placeholder="12345678Âè∑"><p style="font-size:.85em;color:#666;margin-top:5px">ÂÖ¨ÂÆâËÅîÁΩëÂ§áÊ°àÂè∑ÔºàÂ¶ÇÔºö12345678Âè∑ÔºâÔºå‰ªÖÁî®‰∫éÈìæÊé•‰∏≠ÁöÑrecordcodeÂèÇÊï∞</div><div class="form-group"><label for="policeRecordContent">ÂÖ¨ÂÆâÂ§áÊ°àÊòæÁ§∫ÂÜÖÂÆπ</label> <input id="policeRecordContent" class="form-control" placeholder="‰∫¨ÂÖ¨ÁΩëÂÆâÂ§á 12345678Âè∑"><p style="font-size:.85em;color:#666;margin-top:5px">Âú®È°µËÑöÊòæÁ§∫ÁöÑÂÆåÊï¥ÂÖ¨ÂÆâÂ§áÊ°àÊñáÂ≠óÔºàÈÄöÂ∏∏ÂåÖÂê´ÂõæÊ†áÂíåÂ§áÊ°àÂè∑Ôºâ</div></div></div><div class="btn-group"><button class="btn-secondary" id="resetSettingsBtn">ÈáçÁΩÆ‰∏∫ÈªòËÆ§</button> <button class="btn-primary" id="saveMusicSettingsBtn">‰øùÂ≠òÈü≥‰πêËÆæÁΩÆ</button> <button class="btn-primary" id="saveSettingsBtn">‰øùÂ≠òÂ§ñËßÇËÆæÁΩÆ</button> <button class="btn-primary" id="saveTemplateSettingsBtn">‰øùÂ≠òÊ®°ÊùøËÆæÁΩÆ</button></div></div></div></div></div></main><div class="modal" id="uploadModal"><div class="modal-content"><div class="modal-header"><h3>‰∏ä‰º†ÊñáÁ´†</h3><button class="modal-close" data-modal="uploadModal">√ó</button></div><div class="modal-body"><form id="uploadForm"><div class="form-group"><label for="uploadTitle">ÊñáÁ´†Ê†áÈ¢ò <span style="color:#e74c3c">*</span></label> <input id="uploadTitle" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò" required></div><div class="form-group"><label for="uploadAuthor">‰ΩúËÄÖ <span style="color:#e74c3c">*</span></label> <input id="uploadAuthor" class="form-control" value="ÁÆ°ÁêÜÂëò"></div><div class="form-group"><label>ÂèëÂ∏ÉÊó•ÊúüÔºà‰ªÖÂØπMarkdownÊñá‰ª∂ÊúâÊïàÔºâ</label><div style="display:flex;gap:10px"><div style="flex:1"><input type="number" id="uploadYear" class="form-control" placeholder="Âπ¥" min="2020" max="2030"></div><div style="flex:1"><input type="number" id="uploadMonth" class="form-control" placeholder="Êúà" min="1" max="12"></div><div style="flex:1"><input type="number" id="uploadDay" class="form-control" placeholder="Êó•" min="1" max="31"></div></div><p style="font-size:.85em;color:#666;margin-top:5px">ÁïôÁ©∫Âàô‰ΩøÁî®ÂΩìÂâçÊó•Êúü</div><div class="form-group"><label for="uploadCategory">ÂàÜÁ±ª</label><div class="category-selector" id="uploadCategorySelector"></div><div class="category-input-container"><input class="form-control category-input" id="uploadCategoryInput" placeholder="Ê∑ªÂä†Ëá™ÂÆö‰πâÂàÜÁ±ª"> <button type="button" class="btn-secondary" id="addUploadCategoryBtn">Ê∑ªÂä†</button></div><p style="font-size:.85em;color:#666;margin-top:5px">ÈÄâÊã©ÊñáÁ´†ÊâÄÂ±ûÂàÜÁ±ªÔºåÊàñËæìÂÖ•Êñ∞ÂàÜÁ±ªÂêçÁß∞ÔºàÂèØÈÄâÔºâ</div><div class="form-group"><label>Ê†áÁ≠æ</label><div class="tag-selector" id="uploadTagSelector"></div><div class="tag-input-container"><input class="form-control tag-input" id="uploadTagInput" placeholder="Ê∑ªÂä†Ëá™ÂÆö‰πâÊ†áÁ≠æ"> <button type="button" class="btn-secondary" id="addUploadTagBtn">Ê∑ªÂä†</button></div></div><div class="form-group"><label for="uploadContent">ÊñáÁ´†ÂÜÖÂÆπ <span style="color:#e74c3c">*</span></label> <textarea id="uploadContent" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†ÂÜÖÂÆπÔºàÊîØÊåÅMarkdownÊ†ºÂºèÔºâ" rows="10"></textarea><p style="font-size:.85em;color:#666;margin-top:5px">ËæìÂÖ•ÊñáÁ´†ÂÜÖÂÆπÊàñ‰∏ä‰º†MarkdownÊñá‰ª∂ÔºàËá≥Â∞ëÊèê‰æõ‰∏ÄÁßçÔºâ</div><div class="form-group"><label>‰∏ä‰º†ÈôÑ‰ª∂</label><div class="upload-area" id="uploadArea"><div class="upload-icon">üìÅ</div><div class="upload-text"><h4>ÁÇπÂáªÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ</h4><p>ÊîØÊåÅÂõæÁâá„ÄÅÊñáÊ°£„ÄÅÂéãÁº©ÂåÖÁ≠âÊñá‰ª∂Ê†ºÂºèÔºåÂçï‰∏™Êñá‰ª∂ÊúÄÂ§ß10MB</div><input type="file" id="fileInput" multiple style="display:none"></div><div class="upload-preview" id="uploadPreview"></div></div><div class="form-group"><label for="uploadStatus">ÂèëÂ∏ÉÁä∂ÊÄÅ</label> <select id="uploadStatus" class="form-control"><option value="draft">ËçâÁ®ø<option value="pending">ÂæÖÂÆ°Ê†∏<option value="published">Á´ãÂç≥ÂèëÂ∏É</select></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="uploadModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰∏ä‰º†ÊñáÁ´†</button></div></form></div></div></div><div class="modal" id="articleModal"><div class="modal-content"><div class="modal-header"><h3>Êñ∞Âª∫ÊñáÁ´†</h3><button class="modal-close" data-modal="articleModal">√ó</button></div><div class="modal-body"><form id="articleForm"><div class="form-group"><label for="articleTitle">ÊñáÁ´†Ê†áÈ¢ò <span style="color:#e74c3c">*</span></label> <input id="articleTitle" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò" required></div><div class="form-group"><label for="articleAuthor">‰ΩúËÄÖ <span style="color:#e74c3c">*</span></label> <input id="articleAuthor" class="form-control" value="ÁÆ°ÁêÜÂëò"></div><div class="form-group"><label for="articleCategory">ÂàÜÁ±ª</label> <select id="articleCategory" class="form-control"></select></div><div class="form-group"><label>Ê†áÁ≠æ</label><div id="articleTagSelector" class="tag-selector"></div><input type="hidden" id="articleTags" name="tags"></div><div class="form-group"><label for="articleCoverImage">Â∞ÅÈù¢ÂõæÁâáË∑ØÂæÑ</label> <input id="articleCoverImage" class="form-control" placeholder="/img/xxx.webpÔºàÈúÄË¶ÅÈ¢ÑÂÖà‰∏ä‰º†ÂõæÁâáÊñá‰ª∂Ôºâ" value="/img/passage-cover2.webp"><p style="font-size:.85em;color:#666;margin-top:5px">ËØ∑ËæìÂÖ•ÂõæÁâáÁöÑÁõ∏ÂØπË∑ØÂæÑÔºåÈªòËÆ§‰ΩøÁî® /img/passage-cover2.webp</div><div class="form-group"><label for="articleContent">ÊñáÁ´†ÂÜÖÂÆπ <span style="color:#e74c3c">*</span></label> <textarea id="articleContent" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†ÂÜÖÂÆπÔºàÊîØÊåÅMarkdownÊ†ºÂºèÔºâ" rows="15"></textarea></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="articleModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠òÊñáÁ´†</button></div></form></div></div></div><div class="modal" id="editModal"><div class="modal-content"><div class="modal-header"><h3>ÁºñËæëÊñáÁ´†</h3><button class="modal-close" data-modal="editModal">√ó</button></div><div class="modal-body"><form id="editForm"><div class="form-group"><label for="editTitle">ÊñáÁ´†Ê†áÈ¢ò <span style="color:#e74c3c">*</span></label> <input id="editTitle" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò" required></div><div class="form-group"><label for="editAuthor">‰ΩúËÄÖ <span style="color:#e74c3c">*</span></label> <input id="editAuthor" class="form-control" placeholder="ËØ∑ËæìÂÖ•‰ΩúËÄÖ"></div><div class="form-group"><label for="editShowTitle"><input type="checkbox" id="editShowTitle" checked> ÊòæÁ§∫Ê†áÈ¢òÔºàÈò≤Ê≠¢Âá∫Áé∞‰∏§Ê¨°Ê†áÈ¢òÔºâ</label><p style="font-size:.85em;color:#666;margin-top:5px">ÂèñÊ∂àÂãæÈÄâÂêéÔºåÊñáÁ´†ÂÜÖÂÆπÂ∞Ü‰∏çÊòæÁ§∫Ê†áÈ¢òÔºåÈÄÇÁî®‰∫éÊ†áÈ¢òÂ∑≤Âú®ÂÜÖÂÆπ‰∏≠ÂåÖÂê´ÁöÑÊÉÖÂÜµ</div><div class="form-group"><label for="editCategory">ÂàÜÁ±ª</label> <select id="editCategory" class="form-control"><option value="">Âä†ËΩΩ‰∏≠...</select></div><div class="form-group"><label>Ê†áÁ≠æ</label><div id="editTagSelector" class="tag-selector"></div><input type="hidden" id="editTags" name="tags"></div><div class="form-group"><label for="editStatus">ÊñáÁ´†Áä∂ÊÄÅ</label> <select id="editStatus" class="form-control"><option value="draft">ËçâÁ®ø<option value="published">Â∑≤ÂèëÂ∏É<option value="pending">ÂæÖÂÆ°Ê†∏</select><p style="font-size:.85em;color:#666;margin-top:5px">ËçâÁ®øÔºö‰ªÖÁÆ°ÁêÜÂëòÂèØËßÅ<br>Â∑≤ÂèëÂ∏ÉÔºöÂÖ¨ÂºÄÂèØËßÅÔºàÂ¶ÇÊûúÂèØËßÅÊÄß‰∏∫ÂÖ¨ÂºÄÔºâ</div><div class="form-group"><label for="editVisibility">ÂèØËßÅÊÄß</label> <select id="editVisibility" class="form-control"><option value="public">ÂÖ¨ÂºÄ<option value="private">ÁßÅÂØÜ</select><p style="font-size:.85em;color:#666;margin-top:5px">ÂÖ¨ÂºÄÔºöÊâÄÊúâÁî®Êà∑ÂèØËßÅ<br>ÁßÅÂØÜÔºö‰ªÖÁÆ°ÁêÜÂëòÂèØËßÅ</div><div class="form-group"><label for="editIsScheduled"><input type="checkbox" id="editIsScheduled"> ÂÆöÊó∂ÂèëÂ∏É</label><p style="font-size:.85em;color:#666;margin-top:5px">ÂãæÈÄâÂêéÔºåÊñáÁ´†Â∞ÜÂú®ÊåáÂÆöÊó∂Èó¥Ëá™Âä®ÂèëÂ∏É</div><div class="form-group" id="editPublishedAtGroup" style="display:none"><label for="editPublishedAt">ÂèëÂ∏ÉÊó∂Èó¥</label> <input type="datetime-local" id="editPublishedAt" class="form-control"><p style="font-size:.85em;color:#666;margin-top:5px">ËÆæÁΩÆÊñáÁ´†ÁöÑÂÆöÊó∂ÂèëÂ∏ÉÊó∂Èó¥</div><div class="form-group"><label for="editCoverImage">Â∞ÅÈù¢ÂõæÁâáË∑ØÂæÑ</label> <input id="editCoverImage" class="form-control" placeholder="/img/xxx.webpÔºàÈúÄË¶ÅÈ¢ÑÂÖà‰∏ä‰º†ÂõæÁâáÊñá‰ª∂Ôºâ"><p style="font-size:.85em;color:#666;margin-top:5px">ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂéüÊúâÂ∞ÅÈù¢Ë∑ØÂæÑ</div><div class="form-group"><label for="editContent">ÊñáÁ´†ÂÜÖÂÆπ <span style="color:#e74c3c">*</span></label> <textarea id="editContent" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†ÂÜÖÂÆπÔºàÊîØÊåÅMarkdownÊ†ºÂºèÔºâ" rows="15"></textarea></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="editModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò‰øÆÊîπ</button></div></form></div></div></div><div class="modal" id="userModal"><div class="modal-content"><div class="modal-header"><h3>Ê∑ªÂä†Áî®Êà∑</h3><button class="modal-close" data-modal="userModal">√ó</button></div><div class="modal-body"><form id="userForm"><div class="form-group"><label for="userName">Áî®Êà∑Âêç</label> <input id="userName" class="form-control" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required></div><div class="form-group"><label for="userEmail">ÈÇÆÁÆ±</label> <input type="email" id="userEmail" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ" required></div><div class="form-group"><label for="userPassword">ÂØÜÁ†Å</label> <input type="password" id="userPassword" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required></div><div class="form-group"><label for="userRole">ËßíËâ≤</label> <select id="userRole" class="form-control"><option value="user">ÊôÆÈÄöÁî®Êà∑<option value="editor">ÁºñËæë<option value="admin">ÁÆ°ÁêÜÂëò</select></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="userModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">ÂàõÂª∫Áî®Êà∑</button></div></form></div></div></div><div class="modal" id="editUserModal"><div class="modal-content"><div class="modal-header"><h3>ÁºñËæëÁî®Êà∑</h3><button class="modal-close" data-modal="editUserModal">√ó</button></div><div class="modal-body"><form id="editUserForm"><div class="form-group"><label for="editUserName">Áî®Êà∑Âêç</label> <input id="editUserName" class="form-control" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required></div><div class="form-group"><label for="editUserEmail">ÈÇÆÁÆ±</label> <input type="email" id="editUserEmail" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ" required></div><div class="form-group"><label for="editUserPassword">ÂØÜÁ†Å</label> <input type="password" id="editUserPassword" class="form-control" placeholder="ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπÂØÜÁ†Å"></div><div class="form-group"><label for="editUserRole">ËßíËâ≤</label> <select id="editUserRole" class="form-control"><option value="user">ÊôÆÈÄöÁî®Êà∑<option value="editor">ÁºñËæë<option value="admin">ÁÆ°ÁêÜÂëò</select></div><div class="form-group"><label for="editUserStatus">Áä∂ÊÄÅ</label> <select id="editUserStatus" class="form-control"><option value="active">Ê≠£Â∏∏<option value="restricted">ÂèóÈôê<option value="banned">Á¶ÅÁî®</select></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="editUserModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò‰øÆÊîπ</button></div></form></div></div></div><div class="modal" id="viewArticleModal"><div class="modal-content"><div class="modal-header"><h3>ÊñáÁ´†ËØ¶ÊÉÖ</h3><button class="modal-close" data-modal="viewArticleModal">√ó</button></div><div class="modal-body"><div class="form-group"><label>ÊñáÁ´†ID</label><div id="viewArticleId" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>Ê†áÈ¢ò</label><div id="viewArticleTitle" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>‰ΩúËÄÖ</label><div id="viewArticleAuthor" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>Áä∂ÊÄÅ</label><div id="viewArticleStatus" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ÂàõÂª∫Êó∂Èó¥</label><div id="viewArticleDate" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ÂÜÖÂÆπ</label><div id="viewArticleContent" class="form-control" style="background:rgba(0,0,0,.03);min-height:200px;white-space:pre-wrap"></div></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="viewArticleModal">ÂÖ≥Èó≠</button></div></div></div></div><div class="modal" id="uploadAttachmentModal"><div class="modal-content"><div class="modal-header"><h3>‰∏ä‰º†ÈôÑ‰ª∂</h3><button class="modal-close" data-modal="uploadAttachmentModal">√ó</button></div><div class="modal-body"><div class="form-group"><label>ÊñáÁ´†ID</label><div id="uploadAttachmentArticleId" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ÈÄâÊã©Êñá‰ª∂</label> <input type="file" id="attachmentFile" class="form-control" accept=".svg,.bmp,.pdf,.docx,.mp4,.mp3,.flac,.zip,.tar,.7z,.gz,.tar.gz"> <small style="color:rgba(255,255,255,.6);display:block;margin-top:5px">ÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûãÔºöSVG, BMP, PDF, DOCX, MP4, MP3, FLAC, ZIP, TAR, 7Z, GZ, TAR.GZ</small></div><div id="uploadAttachmentProgress" style="display:none;margin-top:15px"><div style="background:rgba(0,0,0,.1);border-radius:4px;overflow:hidden"><div id="uploadAttachmentProgressBar" style="width:0%;height:20px;background:#007bff;transition:width .3s"></div></div><div id="uploadAttachmentStatus" style="margin-top:5px;font-size:.9em"></div></div><div id="uploadAttachmentResult" style="display:none;margin-top:15px"><div style="background:rgba(0,184,148,.1);border:1px solid rgba(0,184,148,.3);border-radius:8px;padding:15px"><div style="color:#00b894;font-weight:500">‰∏ä‰º†ÊàêÂäüÔºÅ</div><div id="uploadAttachmentFileInfo" style="margin-top:10px;font-size:.9em"></div></div></div><div class="btn-group"><button type="button" class="btn-primary" id="uploadAttachmentBtn">‰∏ä‰º†</button> <button type="button" class="btn-secondary" data-modal="uploadAttachmentModal">ÂèñÊ∂à</button></div></div></div></div><div class="modal" id="viewUserModal"><div class="modal-content"><div class="modal-header"><h3>Áî®Êà∑ËØ¶ÊÉÖ</h3><button class="modal-close" data-modal="viewUserModal">√ó</button></div><div class="modal-body"><div class="form-group"><label>Áî®Êà∑ID</label><div id="viewUserId" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>Áî®Êà∑Âêç</label><div id="viewUserName" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ÈÇÆÁÆ±</label><div id="viewUserEmail" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ËßíËâ≤</label><div id="viewUserRole" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>Áä∂ÊÄÅ</label><div id="viewUserStatus" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>Ê≥®ÂÜåÊó∂Èó¥</label><div id="viewUserDate" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="viewUserModal">ÂÖ≥Èó≠</button></div></div></div></div><div class="modal" id="viewCommentModal"><div class="modal-content"><div class="modal-header"><h3>ËØÑËÆ∫ËØ¶ÊÉÖ</h3><button class="modal-close" data-modal="viewCommentModal">√ó</button></div><div class="modal-body"><div class="form-group"><label>ËØÑËÆ∫ID</label><div id="viewCommentId" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ËØÑËÆ∫ÂÜÖÂÆπ</label><div id="viewCommentContent" class="form-control" style="background:rgba(0,0,0,.03);min-height:100px;white-space:pre-wrap"></div></div><div class="form-group"><label>ÊâÄÂ±ûÊñáÁ´†</label><div id="viewCommentArticle" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ËØÑËÆ∫Áî®Êà∑</label><div id="viewCommentUser" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>Áä∂ÊÄÅ</label><div id="viewCommentStatus" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="form-group"><label>ËØÑËÆ∫Êó∂Èó¥</label><div id="viewCommentDate" class="form-control" style="background:rgba(0,0,0,.03)"></div></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="viewCommentModal">ÂÖ≥Èó≠</button></div></div></div></div><div class="modal" id="categoryModal"><div class="modal-content"><div class="modal-header"><h3 id="categoryModalTitle">Ê∑ªÂä†ÂàÜÁ±ª</h3><button class="modal-close" data-modal="categoryModal">√ó</button></div><div class="modal-body"><form id="categoryForm"><div class="form-group"><label for="categoryName">ÂàÜÁ±ªÂêçÁß∞</label> <input id="categoryName" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞" required></div><div class="form-group"><label for="categoryDescription">ÊèèËø∞</label> <textarea id="categoryDescription" class="form-control" rows="3" placeholder="ËØ∑ËæìÂÖ•ÂàÜÁ±ªÊèèËø∞"></textarea></div><div class="form-group"><label for="categoryIcon">ÂõæÊ†á</label> <input id="categoryIcon" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂõæÊ†áÔºàemojiÊàñÂõæÊ†áÁ±ªÂêçÔºâ"></div><div class="form-group"><label for="categorySortOrder">ÊéíÂ∫è</label> <input type="number" id="categorySortOrder" class="form-control" placeholder="0" min="0" value="0"></div><div class="form-group"><label for="categoryEnabled"><input type="checkbox" id="categoryEnabled" checked> ÂêØÁî®</label></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="categoryModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò</button></div></form></div></div></div><div class="modal" id="tagModal"><div class="modal-content"><div class="modal-header"><h3 id="tagModalTitle">Ê∑ªÂä†Ê†áÁ≠æ</h3><button class="modal-close" data-modal="tagModal">√ó</button></div><div class="modal-body"><form id="tagForm"><div class="form-group"><label for="tagName">Ê†áÁ≠æÂêçÁß∞</label> <input id="tagName" class="form-control" placeholder="ËØ∑ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞" required></div><div class="form-group"><label for="tagDescription">ÊèèËø∞</label> <textarea id="tagDescription" class="form-control" rows="3" placeholder="ËØ∑ËæìÂÖ•Ê†áÁ≠æÊèèËø∞"></textarea></div><div class="form-group"><label for="tagColor">È¢úËâ≤</label> <input type="color" id="tagColor" class="form-control" value="#007bff"></div><div class="form-group"><label for="tagCategory">ÊâÄÂ±ûÂàÜÁ±ª</label> <select id="tagCategory" class="form-control"><option value="0">Êó†ÂàÜÁ±ª</select></div><div class="form-group"><label for="tagSortOrder">ÊéíÂ∫è</label> <input type="number" id="tagSortOrder" class="form-control" placeholder="0" min="0" value="0"></div><div class="form-group"><label for="tagEnabled"><input type="checkbox" id="tagEnabled" checked> ÂêØÁî®</label></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="tagModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò</button></div></form></div></div></div><div class="modal" id="confirmModal"><div class="modal-content"><div class="modal-header"><h3>Á°ÆËÆ§Êìç‰Ωú</h3><button class="modal-close" data-modal="confirmModal">√ó</button></div><div class="modal-body"><p id="confirmMessage">Á°ÆÂÆöË¶ÅÊâßË°åÊ≠§Êìç‰ΩúÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ<div class="btn-group"><button type="button" class="btn-secondary" data-modal="confirmModal">ÂèñÊ∂à</button> <button type="button" class="btn-primary" id="confirmAction">Á°ÆËÆ§</button></div></div></div></div><div class="modal" id="mainCardModal"><div class="modal-content"><div class="modal-header"><h3 id="mainCardModalTitle">ÁºñËæë‰∏ªÂç°Áâá</h3><button class="modal-close" data-modal="mainCardModal">√ó</button></div><div class="modal-body"><form id="mainCardForm"><input type="hidden" id="mainCardId"><div class="form-group"><label for="mainCardTitle">Ê†áÈ¢ò</label> <input id="mainCardTitle" class="form-control" placeholder="ËØ∑ËæìÂÖ•‰∏ªÂç°ÁâáÊ†áÈ¢ò" required></div><div class="form-group"><label for="mainCardIcon">ÂõæÊ†á</label> <input id="mainCardIcon" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂõæÊ†áÔºàÂ¶ÇÔºöüìöÔºâ"></div><div class="form-group"><label for="mainCardLayoutType">Â∏ÉÂ±ÄÁ±ªÂûã</label> <select id="mainCardLayoutType" class="form-control"><option value="grid">ÁΩëÊ†ºÂ∏ÉÂ±Ä<option value="flex">ÂºπÊÄßÂ∏ÉÂ±Ä<option value="team">Âõ¢ÈòüÂ∏ÉÂ±Ä</select></div><div class="form-group"><label for="mainCardCustomCss">Ëá™ÂÆö‰πâCSS</label> <textarea id="mainCardCustomCss" class="form-control" rows="3" placeholder="ÂèØÈÄâÔºöËæìÂÖ•Ëá™ÂÆö‰πâCSSÊ†∑Âºè"></textarea></div><div class="form-group"><label for="mainCardSortOrder">ÊéíÂ∫è</label> <input type="number" id="mainCardSortOrder" class="form-control" placeholder="0" min="0" value="0"></div><div class="form-group"><label for="mainCardEnabled"><input type="checkbox" id="mainCardEnabled" checked> ÂêØÁî®</label></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="mainCardModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò</button></div></form></div></div></div><div class="modal" id="subCardModal"><div class="modal-content"><div class="modal-header"><h3 id="subCardModalTitle">ÁºñËæëÊ¨°Âç°Áâá</h3><button class="modal-close" data-modal="subCardModal">√ó</button></div><div class="modal-body"><form id="subCardForm"><input type="hidden" id="subCardId"><div class="form-group"><label for="subCardMainCardId">ÊâÄÂ±û‰∏ªÂç°Áâá</label> <select id="subCardMainCardId" class="form-control" required><option value="">ËØ∑ÈÄâÊã©‰∏ªÂç°Áâá</select></div><div class="form-group"><label for="subCardTitle">Ê†áÈ¢ò</label> <input id="subCardTitle" class="form-control" placeholder="ËØ∑ËæìÂÖ•Ê¨°Âç°ÁâáÊ†áÈ¢ò" required></div><div class="form-group"><label for="subCardDescription">ÊèèËø∞</label> <textarea id="subCardDescription" class="form-control" rows="3" placeholder="ËØ∑ËæìÂÖ•ÊèèËø∞"></textarea></div><div class="form-group"><label for="subCardIcon">ÂõæÊ†á</label> <input id="subCardIcon" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂõæÊ†áÔºàÂ¶ÇÔºö‚≠êÔºâ"></div><div class="form-group"><label for="subCardLinkUrl">ÈìæÊé•URL</label> <input id="subCardLinkUrl" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÈìæÊé•URLÔºàÂèØÈÄâÔºâ"></div><div class="form-group"><label for="subCardCustomCss">Ëá™ÂÆö‰πâCSS</label> <textarea id="subCardCustomCss" class="form-control" rows="3" placeholder="ÂèØÈÄâÔºöËæìÂÖ•Ëá™ÂÆö‰πâCSSÊ†∑Âºè"></textarea></div><div class="form-group"><label for="subCardSortOrder">ÊéíÂ∫è</label> <input type="number" id="subCardSortOrder" class="form-control" placeholder="0" min="0" value="0"></div><div class="form-group"><label for="subCardEnabled"><input type="checkbox" id="subCardEnabled" checked> ÂêØÁî®</label></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="subCardModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò</button></div></form></div></div></div><div class="modal" id="friendLinkModal"><div class="modal-content"><div class="modal-header"><h3 id="friendLinkModalTitle">Ê∑ªÂä†ÂèãÊÉÖÈìæÊé•</h3><button class="modal-close" data-modal="friendLinkModal">√ó</button></div><div class="modal-body"><form id="friendLinkForm"><input type="hidden" id="friendLinkId"><div class="form-group"><label for="friendLinkNickname">ÊòµÁß∞ *</label> <input id="friendLinkNickname" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂèãÈìæÊòµÁß∞" required></div><div class="form-group"><label for="friendLinkUrl">ÈìæÊé•Âú∞ÂùÄ *</label> <input type="url" id="friendLinkUrl" class="form-control" placeholder="https://example.com" required></div><div class="form-group"><label for="friendLinkAvatar">Â§¥ÂÉèÂú∞ÂùÄ</label> <input id="friendLinkAvatar" class="form-control" placeholder="/img/avatar.png Êàñ https://example.com/avatar.png"></div><div class="form-group"><label for="friendLinkMotto">‰∏™ÊÄßÁ≠æÂêç</label> <input id="friendLinkMotto" class="form-control" placeholder="ÁÆÄÁü≠ÁöÑ‰∏™ÊÄßÁ≠æÂêçÊàñÊèèËø∞"></div><div class="form-group"><label for="friendLinkSortOrder">ÊéíÂ∫èÈ°∫Â∫è</label> <input type="number" id="friendLinkSortOrder" class="form-control" placeholder="0" min="0" value="0"> <small style="color:rgba(255,255,255,.6)">Êï∞Â≠óË∂äÂ∞èË∂äÈù†Ââç</small></div><div class="form-group"><label for="friendLinkEnabled"><input type="checkbox" id="friendLinkEnabled" checked> ÂêØÁî®Ê≠§ÂèãÈìæ</label></div><div class="btn-group"><button type="button" class="btn-secondary" data-modal="friendLinkModal">ÂèñÊ∂à</button> <button type="submit" class="btn-primary">‰øùÂ≠ò</button></div></form></div></div></div><footer><div>&copy; {{ year }} {{ foodes }}</div></footer><script>function showToast(e,t="success"){const n=document.getElementById("toastContainer");if(!n)return void console.error("Toast container not found");const a=document.createElement("div");a.className=`toast ${t}`;let o="";switch(t){case"success":default:o="‚≠ï";break;case"error":o="‚ùå";break;case"warning":o="‚ö†Ô∏è"}a.innerHTML=`\n    <div class="toast-icon">${o}</div>\n    <div class="toast-message">${e}</div>\n    <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>\n  `,n.appendChild(a),setTimeout(()=>{a.parentElement&&a.remove()},3e3)}async function fetchCategories(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/admin/categories",{headers:t}),a=await n.json();return a.success&&a.data?a.data:(console.error("Ëé∑ÂèñÂàÜÁ±ªÂàóË°®Â§±Ë¥•:",a.message),[])}catch(e){return console.error("Ëé∑ÂèñÂàÜÁ±ªÂàóË°®Â§±Ë¥•:",e),[]}}async function fetchTags(e=null){try{const t=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};t&&(n.Authorization=`Bearer ${t}`);let a="/api/admin/tags";null!==e&&""!==e&&(a+=`?category_id=${e}`);const o=await fetch(a,{headers:n}),c=await o.json();return c.success&&c.data?c.data:(console.error("Ëé∑ÂèñÊ†áÁ≠æÂàóË°®Â§±Ë¥•:",c.message),[])}catch(e){return console.error("Ëé∑ÂèñÊ†áÁ≠æÂàóË°®Â§±Ë¥•:",e),[]}}function updateCategoriesTable(e){const t=document.querySelector("#categories tbody");t&&(t.innerHTML="",0!==e.length?(e.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`\n      <td>\n        <input type="checkbox" class="category-checkbox" data-id="${e.id}">\n      </td>\n      <td>${e.sort_order}</td>\n      <td>${e.icon||""}</td>\n      <td>${e.name}</td>\n      <td>${e.description||"-"}</td>\n      <td><span style="color: ${e.is_enabled?"#00b894":"#e74c3c"};">${e.is_enabled?"ÂêØÁî®":"Á¶ÅÁî®"}</span></td>\n      <td class="action-buttons">\n        <button class="btn btn-sm btn-edit" data-action="edit-category" data-id="${e.id}">ÁºñËæë</button>\n        <button class="btn btn-sm btn-delete" data-action="delete-category" data-id="${e.id}">Âà†Èô§</button>\n      </td>\n    `,t.appendChild(n)}),bindActionButtons(),bindCategoryCheckboxes()):t.innerHTML='\n      <tr>\n        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">\n          <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>\n          <div>ÊöÇÊó†ÂàÜÁ±ª</div>\n        </td>\n      </tr>\n    ')}function updateTagsTable(e){const t=document.querySelector("#tags tbody");t&&(t.innerHTML="",0!==e.length?(e.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`\n      <td>\n        <input type="checkbox" class="tag-checkbox" data-id="${e.id}">\n      </td>\n      <td>${e.sort_order}</td>\n      <td><span style="display: inline-block; width: 20px; height: 20px; background-color: ${e.color}; border-radius: 4px;"></span></td>\n      <td>${e.name}</td>\n      <td>${e.description||"-"}</td>\n      <td>${0===e.category_id?"Êó†ÂàÜÁ±ª":e.category_id}</td>\n      <td><span style="color: ${e.is_enabled?"#00b894":"#e74c3c"};">${e.is_enabled?"ÂêØÁî®":"Á¶ÅÁî®"}</span></td>\n      <td class="action-buttons">\n        <button class="btn btn-sm btn-edit" data-action="edit-tag" data-id="${e.id}">ÁºñËæë</button>\n        <button class="btn btn-sm btn-delete" data-action="delete-tag" data-id="${e.id}">Âà†Èô§</button>\n      </td>\n    `,t.appendChild(n)}),bindActionButtons(),bindTagCheckboxes()):t.innerHTML='\n      <tr>\n        <td colspan="8" style="text-align: center; padding: 40px; color: #999;">\n          <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>\n          <div>ÊöÇÊó†Ê†áÁ≠æ</div>\n        </td>\n      </tr>\n    ')}async function loadCategoriesAndTags(){const e=await fetchCategories();updateCategoriesTable(e);const t=document.getElementById("tagCategoryFilter");t&&(t.innerHTML='<option value="">ÂÖ®ÈÉ®Ê†áÁ≠æ</option>',e.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.name,t.appendChild(n)}));const n=document.getElementById("tagCategory");n&&(n.innerHTML='<option value="0">Êó†ÂàÜÁ±ª</option>',e.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,n.appendChild(t)}));updateTagsTable(await fetchTags())}async function populateCategorySelect(e,t=""){const n=document.getElementById(e);if(!n)return;const a=await fetchCategories();n.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="Êú™ÂàÜÁ±ª",""!==t&&"Êú™ÂàÜÁ±ª"!==t||(o.selected=!0),n.appendChild(o),a.length>0&&a.forEach(e=>{const a=document.createElement("option");a.value=e.name,a.textContent=e.name,e.icon&&(a.textContent=`${e.icon} ${e.name}`),e.name===t&&(a.selected=!0),n.appendChild(a)})}async function fetchTags(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/admin/tags",{headers:t}),a=await n.json();return a.success&&a.data?a.data:[]}catch(e){return console.error("Ëé∑ÂèñÊ†áÁ≠æÂàóË°®Â§±Ë¥•:",e),[]}}async function populateTagSelector(e=[]){const t=document.getElementById("editTagSelector");if(!t)return;const n=await fetchTags();if(t.innerHTML="",0===n.length)return void(t.innerHTML='<div style="color: #999; font-size: 0.9em;">ÊöÇÊó†Ê†áÁ≠æ</div>');n.forEach(n=>{if(!n.is_enabled)return;const a=document.createElement("div");a.className="tag-option",a.dataset.tagId=n.id,a.dataset.tagName=n.name,a.innerHTML=`\n      <span style="display: inline-block; width: 12px; height: 12px; background-color: ${n.color}; border-radius: 2px; margin-right: 6px;"></span>\n      ${n.name}\n    `,e.includes(n.name)&&a.classList.add("selected"),a.addEventListener("click",function(){this.classList.toggle("selected"),updateSelectedTags()}),t.appendChild(a)});const a=document.getElementById("editTags");a&&(a.value=JSON.stringify(e))}function updateSelectedTags(){const e=[];document.querySelectorAll("#editTagSelector .tag-option.selected").forEach(t=>{e.push(t.dataset.tagName)});const t=document.getElementById("editTags");t&&(t.value=JSON.stringify(e))}async function populateTagSelectorForNewArticle(){const e=document.getElementById("articleTagSelector");if(!e)return;const t=await fetchTags();e.innerHTML="",0!==t.length?(t.forEach(t=>{if(!t.is_enabled)return;const n=document.createElement("div");n.className="tag-option",n.dataset.tagId=t.id,n.dataset.tagName=t.name,n.innerHTML=`\n      <span style="display: inline-block; width: 12px; height: 12px; background-color: ${t.color}; border-radius: 2px; margin-right: 6px;"></span>\n      ${t.name}\n    `,n.addEventListener("click",function(){this.classList.toggle("selected"),updateSelectedTagsForNewArticle()}),e.appendChild(n)}),updateSelectedTagsForNewArticle()):e.innerHTML='<div style="color: #999; font-size: 0.9em;">ÊöÇÊó†Ê†áÁ≠æ</div>'}function updateSelectedTagsForNewArticle(){const e=[];document.querySelectorAll("#articleTagSelector .tag-option.selected").forEach(t=>{e.push(t.dataset.tagName)});const t=document.getElementById("articleTags");t&&(t.value=JSON.stringify(e))}async function populateTagSelectorForUpload(){const e=document.getElementById("uploadTagSelector");if(!e)return;const t=await fetchTags();e.innerHTML="",0!==t.length?t.forEach(t=>{if(!t.is_enabled)return;const n=document.createElement("div");n.className="tag-option",n.dataset.tagId=t.id,n.dataset.tagName=t.name,n.innerHTML=`\n      <span style="display: inline-block; width: 12px; height: 12px; background-color: ${t.color}; border-radius: 2px; margin-right: 6px;"></span>\n      ${t.name}\n    `,n.addEventListener("click",function(){this.classList.toggle("selected")}),e.appendChild(n)}):e.innerHTML='<div style="color: #999; font-size: 0.9em;">ÊöÇÊó†Ê†áÁ≠æ</div>'}async function populateCategorySelectorForUpload(){const e=document.getElementById("uploadCategorySelector");if(!e)return;const t=await fetchCategories();e.innerHTML="",0!==t.length?t.forEach(t=>{if(!t.is_enabled)return;const n=document.createElement("div");n.className="category-option",n.dataset.categoryId=t.id,n.dataset.categoryName=t.name,n.innerHTML=`\n      <span style="display: inline-block; width: 12px; height: 12px; background-color: #007bff; border-radius: 2px; margin-right: 6px;"></span>\n      ${t.name}\n    `,n.addEventListener("click",function(){this.classList.contains("selected")?this.classList.remove("selected"):(e.querySelectorAll(".category-option").forEach(e=>{e.classList.remove("selected")}),this.classList.add("selected"))}),e.appendChild(n)}):e.innerHTML='<div style="color: #999; font-size: 0.9em;">ÊöÇÊó†ÂàÜÁ±ª</div>'}async function populateCategorySelectorForNewArticle(){const e=document.getElementById("articleCategory");if(!e)return;const t=await fetchCategories();if(e.innerHTML="",0===t.length){const t=document.createElement("option");return t.value="",t.textContent="ÊöÇÊó†ÂàÜÁ±ª",void e.appendChild(t)}t.forEach(t=>{const n=document.createElement("option");n.value=t.name,n.textContent=t.name,e.appendChild(n)})}async function fetchAdminData(e=1,t=10,n=1,a=10,o=1,c=10){try{const s=localStorage.getItem("auth_token"),d={"Content-Type":"application/json"};s&&(d.Authorization=`Bearer ${s}`);const i=await fetch(`/api/admin/passages?page=${e}&limit=${t}`,{headers:d}),r=await i.json();if(r.success&&r.data)if(r.data.length>0){updateArticlesTable(r.data);updateStatCard("totalArticles",r.pagination?.total||r.data.length),updatePagination(r.pagination)}else showEmptyState("articlesTableBody","ÊöÇÊó†ÊñáÁ´†"),updateStatCard("totalArticles",0),hidePagination();else showEmptyState("articlesTableBody","ÊöÇÊó†ÊñáÁ´†"),updateStatCard("totalArticles",0),hidePagination();const l=await fetch(`/api/admin/users?page=${n}&limit=${a}`,{headers:d}),u=await l.json();if(u.success&&u.data)if(u.data.length>0){updateUsersTable(u.data);updateStatCard("totalUsers",u.pagination?.total||u.data.length),updateUserPagination(u.pagination)}else showEmptyState("usersTableBody","ÊöÇÊó†Áî®Êà∑",7),updateStatCard("totalUsers",0),hideUserPagination();else showEmptyState("usersTableBody","ÊöÇÊó†Áî®Êà∑",7),updateStatCard("totalUsers",0),hideUserPagination();const m=await fetch(`/api/admin/comments?page=${o}&limit=${c}`,{headers:d}),g=await m.json();g.success&&g.data&&g.data.length>0?(updateCommentsTable(g.data),updateCommentsPagination(g.pagination)):(showEmptyState("commentsTableBody","ÊöÇÊó†ËØÑËÆ∫",6),hideCommentsPagination());const h=await fetch("/api/admin/stats",{headers:d}),y=await h.json();if(console.log("ÁªüËÆ°Êï∞ÊçÆÂìçÂ∫î:",y),y.success&&y.data){updateStatCard("todayVisits",y.data.today_visits||0);const e=document.querySelector("#todayVisits").closest(".stat-card").querySelector(".stat-change");if(e&&void 0!==y.data.yesterday_visits){y.data.yesterday_visits;const t=y.data.visits_change_percent||0,n=y.data.visits_trend||"stable";"up"===n?(e.className="stat-change positive",e.textContent=`ËæÉÊò®Êó• +${t.toFixed(1)}%`):"down"===n?(e.className="stat-change negative",e.textContent=`ËæÉÊò®Êó• ${t.toFixed(1)}%`):(e.className="stat-change neutral",e.textContent="ËæÉÊò®Êó•ÊåÅÂπ≥")}}else console.error("Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:",y)}catch(e){console.error("Ëé∑ÂèñÁÆ°ÁêÜÊï∞ÊçÆÂ§±Ë¥•:",e)}}function showEmptyState(e,t,n=6){const a=document.querySelector(`#${e}`);if(!a)return;const o=localStorage.getItem("auth_token");let c=t;o||(c="ËØ∑ÂÖàÁôªÂΩï‰ª•Êü•ÁúãÊï∞ÊçÆ"),a.innerHTML=`\n    <tr>\n      <td colspan="${n}" style="text-align: center; padding: 40px; color: #999;">\n        <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>\n        <div>${c}</div>\n        ${o?"":'<div style="margin-top: 10px; font-size: 0.9em;"><a href="#loginModal" onclick="document.getElementById(\'loginBtn\').click(); return false;" style="color: #007bff; text-decoration: none;">ÁÇπÂáªÁôªÂΩï</a></div>'}\n      </td>\n    </tr>\n  `}let currentPage=1,currentLimit=10,totalPages=1;function updatePagination(e){if(!e)return void hidePagination();const t=parseInt(e.page)||1,n=parseInt(e.limit)||10,a=parseInt(e.total)||0;currentPage=t,currentLimit=n,totalPages=Math.ceil(a/n);const o=document.getElementById("paginationContainer");o&&(o.style.display="flex");const c=(t-1)*n+1,s=Math.min(t*n,a),d=document.getElementById("paginationInfo");d&&(d.textContent=`ÊòæÁ§∫ ${c}-${s} Êù°ÔºåÂÖ± ${a} Êù°`);const i=document.getElementById("prevPageBtn"),r=document.getElementById("nextPageBtn");i&&(i.disabled=t<=1),r&&(r.disabled=t>=totalPages),generatePageButtons(t,totalPages)}function hidePagination(){const e=document.getElementById("paginationContainer");e&&(e.style.display="none")}function generatePageButtons(e,t){const n=document.getElementById("paginationPages");if(!n)return;n.innerHTML="";let a=Math.max(1,e-2),o=Math.min(t,e+2);o-a<4&&(1===a?o=Math.min(t,5):o===t&&(a=Math.max(1,t-4))),a>1&&(addPageButton(1,n),a>2&&addEllipsis(n));for(let t=a;t<=o;t++)addPageButton(t,n,t===e);o<t&&(o<t-1&&addEllipsis(n),addPageButton(t,n))}function addPageButton(e,t,n=!1){const a=document.createElement("button");a.className="pagination-page "+(n?"active":""),a.textContent=e,a.addEventListener("click",()=>{e!==currentPage&&fetchAdminData(e,currentLimit)}),t.appendChild(a)}function addEllipsis(e){const t=document.createElement("span");t.className="pagination-page ellipsis",t.textContent="...",e.appendChild(t)}function goToPrevPage(){currentPage>1&&fetchAdminData(currentPage-1,currentLimit)}function goToNextPage(){currentPage<totalPages&&fetchAdminData(currentPage+1,currentLimit)}function getUsernameFromToken(){const e=localStorage.getItem("auth_token");if(!e)return"ÁÆ°ÁêÜÂëò";try{const t=e.split(".");if(3!==t.length)return"ÁÆ°ÁêÜÂëò";const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),a=atob(n);return JSON.parse(a).username||"ÁÆ°ÁêÜÂëò"}catch(e){return console.error("Ëß£ÊûêtokenÂ§±Ë¥•:",e),"ÁÆ°ÁêÜÂëò"}}async function updateWelcomeMessage(){const e=getUsernameFromToken(),t=document.querySelector(".welcome-text h2");t&&(t.textContent=`Ê¨¢ËøéÂõûÊù•Ôºå${e}`);let n="/img/avatar.webp";try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const a=await fetch("/api/settings/template",{method:"GET",headers:t});if(a.ok){const e=await a.json();e.global_avatar&&(n=e.global_avatar)}}catch(e){console.error("Ëé∑ÂèñÂÖ®Â±ÄÂ§¥ÂÉèËÆæÁΩÆÂ§±Ë¥•:",e)}const a=document.querySelector(".admin-avatar");a&&(a.innerHTML=`<img src="${n}" alt="${e}" class="avatar-image">`)}document.addEventListener("DOMContentLoaded",function(){updateWelcomeMessage();const e=document.getElementById("prevPageBtn"),t=document.getElementById("nextPageBtn"),n=document.getElementById("refreshArticlesBtn");e&&e.addEventListener("click",goToPrevPage),t&&t.addEventListener("click",goToNextPage),n&&n.addEventListener("click",()=>{fetchAdminData(currentPage,currentLimit)});const a=document.getElementById("prevUserPageBtn"),o=document.getElementById("nextUserPageBtn");a&&a.addEventListener("click",goToPrevUserPage),o&&o.addEventListener("click",goToNextUserPage);const c=document.getElementById("prevCommentsPageBtn"),s=document.getElementById("nextCommentsPageBtn"),d=document.getElementById("refreshCommentsBtn");c&&c.addEventListener("click",goToPrevCommentsPage),s&&s.addEventListener("click",goToNextCommentsPage),d&&d.addEventListener("click",()=>{fetchAdminData(currentPage,currentLimit,currentUserPage,currentUserLimit,currentCommentsPage,currentCommentsLimit)});const i=document.getElementById("batchDeleteCommentsBtn");i&&i.addEventListener("click",batchDeleteComments);const r=document.getElementById("addCategoryBtn"),l=document.getElementById("refreshCategoriesBtn");r&&r.addEventListener("click",()=>{document.getElementById("categoryModalTitle").textContent="Ê∑ªÂä†ÂàÜÁ±ª",document.getElementById("categoryForm").reset(),delete document.getElementById("categoryForm").dataset.categoryId,openModal("categoryModal")}),l&&l.addEventListener("click",loadCategoriesAndTags);const u=document.getElementById("batchDeleteCategoriesBtn");u&&u.addEventListener("click",batchDeleteCategories);const m=document.getElementById("addTagBtn"),g=document.getElementById("refreshTagsBtn"),h=document.getElementById("tagCategoryFilter");m&&m.addEventListener("click",async()=>{await loadCategoriesAndTags(),document.getElementById("tagModalTitle").textContent="Ê∑ªÂä†Ê†áÁ≠æ",document.getElementById("tagForm").reset(),delete document.getElementById("tagForm").dataset.tagId,openModal("tagModal")}),g&&g.addEventListener("click",loadCategoriesAndTags);const y=document.getElementById("batchDeleteTagsBtn");y&&y.addEventListener("click",batchDeleteTags),h&&h.addEventListener("change",async function(){const e=this.value;updateTagsTable(await fetchTags(e))})});let currentUserPage=1,currentUserLimit=10,totalUserPages=1;function updateUserPagination(e){if(!e)return void hideUserPagination();const t=parseInt(e.page)||1,n=parseInt(e.limit)||10,a=parseInt(e.total)||0;currentUserPage=t,currentUserLimit=n,totalUserPages=Math.ceil(a/n);const o=document.getElementById("userPaginationContainer");o&&(o.style.display="flex");const c=(t-1)*n+1,s=Math.min(t*n,a),d=document.getElementById("userPaginationInfo");d&&(d.textContent=`ÊòæÁ§∫ ${c}-${s} Êù°ÔºåÂÖ± ${a} Êù°`);const i=document.getElementById("prevUserPageBtn"),r=document.getElementById("nextUserPageBtn");i&&(i.disabled=t<=1),r&&(r.disabled=t>=totalUserPages),generateUserPageButtons(t,totalUserPages)}function hideUserPagination(){const e=document.getElementById("userPaginationContainer");e&&(e.style.display="none")}function generateUserPageButtons(e,t){const n=document.getElementById("userPaginationPages");if(!n)return;n.innerHTML="";let a=Math.max(1,e-2),o=Math.min(t,e+2);o-a<4&&(1===a?o=Math.min(t,5):o===t&&(a=Math.max(1,t-4))),a>1&&(addUserPageButton(1,n),a>2&&addUserEllipsis(n));for(let t=a;t<=o;t++)addUserPageButton(t,n,t===e);o<t&&(o<t-1&&addUserEllipsis(n),addUserPageButton(t,n))}function addUserPageButton(e,t,n=!1){const a=document.createElement("button");a.className="pagination-page "+(n?"active":""),a.textContent=e,a.addEventListener("click",()=>{e!==currentUserPage&&fetchAdminData(currentPage,currentLimit,e,currentUserLimit)}),t.appendChild(a)}function addUserEllipsis(e){const t=document.createElement("span");t.className="pagination-page ellipsis",t.textContent="...",e.appendChild(t)}function goToPrevUserPage(){currentUserPage>1&&fetchAdminData(currentPage,currentLimit,currentUserPage-1,currentUserLimit)}function goToNextUserPage(){currentUserPage<totalUserPages&&fetchAdminData(currentPage,currentLimit,currentUserPage+1,currentUserLimit)}let currentCommentsPage=1,currentCommentsLimit=10,totalCommentsPages=1;function updateCommentsTable(e){const t=document.querySelector("#comments tbody");t&&(t.innerHTML="",e.forEach(e=>{const n=document.createElement("tr"),a=generateAdminIdenticon(e.username||"anonymous",24);n.innerHTML=`\n      <td>\n        <input type="checkbox" class="comment-checkbox" data-id="${e.id}">\n      </td>\n      <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${e.content}</td>\n      <td>${e.passage_uuid}</td>\n      <td>\n        <div style="display: flex; align-items: center; gap: 8px;">\n          <img src="${a}" alt="${e.username||"ÂåøÂêçÁî®Êà∑"}" style="width: 24px; height: 24px; border-radius: 50%;"/>\n          <span>${e.username}</span>\n        </div>\n      </td>\n      <td>${e.created_at}</td>\n      <td class="action-buttons">\n        <button class="btn btn-sm btn-delete" data-action="delete-comment" data-id="${e.id}">Âà†Èô§</button>\n      </td>\n    `,t.appendChild(n)}),bindActionButtons(),bindCommentCheckboxes())}function generateAdminIdenticon(e,t=24){const n=simpleAdminHash(e),a=n%360,o=65+n%15,c=55+n%10,s=`hsl(${a}, ${o}%, ${c}%)`,d=`hsl(${a}, ${o}%, ${c-25}%)`;let i="";for(let e=0;e<5;e++)for(let t=0;t<Math.ceil(2.5);t++){n>>5*e+t&1&&(i+=`<rect x="${t}" y="${e}" width="1" height="1" fill="${s}"/>`,i+=`<rect x="${4-t}" y="${e}" width="1" height="1" fill="${s}"/>`)}const r=e?e.charAt(0).toUpperCase():"?";return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(`\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 5 5" width="${t}" height="${t}">\n      <rect width="5" height="5" fill="#f0f0f0"/>\n      ${i}\n      <text x="2.5" y="2.85" \n            text-anchor="middle" \n            font-size="2.5" \n            font-weight="bold" \n            fill="${d}"\n            font-family="system-ui, -apple-system, sans-serif">${r}</text>\n    </svg>\n  `)))}function simpleAdminHash(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t)}function bindCommentCheckboxes(){const e=document.getElementById("selectAllComments"),t=document.querySelectorAll(".comment-checkbox");e&&e.addEventListener("change",function(){t.forEach(e=>{e.checked=this.checked;const t=e.closest("tr");t&&(this.checked?t.classList.add("selected"):t.classList.remove("selected"))}),updateBatchDeleteButton()}),t.forEach(e=>{e.addEventListener("change",function(){const e=this.closest("tr");e&&(this.checked?e.classList.add("selected"):e.classList.remove("selected")),updateBatchDeleteButton(),updateSelectAllCheckbox()})})}function updateBatchDeleteButton(){const e=document.querySelectorAll(".comment-checkbox:checked").length,t=document.getElementById("batchDeleteCommentsBtn");t&&(e>0?(t.style.display="inline-block",t.textContent=`ÊâπÈáèÂà†Èô§ (${e})`):t.style.display="none")}function updateSelectAllCheckbox(){const e=document.getElementById("selectAllComments"),t=document.querySelectorAll(".comment-checkbox");if(e&&t.length>0){const n=Array.from(t).every(e=>e.checked),a=Array.from(t).some(e=>e.checked);e.checked=n,e.indeterminate=a&&!n}}function clearCommentSelection(){const e=document.getElementById("selectAllComments"),t=document.querySelectorAll(".comment-checkbox");e&&(e.checked=!1,e.indeterminate=!1),t.forEach(e=>{e.checked=!1;const t=e.closest("tr");t&&t.classList.remove("selected")}),updateBatchDeleteButton()}async function batchDeleteComments(){const e=document.querySelectorAll(".comment-checkbox:checked"),t=Array.from(e).map(e=>parseInt(e.dataset.id));0!==t.length?(currentAction="batch-delete-comments",currentItemId=t.join(","),document.getElementById("confirmMessage").textContent=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${t.length} Êù°ËØÑËÆ∫ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,openModal("confirmModal")):showToast("ËØ∑ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑËØÑËÆ∫","warning")}function bindCategoryCheckboxes(){const e=document.getElementById("selectAllCategories"),t=document.querySelectorAll(".category-checkbox");e&&e.addEventListener("change",function(){t.forEach(e=>{e.checked=this.checked;const t=e.closest("tr");t&&(this.checked?t.classList.add("selected"):t.classList.remove("selected"))}),updateBatchDeleteCategoriesButton()}),t.forEach(e=>{e.addEventListener("change",function(){const e=this.closest("tr");e&&(this.checked?e.classList.add("selected"):e.classList.remove("selected")),updateBatchDeleteCategoriesButton(),updateSelectAllCategoriesCheckbox()})})}function updateBatchDeleteCategoriesButton(){const e=document.querySelectorAll(".category-checkbox:checked").length,t=document.getElementById("batchDeleteCategoriesBtn");t&&(e>0?(t.style.display="inline-block",t.textContent=`ÊâπÈáèÂà†Èô§ (${e})`):t.style.display="none")}function updateSelectAllCategoriesCheckbox(){const e=document.getElementById("selectAllCategories"),t=document.querySelectorAll(".category-checkbox");if(e&&t.length>0){const n=Array.from(t).every(e=>e.checked),a=Array.from(t).some(e=>e.checked);e.checked=n,e.indeterminate=a&&!n}}function clearCategorySelection(){const e=document.getElementById("selectAllCategories"),t=document.querySelectorAll(".category-checkbox");e&&(e.checked=!1,e.indeterminate=!1),t.forEach(e=>{e.checked=!1;const t=e.closest("tr");t&&t.classList.remove("selected")}),updateBatchDeleteCategoriesButton()}async function batchDeleteCategories(){const e=document.querySelectorAll(".category-checkbox:checked"),t=Array.from(e).map(e=>parseInt(e.dataset.id));0!==t.length?(currentAction="batch-delete-categories",currentItemId=t.join(","),document.getElementById("confirmMessage").textContent=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${t.length} ‰∏™ÂàÜÁ±ªÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,openModal("confirmModal")):showToast("ËØ∑ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÂàÜÁ±ª","warning")}function bindTagCheckboxes(){const e=document.getElementById("selectAllTags"),t=document.querySelectorAll(".tag-checkbox");e&&e.addEventListener("change",function(){t.forEach(e=>{e.checked=this.checked;const t=e.closest("tr");t&&(this.checked?t.classList.add("selected"):t.classList.remove("selected"))}),updateBatchDeleteTagsButton()}),t.forEach(e=>{e.addEventListener("change",function(){const e=this.closest("tr");e&&(this.checked?e.classList.add("selected"):e.classList.remove("selected")),updateBatchDeleteTagsButton(),updateSelectAllTagsCheckbox()})})}function updateBatchDeleteTagsButton(){const e=document.querySelectorAll(".tag-checkbox:checked").length,t=document.getElementById("batchDeleteTagsBtn");t&&(e>0?(t.style.display="inline-block",t.textContent=`ÊâπÈáèÂà†Èô§ (${e})`):t.style.display="none")}function updateSelectAllTagsCheckbox(){const e=document.getElementById("selectAllTags"),t=document.querySelectorAll(".tag-checkbox");if(e&&t.length>0){const n=Array.from(t).every(e=>e.checked),a=Array.from(t).some(e=>e.checked);e.checked=n,e.indeterminate=a&&!n}}function clearTagSelection(){const e=document.getElementById("selectAllTags"),t=document.querySelectorAll(".tag-checkbox");e&&(e.checked=!1,e.indeterminate=!1),t.forEach(e=>{e.checked=!1;const t=e.closest("tr");t&&t.classList.remove("selected")}),updateBatchDeleteTagsButton()}async function batchDeleteTags(){const e=document.querySelectorAll(".tag-checkbox:checked"),t=Array.from(e).map(e=>parseInt(e.dataset.id));0!==t.length?(currentAction="batch-delete-tags",currentItemId=t.join(","),document.getElementById("confirmMessage").textContent=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${t.length} ‰∏™Ê†áÁ≠æÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,openModal("confirmModal")):showToast("ËØ∑ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÊ†áÁ≠æ","warning")}function updateCommentsPagination(e){if(!e)return void hideCommentsPagination();const t=parseInt(e.page)||1,n=parseInt(e.limit)||10,a=parseInt(e.total)||0;currentCommentsPage=t,currentCommentsLimit=n,totalCommentsPages=Math.ceil(a/n);const o=document.getElementById("commentsPaginationContainer");o&&(o.style.display="flex");const c=(t-1)*n+1,s=Math.min(t*n,a),d=document.getElementById("commentsPaginationInfo");d&&(d.textContent=`ÊòæÁ§∫ ${c}-${s} Êù°ÔºåÂÖ± ${a} Êù°`);const i=document.getElementById("prevCommentsPageBtn"),r=document.getElementById("nextCommentsPageBtn");i&&(i.disabled=t<=1),r&&(r.disabled=t>=totalCommentsPages),generateCommentsPageButtons(t,totalCommentsPages)}function hideCommentsPagination(){const e=document.getElementById("commentsPaginationContainer");e&&(e.style.display="none")}function generateCommentsPageButtons(e,t){const n=document.getElementById("commentsPaginationPages");if(!n)return;n.innerHTML="";let a=Math.max(1,e-2),o=Math.min(t,e+2);o-a<4&&(1===a?o=Math.min(t,5):o===t&&(a=Math.max(1,t-4))),a>1&&(addCommentsPageButton(1,n),a>2&&addCommentsEllipsis(n));for(let t=a;t<=o;t++)addCommentsPageButton(t,n,t===e);o<t&&(o<t-1&&addCommentsEllipsis(n),addCommentsPageButton(t,n))}function addCommentsPageButton(e,t,n=!1){const a=document.createElement("button");a.className="pagination-page "+(n?"active":""),a.textContent=e,a.addEventListener("click",()=>{e!==currentCommentsPage&&fetchAdminData(currentPage,currentLimit,currentUserPage,currentUserLimit,e,currentCommentsLimit)}),t.appendChild(a)}function addCommentsEllipsis(e){const t=document.createElement("span");t.className="pagination-page ellipsis",t.textContent="...",e.appendChild(t)}function goToPrevCommentsPage(){currentCommentsPage>1&&fetchAdminData(currentPage,currentLimit,currentUserPage,currentUserLimit,currentCommentsPage-1,currentCommentsLimit)}function goToNextCommentsPage(){currentCommentsPage<totalCommentsPages&&fetchAdminData(currentPage,currentLimit,currentUserPage,currentUserLimit,currentCommentsPage+1,currentCommentsLimit)}function updateArticlesTable(e){const t=document.querySelector("#articles tbody");t&&(t.innerHTML="",e.forEach(e=>{const n=document.createElement("tr");n.dataset.articleId=e.id;let a=`<span class="status ${e.status||"published"}">${getStatusText(e.status||"published")}</span>`;e.is_scheduled&&(a+=` <span class="status scheduled" title="ÂÆöÊó∂ÂèëÂ∏É">‚è∞ ${e.published_at?formatDate(e.published_at):"Êú™ËÆæÁΩÆ"}</span>`);const o=e.visibility||"public",c="public"===o?"ÂÖ¨ÂºÄ":"ÁßÅÂØÜ",s="public"===o?"visibility-public":"visibility-private";n.innerHTML=`\n      <td>\n        <input type="checkbox" class="article-checkbox" data-id="${e.id}">\n      </td>\n      <td>${e.title}</td>\n      <td>ÁÆ°ÁêÜÂëò</td>\n      <td>${formatDate(e.created_at)||"2024-01-01"}</td>\n      <td>${a}</td>\n      <td><span class="visibility ${s}">${c}</span></td>\n      <td class="action-buttons">\n        <button class="btn btn-sm btn-view" data-action="view" data-id="${e.id}">Êü•Áúã</button>\n        <button class="btn btn-sm btn-edit" data-action="edit" data-id="${e.id}">ÁºñËæë</button>\n        <button class="btn btn-sm btn-upload" data-action="upload" data-id="${e.id}">‰∏ä‰º†ÈôÑ‰ª∂</button>\n        <button class="btn btn-sm btn-delete" data-action="delete" data-id="${e.id}">Âà†Èô§</button>\n      </td>\n    `,n.addEventListener("click",e=>{if(e.target.closest(".action-buttons")||e.target.classList.contains("article-checkbox"))return;const t=n.querySelector(".article-checkbox");t.checked=!t.checked,n.classList.toggle("selected",t.checked),updateBatchActionsBar()});n.querySelector(".article-checkbox").addEventListener("change",e=>{n.classList.toggle("selected",e.target.checked),updateBatchActionsBar()}),t.appendChild(n)}),bindActionButtons(),bindBatchActionEvents())}function bindBatchActionEvents(){const e=document.getElementById("selectAllCheckbox"),t=document.getElementById("batchDeleteBtn"),n=document.getElementById("clearSelectionBtn");e&&e.addEventListener("change",e=>{document.querySelectorAll(".article-checkbox").forEach(t=>{t.checked=e.target.checked;const n=t.closest("tr");n&&n.classList.toggle("selected",e.target.checked)}),updateBatchActionsBar()}),t&&t.addEventListener("click",batchDeleteArticles),n&&n.addEventListener("click",clearSelection)}function updateBatchActionsBar(){const e=document.querySelectorAll(".article-checkbox:checked"),t=document.getElementById("batchActionsBar"),n=document.getElementById("selectedCount"),a=document.getElementById("selectAllCheckbox"),o=e.length;if(o>0?(t.style.display="flex",n.textContent=`Â∑≤ÈÄâÊã© ${o} ÁØáÊñáÁ´†`):t.style.display="none",a){const e=document.querySelectorAll(".article-checkbox");e.length>0&&o===e.length?(a.checked=!0,a.indeterminate=!1):o>0?(a.checked=!1,a.indeterminate=!0):(a.checked=!1,a.indeterminate=!1)}}async function batchDeleteArticles(){const e=document.querySelectorAll(".article-checkbox:checked"),t=Array.from(e).map(e=>parseInt(e.dataset.id));0!==t.length?(currentAction="batch-delete-articles",currentItemId=t.join(","),document.getElementById("confirmMessage").textContent=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${t.length} ÁØáÊñáÁ´†ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,openModal("confirmModal")):showToast("ËØ∑ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÊñáÁ´†","warning")}function clearSelection(){document.querySelectorAll(".article-checkbox").forEach(e=>{e.checked=!1;const t=e.closest("tr");t&&t.classList.remove("selected")});const e=document.getElementById("selectAllCheckbox");e&&(e.checked=!1,e.indeterminate=!1),updateBatchActionsBar()}function bindUserBatchActionEvents(){const e=document.getElementById("selectAllUsersCheckbox"),t=document.getElementById("batchDeleteUsersBtn"),n=document.getElementById("clearUserSelectionBtn");e&&e.addEventListener("change",e=>{document.querySelectorAll(".user-checkbox:not(:disabled)").forEach(t=>{t.checked=e.target.checked;const n=t.closest("tr");n&&n.classList.toggle("selected",e.target.checked)}),updateUserBatchActionsBar()}),t&&t.addEventListener("click",batchDeleteUsers),n&&n.addEventListener("click",clearUserSelection)}function updateUserBatchActionsBar(){const e=document.querySelectorAll(".user-checkbox:checked"),t=document.getElementById("userBatchActionsBar"),n=document.getElementById("userSelectedCount"),a=document.getElementById("selectAllUsersCheckbox"),o=e.length;if(o>0?(t.style.display="flex",n.textContent=`Â∑≤ÈÄâÊã© ${o} ‰∏™Áî®Êà∑`):t.style.display="none",a){const e=document.querySelectorAll(".user-checkbox:not(:disabled)");e.length>0&&o===e.length?(a.checked=!0,a.indeterminate=!1):o>0?(a.checked=!1,a.indeterminate=!0):(a.checked=!1,a.indeterminate=!1)}}async function batchDeleteUsers(){const e=document.querySelectorAll(".user-checkbox:checked"),t=Array.from(e).map(e=>parseInt(e.dataset.id));0!==t.length?(currentAction="batch-delete-users",currentItemId=t.join(","),document.getElementById("confirmMessage").textContent=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${t.length} ‰∏™Áî®Êà∑ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`,openModal("confirmModal")):showToast("ËØ∑ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÁî®Êà∑","warning")}function clearUserSelection(){document.querySelectorAll(".user-checkbox").forEach(e=>{e.checked=!1;const t=e.closest("tr");t&&t.classList.remove("selected")});const e=document.getElementById("selectAllUsersCheckbox");e&&(e.checked=!1,e.indeterminate=!1),updateUserBatchActionsBar()}function formatDate(e){if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}function updateUsersTable(e){const t=document.querySelector("#users tbody");t&&(t.innerHTML="",e.forEach(e=>{const n=document.createElement("tr");n.dataset.userId=e.id;const a="admin"===e.role?"ÁÆ°ÁêÜÂëò":"editor"===e.role?"ÁºñËæë":"ÊôÆÈÄöÁî®Êà∑",o="active"===e.status?"Ê≠£Â∏∏":"restricted"===e.status?"ÂèóÈôê":"Á¶ÅÁî®",c="active"===e.status?"#00b894":"restricted"===e.status?"#fdcb6e":"#e74c3c";n.innerHTML=`\n      <td>\n        <input type="checkbox" class="user-checkbox" data-id="${e.id}" ${"admin"===e.role?"disabled":""}>\n      </td>\n      <td>${e.username}</td>\n      <td>${e.email}</td>\n      <td>${e.created_at||"2024-01-01"}</td>\n      <td>${a}</td>\n      <td><span style="color:${c};">${o}</span></td>\n      <td class="action-buttons">\n        <button class="btn btn-sm btn-view" data-action="view-user" data-id="${e.id}">ËØ¶ÊÉÖ</button>\n        <button class="btn btn-sm btn-edit" data-action="edit-user" data-id="${e.id}">ÁºñËæë</button>\n        ${"admin"!==e.role?`<button class="btn btn-sm btn-delete" data-action="delete-user" data-id="${e.id}">Âà†Èô§</button>`:""}\n      </td>\n    `,n.addEventListener("click",e=>{if(e.target.closest(".action-buttons")||e.target.classList.contains("user-checkbox"))return;const t=n.querySelector(".user-checkbox");t.disabled||(t.checked=!t.checked,n.classList.toggle("selected",t.checked),updateUserBatchActionsBar())});n.querySelector(".user-checkbox").addEventListener("change",e=>{n.classList.toggle("selected",e.target.checked),updateUserBatchActionsBar()}),t.appendChild(n)}),bindActionButtons(),bindUserBatchActionEvents())}function updateStatCard(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function getAuthHeaders(){const e=localStorage.getItem("auth_token");return e?{Authorization:`Bearer ${e}`}:{}}let viewTrendChart=null;async function loadMostViewedArticles(){const e=document.getElementById("mostViewedLimit")?.value||10,t=document.getElementById("mostViewedTableBody");if(t){t.innerHTML='<tr><td colspan="4" style="text-align: center;">Âä†ËΩΩ‰∏≠...</td></tr>';try{const n=await fetch(`/api/admin/analytics?action=most-viewed&limit=${e}`,{headers:getAuthHeaders()}),a=await n.json();if(a.success&&a.data){if(0===a.data.length)return void(t.innerHTML='<tr><td colspan="4" style="text-align: center;">ÊöÇÊó†Êï∞ÊçÆ</td></tr>');t.innerHTML=a.data.map((e,t)=>`\n        <tr>\n          <td>${t+1}</td>\n          <td>${e.title}</td>\n          <td>${e.author}</td>\n          <td>${e.view_count}</td>\n        </tr>\n      `).join("")}else t.innerHTML='<tr><td colspan="4" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}catch(e){console.error("Âä†ËΩΩÁÉ≠Èó®ÊñáÁ´†Â§±Ë¥•:",e),t.innerHTML='<tr><td colspan="4" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}}}async function loadViewSources(){const e=document.getElementById("viewSourcesDays")?.value||30,t=document.getElementById("viewSourcesTableBody");if(t){t.innerHTML='<tr><td colspan="3" style="text-align: center;">Âä†ËΩΩ‰∏≠...</td></tr>';try{const n=await fetch(`/api/admin/analytics?action=view-sources&days=${e}`,{headers:getAuthHeaders()}),a=await n.json();if(a.success&&a.data){if(0===a.data.length)return void(t.innerHTML='<tr><td colspan="3" style="text-align: center;">ÊöÇÊó†Êï∞ÊçÆ</td></tr>');t.innerHTML=a.data.map((e,t)=>`\n        <tr>\n          <td>${t+1}</td>\n          <td>${"unknown"===e.country?"Êú™Áü•":e.country}</td>\n          <td>${e.count}</td>\n        </tr>\n      `).join("")}else t.innerHTML='<tr><td colspan="3" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}catch(e){console.error("Âä†ËΩΩËÆøÈóÆÊù•Ê∫êÂ§±Ë¥•:",e),t.innerHTML='<tr><td colspan="3" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}}}async function loadViewByCity(){const e=document.getElementById("viewByCityDays")?.value||30,t=document.getElementById("viewByCityTableBody");if(t){t.innerHTML='<tr><td colspan="4" style="text-align: center;">Âä†ËΩΩ‰∏≠...</td></tr>';try{const n=await fetch(`/api/admin/analytics?action=view-by-city&days=${e}`,{headers:getAuthHeaders()}),a=await n.json();if(a.success&&a.data){if(0===a.data.length)return void(t.innerHTML='<tr><td colspan="4" style="text-align: center;">ÊöÇÊó†Êï∞ÊçÆ</td></tr>');t.innerHTML=a.data.map((e,t)=>`\n        <tr>\n          <td>${t+1}</td>\n          <td>${"unknown"===e.city?"Êú™Áü•":e.city}</td>\n          <td>${"unknown"===e.country?"Êú™Áü•":e.country}</td>\n          <td>${e.count}</td>\n        </tr>\n      `).join("")}else t.innerHTML='<tr><td colspan="4" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}catch(e){console.error("Âä†ËΩΩÂüéÂ∏ÇÁªüËÆ°Â§±Ë¥•:",e),t.innerHTML='<tr><td colspan="4" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}}}async function loadViewByIP(){const e=document.getElementById("viewByIPDays")?.value||30,t=document.getElementById("viewByIPTableBody");if(t){t.innerHTML='<tr><td colspan="8" style="text-align: center;">Âä†ËΩΩ‰∏≠...</td></tr>';try{const n=await fetch(`/api/admin/analytics?action=view-by-ip&days=${e}`,{headers:getAuthHeaders()}),a=await n.json();if(a.success&&a.data){if(0===a.data.length)return void(t.innerHTML='<tr><td colspan="8" style="text-align: center;">ÊöÇÊó†Êï∞ÊçÆ</td></tr>');t.innerHTML=a.data.map((e,t)=>`\n        <tr>\n          <td>${t+1}</td>\n          <td>${e.ip}</td>\n          <td>${"unknown"===e.country?"Êú™Áü•":e.country||"-"}</td>\n          <td>${"unknown"===e.city?"Êú™Áü•":e.city||"-"}</td>\n          <td>${"unknown"===e.region?"Êú™Áü•":e.region||"-"}</td>\n          <td>${e.count}</td>\n          <td>${e.firstVisit}</td>\n          <td>${e.lastVisit}</td>\n        </tr>\n      `).join("")}else t.innerHTML='<tr><td colspan="8" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}catch(e){console.error("Âä†ËΩΩIPÁªüËÆ°Â§±Ë¥•:",e),t.innerHTML='<tr><td colspan="8" style="text-align: center;">Âä†ËΩΩÂ§±Ë¥•</td></tr>'}}}async function loadViewTrend(){const e=document.getElementById("viewTrendDays")?.value||30;if(document.getElementById("viewTrendChart"))try{const t=await fetch(`/api/admin/analytics?action=view-trend&days=${e}`,{headers:getAuthHeaders()}),n=await t.json();n.success&&n.data&&drawViewTrendChart(n.data)}catch(e){console.error("Âä†ËΩΩÈòÖËØªË∂ãÂäøÂ§±Ë¥•:",e)}}function drawViewTrendChart(e){const t=document.getElementById("viewTrendChart");if(!t)return;const n=t.getContext("2d");if(n.clearRect(0,0,t.width,t.height),!e||0===e.length)return n.font="16px Arial",n.fillStyle="rgba(255, 255, 255, 0.7)",n.textAlign="center",void n.fillText("ÊöÇÊó†Êï∞ÊçÆ",t.width/2,t.height/2);const a=50,o=t.width-100,c=t.height-100,s=Math.max(...e.map(e=>e.count));n.strokeStyle="rgba(255, 255, 255, 0.3)",n.lineWidth=1,n.beginPath(),n.moveTo(a,a),n.lineTo(a,t.height-a),n.lineTo(t.width-a,t.height-a),n.stroke();const d=o/(e.length-1||1);n.beginPath(),n.strokeStyle="rgba(255, 255, 255, 0.8)",n.lineWidth=2,e.forEach((e,o)=>{const i=a+o*d,r=t.height-a-e.count/s*c;0===o?n.moveTo(i,r):n.lineTo(i,r)}),n.stroke(),e.forEach((e,o)=>{const i=a+o*d,r=t.height-a-e.count/s*c;n.beginPath(),n.fillStyle="rgba(255, 255, 255, 0.9)",n.arc(i,r,4,0,2*Math.PI),n.fill(),n.fillStyle="rgba(255, 255, 255, 0.8)",n.font="12px Arial",n.textAlign="center",n.fillText(e.count,i,r-10),n.fillStyle="rgba(255, 255, 255, 0.6)",n.font="10px Arial",e.date&&"string"==typeof e.date&&n.fillText(e.date.substring(5),i,t.height-a+15)})}function initAnalytics(){const e=document.getElementById("mostViewedLimit");e&&e.addEventListener("change",loadMostViewedArticles);const t=document.getElementById("viewSourcesDays");t&&t.addEventListener("change",loadViewSources);const n=document.getElementById("viewByCityDays");n&&n.addEventListener("change",loadViewByCity);const a=document.getElementById("viewByIPDays");a&&a.addEventListener("change",loadViewByIP);const o=document.getElementById("viewTrendDays");o&&o.addEventListener("change",loadViewTrend),loadMostViewedArticles(),loadViewSources(),loadViewByCity(),loadViewByIP(),loadViewTrend()}function getStatusText(e){return{published:"Â∑≤ÂèëÂ∏É",draft:"ËçâÁ®ø",pending:"ÂæÖÂÆ°Ê†∏"}[e]||e}function bindActionButtons(){document.querySelectorAll(".action-buttons button").forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",async function(){const e=this.getAttribute("data-action"),t=this.getAttribute("data-id");if("delete"===e||"delete-comment"===e||"delete-user"===e||"delete-category"===e){currentAction=e,currentItemId=t;let n="";"delete"===e?n=`Á°ÆÂÆöË¶ÅÂà†Èô§ÊñáÁ´† #${t} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`:"delete-comment"===e?n=`Á°ÆÂÆöË¶ÅÂà†Èô§ËØÑËÆ∫ #${t} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`:"delete-user"===e?n=`Á°ÆÂÆöË¶ÅÂà†Èô§Áî®Êà∑ #${t} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`:"delete-category"===e&&(n=`Á°ÆÂÆöË¶ÅÂà†Èô§ÂàÜÁ±ª #${t} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`),document.getElementById("confirmMessage").textContent=n,openModal("confirmModal")}else if("edit"===e)try{const e=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const a=await fetch(`/api/admin/passages?id=${t}`,{headers:n}),o=await a.json();if(o.success&&o.data){await populateCategorySelect("editCategory",o.data.category||""),document.getElementById("editTitle").value=o.data.title||"",document.getElementById("editAuthor").value=o.data.author||"ÁÆ°ÁêÜÂëò",document.getElementById("editContent").value=o.data.original_content||o.data.content||"",document.getElementById("editShowTitle").checked=!1!==o.data.show_title,document.getElementById("editCoverImage").value=o.data.cover_image||"",document.getElementById("editStatus").value=o.data.status||"published",document.getElementById("editVisibility").value=o.data.visibility||"public";const e=o.data.is_scheduled||!1;document.getElementById("editIsScheduled").checked=e;const n=document.getElementById("editPublishedAtGroup");if(e){if(n.style.display="block",o.data.published_at){const e=new Date(o.data.published_at),t=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,16);document.getElementById("editPublishedAt").value=t}}else n.style.display="none",document.getElementById("editPublishedAt").value="";let a=[];if(o.data.tags){const e=o.data.tags;if(Array.isArray(e))a=e;else if("string"==typeof e)try{const t=JSON.parse(e);a=Array.isArray(t)?t:e.split(",").map(e=>e.trim()).filter(e=>e)}catch(t){a=e.split(",").map(e=>e.trim()).filter(e=>e)}}await populateTagSelector(a),document.getElementById("editForm").dataset.articleId=t,openModal("editModal")}else showToast("Ëé∑ÂèñÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•Ôºö"+(o.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Ëé∑ÂèñÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•:",e),showToast("Ëé∑ÂèñÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else if("upload"===e)document.getElementById("uploadAttachmentArticleId").textContent="#"+t,document.getElementById("uploadAttachmentArticleId").dataset.articleId=t,document.getElementById("attachmentFile").value="",document.getElementById("uploadAttachmentProgress").style.display="none",document.getElementById("uploadAttachmentResult").style.display="none",openModal("uploadAttachmentModal");else if("view"===e)try{const e=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const a=await fetch(`/api/admin/passages?id=${t}`,{headers:n}),o=await a.json();o.success&&o.data?(document.getElementById("viewArticleId").textContent="#"+o.data.id,document.getElementById("viewArticleTitle").textContent=o.data.title||"",document.getElementById("viewArticleAuthor").textContent=o.data.author||"ÁÆ°ÁêÜÂëò",document.getElementById("viewArticleStatus").textContent=getStatusText(o.data.status||"published"),document.getElementById("viewArticleDate").textContent=o.data.created_at||"",document.getElementById("viewArticleContent").textContent=o.data.content||"",openModal("viewArticleModal")):showToast("Ëé∑ÂèñÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•Ôºö"+(o.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Ëé∑ÂèñÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•:",e),showToast("Ëé∑ÂèñÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else if("edit-user"===e)try{const e=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const a=await fetch(`/api/admin/users/${t}`,{headers:n}),o=await a.json();if(o.success&&o.data){const e=o.data;document.getElementById("editUserName").value=e.username||"",document.getElementById("editUserEmail").value=e.email||"",document.getElementById("editUserRole").value=e.role||"user",document.getElementById("editUserStatus").value=e.status||"active",document.getElementById("editUserPassword").value="",document.getElementById("editUserForm").dataset.userId=t,openModal("editUserModal")}else showToast("Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•Ôºö"+(o.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•:",e),showToast("Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else if("view-user"===e)try{const e=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const a=await fetch(`/api/admin/users/${t}`,{headers:n}),o=await a.json();if(o.success&&o.data){const e=o.data;document.getElementById("viewUserId").textContent="#"+e.id,document.getElementById("viewUserName").textContent=e.username||"",document.getElementById("viewUserEmail").textContent=e.email||"",document.getElementById("viewUserRole").textContent=e.role||"ÊôÆÈÄöÁî®Êà∑",document.getElementById("viewUserStatus").textContent=e.status||"Ê≠£Â∏∏",document.getElementById("viewUserDate").textContent=e.created_at||"",openModal("viewUserModal")}else showToast("Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•Ôºö"+(o.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•:",e),showToast("Ëé∑ÂèñÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else if("edit-comment"===e)alert(`ÁºñËæëËØÑËÆ∫ #${t}`);else if("view-comment"===e){const e=this.closest("tr").querySelectorAll("td");e.length>=6?(document.getElementById("viewCommentId").textContent=e[0].textContent,document.getElementById("viewCommentContent").textContent=e[1].textContent,document.getElementById("viewCommentArticle").textContent=e[2].textContent,document.getElementById("viewCommentUser").textContent=e[3].textContent,document.getElementById("viewCommentDate").textContent=e[4].textContent,document.getElementById("viewCommentStatus").textContent=e[5].textContent.trim(),openModal("viewCommentModal")):alert("Êü•ÁúãËØÑËÆ∫ #${itemId} ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ")}else if("delete-tag"===e)currentAction=e,currentItemId=t,document.getElementById("confirmMessage").textContent=`Á°ÆÂÆöË¶ÅÂà†Èô§Ê†áÁ≠æ #${t} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`,openModal("confirmModal");else if("edit-tag"===e)try{const e=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const a=await fetch(`/api/admin/tags?id=${t}`,{headers:n}),o=await a.json();o.success&&o.data?(document.getElementById("tagModalTitle").textContent="ÁºñËæëÊ†áÁ≠æ",document.getElementById("tagName").value=o.data.name||"",document.getElementById("tagDescription").value=o.data.description||"",document.getElementById("tagColor").value=o.data.color||"#007bff",document.getElementById("tagCategory").value=o.data.category_id||0,document.getElementById("tagSortOrder").value=o.data.sort_order||0,document.getElementById("tagEnabled").checked=o.data.is_enabled,document.getElementById("tagForm").dataset.tagId=t,openModal("tagModal")):showToast("Ëé∑ÂèñÊ†áÁ≠æËØ¶ÊÉÖÂ§±Ë¥•Ôºö"+(o.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Ëé∑ÂèñÊ†áÁ≠æËØ¶ÊÉÖÂ§±Ë¥•:",e),showToast("Ëé∑ÂèñÊ†áÁ≠æËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else if("edit-category"===e)try{const e=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};e&&(n.Authorization=`Bearer ${e}`);const a=await fetch(`/api/admin/categories?id=${t}`,{headers:n}),o=await a.json();o.success&&o.data?(document.getElementById("categoryModalTitle").textContent="ÁºñËæëÂàÜÁ±ª",document.getElementById("categoryName").value=o.data.name||"",document.getElementById("categoryDescription").value=o.data.description||"",document.getElementById("categoryIcon").value=o.data.icon||"",document.getElementById("categorySortOrder").value=o.data.sort_order||0,document.getElementById("categoryEnabled").checked=o.data.is_enabled,document.getElementById("categoryForm").dataset.categoryId=t,openModal("categoryModal")):showToast("Ëé∑ÂèñÂàÜÁ±ªËØ¶ÊÉÖÂ§±Ë¥•Ôºö"+(o.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Ëé∑ÂèñÂàÜÁ±ªËØ¶ÊÉÖÂ§±Ë¥•:",e),showToast("Ëé∑ÂèñÂàÜÁ±ªËØ¶ÊÉÖÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}})})}let lastScrollTop=0,isNavHidden=!1;const nav=document.getElementById("mainNav"),scrollIndicator=document.getElementById("scrollIndicator"),scrollProgress=document.getElementById("scrollProgress");nav.classList.add("scrolled-top"),window.addEventListener("scroll",function(){const e=window.pageYOffset||document.documentElement.scrollTop,t=e/(document.documentElement.scrollHeight-window.innerHeight)*100;e>100?(scrollIndicator.classList.add("active"),scrollProgress.style.height=`${t}%`):scrollIndicator.classList.remove("active"),e>lastScrollTop&&e>50?isNavHidden||(nav.classList.add("hidden"),isNavHidden=!0):(e<lastScrollTop||e<=50)&&(isNavHidden&&(nav.classList.remove("hidden"),isNavHidden=!1),0===e?(nav.classList.add("scrolled-top"),nav.classList.remove("scrolled")):(nav.classList.remove("scrolled-top"),nav.classList.add("scrolled"))),lastScrollTop=e},{passive:!0}),window.addEventListener("load",function(){document.body.style.opacity="0",document.body.style.transition="opacity 0.5s ease",setTimeout(()=>{document.body.style.opacity="1"},100),showEmptyState("articlesTableBody","ÊöÇÊó†ÊñáÁ´†",6),showEmptyState("usersTableBody","ÊöÇÊó†Áî®Êà∑",7),showEmptyState("commentsTableBody","ÊöÇÊó†ËØÑËÆ∫",6),fetchAdminData(),loadCategoriesAndTags();document.querySelectorAll(".stat-card").forEach((e,t)=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},200+50*t)})});const mainTitle=document.getElementById("main-title");function openModal(e){const t=document.getElementById(e);t&&(t.classList.add("active"),document.body.style.overflow="hidden")}function closeModal(e){const t=document.getElementById(e);t&&(t.classList.add("closing"),setTimeout(()=>{t.classList.remove("active","closing"),document.body.style.overflow="auto"},300))}mainTitle&&(mainTitle.addEventListener("mouseenter",function(){this.style.animationPlayState="paused"}),mainTitle.addEventListener("mouseleave",function(){this.style.animationPlayState="running"})),document.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",async function(){document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),this.classList.add("active"),document.querySelectorAll(".tab-pane").forEach(e=>{e.classList.remove("active")});const e=this.getAttribute("data-tab"),t=document.getElementById(e);t&&(t.classList.add("active"),"tags"===e&&await loadCategoriesAndTags(),"analytics"===e&&initAnalytics(),"attachments"===e&&await loadAttachments())})}),document.querySelectorAll("[data-modal]").forEach(e=>{(e.classList.contains("modal-close")||e.hasAttribute("data-modal"))&&e.addEventListener("click",function(){closeModal(this.getAttribute("data-modal"))})}),document.getElementById("uploadArticleBtn").addEventListener("click",async()=>{await populateTagSelectorForUpload(),await populateCategorySelectorForUpload(),openModal("uploadModal")}),document.getElementById("newArticleBtn").addEventListener("click",async()=>{await populateTagSelectorForNewArticle(),await populateCategorySelectorForNewArticle(),openModal("articleModal")}),document.getElementById("addUserBtn").addEventListener("click",()=>{openModal("userModal")}),document.querySelectorAll(".tag-option").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("selected")})}),document.getElementById("addUploadTagBtn").addEventListener("click",async function(){const e=document.getElementById("uploadTagInput"),t=e.value.trim();if(!t)return void showToast("ËØ∑ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞","warning");const n=document.getElementById("uploadTagSelector");if(Array.from(n.querySelectorAll(".tag-option")).map(e=>e.dataset.tagName?e.dataset.tagName.toLowerCase():e.textContent.trim().toLowerCase()).includes(t.toLowerCase()))return showToast("Ê†áÁ≠æÂ∑≤Â≠òÂú®","warning"),void(e.value="");const a=["#e74c3c","#e67e22","#f1c40f","#2ecc71","#1abc9c","#3498db","#9b59b6","#34495e"],o=a[Math.floor(Math.random()*a.length)],c=document.createElement("div");c.className="tag-option selected",c.dataset.tagName=t,c.dataset.isNew="true",c.innerHTML=`\n    <span style="display: inline-block; width: 12px; height: 12px; background-color: ${o}; border-radius: 2px; margin-right: 6px;"></span>\n    ${t}\n  `,c.addEventListener("click",function(){this.classList.toggle("selected")}),n.appendChild(c),e.value="",showToast(`Ê†áÁ≠æ "${t}" Â∑≤Ê∑ªÂä†`,"success")}),document.getElementById("addUploadCategoryBtn").addEventListener("click",async function(){const e=document.getElementById("uploadCategoryInput"),t=e.value.trim();if(!t)return void showToast("ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞","warning");const n=document.getElementById("uploadCategorySelector");if(Array.from(n.querySelectorAll(".category-option")).map(e=>e.dataset.categoryName?e.dataset.categoryName.toLowerCase():e.textContent.trim().toLowerCase()).includes(t.toLowerCase()))return showToast("ÂàÜÁ±ªÂ∑≤Â≠òÂú®","warning"),void(e.value="");const a=document.createElement("div");a.className="category-option selected",a.dataset.categoryName=t,a.dataset.isNew="true",a.innerHTML=`\n    <span style="display: inline-block; width: 12px; height: 12px; background-color: #007bff; border-radius: 2px; margin-right: 6px;"></span>\n    ${t}\n  `,a.addEventListener("click",function(){this.classList.contains("selected")?this.classList.remove("selected"):(n.querySelectorAll(".category-option").forEach(e=>{e.classList.remove("selected")}),this.classList.add("selected"))}),n.querySelectorAll(".category-option").forEach(e=>{e.classList.remove("selected")}),n.appendChild(a),e.value="",showToast(`ÂàÜÁ±ª "${t}" Â∑≤Ê∑ªÂä†`,"success")});const uploadArea=document.getElementById("uploadArea"),fileInput=document.getElementById("fileInput"),uploadPreview=document.getElementById("uploadPreview");let selectedFiles=[];function handleFiles(e){for(let t=0;t<e.length;t++){const n=e[t];if(n.size>10485760){showToast(`Êñá‰ª∂ ${n.name} Ë∂ÖËøá10MBÈôêÂà∂`,"error");continue}selectedFiles.push(n);const a=new FileReader;a.onload=function(e){const t=document.createElement("div");if(t.className="upload-item",t.dataset.fileIndex=selectedFiles.length-1,n.type.startsWith("image/"))t.innerHTML=`\n          <img src="${e.target.result}" alt="${n.name}">\n          <button class="upload-remove">√ó</button>\n        `;else{const e=n.name.split(".").pop().toUpperCase();t.innerHTML=`\n          <div style="background:#f0f0f0; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; color:#666;">\n            <div style="font-size:2em;">üìÑ</div>\n            <div style="font-size:0.8em; margin-top:5px; text-align:center; padding:0 5px;">${e}</div>\n          </div>\n          <button class="upload-remove">√ó</button>\n        `}t.querySelector(".upload-remove").addEventListener("click",function(){const e=parseInt(t.dataset.fileIndex);selectedFiles.splice(e,1),t.remove()}),uploadPreview.appendChild(t)},a.readAsDataURL(n)}}function readFileContent(e){return new Promise((t,n)=>{const a=new FileReader;a.onload=e=>{t(e.target.result)},a.onerror=e=>{n(new Error("ËØªÂèñÊñá‰ª∂Â§±Ë¥•"))},a.readAsText(e)})}uploadArea.addEventListener("click",()=>{fileInput.click()}),uploadArea.addEventListener("dragover",e=>{e.preventDefault(),uploadArea.classList.add("dragover")}),uploadArea.addEventListener("dragleave",()=>{uploadArea.classList.remove("dragover")}),uploadArea.addEventListener("drop",e=>{e.preventDefault(),uploadArea.classList.remove("dragover");handleFiles(e.dataTransfer.files)}),fileInput.addEventListener("change",()=>{handleFiles(fileInput.files)}),document.getElementById("uploadForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("uploadTitle").value.trim();if(!t)return showToast("ËØ∑ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò","warning"),void document.getElementById("uploadTitle").focus();const n=document.getElementById("uploadAuthor").value.trim();if(!n)return showToast("ËØ∑ËæìÂÖ•‰ΩúËÄÖÂêçÁß∞","warning"),void document.getElementById("uploadAuthor").focus();const a=document.querySelector("#uploadCategorySelector .category-option.selected"),o=a?a.dataset.categoryName:"",c=[];document.querySelectorAll("#uploadTagSelector .tag-option.selected").forEach(e=>{c.push(e.dataset.tagName)});const s=this.querySelector('button[type="submit"]'),d=s.textContent;s.textContent="‰∏ä‰º†‰∏≠...",s.disabled=!0;try{const e=selectedFiles,a=document.getElementById("uploadContent").value.trim();if(0===e.length&&!a)return showToast("ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÊñá‰ª∂ÊàñËæìÂÖ•ÊñáÁ´†ÂÜÖÂÆπ","warning"),s.textContent=d,void(s.disabled=!1);let i=a;if(e.length>0&&!a){const t=e[0];i=await readFileContent(t)}if(!i||0===i.trim().length)return showToast("ÊñáÁ´†ÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫","warning"),s.textContent=d,void(s.disabled=!1);const r=document.getElementById("uploadStatus").value,l=document.getElementById("uploadYear").value,u=document.getElementById("uploadMonth").value,m=document.getElementById("uploadDay").value;let g=null;if(l&&u&&m){const e=parseInt(l),t=parseInt(u),n=parseInt(m);e>=2020&&e<=2030&&t>=1&&t<=12&&n>=1&&n<=31&&(g=new Date(e,t-1,n).toISOString())}const h=localStorage.getItem("auth_token"),y={"Content-Type":"application/json"};h&&(y.Authorization=`Bearer ${h}`);const p={title:t,content:i,author:n,category:o,tags:c.join(","),status:r};g&&(p.created_at=g);const f=await fetch("/api/admin/passages",{method:"POST",headers:y,body:JSON.stringify(p)}),b=await f.json();if(!b.success)return s.textContent=d,s.disabled=!1,void showToast("ÂàõÂª∫Â§±Ë¥•Ôºö"+(b.message||"Êú™Áü•ÈîôËØØ"),"error");const E=b.data.id;let v=0,B=0;const I=[];for(const t of e)try{const e=new FormData;e.append("file",t),e.append("passage_id",E);const n=await fetch("/api/admin/attachments",{method:"POST",headers:{Authorization:`Bearer ${h}`},body:e}),a=await n.json();a.success?(v++,console.log(`ÈôÑ‰ª∂ ${t.name} ‰∏ä‰º†ÊàêÂäü`)):(B++,I.push(`${t.name}: ${a.message||"Êú™Áü•ÈîôËØØ"}`),console.error(`ÈôÑ‰ª∂ ${t.name} ‰∏ä‰º†Â§±Ë¥•:`,a))}catch(e){B++,I.push(`${t.name}: ${e.message||"ÁΩëÁªúÈîôËØØ"}`),console.error(`‰∏ä‰º†ÈôÑ‰ª∂ ${t.name} Â§±Ë¥•:`,e)}B>0&&console.error("ÈôÑ‰ª∂‰∏ä‰º†Â§±Ë¥•ËØ¶ÊÉÖ:",I),s.textContent="ÂàõÂª∫ÊàêÂäü!",s.style.background="rgba(255, 183, 122, 0.8)";let C="ÊñáÁ´†ÂàõÂª∫ÊàêÂäüÔºÅ";v>0&&(C+=` ÊàêÂäü‰∏ä‰º† ${v} ‰∏™ÈôÑ‰ª∂`),B>0&&(C+=` Â§±Ë¥• ${B} ‰∏™ÈôÑ‰ª∂`),setTimeout(()=>{closeModal("uploadModal"),s.textContent=d,s.disabled=!1,s.style.background="rgba(255, 183, 122, 0.8)",this.reset(),uploadPreview.innerHTML="",selectedFiles=[],fetchAdminData(),showToast(C,B>0?"warning":"success")},2e3)}catch(e){console.error("ÂàõÂª∫ÊñáÁ´†Â§±Ë¥•:",e),s.textContent=d,s.disabled=!1,showToast("ÂàõÂª∫Â§±Ë¥•ÔºåÊó†Ê≥ïËøûÊé•Âà∞ÊúçÂä°Âô®ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂêéÈáçËØï","error")}}),document.getElementById("articleForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("articleTitle").value;if(!t)return void showToast("ËØ∑ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò","warning");const n=this.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="‰øùÂ≠ò‰∏≠...",n.disabled=!0;try{const e=localStorage.getItem("auth_token"),o={"Content-Type":"application/json"};e&&(o.Authorization=`Bearer ${e}`);const c=await fetch("/api/admin/passages",{method:"POST",headers:o,body:JSON.stringify({title:t,content:document.getElementById("articleContent").value,author:document.getElementById("articleAuthor").value,category:document.getElementById("articleCategory").value,tags:document.getElementById("articleTags").value,cover_image:document.getElementById("articleCoverImage").value})}),s=await c.json();s.success?(n.textContent="‰øùÂ≠òÊàêÂäü!",n.style.background="rgba(255, 183, 122, 0.8)",setTimeout(()=>{closeModal("articleModal"),n.textContent=a,n.disabled=!1,n.style.background="rgba(255, 183, 122, 0.8)",this.reset(),fetchAdminData(),showToast("ÊñáÁ´†ÂàõÂª∫ÊàêÂäüÔºÅ","success")},2e3)):(n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(s.message||"Êú™Áü•ÈîôËØØ"),"error"))}catch(e){console.error("‰øùÂ≠òÊñáÁ´†Â§±Ë¥•:",e),n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}),document.getElementById("editForm").addEventListener("submit",async function(e){e.preventDefault();const t=this.dataset.articleId;if(!t)return void showToast("Êó†Ê≥ïÁ°ÆÂÆöË¶ÅÁºñËæëÁöÑÊñáÁ´†","error");const n=this.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="‰øùÂ≠ò‰∏≠...",n.disabled=!0;try{const e=localStorage.getItem("auth_token"),o={"Content-Type":"application/json"};e&&(o.Authorization=`Bearer ${e}`);const c=document.getElementById("editIsScheduled").checked;let s=null;if(c){const e=document.getElementById("editPublishedAt").value;e&&(s=new Date(e).toISOString())}const d=await fetch(`/api/admin/passages?id=${t}`,{method:"PUT",headers:o,body:JSON.stringify({title:document.getElementById("editTitle").value,content:document.getElementById("editContent").value,author:document.getElementById("editAuthor").value,category:document.getElementById("editCategory").value,show_title:document.getElementById("editShowTitle").checked,tags:document.getElementById("editTags").value,status:document.getElementById("editStatus").value,visibility:document.getElementById("editVisibility").value,is_scheduled:c,published_at:s,cover_image:document.getElementById("editCoverImage").value||void 0})}),i=await d.json();i.success?(n.textContent="‰øùÂ≠òÊàêÂäü!",n.style.background="rgba(255, 183, 122, 0.8)",setTimeout(()=>{closeModal("editModal"),n.textContent=a,n.disabled=!1,n.style.background="rgba(255, 183, 122, 0.8)",fetchAdminData(),showToast("ÊñáÁ´†‰øÆÊîπÂ∑≤‰øùÂ≠òÔºÅ","success")},2e3)):(n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(i.message||"Êú™Áü•ÈîôËØØ"),"error"))}catch(e){console.error("‰øùÂ≠òÊñáÁ´†Â§±Ë¥•:",e),n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}),document.getElementById("editIsScheduled").addEventListener("change",function(e){const t=document.getElementById("editPublishedAtGroup"),n=document.getElementById("editPublishedAt");if(e.target.checked){if(t.style.display="block",!n.value){const e=new Date;e.setDate(e.getDate()+1);const t=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,16);n.value=t}}else t.style.display="none",n.value=""}),document.getElementById("userForm").addEventListener("submit",async function(e){e.preventDefault();const t=this.querySelector('button[type="submit"]'),n=t.textContent;t.textContent="ÂàõÂª∫‰∏≠...",t.disabled=!0;const a=document.getElementById("userName").value.trim(),o=document.getElementById("userEmail").value.trim(),c=document.getElementById("userPassword").value,s=document.getElementById("userRole").value;try{const e=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json",...getAuthHeaders()},body:JSON.stringify({username:a,email:o,password:c,role:s})}),t=await e.json();t.success?(showToast("Áî®Êà∑ÂàõÂª∫ÊàêÂäüÔºÅ","success"),closeModal("userModal"),this.reset(),fetchAdminData(currentPage,10,currentUserPage,10)):showToast(t.message||"Áî®Êà∑ÂàõÂª∫Â§±Ë¥•","error")}catch(e){console.error("ÂàõÂª∫Áî®Êà∑Â§±Ë¥•:",e),showToast("ÂàõÂª∫Áî®Êà∑Â§±Ë¥•ÔºåËØ∑ÈáçËØï","error")}finally{t.textContent=n,t.disabled=!1}}),document.getElementById("editUserForm").addEventListener("submit",async function(e){e.preventDefault();const t=this.dataset.userId;if(!t)return void showToast("Êó†Ê≥ïÁ°ÆÂÆöË¶ÅÁºñËæëÁöÑÁî®Êà∑","error");const n=this.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="‰øùÂ≠ò‰∏≠...",n.disabled=!0;try{const e=localStorage.getItem("auth_token"),o={"Content-Type":"application/json"};e&&(o.Authorization=`Bearer ${e}`);const c={username:document.getElementById("editUserName").value,email:document.getElementById("editUserEmail").value,role:document.getElementById("editUserRole").value,status:document.getElementById("editUserStatus").value},s=document.getElementById("editUserPassword").value;s&&(c.password=s);const d=await fetch(`/api/admin/users/${t}`,{method:"PATCH",headers:o,body:JSON.stringify(c)}),i=await d.json();i.success?(n.textContent="‰øùÂ≠òÊàêÂäü!",n.style.background="rgba(255, 183, 122, 0.8)",setTimeout(()=>{closeModal("editUserModal"),n.textContent=a,n.disabled=!1,n.style.background="rgba(255, 183, 122, 0.8)",fetchAdminData(),showToast("Áî®Êà∑‰øÆÊîπÂ∑≤‰øùÂ≠òÔºÅ","success")},2e3)):(n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(i.message||"Êú™Áü•ÈîôËØØ"),"error"))}catch(e){console.error("‰øùÂ≠òÁî®Êà∑Â§±Ë¥•:",e),n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}),document.getElementById("categoryForm").addEventListener("submit",async function(e){e.preventDefault();const t=this.dataset.categoryId,n=this.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="‰øùÂ≠ò‰∏≠...",n.disabled=!0;try{const e=localStorage.getItem("auth_token"),o={"Content-Type":"application/json"};e&&(o.Authorization=`Bearer ${e}`);const c={name:document.getElementById("categoryName").value,description:document.getElementById("categoryDescription").value,icon:document.getElementById("categoryIcon").value,sort_order:parseInt(document.getElementById("categorySortOrder").value)||0,is_enabled:document.getElementById("categoryEnabled").checked};let s="/api/admin/categories",d="POST";t&&(s+=`?id=${t}`,d="PUT");const i=await fetch(s,{method:d,headers:o,body:JSON.stringify(c)}),r=await i.json();r.success?(n.textContent="‰øùÂ≠òÊàêÂäü!",n.style.background="rgba(255, 183, 122, 0.8)",setTimeout(()=>{closeModal("categoryModal"),n.textContent=a,n.disabled=!1,n.style.background="rgba(255, 183, 122, 0.8)",this.reset(),delete this.dataset.categoryId,loadCategoriesAndTags(),showToast(t?"ÂàÜÁ±ª‰øÆÊîπÂ∑≤‰øùÂ≠òÔºÅ":"ÂàÜÁ±ªÂàõÂª∫ÊàêÂäüÔºÅ","success")},2e3)):(n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(r.message||"Êú™Áü•ÈîôËØØ"),"error"))}catch(e){console.error("‰øùÂ≠òÂàÜÁ±ªÂ§±Ë¥•:",e),n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}),document.getElementById("tagForm").addEventListener("submit",async function(e){e.preventDefault();const t=this.dataset.tagId,n=this.querySelector('button[type="submit"]'),a=n.textContent;n.textContent="‰øùÂ≠ò‰∏≠...",n.disabled=!0;try{const e=localStorage.getItem("auth_token"),o={"Content-Type":"application/json"};e&&(o.Authorization=`Bearer ${e}`);const c={name:document.getElementById("tagName").value,description:document.getElementById("tagDescription").value,color:document.getElementById("tagColor").value,category_id:parseInt(document.getElementById("tagCategory").value)||0,sort_order:parseInt(document.getElementById("tagSortOrder").value)||0,is_enabled:document.getElementById("tagEnabled").checked};let s="/api/admin/tags",d="POST";t&&(s+=`?id=${t}`,d="PUT");const i=await fetch(s,{method:d,headers:o,body:JSON.stringify(c)}),r=await i.json();r.success?(n.textContent="‰øùÂ≠òÊàêÂäü!",n.style.background="rgba(255, 183, 122, 0.8)",setTimeout(()=>{closeModal("tagModal"),n.textContent=a,n.disabled=!1,n.style.background="rgba(255, 183, 122, 0.8)",this.reset(),delete this.dataset.tagId,loadCategoriesAndTags(),showToast(t?"Ê†áÁ≠æ‰øÆÊîπÂ∑≤‰øùÂ≠òÔºÅ":"Ê†áÁ≠æÂàõÂª∫ÊàêÂäüÔºÅ","success")},2e3)):(n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(r.message||"Êú™Áü•ÈîôËØØ"),"error"))}catch(e){console.error("‰øùÂ≠òÊ†áÁ≠æÂ§±Ë¥•:",e),n.textContent=a,n.disabled=!1,showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}});let currentAction=null,currentItemId=null,selectedAttachments=new Set;async function handleBatchDelete(e,t){const n=t.split(",").map(e=>parseInt(e.trim()));let a="",o="",c=null;switch(e){case"batch-delete-comments":a="/api/admin/comments/batch-delete",o="ÊâπÈáèÂà†Èô§ËØÑËÆ∫ÊàêÂäü",c=()=>{clearCommentSelection(),fetchAdminData(currentPage,currentLimit,currentUserPage,currentUserLimit,currentCommentsPage,currentCommentsLimit)};break;case"batch-delete-categories":a="/api/admin/categories/batch-delete",o="ÊâπÈáèÂà†Èô§ÂàÜÁ±ªÊàêÂäü",c=()=>{clearCategorySelection(),loadCategoriesAndTags()};break;case"batch-delete-tags":a="/api/admin/tags/batch-delete",o="ÊâπÈáèÂà†Èô§Ê†áÁ≠æÊàêÂäü",c=()=>{clearTagSelection(),loadCategoriesAndTags()};break;case"batch-delete-users":a="/api/admin/users/batch-delete",o="ÊâπÈáèÂà†Èô§Áî®Êà∑ÊàêÂäü",c=()=>{clearUserSelection(),fetchAdminData(currentPage,10,currentUserPage,10)};break;case"batch-delete-articles":a="/api/admin/passages/batch-delete",o="ÊâπÈáèÂà†Èô§ÊñáÁ´†ÊàêÂäü",c=()=>{clearSelection(),fetchAdminData(currentPage,10)};break;default:return}try{const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",...getAuthHeaders()},body:JSON.stringify({ids:n})}),t=await e.json();t.success?(closeModal("confirmModal"),showToast(t.message||o,"success"),c&&c()):showToast(t.message||"ÊâπÈáèÂà†Èô§Â§±Ë¥•","error")}catch(e){console.error("ÊâπÈáèÂà†Èô§Â§±Ë¥•:",e),showToast("ÊâπÈáèÂà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï","error")}}document.getElementById("confirmAction").addEventListener("click",async function(){if(currentAction&&currentItemId){if(currentAction.startsWith("batch-delete-"))return void await handleBatchDelete(currentAction,currentItemId);const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);try{let e="";if("delete"===currentAction)e=`/api/admin/passages?id=${currentItemId}`;else if("delete-comment"===currentAction)e=`/api/admin/comments/${currentItemId}`;else if("delete-user"===currentAction)e=`/api/admin/users/${currentItemId}`;else if("delete-category"===currentAction)e=`/api/admin/categories?id=${currentItemId}`;else if("delete-tag"===currentAction)e=`/api/admin/tags/${currentItemId}`;else if("delete-main-card"===currentAction)e=`/api/about/main-cards/delete?id=${currentItemId}`;else if("delete-sub-card"===currentAction)e=`/api/about/sub-cards/delete?id=${currentItemId}`;else if("delete-attachment"===currentAction)e=`/api/admin/attachments/${currentItemId}`;else if("batch-delete-attachment"===currentAction){const e=currentItemId.split(",");let t=0,n=0;for(const a of e)try{const e=await fetch(`/api/admin/attachments/${a}`,{method:"DELETE"});(await e.json()).success?t++:n++}catch(e){console.error("Âà†Èô§Â§±Ë¥•:",e),n++}return closeModal("confirmModal"),t>0&&showToast(`ÊàêÂäüÂà†Èô§ ${t} ‰∏™ÈôÑ‰ª∂`,"success"),n>0&&showToast(`${n} ‰∏™ÈôÑ‰ª∂Âà†Èô§Â§±Ë¥•`,"error"),selectedAttachments.clear(),updateBatchActions(),void loadAttachments()}const n=await fetch(e,{method:"DELETE",headers:t}),a=await n.json();a.success?(closeModal("confirmModal"),showToast("Âà†Èô§ÊàêÂäüÔºÅ","success"),"delete-category"===currentAction||"delete-tag"===currentAction?loadCategoriesAndTags():"delete-main-card"===currentAction?(loadMainCards(),loadSubCards()):"delete-sub-card"===currentAction?loadSubCards():"delete-attachment"===currentAction?(selectedAttachments.delete(currentItemId),updateBatchActions(),loadAttachments()):fetchAdminData()):showToast("Âà†Èô§Â§±Ë¥•Ôºö"+(a.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(e){console.error("Âà†Èô§Â§±Ë¥•:",e),alert("Âà†Èô§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}}}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",function(e){if(e.target===this){closeModal(this.id)}})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".modal.active").forEach(e=>{closeModal(e.id)})})</script><div class="modal" id="loginModal"><div class="modal-content"><div class="modal-header"><h3>Áî®Êà∑ÁôªÂΩï</h3><button class="modal-close" data-modal="loginModal">√ó</button></div><div class="modal-body"><form id="loginForm"><div class="form-group"><label for="loginUsername">Áî®Êà∑Âêç</label> <input id="loginUsername" class="form-control" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required autocomplete="username"></div><div class="form-group"><label for="loginPassword">ÂØÜÁ†Å</label> <input type="password" id="loginPassword" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required autocomplete="current-password"></div><div class="form-group" id="loginError" style="display:none;color:#e74c3c;font-size:.9em"></div><button type="submit" id="loginSubmitBtn" class="btn-primary" style="width:100%">ÁôªÂΩï</button></form><div style="margin-top:20px;text-align:center;font-size:.9em"><a href="#" id="openRegisterModal" style="color:#007bff;text-decoration:none">ËøòÊ≤°ÊúâË¥¶Âè∑ÔºüÁ´ãÂç≥Ê≥®ÂÜå</a></div></div></div></div><div class="modal" id="registerModal"><div class="modal-content"><div class="modal-header"><h3>Áî®Êà∑Ê≥®ÂÜå</h3><button class="modal-close" data-modal="registerModal">√ó</button></div><div class="modal-body"><form id="registerForm"><div class="form-group"><label for="registerUsername">Áî®Êà∑Âêç</label> <input id="registerUsername" class="form-control" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÔºà3-20‰∏™Â≠óÁ¨¶ÔºåÂ≠óÊØçÊï∞Â≠ó‰∏ãÂàíÁ∫øÔºâ" required autocomplete="username"></div><div class="form-group"><label for="registerEmail">ÈÇÆÁÆ±</label> <input type="email" id="registerEmail" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±" required autocomplete="email"></div><div class="form-group"><label for="registerPassword">ÂØÜÁ†Å</label> <input type="password" id="registerPassword" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†ÅÔºàËá≥Â∞ë6‰∏™Â≠óÁ¨¶Ôºâ" required autocomplete="new-password"></div><div class="form-group" id="registerError" style="display:none;color:#e74c3c;font-size:.9em"></div><button type="submit" id="registerSubmitBtn" class="btn-primary" style="width:100%">Ê≥®ÂÜå</button></form><div style="margin-top:20px;text-align:center;font-size:.9em"><a href="#" id="openLoginModal" style="color:#007bff;text-decoration:none">Â∑≤ÊúâË¥¶Âè∑ÔºüÁ´ãÂç≥ÁôªÂΩï</a></div></div></div></div><style>.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1000;justify-content:center;align-items:center;padding:20px;animation:fadeIn .3s ease}.modal.active{display:flex}.modal-content{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);border-radius:20px;max-width:500px;width:100%;animation:slideIn .3s ease;position:relative}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{background:rgba(0,123,255,.1);backdrop-filter:blur(40px) saturate(200%);-webkit-backdrop-filter:blur(40px) saturate(200%);border:1px solid rgba(255,255,255,.5);border-bottom:1px solid rgba(255,255,255,.3);padding:20px 30px;color:#007bff;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center}.modal-header h3{font-size:1.5em;font-weight:600}.modal-close{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);font-size:1.5em;cursor:pointer;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.modal-close:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:rotate(90deg)}.modal-body{padding:30px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;color:rgba(255,255,255,.9);font-weight:500}.form-control{width:100%;padding:12px 15px;border:1px solid rgba(255,255,255,.3);border-radius:8px;font-size:1em;background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);color:rgba(255,255,255,.9);transition:all .3s ease}.form-control:focus{outline:0;border-color:rgba(255,255,255,.5);background:rgba(0,0,0,0)}.btn-primary{background:rgba(0,0,0,0);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,.3);color:rgba(255,255,255,.9);padding:12px 30px;border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease}.btn-primary:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.5);transform:translateY(-2px)}.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}.btn-primary:disabled:hover{background:rgba(0,0,0,0);border-color:rgba(255,255,255,.3);transform:none}.btn-danger{background:rgba(231,76,60,.2);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(231,76,60,.4);color:rgba(255,255,255,.95);padding:12px 30px;border-radius:8px;font-size:1em;font-weight:500;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 15px rgba(231,76,60,.2)}.btn-danger:hover{background:rgba(231,76,60,.35);border-color:rgba(231,76,60,.6);transform:translateY(-2px);box-shadow:0 8px 25px rgba(231,76,60,.3)}.btn-danger:active{transform:translateY(0);box-shadow:0 2px 10px rgba(231,76,60,.2)}.btn-danger:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.btn-danger:disabled:hover{background:rgba(231,76,60,.2);border-color:rgba(231,76,60,.4);transform:none;box-shadow:none}</style><script>let originalAppearanceSettings={};async function loadSettings(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/settings/appearance",{headers:t});if(n.ok){const e=await n.json();originalAppearanceSettings={...e},document.getElementById("backgroundImage").value=e.background_image||"/img/test.webp",document.getElementById("mobileBackgroundImage").value=e.mobile_background_image||"/img/mobile-test.webp",document.getElementById("globalOpacity").value=e.global_opacity||"0.15",document.getElementById("opacityValue").textContent=e.global_opacity||"0.15",document.getElementById("backgroundSize").value=e.background_size||"cover",document.getElementById("backgroundPosition").value=e.background_position||"center",document.getElementById("backgroundRepeat").value=e.background_repeat||"no-repeat",document.getElementById("backgroundAttachment").value=e.background_attachment||"fixed",document.getElementById("blurAmount").value=e.blur_amount||"20px",document.getElementById("saturateAmount").value=e.saturate_amount||"180%",document.getElementById("darkModeEnabled").checked=e.dark_mode_enabled||!1,document.getElementById("navbarGlassColor").value=e.navbar_glass_color||"rgba(255, 255, 255, 0.85)",document.getElementById("navbarTextColor").value=e.navbar_text_color||"#333333",document.getElementById("cardGlassColor").value=e.card_glass_color||"rgba(255, 255, 255, 0.75)",document.getElementById("footerGlassColor").value=e.footer_glass_color||"rgba(255, 255, 255, 0.9)",document.getElementById("floatingTextEnabled").checked=e.floating_text_enabled||!1,document.getElementById("floatingTexts").value=e.floating_texts&&Array.isArray(e.floating_texts)?e.floating_texts.join(", "):"perfect, good, excellent, extraordinary, legend",updateColorPickers(),applyDarkMode(e.dark_mode_enabled||!1),applyGlassColors(e.navbar_glass_color,e.card_glass_color,e.footer_glass_color),updatePreview()}else console.error("Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:",n.statusText)}catch(e){console.error("Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:",e)}}async function saveSettings(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n={background_image:document.getElementById("backgroundImage").value,mobile_background_image:document.getElementById("mobileBackgroundImage").value,global_opacity:document.getElementById("globalOpacity").value,background_size:document.getElementById("backgroundSize").value,background_position:document.getElementById("backgroundPosition").value,background_repeat:document.getElementById("backgroundRepeat").value,background_attachment:document.getElementById("backgroundAttachment").value,blur_amount:document.getElementById("blurAmount").value,saturate_amount:document.getElementById("saturateAmount").value,dark_mode_enabled:document.getElementById("darkModeEnabled").checked,navbar_glass_color:document.getElementById("navbarGlassColor").value,navbar_text_color:document.getElementById("navbarTextColor").value,card_glass_color:document.getElementById("cardGlassColor").value,footer_glass_color:document.getElementById("footerGlassColor").value,floating_text_enabled:document.getElementById("floatingTextEnabled").checked,floating_texts:document.getElementById("floatingTexts").value.split(",").map(e=>e.trim()).filter(e=>e.length>0)},o={};for(const e in n){const t=originalAppearanceSettings[e],a=n[e];"navbar_text_color"===e&&(console.log("navbar_text_color ÊØîÂØπ:"),console.log("  ÂéüÂßãÂÄº:",t,"(Á±ªÂûã:",typeof t,")"),console.log("  ÂΩìÂâçÂÄº:",a,"(Á±ªÂûã:",typeof a,")"),console.log("  ÊòØÂê¶Áõ∏Á≠â:",a===t)),a!==t&&(o[e]=a)}if(console.log("ÂéüÂßãËÆæÁΩÆ:",originalAppearanceSettings),console.log("ÂΩìÂâçËÆæÁΩÆ:",n),console.log("ÂèòÊõ¥ËÆæÁΩÆ:",o),0===Object.keys(o).length)return void showToast("Ê≤°ÊúâÊ£ÄÊµãÂà∞‰ªª‰ΩïÂèòÂåñ","warning");console.log("ÂèëÈÄÅÂèòÊõ¥ÁöÑÂ§ñËßÇÂ≠óÊÆµ:",o);const a=await fetch("/api/settings/appearance",{method:"PATCH",headers:t,body:JSON.stringify(o)});if(a.ok)showToast("ËÆæÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ","success"),Object.assign(originalAppearanceSettings,o),"dark_mode_enabled"in o&&applyDarkMode(o.dark_mode_enabled),updatePreview();else{const e=await a.json();showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(e.error||"Êú™Áü•ÈîôËØØ"),"error")}}catch(e){console.error("‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•:",e),showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}function resetSettings(){confirm("Á°ÆÂÆöË¶ÅÈáçÁΩÆ‰∏∫ÈªòËÆ§ËÆæÁΩÆÂêóÔºü")&&(document.getElementById("backgroundImage").value="/img/test.webp",document.getElementById("globalOpacity").value="0.15",document.getElementById("opacityValue").textContent="0.15",document.getElementById("backgroundSize").value="cover",document.getElementById("backgroundPosition").value="center",document.getElementById("backgroundRepeat").value="no-repeat",document.getElementById("backgroundAttachment").value="fixed",document.getElementById("blurAmount").value="20px",document.getElementById("saturateAmount").value="180%",document.getElementById("darkModeEnabled").checked=!1,document.getElementById("navbarGlassColor").value="rgba(255, 255, 255, 0.85)",document.getElementById("navbarTextColor").value="#333333",document.getElementById("cardGlassColor").value="rgba(255, 255, 255, 0.75)",document.getElementById("footerGlassColor").value="rgba(255, 255, 255, 0.9)",document.getElementById("floatingTextEnabled").checked=!1,document.getElementById("floatingTexts").value="perfect, good, excellent, extraordinary, legend",updateColorPickers(),applyDarkMode(!1),applyGlassColors("rgba(255, 255, 255, 0.85)","rgba(255, 255, 255, 0.75)","rgba(255, 255, 255, 0.9)"),updatePreview())}function updatePreview(){const e=document.getElementById("previewBox");if(!e)return;const t=document.getElementById("backgroundImage").value,n=document.getElementById("mobileBackgroundImage").value,o=document.getElementById("globalOpacity").value,a=document.getElementById("backgroundSize").value,d=document.getElementById("backgroundPosition").value,i=document.getElementById("backgroundRepeat").value,r=document.getElementById("backgroundAttachment").value,l=document.getElementById("blurAmount").value,s=document.getElementById("saturateAmount").value,c=window.innerWidth<=768&&n?n:t;e.style.backgroundImage=`url('${c}')`,e.style.backgroundSize=a,e.style.backgroundPosition=d,e.style.backgroundRepeat=i,e.style.backgroundAttachment=r,e.style.setProperty("--blur-amount",l),e.style.setProperty("--saturate-amount",s),e.style.setProperty("--global-opacity",o);const u=document.createElement("style");u.textContent=`\n    #previewBox::before {\n      background-image: url('${c}') !important;\n      background-size: ${a} !important;\n      background-position: ${d} !important;\n      background-repeat: ${i} !important;\n      background-attachment: ${r} !important;\n      filter: blur(${l}) saturate(${s}) !important;\n    }\n    #previewBox {\n      background: rgba(255, 255, 255, ${o}) !important;\n      backdrop-filter: blur(${l}) saturate(${s}) !important;\n      -webkit-backdrop-filter: blur(${l}) saturate(${s}) !important;\n    }\n  `;const m=document.getElementById("preview-style");m&&m.remove(),u.id="preview-style",document.head.appendChild(u)}function applyDarkMode(e){e?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode")}function updateColorPickers(){const e=document.getElementById("navbarGlassColor").value,t=document.getElementById("navbarTextColor").value,n=document.getElementById("cardGlassColor").value,o=document.getElementById("footerGlassColor").value;if(e.startsWith("rgba")){const t=parseRgba(e);t&&(document.getElementById("navbarGlassColorPicker").value=rgbaToHex(t.r,t.g,t.b))}if(t.startsWith("#"))document.getElementById("navbarTextColorPicker").value=t;else if(t.startsWith("rgb")){const e=parseRgba(t);e&&(document.getElementById("navbarTextColorPicker").value=rgbaToHex(e.r,e.g,e.b))}if(n.startsWith("rgba")){const e=parseRgba(n);e&&(document.getElementById("cardGlassColorPicker").value=rgbaToHex(e.r,e.g,e.b))}if(o.startsWith("rgba")){const e=parseRgba(o);e&&(document.getElementById("footerGlassColorPicker").value=rgbaToHex(e.r,e.g,e.b))}}function applyGlassColors(e,t,n){document.documentElement.style.setProperty("--navbar-glass-color",e),document.documentElement.style.setProperty("--card-glass-color",t),document.documentElement.style.setProperty("--footer-glass-color",n)}function parseRgba(e){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);return t?{r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),a:t[4]?parseFloat(t[4]):1}:null}function rgbaToHex(e,t,n){const o=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return"#"+o(e)+o(t)+o(n)}document.addEventListener("DOMContentLoaded",async function(){await loadSettings(),await loadTemplateSettings(),await loadMusicSettings(),await loadMusicPlaylist();const e=document.getElementById("globalOpacity"),t=document.getElementById("opacityValue");e&&t&&e.addEventListener("input",function(){t.textContent=this.value,updatePreview()});const n=document.getElementById("saveSettingsBtn");n&&n.addEventListener("click",saveSettings);const o=document.getElementById("saveTemplateSettingsBtn");o&&o.addEventListener("click",saveTemplateSettings);const a=document.getElementById("saveMusicSettingsBtn");a&&a.addEventListener("click",saveMusicSettings),initMusicDragDrop();const d=document.getElementById("musicPlayerColorPicker"),i=document.getElementById("musicPlayerColor");d&&i&&d.addEventListener("input",function(){const e=parseRgba(i.value);if(e){const t=`rgba(${this.value.match(/\w\w/g).map(e=>parseInt(e,16)).join(", ")}, ${e.a})`;i.value=t}});const r=document.getElementById("live2dEnabled"),l=document.getElementById("live2dConfig");r&&l&&r.addEventListener("change",function(){l.style.display=this.checked?"block":"none"});const s=document.getElementById("resetSettingsBtn");s&&s.addEventListener("click",resetSettings);[{picker:"navbarGlassColorPicker",input:"navbarGlassColor"},{picker:"navbarTextColorPicker",input:"navbarTextColor"},{picker:"cardGlassColorPicker",input:"cardGlassColor"},{picker:"footerGlassColorPicker",input:"footerGlassColor"}].forEach(({picker:e,input:t})=>{const n=document.getElementById(e),o=document.getElementById(t);n&&o&&(n.addEventListener("input",function(){const e=o.value;if(e.startsWith("rgba")){const t=parseRgba(e);if(t){const e=`rgba(${this.value.match(/\w\w/g).map(e=>parseInt(e,16)).join(", ")}, ${t.a})`;o.value=e}}else o.value=this.value}),o.addEventListener("input",function(){updateColorPickers()}))});["backgroundImage","mobileBackgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","backgroundAttachment","blurAmount","saturateAmount"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("input",updatePreview),t.addEventListener("change",updatePreview))}),window.addEventListener("resize",updatePreview);const c=document.querySelector('[data-tab="settings"]');c&&c.addEventListener("click",function(){loadSettings(),loadTemplateSettings()})});let originalTemplateSettings={};async function loadTemplateSettings(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/settings/template",{method:"GET",headers:t});if(n.ok){const e=await n.json();originalTemplateSettings={...e},document.getElementById("templateName").value=e.name||"",document.getElementById("templateGreting").value=e.greting||"",document.getElementById("templateYear").value=e.year||"",document.getElementById("templateFoodes").value=e.foodes||"",document.getElementById("globalAvatar").value=e.global_avatar||"/img/avatar.webp",document.getElementById("templateArticleTitle").checked=e.article_title||!1,document.getElementById("templateArticleTitlePrefix").value=e.article_title_prefix||"",document.getElementById("templateSwitchNotice").checked=e.switch_notice||!1,document.getElementById("templateSwitchNoticeText").value=e.switch_notice_text||"",document.getElementById("externalLinkWarning").checked=e.external_link_warning||!1,document.getElementById("externalLinkWhitelist").value=e.external_link_whitelist||"",document.getElementById("externalLinkWarningText").value=e.external_link_warning_text||"",document.getElementById("live2dEnabled").checked=e.live2d_enabled||!1,document.getElementById("live2dShowOnIndex").checked=!1!==e.live2d_show_on_index,document.getElementById("live2dShowOnPassage").checked=!1!==e.live2d_show_on_passage,document.getElementById("live2dShowOnCollect").checked=!1!==e.live2d_show_on_collect,document.getElementById("live2dShowOnAbout").checked=!1!==e.live2d_show_on_about,document.getElementById("live2dShowOnAdmin").checked=e.live2d_show_on_admin||!1,document.getElementById("live2dModelId").value=e.live2d_model_id||"1",document.getElementById("live2dModelPath").value=e.live2d_model_path||"",document.getElementById("live2dCDNPath").value=e.live2d_cdn_path||"https://unpkg.com/live2d-widget-model@1.0.5/",document.getElementById("live2dPosition").value=e.live2d_position||"right",document.getElementById("live2dWidth").value=e.live2d_width||"280px",document.getElementById("live2dHeight").value=e.live2d_height||"250px";document.getElementById("live2dConfig").style.display=e.live2d_enabled?"block":"none",document.getElementById("sponsorEnabled").checked=e.sponsor_enabled||!1,document.getElementById("sponsorTitle").value=e.sponsor_title||"ÊÑüË∞¢ÊÇ®ÁöÑÊîØÊåÅ",document.getElementById("sponsorImage").value=e.sponsor_image||"/img/avatar.webp",document.getElementById("sponsorDescription").value=e.sponsor_description||"Â¶ÇÊûúÊÇ®ËßâÂæóËøô‰∏™ÂçöÂÆ¢ÂØπÊÇ®ÊúâÂ∏ÆÂä©ÔºåÊ¨¢ËøéËµûÂä©ÊîØÊåÅÔºÅ",document.getElementById("sponsorButtonText").value=e.sponsor_button_text||"‚ù§Ô∏è ËµûÂä©ÊîØÊåÅ",document.getElementById("beianEnabled").checked=e.beian_enabled||!1,document.getElementById("icpNumber").value=e.icp_number||"",document.getElementById("policeRecordCode").value=e.police_record_code||"",document.getElementById("policeRecordContent").value=e.police_record_content||""}else console.error("Âä†ËΩΩÊ®°ÊùøËÆæÁΩÆÂ§±Ë¥•")}catch(e){console.error("Âä†ËΩΩÊ®°ÊùøËÆæÁΩÆÂ§±Ë¥•:",e)}}async function saveTemplateSettings(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n={name:document.getElementById("templateName").value,greting:document.getElementById("templateGreting").value,year:document.getElementById("templateYear").value,foodes:document.getElementById("templateFoodes").value,global_avatar:document.getElementById("globalAvatar").value,article_title:document.getElementById("templateArticleTitle").checked,article_title_prefix:document.getElementById("templateArticleTitlePrefix").value,switch_notice:document.getElementById("templateSwitchNotice").checked,switch_notice_text:document.getElementById("templateSwitchNoticeText").value,external_link_warning:document.getElementById("externalLinkWarning").checked,external_link_whitelist:document.getElementById("externalLinkWhitelist").value,external_link_warning_text:document.getElementById("externalLinkWarningText").value,live2d_enabled:document.getElementById("live2dEnabled").checked,live2d_show_on_index:document.getElementById("live2dShowOnIndex").checked,live2d_show_on_passage:document.getElementById("live2dShowOnPassage").checked,live2d_show_on_collect:document.getElementById("live2dShowOnCollect").checked,live2d_show_on_about:document.getElementById("live2dShowOnAbout").checked,live2d_show_on_admin:document.getElementById("live2dShowOnAdmin").checked,live2d_model_id:document.getElementById("live2dModelId").value,live2d_model_path:document.getElementById("live2dModelPath").value,live2d_cdn_path:document.getElementById("live2dCDNPath").value,live2d_position:document.getElementById("live2dPosition").value,live2d_width:document.getElementById("live2dWidth").value,live2d_height:document.getElementById("live2dHeight").value,sponsor_enabled:document.getElementById("sponsorEnabled").checked,sponsor_title:document.getElementById("sponsorTitle").value,sponsor_image:document.getElementById("sponsorImage").value,sponsor_description:document.getElementById("sponsorDescription").value,sponsor_button_text:document.getElementById("sponsorButtonText").value,beian_enabled:document.getElementById("beianEnabled").checked,icp_number:document.getElementById("icpNumber").value,police_record_code:document.getElementById("policeRecordCode").value,police_record_content:document.getElementById("policeRecordContent").value},o={};for(const e in n)n[e]!==originalTemplateSettings[e]&&(o[e]=n[e]);if(0===Object.keys(o).length)return void showToast("Ê≤°ÊúâÊ£ÄÊµãÂà∞‰ªª‰ΩïÂèòÂåñ","warning");console.log("ÂèëÈÄÅÂèòÊõ¥ÁöÑÂ≠óÊÆµ:",o);const a=await fetch("/api/settings/template",{method:"PATCH",headers:t,body:JSON.stringify(o)});if(a.ok)showToast("Ê®°ÊùøËÆæÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ","success"),Object.assign(originalTemplateSettings,o);else{const e=await a.json();showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(e.error||"Êú™Áü•ÈîôËØØ"),"error")}}catch(e){console.error("‰øùÂ≠òÊ®°ÊùøËÆæÁΩÆÂ§±Ë¥•:",e),showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}let originalMusicSettings={};async function loadMusicSettings(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/settings/music",{method:"GET",headers:t});if(n.ok){const e=await n.json();originalMusicSettings={...e},document.getElementById("musicEnabled").checked=e.enabled||!1,document.getElementById("musicAutoPlay").checked=e.auto_play||!1,document.getElementById("musicControlSize").value=e.control_size||"medium",document.getElementById("musicPlayerColor").value=e.player_color||"rgba(66, 133, 244, 0.9)",document.getElementById("musicPosition").value=e.position||"bottom-right",document.getElementById("musicCustomCSS").value=e.custom_css||"";const t=parseRgba(e.player_color||"rgba(66, 133, 244, 0.9)");t&&(document.getElementById("musicPlayerColorPicker").value=rgbaToHex(t.r,t.g,t.b))}else console.error("Âä†ËΩΩÈü≥‰πêËÆæÁΩÆÂ§±Ë¥•")}catch(e){console.error("Âä†ËΩΩÈü≥‰πêËÆæÁΩÆÂ§±Ë¥•:",e)}}async function saveMusicSettings(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n={enabled:document.getElementById("musicEnabled").checked,auto_play:document.getElementById("musicAutoPlay").checked,control_size:document.getElementById("musicControlSize").value,player_color:document.getElementById("musicPlayerColor").value,position:document.getElementById("musicPosition").value,custom_css:document.getElementById("musicCustomCSS").value},o={};for(const e in n)n[e]!==originalMusicSettings[e]&&(o[e]=n[e]);if(0===Object.keys(o).length)return void showToast("Ê≤°ÊúâÊ£ÄÊµãÂà∞‰ªª‰ΩïÂèòÂåñ","warning");console.log("ÂèëÈÄÅÂèòÊõ¥ÁöÑÈü≥‰πêËÆæÁΩÆÂ≠óÊÆµ:",o);const a=await fetch("/api/settings/music",{method:"PATCH",headers:t,body:JSON.stringify(o)});if(a.ok)showToast("Èü≥‰πêËÆæÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ","success"),Object.assign(originalMusicSettings,o);else{const e=await a.json();showToast("‰øùÂ≠òÂ§±Ë¥•Ôºö"+(e.error||"Êú™Áü•ÈîôËØØ"),"error")}}catch(e){console.error("‰øùÂ≠òÈü≥‰πêËÆæÁΩÆÂ§±Ë¥•:",e),showToast("‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}let musicUploadQueue=[],isUploading=!1,uploadAbortController=null;function initMusicDragDrop(){const e=document.getElementById("musicDropZone"),t=document.getElementById("musicFileUpload"),n=document.querySelector(".browse-link");if(!e||!t)return;function o(e){e.preventDefault(),e.stopPropagation()}e.addEventListener("click",()=>{t.click()}),n&&n.addEventListener("click",e=>{e.stopPropagation(),t.click()}),t.addEventListener("change",e=>{handleFileSelect(e.target.files),t.value=""}),["dragenter","dragover","dragleave","drop"].forEach(t=>{e.addEventListener(t,o,!1)}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,()=>{e.classList.add("dragover")},!1)}),e.addEventListener("dragleave",t=>{e.contains(t.relatedTarget)||e.classList.remove("dragover")},!1),e.addEventListener("drop",t=>{e.classList.remove("dragover");handleFileSelect(t.dataTransfer.files)},!1);const a=document.getElementById("clearUploadBtn");a&&a.addEventListener("click",()=>{isUploading?showToast("Ê≠£Âú®‰∏ä‰º†‰∏≠ÔºåËØ∑ÂÖàÂèñÊ∂à‰∏ä‰º†","warning"):(musicUploadQueue=[],updateUploadListUI())});const d=document.getElementById("uploadAllMusicBtn");d&&d.addEventListener("click",startBatchUpload);const i=document.getElementById("cancelUploadBtn");i&&i.addEventListener("click",cancelBatchUpload)}function handleFileSelect(e){if(!e||0===e.length)return;const t=Array.from(e).filter(e=>{const t="."+e.name.split(".").pop().toLowerCase(),n=["audio/mpeg","audio/mp3","audio/wav","audio/wave","audio/ogg","audio/x-m4a","audio/mp4"].includes(e.type)||[".mp3",".wav",".ogg",".m4a"].includes(t);return n||showToast(`Ë∑≥Ëøá‰∏çÊîØÊåÅÁöÑÊñá‰ª∂: ${e.name}`,"warning"),n});0!==t.length?(t.forEach(e=>{musicUploadQueue.some(t=>t.file.name===e.name&&t.file.size===e.size)||musicUploadQueue.push({file:e,id:Date.now()+Math.random(),status:"pending",progress:0,error:null})}),updateUploadListUI()):showToast("Ê≤°ÊúâÊúâÊïàÁöÑÈü≥È¢ëÊñá‰ª∂","warning")}function updateUploadListUI(){const e=document.getElementById("musicUploadList"),t=document.getElementById("musicUploadItems");e&&t&&(0!==musicUploadQueue.length?(e.style.display="block",t.innerHTML=musicUploadQueue.map((e,t)=>`\n    <div class="upload-item" data-id="${e.id}">\n      <div class="upload-item-cover">\n        <div class="cover-preview ${e.coverFile?"has-cover":""}" onclick="triggerCoverSelect('${e.id}')">\n          ${e.coverFile?`<img src="${e.coverPreview}" alt="Â∞ÅÈù¢">\n             <div class="cover-remove-btn" onclick="event.stopPropagation(); removeCover('${e.id}')">√ó</div>`:'<span class="cover-placeholder">üñºÔ∏è</span>'}\n          <div class="cover-upload-hint">ÁÇπÂáª‰∏ä‰º†Â∞ÅÈù¢</div>\n        </div>\n        <input type="file" class="cover-input" id="coverInput-${e.id}" accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" onchange="handleCoverSelect('${e.id}', this)">\n      </div>\n      <div class="upload-item-icon" style="display: none;">üéµ</div>\n      <div class="upload-item-info">\n        <div class="upload-item-name">${e.file.name}</div>\n        <div class="upload-item-meta">\n          <span>${formatFileSize(e.file.size)}</span>\n          <span>${e.file.type||"audio/*"}</span>\n        </div>\n      </div>\n      <div class="upload-item-progress">\n        <div class="progress-bar">\n          <div class="progress-fill" style="width: ${e.progress}%"></div>\n        </div>\n        <div class="progress-text">${e.progress}%</div>\n      </div>\n      <div class="upload-item-status ${e.status}">\n        ${getStatusText(e.status)}\n      </div>\n      <div class="upload-item-action">\n        <button class="remove-upload-btn" onclick="removeUploadItem('${e.id}')" ${"uploading"===e.status?"disabled":""}>√ó</button>\n      </div>\n    </div>\n  `).join("")):e.style.display="none")}function formatFileSize(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","KB","MB","GB"][t]}function getStatusText(e){return{pending:"Á≠âÂæÖ‰∏ä‰º†",uploading:"‰∏ä‰º†‰∏≠",success:"‰∏ä‰º†ÊàêÂäü",error:"‰∏ä‰º†Â§±Ë¥•"}[e]||e}function removeUploadItem(e){isUploading?showToast("Ê≠£Âú®‰∏ä‰º†‰∏≠ÔºåËØ∑ÂÖàÂèñÊ∂à‰∏ä‰º†","warning"):(musicUploadQueue=musicUploadQueue.filter(t=>t.id!=e),updateUploadListUI())}function triggerCoverSelect(e){const t=document.getElementById(`coverInput-${e}`);t&&t.click()}function handleCoverSelect(e,t){const n=t.files[0];if(!n)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(n.type))return showToast("ËØ∑ÈÄâÊã©ÊúâÊïàÁöÑÂõæÁâáÊñá‰ª∂ÔºàJPG„ÄÅPNG„ÄÅGIF„ÄÅWebPÔºâ","error"),void(t.value="");if(n.size>5242880)return showToast("Â∞ÅÈù¢ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá 5MB","error"),void(t.value="");const o=new FileReader;o.onload=function(t){const o=musicUploadQueue.find(t=>t.id==e);o&&(o.coverFile=n,o.coverPreview=t.target.result,updateUploadListUI())},o.readAsDataURL(n)}function removeCover(e){const t=musicUploadQueue.find(t=>t.id==e);if(t){t.coverFile=null,t.coverPreview=null;const n=document.getElementById(`coverInput-${e}`);n&&(n.value=""),updateUploadListUI()}}async function startBatchUpload(){if(isUploading)return void showToast("Ê≠£Âú®‰∏ä‰º†‰∏≠...","info");const e=musicUploadQueue.filter(e=>"pending"===e.status);if(0===e.length)return void showToast("Ê≤°ÊúâÁ≠âÂæÖ‰∏ä‰º†ÁöÑÊñá‰ª∂","warning");isUploading=!0,uploadAbortController=new AbortController;const t=document.getElementById("uploadAllMusicBtn"),n=document.getElementById("cancelUploadBtn");t&&(t.disabled=!0),n&&(n.disabled=!1);let o=0,a=0;for(const t of e){if(!isUploading)break;t.status="uploading",updateUploadListUI();try{await uploadSingleMusicFile(t,uploadAbortController.signal),t.status="success",t.progress=100,o++}catch(e){t.status="error",t.error=e.message,a++,console.error(`‰∏ä‰º†Êñá‰ª∂ ${t.file.name} Â§±Ë¥•:`,e)}updateUploadListUI()}isUploading=!1,uploadAbortController=null,t&&(t.disabled=!1),n&&(n.disabled=!0),o>0&&(showToast(`ÊàêÂäü‰∏ä‰º† ${o} ‰∏™Êñá‰ª∂`,"success"),loadMusicPlaylist()),a>0&&showToast(`${a} ‰∏™Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•`,"error"),setTimeout(()=>{musicUploadQueue=musicUploadQueue.filter(e=>"success"!==e.status),updateUploadListUI()},2e3)}function uploadSingleMusicFile(e,t){return new Promise((n,o)=>{const a=new FormData;a.append("file",e.file);const d=e.file.name.replace(/\.[^/.]+$/,"");a.append("title",d),a.append("artist","Êú™Áü•Ëâ∫ÊúØÂÆ∂"),e.coverFile&&a.append("cover",e.coverFile);const i=localStorage.getItem("auth_token");const r=new XMLHttpRequest;r.upload.addEventListener("progress",t=>{if(t.lengthComputable){const n=Math.round(t.loaded/t.total*100);e.progress=n,updateUploadListUI()}}),r.addEventListener("load",()=>{if(r.status>=200&&r.status<300)n();else try{const e=JSON.parse(r.responseText);o(new Error(e.error||"‰∏ä‰º†Â§±Ë¥•"))}catch(e){o(new Error(`‰∏ä‰º†Â§±Ë¥•: ${r.status}`))}}),r.addEventListener("error",()=>{o(new Error("ÁΩëÁªúÈîôËØØ"))}),r.addEventListener("abort",()=>{o(new Error("‰∏ä‰º†Â∑≤ÂèñÊ∂à"))}),t.addEventListener("abort",()=>{r.abort()}),r.open("POST","/api/music/upload"),i&&r.setRequestHeader("Authorization",`Bearer ${i}`),r.send(a)})}function cancelBatchUpload(){if(!isUploading)return;uploadAbortController&&uploadAbortController.abort(),isUploading=!1,uploadAbortController=null,musicUploadQueue.forEach(e=>{"uploading"===e.status&&(e.status="pending",e.progress=0)}),updateUploadListUI(),showToast("Â∑≤ÂèñÊ∂à‰∏ä‰º†","info");const e=document.getElementById("uploadAllMusicBtn"),t=document.getElementById("cancelUploadBtn");e&&(e.disabled=!1),t&&(t.disabled=!0)}async function uploadMusicFile(){const e=document.getElementById("musicFileUpload");e.files&&0!==e.files.length?(handleFileSelect(e.files),e.value=""):showToast("ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÈü≥‰πêÊñá‰ª∂","warning")}async function loadMusicPlaylist(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/music/playlist",{method:"GET",headers:t});if(n.ok){updateMusicPlaylistUI(await n.json())}else console.error("Âä†ËΩΩÊí≠ÊîæÂàóË°®Â§±Ë¥•")}catch(e){console.error("Âä†ËΩΩÊí≠ÊîæÂàóË°®Â§±Ë¥•:",e)}}function updateMusicPlaylistUI(e){const t=document.getElementById("musicPlaylistContainer");t&&(e&&0!==e.length?t.innerHTML=e.map((e,t)=>{let n=e.title;const o=n.match(/^\d+_/);return o&&(n=n.substring(o[0].length)),`\n    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid rgba(0, 0, 0, 0.05);">\n      <div style="width: 50px; height: 50px; border-radius: 8px; overflow: hidden; background: rgba(0, 0, 0, 0.05); display: flex; align-items: center; justify-content: center;">\n        ${e.cover_image?`<img src="${e.cover_image}" alt="${e.title}" style="width: 100%; height: 100%; object-fit: cover;">`:'<span style="font-size: 24px;">üéµ</span>'}\n      </div>\n      <div style="flex: 1;">\n        <div style="font-weight: 500;">${n}</div>\n        <div style="font-size: 0.85em; color: #666;">${e.artist}</div>\n      </div>\n      <div style="font-size: 0.85em; color: #999;">${e.duration}</div>\n      <div style="display: flex; gap: 5px;">\n        <button onclick="editMusicTitle(${e.id}, '${n.replace(/'/g,"\\'")}')" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">ÁºñËæëÊ†áÈ¢ò</button>\n        <button onclick="changeMusicCover(${e.id})" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">Êõ¥Êç¢Â∞ÅÈù¢</button>\n        <button onclick="deleteMusicTrack(${e.id})" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">Âà†Èô§</button>\n      </div>\n    </div>\n    `}).join(""):t.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">ÊöÇÊó†Èü≥‰πêÊñá‰ª∂</div>')}async function deleteMusicTrack(e){if(confirm("Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÈ¶ñÈü≥‰πêÂêóÔºü"))try{const t=localStorage.getItem("auth_token"),n={"Content-Type":"application/json"};t&&(n.Authorization=`Bearer ${t}`);const o=await fetch(`/api/music/${e}`,{method:"DELETE",headers:n});if(o.ok)showToast("Âà†Èô§ÊàêÂäüÔºÅ","success"),loadMusicPlaylist();else{const e=await o.json();showToast("Âà†Èô§Â§±Ë¥•Ôºö"+(e.error||"Êú™Áü•ÈîôËØØ"),"error")}}catch(e){console.error("Âà†Èô§Èü≥‰πêÂ§±Ë¥•:",e),showToast("Âà†Èô§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}}async function changeMusicCover(e){const t=document.createElement("input");t.type="file",t.accept="image/jpeg,image/jpg,image/png,image/gif,image/webp",t.onchange=async t=>{const n=t.target.files[0];if(!n)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(n.type))return void showToast("ËØ∑ÈÄâÊã©ÊúâÊïàÁöÑÂõæÁâáÊñá‰ª∂ÔºàJPEG, PNG, GIF, WebPÔºâ","error");if(n.size>5242880)return void showToast("ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá 5MB","error");const o=new FormData;o.append("cover",n);try{const t=localStorage.getItem("auth_token"),n={};t&&(n.Authorization=`Bearer ${t}`);const a=await fetch(`/api/music/${e}/cover`,{method:"POST",body:o,headers:n});if(a.ok){await a.json();showToast("Â∞ÅÈù¢Êõ¥Êñ∞ÊàêÂäüÔºÅ","success"),loadMusicPlaylist()}else{const e=await a.json();showToast("Â∞ÅÈù¢Êõ¥Êñ∞Â§±Ë¥•Ôºö"+(e.message||"Êú™Áü•ÈîôËØØ"),"error")}}catch(e){console.error("Êõ¥Êñ∞Â∞ÅÈù¢Â§±Ë¥•:",e),showToast("Êõ¥Êñ∞Â∞ÅÈù¢Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}},t.click()}function editMusicTitle(e,t){const n=document.createElement("div");n.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 10000;\n  ",n.innerHTML=`\n    <div style="background: white; padding: 30px; border-radius: 10px; width: 400px; max-width: 90%;">\n      <h3 style="margin: 0 0 20px 0;">ÁºñËæëÊ†áÈ¢ò</h3>\n      <input type="text" id="musicTitleInput" value="${t}" \n             style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 20px; box-sizing: border-box;">\n      <div style="display: flex; gap: 10px; justify-content: flex-end;">\n        <button id="cancelBtn" style="padding: 8px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">ÂèñÊ∂à</button>\n        <button id="saveBtn" style="padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">‰øùÂ≠ò</button>\n      </div>\n    </div>\n  `,document.body.appendChild(n);const o=n.querySelector("#musicTitleInput"),a=n.querySelector("#cancelBtn"),d=n.querySelector("#saveBtn");a.onclick=()=>{document.body.removeChild(n)},d.onclick=async()=>{const t=o.value.trim();if(t)try{const o=localStorage.getItem("auth_token"),a={"Content-Type":"application/json"};o&&(a.Authorization=`Bearer ${o}`);const d=await fetch(`/api/music/${e}?action=title`,{method:"PUT",body:JSON.stringify({title:t}),headers:a});if(d.ok){await d.json();showToast("Ê†áÈ¢òÊõ¥Êñ∞ÊàêÂäüÔºÅ","success"),document.body.removeChild(n),loadMusicPlaylist()}else{const e=await d.json();showToast("Ê†áÈ¢òÊõ¥Êñ∞Â§±Ë¥•Ôºö"+(e.message||"Êú™Áü•ÈîôËØØ"),"error")}}catch(e){console.error("Êõ¥Êñ∞Ê†áÈ¢òÂ§±Ë¥•:",e),showToast("Êõ¥Êñ∞Ê†áÈ¢òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else showToast("Ê†áÈ¢ò‰∏çËÉΩ‰∏∫Á©∫","error")},n.onclick=e=>{e.target===n&&document.body.removeChild(n)};const i=e=>{"Escape"===e.key&&(document.body.removeChild(n),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i)}let mainCards=[],subCards=[];async function loadMainCards(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/about/main-cards/admin",{method:"GET",headers:t});n.ok?(mainCards=await n.json(),updateMainCardsTable(),updateMainCardFilter()):showToast("Âä†ËΩΩ‰∏ªÂç°ÁâáÂ§±Ë¥•","error")}catch(e){console.error("Âä†ËΩΩ‰∏ªÂç°ÁâáÂ§±Ë¥•:",e),showToast("Âä†ËΩΩ‰∏ªÂç°ÁâáÂ§±Ë¥•","error")}}function updateMainCardsTable(){const e=document.getElementById("mainCardsTableBody");e&&(0!==mainCards.length?e.innerHTML=mainCards.map(e=>`\n    <tr>\n      <td>${e.sort_order}</td>\n      <td>${e.icon||""}</td>\n      <td>${e.title}</td>\n      <td>${e.layout_type}</td>\n      <td>${getSubCardCount(e.id)}</td>\n      <td>\n        <span style="color: ${e.is_enabled?"#28a745":"#dc3545"}; font-weight: bold;">\n          ${e.is_enabled?"‚úì ÂêØÁî®":"‚úï Á¶ÅÁî®"}\n        </span>\n      </td>\n      <td>\n        <button class="btn-secondary" onclick="editMainCard(${e.id})">ÁºñËæë</button>\n        <button class="btn-secondary" onclick="toggleMainCardEnabled(${e.id}, ${e.is_enabled})">\n          ${e.is_enabled?"Á¶ÅÁî®":"ÂêØÁî®"}\n        </button>\n        <button class="btn-danger" onclick="deleteMainCard(${e.id})">Âà†Èô§</button>\n      </td>\n    </tr>\n  `).join(""):e.innerHTML='<tr><td colspan="7" style="text-align: center; color: #999;">ÊöÇÊó†‰∏ªÂç°Áâá</td></tr>')}function getSubCardCount(e){return subCards.filter(t=>t.main_card_id===e).length}function updateMainCardFilter(){const e=document.getElementById("subCardMainCardFilter");if(!e)return;const t=e.value;e.innerHTML='<option value="">ÂÖ®ÈÉ®‰∏ªÂç°Áâá</option>'+mainCards.map(e=>`<option value="${e.id}">${e.title}</option>`).join(""),e.value=t}async function loadSubCards(){try{const e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};e&&(t.Authorization=`Bearer ${e}`);const n=await fetch("/api/about/sub-cards/admin",{method:"GET",headers:t});n.ok?(subCards=await n.json(),updateSubCardsTable(),updateMainCardsTable()):showToast("Âä†ËΩΩÊ¨°Âç°ÁâáÂ§±Ë¥•","error")}catch(e){console.error("Âä†ËΩΩÊ¨°Âç°ÁâáÂ§±Ë¥•:",e),showToast("Âä†ËΩΩÊ¨°Âç°ÁâáÂ§±Ë¥•","error")}}function updateSubCardsTable(){const e=document.getElementById("subCardsTableBody");if(!e)return;const t=document.getElementById("subCardMainCardFilter").value;let n=subCards;t&&(n=subCards.filter(e=>e.main_card_id===parseInt(t))),0!==n.length?e.innerHTML=n.map(e=>{mainCards.find(t=>t.id===e.main_card_id);return`\n      <tr>\n        <td>${e.sort_order}</td>\n        <td>${e.icon||""}</td>\n        <td>${e.title}</td>\n        <td>${e.description.substring(0,30)}${e.description.length>30?"...":""}</td>\n        <td>${e.link_url||"-"}</td>\n        <td>\n          <span style="color: ${e.is_enabled?"#28a745":"#dc3545"}; font-weight: bold;">\n            ${e.is_enabled?"‚úì ÂêØÁî®":"‚úï Á¶ÅÁî®"}\n          </span>\n        </td>\n        <td>\n          <button class="btn-secondary" onclick="editSubCard(${e.id})">ÁºñËæë</button>\n          <button class="btn-secondary" onclick="toggleSubCardEnabled(${e.id}, ${e.is_enabled})">\n            ${e.is_enabled?"Á¶ÅÁî®":"ÂêØÁî®"}\n          </button>\n          <button class="btn-danger" onclick="deleteSubCard(${e.id})">Âà†Èô§</button>\n        </td>\n      </tr>\n    `}).join(""):e.innerHTML='<tr><td colspan="7" style="text-align: center; color: #999;">ÊöÇÊó†Ê¨°Âç°Áâá</td></tr>'}async function addMainCard(){document.getElementById("mainCardModalTitle").textContent="Ê∑ªÂä†‰∏ªÂç°Áâá",document.getElementById("mainCardForm").reset(),document.getElementById("mainCardId").value="",document.getElementById("mainCardSortOrder").value=mainCards.length+1,document.getElementById("mainCardEnabled").checked=!0,openModal("mainCardModal")}async function editMainCard(e){const t=mainCards.find(t=>t.id===e);t&&(document.getElementById("mainCardModalTitle").textContent="ÁºñËæë‰∏ªÂç°Áâá",document.getElementById("mainCardId").value=t.id,document.getElementById("mainCardTitle").value=t.title||"",document.getElementById("mainCardIcon").value=t.icon||"",document.getElementById("mainCardLayoutType").value=t.layout_type||"grid",document.getElementById("mainCardCustomCss").value=t.custom_css||"",document.getElementById("mainCardSortOrder").value=t.sort_order||0,document.getElementById("mainCardEnabled").checked=t.is_enabled,openModal("mainCardModal"))}async function deleteMainCard(e){currentAction="delete-main-card",currentItemId=e,document.getElementById("confirmMessage").textContent="Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰∏ªÂç°ÁâáÂêóÔºüÊâÄÊúâÂÖ≥ËÅîÁöÑÊ¨°Âç°Áâá‰πü‰ºöË¢´Âà†Èô§„ÄÇÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ",openModal("confirmModal")}async function toggleMainCardEnabled(e,t){try{const n=localStorage.getItem("auth_token");(await fetch(`/api/about/main-cards/enabled?id=${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({enabled:!t})})).ok?loadMainCards():showToast("Êìç‰ΩúÂ§±Ë¥•","error")}catch(e){console.error("ÂàáÊç¢Áä∂ÊÄÅÂ§±Ë¥•:",e),showToast("Êìç‰ΩúÂ§±Ë¥•","error")}}async function addSubCard(){const e=document.getElementById("subCardMainCardFilter").value;if(!e)return void showToast("ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™‰∏ªÂç°Áâá","warning");document.getElementById("subCardModalTitle").textContent="Ê∑ªÂä†Ê¨°Âç°Áâá",document.getElementById("subCardForm").reset(),document.getElementById("subCardId").value="";const t=document.getElementById("subCardMainCardId");t.innerHTML='<option value="">ËØ∑ÈÄâÊã©‰∏ªÂç°Áâá</option>'+mainCards.map(e=>`<option value="${e.id}">${e.title}</option>`).join(""),t.value=e,document.getElementById("subCardSortOrder").value=subCards.filter(t=>t.main_card_id===parseInt(e)).length+1,document.getElementById("subCardEnabled").checked=!0,openModal("subCardModal")}async function editSubCard(e){const t=subCards.find(t=>t.id===e);if(!t)return;document.getElementById("subCardModalTitle").textContent="ÁºñËæëÊ¨°Âç°Áâá",document.getElementById("subCardId").value=t.id;const n=document.getElementById("subCardMainCardId");n.innerHTML='<option value="">ËØ∑ÈÄâÊã©‰∏ªÂç°Áâá</option>'+mainCards.map(e=>`<option value="${e.id}">${e.title}</option>`).join(""),n.value=t.main_card_id,document.getElementById("subCardTitle").value=t.title||"",document.getElementById("subCardDescription").value=t.description||"",document.getElementById("subCardIcon").value=t.icon||"",document.getElementById("subCardLinkUrl").value=t.link_url||"",document.getElementById("subCardCustomCss").value=t.custom_css||"",document.getElementById("subCardSortOrder").value=t.sort_order||0,document.getElementById("subCardEnabled").checked=t.is_enabled,openModal("subCardModal")}async function deleteSubCard(e){currentAction="delete-sub-card",currentItemId=e,document.getElementById("confirmMessage").textContent="Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ê¨°Âç°ÁâáÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ",openModal("confirmModal")}async function toggleSubCardEnabled(e,t){try{const n=localStorage.getItem("auth_token");(await fetch(`/api/about/sub-cards/enabled?id=${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({enabled:!t})})).ok?loadSubCards():showToast("Êìç‰ΩúÂ§±Ë¥•","error")}catch(e){console.error("ÂàáÊç¢Áä∂ÊÄÅÂ§±Ë¥•:",e),showToast("Êìç‰ΩúÂ§±Ë¥•","error")}}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("addMainCardBtn");e&&e.addEventListener("click",addMainCard);const t=document.getElementById("addSubCardBtn");t&&t.addEventListener("click",addSubCard);const n=document.getElementById("refreshAboutCardsBtn");n&&n.addEventListener("click",function(){loadMainCards(),loadSubCards()});const o=document.getElementById("subCardMainCardFilter");o&&o.addEventListener("change",updateSubCardsTable);const a=document.querySelector('[data-tab="about"]');a&&a.addEventListener("click",function(){loadMainCards(),loadSubCards(),loadFriendLinks()}),initializeFriendLinksManagement()});const mainCardForm=document.getElementById("mainCardForm");mainCardForm&&mainCardForm.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("mainCardId").value,n=document.getElementById("mainCardTitle").value,o=document.getElementById("mainCardIcon").value,a=document.getElementById("mainCardLayoutType").value,d=document.getElementById("mainCardCustomCss").value,i=parseInt(document.getElementById("mainCardSortOrder").value),r=document.getElementById("mainCardEnabled").checked;try{const e={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`};let l="/api/about/main-cards",s="POST";t&&(l=`/api/about/main-cards/update?id=${t}`,s="PUT");(await fetch(l,{method:s,headers:e,body:JSON.stringify({title:n,icon:o,layout_type:a,custom_css:d,sort_order:i,is_enabled:r})})).ok?(showToast(t?"Êõ¥Êñ∞ÊàêÂäü":"Ê∑ªÂä†ÊàêÂäü","success"),closeModal("mainCardModal"),loadMainCards()):showToast("Êìç‰ΩúÂ§±Ë¥•","error")}catch(e){console.error("Êìç‰ΩúÂ§±Ë¥•:",e),showToast("Êìç‰ΩúÂ§±Ë¥•","error")}});const subCardForm=document.getElementById("subCardForm");function escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}subCardForm&&subCardForm.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("subCardId").value,n=parseInt(document.getElementById("subCardMainCardId").value),o=document.getElementById("subCardTitle").value,a=document.getElementById("subCardDescription").value,d=document.getElementById("subCardIcon").value,i=document.getElementById("subCardLinkUrl").value,r=document.getElementById("subCardCustomCss").value,l=parseInt(document.getElementById("subCardSortOrder").value),s=document.getElementById("subCardEnabled").checked;try{const e={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`};let c="/api/about/sub-cards",u="POST";t&&(c=`/api/about/sub-cards/update?id=${t}`,u="PUT");(await fetch(c,{method:u,headers:e,body:JSON.stringify({main_card_id:n,title:o,description:a,icon:d,link_url:i,custom_css:r,sort_order:l,is_enabled:s})})).ok?(showToast(t?"Êõ¥Êñ∞ÊàêÂäü":"Ê∑ªÂä†ÊàêÂäü","success"),closeModal("subCardModal"),loadSubCards()):showToast("Êìç‰ΩúÂ§±Ë¥•","error")}catch(e){console.error("Êìç‰ΩúÂ§±Ë¥•:",e),showToast("Êìç‰ΩúÂ§±Ë¥•","error")}});let friendLinks=[],selectedFriendLinkIds=[];async function loadFriendLinks(){try{const e={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},t=await fetch("/api/admin/friend-links?include_disabled=true",{headers:e});if(t.ok){const e=await t.json();e.success?(friendLinks=e.data,updateFriendLinksTable()):showToast(e.message||"Âä†ËΩΩÂèãÈìæÂàóË°®Â§±Ë¥•","error")}else showToast("Âä†ËΩΩÂèãÈìæÂàóË°®Â§±Ë¥•","error")}catch(e){console.error("Âä†ËΩΩÂèãÈìæÂàóË°®Â§±Ë¥•:",e),showToast("Âä†ËΩΩÂèãÈìæÂàóË°®Â§±Ë¥•","error")}}function updateFriendLinksTable(){const e=document.getElementById("friendLinksTableBody");if(0===friendLinks.length)return e.innerHTML='\n      <tr>\n        <td colspan="7" style="text-align: center; padding: 40px;">\n          <div style="opacity: 0.5;">ÊöÇÊó†ÂèãÊÉÖÈìæÊé•</div>\n          <div style="margin-top: 10px;">\n            <button class="btn-primary" onclick="openAddFriendLinkModal()">Ê∑ªÂä†Á¨¨‰∏Ä‰∏™ÂèãÈìæ</button>\n          </div>\n        </td>\n      </tr>\n    ',void updateBatchDeleteButton();e.innerHTML=friendLinks.map(e=>`\n    <tr style="${e.is_enabled?"":"opacity: 0.6;"}">\n      <td>\n        <input type="checkbox" class="friend-link-checkbox" data-id="${e.id}"\n               style="width: auto;"\n               ${selectedFriendLinkIds.includes(e.id)?"checked":""}>\n      </td>\n      <td>\n        <img src="${e.avatar_url||"/img/avatar.webp"}" alt="${e.nickname}"\n             style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;"\n             onerror="this.src='/img/avatar.webp'">\n      </td>\n      <td><strong>${escapeHtml(e.nickname)}</strong></td>\n      <td>\n        <a href="${escapeHtml(e.link_url)}" target="_blank" rel="noopener noreferrer"\n           style="color: #007bff; max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">\n          ${escapeHtml(e.link_url)}\n        </a>\n      </td>\n      <td style="max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">\n        ${escapeHtml(e.motto||"-")}\n      </td>\n      <td>\n        <span style="color: ${e.is_enabled?"#28a745":"#dc3545"}; font-weight: bold;">\n          ${e.is_enabled?"‚úì ÂêØÁî®":"‚úï Á¶ÅÁî®"}\n        </span>\n      </td>\n      <td>\n        <button class="btn-secondary" onclick="toggleFriendLinkStatus(${e.id})" title="${e.is_enabled?"Á¶ÅÁî®":"ÂêØÁî®"}">\n          ${e.is_enabled?"Á¶ÅÁî®":"ÂêØÁî®"}\n        </button>\n        <button class="btn-primary" onclick="openEditFriendLinkModal(${e.id})" title="ÁºñËæë">ÁºñËæë</button>\n        <button class="btn-danger" onclick="deleteFriendLink(${e.id})" title="Âà†Èô§">Âà†Èô§</button>\n      </td>\n    </tr>\n  `).join(""),document.querySelectorAll(".friend-link-checkbox").forEach(e=>{e.addEventListener("change",function(){toggleFriendLinkSelection(parseInt(this.getAttribute("data-id")))})}),updateBatchDeleteButton(),updateSelectAllCheckbox()}function toggleFriendLinkSelection(e){console.log("toggleFriendLinkSelection called with id:",e),console.log("Current selectedFriendLinkIds:",selectedFriendLinkIds);const t=selectedFriendLinkIds.indexOf(e);t>-1?(selectedFriendLinkIds.splice(t,1),console.log("Removed from selection")):(selectedFriendLinkIds.push(e),console.log("Added to selection")),console.log("New selectedFriendLinkIds:",selectedFriendLinkIds),updateBatchDeleteButton(),updateSelectAllCheckbox()}function toggleSelectAllFriendLinks(){const e=document.getElementById("selectAllFriendLinks");selectedFriendLinkIds=e.checked?friendLinks.map(e=>e.id):[],document.querySelectorAll(".friend-link-checkbox").forEach(t=>{t.checked=e.checked}),updateBatchDeleteButton()}function updateSelectAllCheckbox(){const e=document.getElementById("selectAllFriendLinks"),t=document.querySelectorAll(".friend-link-checkbox");if(0===t.length)return e.checked=!1,void(e.disabled=!0);e.disabled=!1,e.checked=t.length>0&&selectedFriendLinkIds.length===friendLinks.length}function updateBatchDeleteButton(){const e=document.getElementById("batchDeleteFriendLinksBtn"),t=document.getElementById("friendLinkSelectedCount");selectedFriendLinkIds.length>0?(e.style.display="inline-flex",t.textContent=selectedFriendLinkIds.length):e.style.display="none"}async function batchDeleteFriendLinks(){if(0!==selectedFriendLinkIds.length){if(confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedFriendLinkIds.length} ‰∏™ÂèãÈìæÂêóÔºü\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`))try{const e=localStorage.getItem("auth_token"),t=await fetch("/api/admin/friend-links/batch-delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({ids:selectedFriendLinkIds})}),n=await t.json();n.success?(showToast(n.message||"ÊâπÈáèÂà†Èô§ÊàêÂäü","success"),selectedFriendLinkIds=[],updateBatchDeleteButton(),await loadFriendLinks()):showToast(n.message||"ÊâπÈáèÂà†Èô§Â§±Ë¥•","error")}catch(e){console.error("ÊâπÈáèÂà†Èô§Â§±Ë¥•:",e),showToast("ÊâπÈáèÂà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï","error")}}else showToast("ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÂèãÈìæ","warning")}function openAddFriendLinkModal(){document.getElementById("friendLinkModalTitle").textContent="Ê∑ªÂä†ÂèãÊÉÖÈìæÊé•",document.getElementById("friendLinkId").value="",document.getElementById("friendLinkNickname").value="",document.getElementById("friendLinkUrl").value="",document.getElementById("friendLinkAvatar").value="",document.getElementById("friendLinkMotto").value="",document.getElementById("friendLinkSortOrder").value="0",document.getElementById("friendLinkEnabled").checked=!0,openModal("friendLinkModal")}function openEditFriendLinkModal(e){const t=friendLinks.find(t=>t.id===e);t?(document.getElementById("friendLinkModalTitle").textContent="ÁºñËæëÂèãÊÉÖÈìæÊé•",document.getElementById("friendLinkId").value=t.id,document.getElementById("friendLinkNickname").value=t.nickname,document.getElementById("friendLinkUrl").value=t.link_url,document.getElementById("friendLinkAvatar").value=t.avatar_url,document.getElementById("friendLinkMotto").value=t.motto,document.getElementById("friendLinkSortOrder").value=t.sort_order,document.getElementById("friendLinkEnabled").checked=t.is_enabled,openModal("friendLinkModal")):showToast("ÂèãÈìæ‰∏çÂ≠òÂú®","error")}async function saveFriendLink(e){e.preventDefault();const t=document.getElementById("friendLinkId").value,n=!!t,o={nickname:document.getElementById("friendLinkNickname").value.trim(),link_url:document.getElementById("friendLinkUrl").value.trim(),avatar_url:document.getElementById("friendLinkAvatar").value.trim(),motto:document.getElementById("friendLinkMotto").value.trim(),sort_order:parseInt(document.getElementById("friendLinkSortOrder").value)||0,is_enabled:document.getElementById("friendLinkEnabled").checked};if(o.nickname&&o.link_url)try{const e={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},a=n?`/api/admin/friend-links/${t}`:"/api/admin/friend-links",d=n?"PUT":"POST",i=await fetch(a,{method:d,headers:e,body:JSON.stringify(o)}),r=await i.json();r.success?(showToast(n?"ÂèãÈìæÊõ¥Êñ∞ÊàêÂäü":"ÂèãÈìæÊ∑ªÂä†ÊàêÂäü","success"),closeModal("friendLinkModal"),await loadFriendLinks()):showToast(r.message||"Êìç‰ΩúÂ§±Ë¥•","error")}catch(e){console.error("‰øùÂ≠òÂèãÈìæÂ§±Ë¥•:",e),showToast("Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï","error")}else showToast("ÊòµÁß∞ÂíåÈìæÊé•Âú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫","error")}async function toggleFriendLinkStatus(e){const t=friendLinks.find(t=>t.id===e);if(t)try{const n={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},o=await fetch("/api/admin/friend-links/batch-update-status",{method:"POST",headers:n,body:JSON.stringify({ids:[e],is_enabled:!t.is_enabled})}),a=await o.json();a.success?(showToast(a.message||"Áä∂ÊÄÅÊõ¥Êñ∞ÊàêÂäü","success"),await loadFriendLinks()):showToast(a.message||"Áä∂ÊÄÅÊõ¥Êñ∞Â§±Ë¥•","error")}catch(e){console.error("ÂàáÊç¢Áä∂ÊÄÅÂ§±Ë¥•:",e),showToast("Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï","error")}}function deleteFriendLink(e){const t=friendLinks.find(t=>t.id===e);if(!t)return;if(!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÂèãÈìæ "${t.nickname}" ÂêóÔºü\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`))return;const n=localStorage.getItem("auth_token");fetch(`/api/admin/friend-links/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}}).then(e=>e.json()).then(e=>{e.success?(showToast("ÂèãÈìæÂà†Èô§ÊàêÂäü","success"),loadFriendLinks()):showToast(e.message||"Âà†Èô§Â§±Ë¥•","error")}).catch(e=>{console.error("Âà†Èô§ÂèãÈìæÂ§±Ë¥•:",e),showToast("Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï","error")})}function initializeFriendLinksManagement(){const e=document.getElementById("addFriendLinkBtn");e&&e.addEventListener("click",openAddFriendLinkModal);const t=document.getElementById("refreshFriendLinksBtn");t&&t.addEventListener("click",loadFriendLinks);const n=document.getElementById("selectAllFriendLinks");n&&n.addEventListener("change",toggleSelectAllFriendLinks);const o=document.getElementById("batchDeleteFriendLinksBtn");o&&o.addEventListener("click",batchDeleteFriendLinks);const a=document.getElementById("friendLinkForm");a&&a.addEventListener("submit",saveFriendLink)}const FileManager={currentPath:"img",currentRoot:"img",selectedFile:null,filesToUpload:[],getAuthHeader(){const e=localStorage.getItem("auth_token");return e?`Bearer ${e}`:""},init(){this.bindEvents(),this.loadTree(),this.loadFiles()},bindEvents(){document.getElementById("fmUploadBtn").addEventListener("click",()=>this.openUploadModal()),document.getElementById("fmCreateDirBtn").addEventListener("click",()=>this.openCreateDirModal()),document.getElementById("fmBackBtn").addEventListener("click",()=>this.goBack()),document.addEventListener("click",e=>{e.target.closest(".fm-context-menu")||e.target.closest(".fm-file-item")||this.hideContextMenu()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.hideContextMenu()})},async loadTree(){try{const e=["img","markdown","attachments","music"],t=document.getElementById("fmTree");t.innerHTML="";for(const n of e){const e=this.createTreeItem(n,!0);t.appendChild(e),await this.loadSubDirectories(n,e)}}catch(e){console.error("Âä†ËΩΩÁõÆÂΩïÊ†ëÂ§±Ë¥•:",e)}},async loadSubDirectories(e,t){try{const n=await fetch(`/api/files?path=${encodeURIComponent(e)}`,{headers:{Authorization:this.getAuthHeader()}}),o=await n.json();if(o.success&&o.data.files){const n=o.data.files.filter(e=>e.is_dir);if(n.length>0){const o=document.createElement("div");o.className="fm-tree-children";for(const t of n){const n=`${e}/${t.name}`,a=this.createTreeItem(t.name,!1,n);o.appendChild(a),await this.loadSubDirectories(n,a)}t.appendChild(o)}}}catch(e){console.error("Âä†ËΩΩÂ≠êÁõÆÂΩïÂ§±Ë¥•:",e)}},createTreeItem(e,t,n=null){const o=document.createElement("div");o.className="fm-tree-item",t&&e===this.currentRoot&&o.classList.add("active");const a=document.createElement("span");a.className="fm-tree-icon",a.textContent=t?"üìÅ":"üìÇ",o.appendChild(a);const d=document.createElement("span");d.textContent=e,o.appendChild(d);const i=n||e;return o.addEventListener("click",e=>{e.stopPropagation(),this.navigateTo(i),document.querySelectorAll(".fm-tree-item").forEach(e=>e.classList.remove("active")),o.classList.add("active")}),o},async loadFiles(){try{const e=await fetch(`/api/files?path=${encodeURIComponent(this.currentPath)}`,{headers:{Authorization:this.getAuthHeader()}}),t=await e.json();t.success?(this.renderFiles(t.data.files),this.updateBreadcrumb(t.data.current_path),this.updateBackButton(t.data.parent_path),this.updateFileCount(t.data.files.length)):showToast(t.message,"error")}catch(e){console.error("Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•:",e),showToast("Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•","error")}},renderFiles(e){const t=document.getElementById("fmFileList"),n=document.getElementById("fmEmptyState");if(0===e.length)return t.innerHTML="",void(n.style.display="flex");n.style.display="none";const o=[...e].sort((e,t)=>e.is_dir&&!t.is_dir?-1:!e.is_dir&&t.is_dir?1:e.name.localeCompare(t.name));t.innerHTML=o.map(e=>this.createFileItem(e)).join(""),t.querySelectorAll(".fm-file-item").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.path;"true"===e.dataset.isDir?this.navigateTo(n):this.openFile(n)}),e.addEventListener("contextmenu",t=>{t.preventDefault();const n=e.dataset.path,o="true"===e.dataset.isDir;this.showContextMenu(t,n,o)})})},createFileItem(e){let t="üìÑ";e.is_dir?t="üìÅ":[".jpg",".jpeg",".png",".gif",".webp",".bmp",".svg"].includes(e.extension)?t=`<img src="/${e.path}" alt="${e.name}" onerror="this.parentElement.innerHTML='üñºÔ∏è'">`:".md"===e.extension&&(t="üìù");const n=this.formatFileSize(e.size);return`\n      <div class="fm-file-item" data-path="${e.path}" data-is-dir="${e.is_dir}">\n        <div class="fm-file-icon">${t}</div>\n        <div class="fm-file-name">${e.name}</div>\n        <div class="fm-file-meta">${e.is_dir?"Êñá‰ª∂Â§π":n}</div>\n      </div>\n    `},formatFileSize(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},updateBreadcrumb(e){document.getElementById("fmBreadcrumb").textContent=e||"/"},updateBackButton(e){document.getElementById("fmBackBtn").disabled=!e},updateFileCount(e){document.getElementById("fmInfo").textContent=`${e} ‰∏™È°πÁõÆ`},navigateTo(e){this.currentPath=e,this.loadFiles()},goBack(){const e=this.getParentPath(this.currentPath);e&&this.navigateTo(e)},getParentPath(e){if(e===this.currentRoot)return null;const t=e.split("/");t.pop();return t.join("/")||this.currentRoot},openFile(e){const t=e.split("/").pop().split(".").pop().toLowerCase();if(["jpg","jpeg","png","gif","webp","bmp","svg"].includes(t)){const t=`/${e}`;return void this.showImagePreview(t)}if("md"===t){let t=e;if(t.startsWith("/")){const n=t.indexOf("/markdown/");if(-1===n)return console.error("Êó†ÊïàÁöÑ Markdown Ë∑ØÂæÑ:",e),void this.showToast("Êó†ÊïàÁöÑ Markdown Ë∑ØÂæÑ","error");t=t.substring(n+10)}else{if(!t.startsWith("markdown/"))return console.error("Êó†ÊïàÁöÑ Markdown Ë∑ØÂæÑ:",e),void this.showToast("Êó†ÊïàÁöÑ Markdown Ë∑ØÂæÑ","error");t=t.substring(9)}return t&&"/"!==t&&""!==t.trim()?void(window.MarkdownPreviewModal?window.MarkdownPreviewModal.open(t):console.error("MarkdownPreviewModal not available")):(console.error("ÊèêÂèñÂêéÁöÑ Markdown Ë∑ØÂæÑÊó†Êïà:",t),void this.showToast("Êó†ÊïàÁöÑ Markdown Ë∑ØÂæÑ","error"))}this.downloadFile(e)},showImagePreview(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.9);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n    ";const n=document.createElement("img");n.src=e,n.style.cssText="\n      max-width: 90%;\n      max-height: 90%;\n      object-fit: contain;\n      border-radius: 8px;\n    ";const o=document.createElement("div");o.textContent="ÁÇπÂáªÂÖ≥Èó≠",o.style.cssText="\n      position: absolute;\n      bottom: 30px;\n      color: white;\n      font-size: 16px;\n      opacity: 0.7;\n    ",t.appendChild(n),t.appendChild(o),t.addEventListener("click",()=>{document.body.removeChild(t)});const a=e=>{"Escape"===e.key&&(document.body.removeChild(t),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a),document.body.appendChild(t)},async downloadFile(e){try{const t=await fetch(`/api/files/download?path=${encodeURIComponent(e)}`,{headers:{Authorization:this.getAuthHeader()}});if(!t.ok){const e=await t.json();return void showToast(e.message||"‰∏ãËΩΩÂ§±Ë¥•","error")}const n=e.split("/").pop(),o=await t.blob(),a=window.URL.createObjectURL(o),d=document.createElement("a");d.href=a,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(a)}catch(e){console.error("‰∏ãËΩΩÂ§±Ë¥•:",e),showToast("‰∏ãËΩΩÂ§±Ë¥•","error")}},showContextMenu(e,t,n){this.selectedFile={path:t,isDir:n};const o=document.querySelector(".fm-context-menu");o&&o.remove();const a=document.createElement("div");a.className="fm-context-menu",a.style.left=e.pageX+"px",a.style.top=e.pageY+"px";const d=t.split("/").pop().split(".").pop().toLowerCase();["jpg","jpeg","png","gif","webp","bmp","svg"].includes(d);[{action:"open",label:"ÊâìÂºÄ",icon:"üìÇ"},{action:"download",label:"‰∏ãËΩΩ",icon:"‚¨áÔ∏è",hide:n},{action:"rename",label:"ÈáçÂëΩÂêç",icon:"‚úèÔ∏è"},{action:"delete",label:"Âà†Èô§",icon:"üóëÔ∏è",danger:!0}].forEach(e=>{if(e.hide)return;const t=document.createElement("div");t.className="fm-context-menu-item"+(e.danger?" danger":""),t.innerHTML=`<span>${e.icon}</span>${e.label}`,t.addEventListener("click",()=>{this.handleContextAction(e.action),this.hideContextMenu()}),a.appendChild(t)}),document.body.appendChild(a),a.classList.add("active")},hideContextMenu(){const e=document.querySelector(".fm-context-menu");e&&e.remove()},handleContextAction(e){if(this.selectedFile)switch(e){case"open":this.selectedFile.isDir?this.navigateTo(this.selectedFile.path):this.openFile(this.selectedFile.path);break;case"download":this.downloadFile(this.selectedFile.path);break;case"rename":this.openRenameModal();break;case"delete":this.openDeleteModal()}},openUploadModal(){const e=document.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",e.addEventListener("change",t=>{const n=Array.from(t.target.files);n.length>0&&this.uploadFiles(n),e.remove()}),document.body.appendChild(e),e.click()},async uploadFiles(e){for(const t of e)try{const e=new FormData;e.append("file",t);const n=await fetch(`/api/files?path=${encodeURIComponent(this.currentPath)}`,{method:"POST",headers:{Authorization:this.getAuthHeader()},body:e});(await n.json()).success?showToast(`ÊàêÂäü‰∏ä‰º† ${t.name}`,"success"):showToast(`‰∏ä‰º† ${t.name} Â§±Ë¥•`,"error")}catch(e){console.error("‰∏ä‰º†Â§±Ë¥•:",e),showToast(`‰∏ä‰º† ${t.name} Â§±Ë¥•`,"error")}this.loadFiles(),this.loadTree()},openCreateDirModal(){const e=prompt("ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞:");e&&e.trim()&&this.createDirectory(e.trim())},async createDirectory(e){try{const t=await fetch("/api/files/create-dir",{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.getAuthHeader()},body:JSON.stringify({path:this.currentPath,dir_name:e})}),n=await t.json();n.success?(showToast("Êñá‰ª∂Â§πÂàõÂª∫ÊàêÂäü","success"),this.loadFiles(),this.loadTree()):showToast(n.message,"error")}catch(e){console.error("ÂàõÂª∫ÁõÆÂΩïÂ§±Ë¥•:",e),showToast("ÂàõÂª∫Êñá‰ª∂Â§πÂ§±Ë¥•","error")}},openRenameModal(){if(!this.selectedFile)return;const e=this.selectedFile.path.split("/").pop(),t=prompt("ËØ∑ËæìÂÖ•Êñ∞ÂêçÁß∞:",e);t&&t.trim()&&t.trim()!==e&&this.renameFile(t.trim())},async renameFile(e){if(this.selectedFile)try{const t=await fetch("/api/files",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:this.getAuthHeader()},body:JSON.stringify({old_path:this.selectedFile.path,new_name:e})}),n=await t.json();n.success?(showToast("ÈáçÂëΩÂêçÊàêÂäü","success"),this.loadFiles(),this.loadTree()):showToast(n.message,"error")}catch(e){console.error("ÈáçÂëΩÂêçÂ§±Ë¥•:",e),showToast("ÈáçÂëΩÂêçÂ§±Ë¥•","error")}},openDeleteModal(){if(!this.selectedFile)return;const e=this.selectedFile.path.split("/").pop();confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ "${e}" ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`)&&this.deleteFile()},async deleteFile(){if(this.selectedFile)try{const e=await fetch(`/api/files?path=${encodeURIComponent(this.selectedFile.path)}`,{method:"DELETE",headers:{Authorization:this.getAuthHeader()}}),t=await e.json();t.success?(showToast("Âà†Èô§ÊàêÂäü","success"),this.loadFiles(),this.loadTree()):showToast(t.message,"error")}catch(e){console.error("Âà†Èô§Â§±Ë¥•:",e),showToast("Âà†Èô§Â§±Ë¥•","error")}}},AttachmentUploader={currentArticleId:null,init(){const e=document.getElementById("uploadAttachmentBtn");e&&e.addEventListener("click",()=>this.uploadAttachment())},async uploadAttachment(){const e=document.getElementById("attachmentFile"),t=document.getElementById("uploadAttachmentArticleId"),n=document.getElementById("uploadAttachmentProgress"),o=document.getElementById("uploadAttachmentResult"),a=document.getElementById("uploadAttachmentProgressBar"),d=document.getElementById("uploadAttachmentStatus"),i=document.getElementById("uploadAttachmentFileInfo");if(!e.files||0===e.files.length)return void showToast("ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÊñá‰ª∂","error");const r=e.files[0];this.currentArticleId=t.dataset.articleId,n.style.display="block",o.style.display="none",a.style.width="0%",d.textContent="Ê≠£Âú®‰∏ä‰º†...";const l=new FormData;l.append("file",r),l.append("passage_id",this.currentArticleId);try{const e=localStorage.getItem("auth_token"),t=await fetch("/api/admin/attachments",{method:"POST",headers:e?{Authorization:`Bearer ${e}`}:{},body:l}),n=await t.json();a.style.width="100%",n.success?(d.textContent="‰∏ä‰º†ÊàêÂäüÔºÅ",o.style.display="block",i.innerHTML=`\n          <div><strong>Êñá‰ª∂ÂêçÔºö</strong>${n.data.fileName}</div>\n          <div><strong>Êñá‰ª∂Â§ßÂ∞èÔºö</strong>${this.formatFileSize(n.data.size)}</div>\n          <div><strong>Êñá‰ª∂Á±ªÂûãÔºö</strong>${n.data.type}</div>\n          <div><strong>ËÆøÈóÆURLÔºö</strong><a href="${n.data.url}" target="_blank" style="color: #007bff;">${n.data.url}</a></div>\n        `,showToast("ÈôÑ‰ª∂‰∏ä‰º†ÊàêÂäüÔºÅ","success"),setTimeout(()=>{closeModal("uploadAttachmentModal")},3e3)):(d.textContent="‰∏ä‰º†Â§±Ë¥•Ôºö"+(n.message||"Êú™Áü•ÈîôËØØ"),showToast("ÈôÑ‰ª∂‰∏ä‰º†Â§±Ë¥•Ôºö"+(n.message||"Êú™Áü•ÈîôËØØ"),"error"))}catch(e){console.error("‰∏ä‰º†ÈôÑ‰ª∂Â§±Ë¥•:",e),a.style.width="100%",d.textContent="‰∏ä‰º†Â§±Ë¥•ÔºöÁΩëÁªúÈîôËØØ",showToast("ÈôÑ‰ª∂‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}},formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}};document.addEventListener("DOMContentLoaded",()=>{AttachmentUploader.init();const e=document.querySelector('[data-tab="filemanager"]');e&&e.addEventListener("click",()=>{setTimeout(()=>{FileManager.initialized||(FileManager.init(),FileManager.initialized=!0)},100)})})</script><script src="/js/ecc-encrypt.js" defer></script><script src="/js/login.js" defer></script><script src="/js/modal-animations.js" defer></script><script src="/js/keyboard-shortcuts.js" defer></script><script src="/js/markdown-preview-modal.js?v=3" defer></script><script>!function(){const t= {{ live2d_enabled }},o= {{ live2d_show_on_admin }};if(!t||!o)return;const s={waifuPath:"https://fastly.jsdelivr.net/npm/live2d-widget@1.0.0/dist/waifu-tips.json",cdnPath:"{{ live2d_cdn_path }}",cubism2Path:"https://fastly.jsdelivr.net/npm/live2d-widget@1.0.0/dist/live2d.min.js",cubism5Path:"https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js",modelId: {{ live2d_model_id }},modelPath:"{{ live2d_model_path }}",tools:["switch-model","switch-texture","photo","info","quit"],drag:!0,logLevel:"error",position:"{{ live2d_position }}",width:"{{ live2d_width }}",height:"{{ live2d_height }}"};window.addEventListener("load",function(){setTimeout(function(){try{if(document.querySelector('script[src*="autoload.js"]'))return;const t=document.createElement("script");t.src="https://fastly.jsdelivr.net/npm/live2d-widgets@1.0.0/dist/autoload.js",t.async=!0,t.onload=function(){if(console.log("Live2D ÁúãÊùøÂ®òÂä†ËΩΩÂÆåÊàê"),"function"==typeof initWidget)try{initWidget(s)}catch(t){console.warn("Live2D ÁúãÊùøÂ®òÂàùÂßãÂåñÂ§±Ë¥•:",t)}},t.onerror=function(){console.warn("Live2D ÁúãÊùøÂ®òÂä†ËΩΩÂ§±Ë¥•ÔºåÂèØËÉΩÊòØÁΩëÁªúÈóÆÈ¢òÊàñ CDN ‰∏çÂèØÁî®")},document.body.appendChild(t)}catch(t){console.warn("Live2D ÁúãÊùøÂ®òÂàùÂßãÂåñÈîôËØØ:",t)}},1e3)})}()</script><script>!function(){let t=[],e=1;const n=20;let a=0;const o={uploadBtn:document.getElementById("amUploadBtn"),emptyUploadBtn:document.getElementById("amEmptyUploadBtn"),refreshBtn:document.getElementById("amRefreshBtn"),fileTypeFilter:document.getElementById("amFileTypeFilter"),visibilityFilter:document.getElementById("amVisibilityFilter"),passageFilter:document.getElementById("amPassageFilter"),searchInput:document.getElementById("amSearchInput"),tableBody:document.getElementById("attachmentsTableBody"),selectAll:document.getElementById("amSelectAll"),totalCount:document.getElementById("amTotalCount"),totalSize:document.getElementById("amTotalSize"),imageCount:document.getElementById("amImageCount"),documentCount:document.getElementById("amDocumentCount"),paginationContainer:document.getElementById("amPaginationContainer"),paginationInfo:document.getElementById("amPaginationInfo"),prevPageBtn:document.getElementById("amPrevPageBtn"),nextPageBtn:document.getElementById("amNextPageBtn"),paginationPages:document.getElementById("amPaginationPages"),batchActions:document.getElementById("amBatchActions"),selectedCount:document.getElementById("amSelectedCount"),batchDeleteBtn:document.getElementById("amBatchDeleteBtn"),batchSetPublicBtn:document.getElementById("amBatchSetPublicBtn"),batchSetPrivateBtn:document.getElementById("amBatchSetPrivateBtn"),cancelSelectionBtn:document.getElementById("amCancelSelectionBtn")};function i(t){if(0===t)return"0 B";const e=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t/Math.pow(1024,e)*100)/100+" "+["B","KB","MB","GB"][e]}function d(t){return{image:"üñºÔ∏è",document:"üìÑ",video:"üé¨",audio:"üéµ",archive:"üì¶"}[t]||"üìé"}function c(){if(0===t.length)return void(o.tableBody.innerHTML='\n        <tr>\n          <td colspan="9" style="text-align: center; padding: 40px;">\n            <div class="am-empty-state">\n              <div class="am-empty-icon">üì≠</div>\n              <p>ÊöÇÊó†ÈôÑ‰ª∂</p>\n              <button class="btn-primary" id="amEmptyUploadBtn" style="margin-top: 15px;">\n                ‰∏ä‰º†Á¨¨‰∏Ä‰∏™ÈôÑ‰ª∂\n              </button>\n            </div>\n          </td>\n        </tr>\n      ');o.tableBody.innerHTML=t.map(t=>{const e=selectedAttachments.has(t.id),n=t.file_path,a="image"===t.file_type;return`\n        <tr class="${e?"selected":""}" data-id="${t.id}">\n          <td>\n            <input type="checkbox" class="am-checkbox" \n                   data-id="${t.id}" \n                   ${e?"checked":""}>\n          </td>\n          <td>\n            ${a?`<img src="${n}" alt="${t.file_name}" \n                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px; cursor: pointer;"\n                     onclick="window.open('${n}', '_blank')">`:`<div style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 4px;">\n                ${d(t.file_type)}\n               </div>`}\n          </td>\n          <td>\n            <div style="font-weight: 500;">${t.file_name}</div>\n            <div style="font-size: 0.85em; color: #888;">${t.stored_name}</div>\n          </td>\n          <td>${d(t.file_type)} ${t.file_type}</td>\n          <td>${i(t.file_size)}</td>\n          <td>${c=t.visibility,{public:'<span class="status published">ÂÖ¨ÂºÄ</span>',private:'<span class="status draft">ÁßÅÂØÜ</span>',protected:'<span class="status pending">Âèó‰øùÊä§</span>'}[c]||c}</td>\n          <td>${t.passage_id?`<a href="/passage?id=${t.passage_id}" target="_blank">#${t.passage_id}</a>`:"-"}</td>\n          <td>${o=t.uploaded_at,new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}</td>\n          <td>\n            <div class="action-buttons">\n              <button class="btn btn-sm btn-view" onclick="viewAttachment(${t.id})" title="Êü•Áúã">\n                üëÅÔ∏è\n              </button>\n              <button class="btn btn-sm btn-edit" onclick="editAttachment(${t.id})" title="ÁºñËæëÊùÉÈôê">\n                üîí\n              </button>\n              <button class="btn btn-sm btn-delete" onclick="deleteAttachment(${t.id})" title="Âà†Èô§">\n                üóëÔ∏è\n              </button>\n            </div>\n          </td>\n        </tr>\n      `;var o,c}).join(""),document.querySelectorAll(".am-checkbox").forEach(t=>{t.addEventListener("change",l)});const e=document.getElementById("amEmptyUploadBtn");e&&e.addEventListener("click",r)}function s(){const t=Math.ceil(a/n);if(t<=1)return void(o.paginationContainer.style.display="none");o.paginationContainer.style.display="flex",o.paginationInfo.textContent=`ÊòæÁ§∫ ${(e-1)*n+1}-${Math.min(e*n,a)} Êù°ÔºåÂÖ± ${a} Êù°`,o.prevPageBtn.disabled=1===e,o.nextPageBtn.disabled=e===t;let i="";let d=Math.max(1,e-Math.floor(2.5)),c=Math.min(t,d+5-1);c-d<4&&(d=Math.max(1,c-5+1));for(let t=d;t<=c;t++)i+=`<button class="pagination-page ${t===e?"active":""}" \n                       data-page="${t}">${t}</button>`;o.paginationPages.innerHTML=i,document.querySelectorAll("#amPaginationPages .pagination-page").forEach(t=>{t.addEventListener("click",()=>{e=parseInt(t.dataset.page),loadAttachments()})})}function l(t){const e=parseInt(t.target.dataset.id);t.target.checked?selectedAttachments.add(e):(selectedAttachments.delete(e),o.selectAll.checked=!1),updateBatchActions()}function r(){document.body.insertAdjacentHTML("beforeend",'\n      <div class="modal active" id="uploadModal">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h3>‰∏ä‰º†ÈôÑ‰ª∂</h3>\n            <button class="modal-close" onclick="closeUploadModal()">√ó</button>\n          </div>\n          <div class="modal-body">\n            <div class="upload-area" id="uploadArea">\n              <div class="upload-icon">üì§</div>\n              <div class="upload-text">\n                <h4>ÊãñÊãΩÊñá‰ª∂Âà∞ËøôÈáåÊàñÁÇπÂáª‰∏ä‰º†</h4>\n                <p>ÊîØÊåÅÂõæÁâá„ÄÅÊñáÊ°£„ÄÅËßÜÈ¢ë„ÄÅÈü≥È¢ë„ÄÅÂéãÁº©ÂåÖ</p>\n              </div>\n              <input type="file" id="fileInput" multiple style="display: none;">\n            </div>\n            <div class="upload-preview" id="uploadPreview"></div>\n            <div class="form-group" style="margin-top: 20px;">\n              <label for="uploadPassageId">ÂÖ≥ËÅîÊñáÁ´†ÔºàÂèØÈÄâÔºâ</label>\n              <select id="uploadPassageId" class="form-control">\n                <option value="">‰∏çÂÖ≥ËÅî</option>\n              </select>\n            </div>\n          </div>\n          <div class="btn-group" style="padding: 0 30px 30px;">\n            <button class="btn-secondary" onclick="closeUploadModal()">ÂèñÊ∂à</button>\n            <button class="btn-primary" id="confirmUploadBtn" disabled>ÂºÄÂßã‰∏ä‰º†</button>\n          </div>\n        </div>\n      </div>\n    '),function(){document.getElementById("uploadModal");const t=document.getElementById("uploadArea"),e=document.getElementById("fileInput"),n=document.getElementById("uploadPreview"),a=document.getElementById("confirmUploadBtn"),o=document.getElementById("uploadPassageId");let i=[];function c(t){i=Array.from(t),s(),a.disabled=0===i.length}function s(){n.innerHTML=i.map((t,e)=>{return`\n        <div class="upload-item">\n          ${t.type.startsWith("image/")?`<img src="${URL.createObjectURL(t)}" alt="${t.name}">`:`<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f5f5f5;">\n              ${d((n=t.type,n.startsWith("image/")?"image":n.startsWith("video/")?"video":n.startsWith("audio/")?"audio":n.includes("pdf")||n.includes("document")||n.includes("word")||n.includes("excel")||n.includes("powerpoint")?"document":n.includes("zip")||n.includes("tar")||n.includes("rar")||n.includes("7z")?"archive":"document"))}\n             </div>`}\n          <button class="upload-remove" onclick="removeUploadFile(${e})">√ó</button>\n          <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); color: white; font-size: 0.75em; padding: 4px; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">\n            ${t.name}\n          </div>\n        </div>\n      `;var n}).join("")}(async function(t){try{const e=await fetch("/api/admin/passages?limit=100"),n=await e.json();n.success&&n.data&&n.data.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.title,t.appendChild(n)})}catch(t){console.error("Âä†ËΩΩÊñáÁ´†ÂàóË°®Â§±Ë¥•:",t)}})(o),t.addEventListener("click",()=>e.click()),e.addEventListener("change",t=>{c(t.target.files)}),t.addEventListener("dragover",e=>{e.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",()=>{t.classList.remove("dragover")}),t.addEventListener("drop",e=>{e.preventDefault(),t.classList.remove("dragover"),c(e.dataTransfer.files)}),a.addEventListener("click",async()=>{if(0===i.length)return;a.disabled=!0,a.textContent="‰∏ä‰º†‰∏≠...";const t=o.value;for(const e of i){const n=new FormData;n.append("file",e),t&&n.append("passage_id",t);try{const t=await fetch("/api/admin/attachments",{method:"POST",body:n}),a=await t.json();a.success||g(`‰∏ä‰º† ${e.name} Â§±Ë¥•: ${a.message}`,"error")}catch(t){console.error("‰∏ä‰º†Â§±Ë¥•:",t),g(`‰∏ä‰º† ${e.name} Â§±Ë¥•`,"error")}}g("‰∏ä‰º†ÂÆåÊàê","success"),closeUploadModal(),loadAttachments()}),window.removeUploadFile=function(t){i.splice(t,1),s(),a.disabled=0===i.length}}()}async function m(){if(0===selectedAttachments.size)return;currentAction="batch-delete-attachment",currentItemId=Array.from(selectedAttachments).join(",");const t=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedAttachments.size} ‰∏™ÈôÑ‰ª∂ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`;document.getElementById("confirmMessage").textContent=t,openModal("confirmModal")}async function u(t){if(0===selectedAttachments.size)return;let e=0,n=0;for(const a of selectedAttachments)try{const o=await fetch(`/api/admin/attachments/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({visibility:t})});(await o.json()).success?e++:n++}catch(t){console.error("ËÆæÁΩÆÂ§±Ë¥•:",t),n++}e>0&&g(`ÊàêÂäüËÆæÁΩÆ ${e} ‰∏™ÈôÑ‰ª∂`,"success"),n>0&&g(`${n} ‰∏™ÈôÑ‰ª∂ËÆæÁΩÆÂ§±Ë¥•`,"error"),loadAttachments()}function p(){selectedAttachments.clear(),o.selectAll.checked=!1,updateBatchActions(),c()}function g(t,e="info"){const n=document.getElementById("toastContainer"),a=document.createElement("div");a.className=`toast ${e}`,a.innerHTML=`\n      <span class="toast-icon">${"success"===e?"‚úì":"error"===e?"‚úó":"‚Ñπ"}</span>\n      <span class="toast-message">${t}</span>\n      <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>\n    `,n.appendChild(a),setTimeout(()=>{a.remove()},3e3)}function h(){const t=document.getElementById("adminShortcutsHelpBtn");t&&window.adminKeyboardManager&&t.addEventListener("click",()=>{window.adminKeyboardManager.showAdminShortcutHelp()}),o.uploadBtn&&o.uploadBtn.addEventListener("click",r),o.refreshBtn&&o.refreshBtn.addEventListener("click",loadAttachments),o.fileTypeFilter&&o.fileTypeFilter.addEventListener("change",()=>{e=1,loadAttachments()}),o.visibilityFilter&&o.visibilityFilter.addEventListener("change",()=>{e=1,loadAttachments()}),o.passageFilter&&o.passageFilter.addEventListener("change",()=>{e=1,loadAttachments()}),o.searchInput&&o.searchInput.addEventListener("input",function(t,e){let n;return function(...a){const o=()=>{clearTimeout(n),t(...a)};clearTimeout(n),n=setTimeout(o,e)}}(()=>{e=1,loadAttachments()},500)),o.selectAll&&o.selectAll.addEventListener("change",t=>{const e=t.target.checked;document.querySelectorAll(".am-checkbox").forEach(t=>{t.checked=e;const n=parseInt(t.dataset.id);e?selectedAttachments.add(n):selectedAttachments.delete(n)}),updateBatchActions(),c()}),o.prevPageBtn&&o.prevPageBtn.addEventListener("click",()=>{e>1&&(e--,loadAttachments())}),o.nextPageBtn&&o.nextPageBtn.addEventListener("click",()=>{const t=Math.ceil(a/n);e<t&&(e++,loadAttachments())}),o.batchDeleteBtn&&o.batchDeleteBtn.addEventListener("click",m),o.batchSetPublicBtn&&o.batchSetPublicBtn.addEventListener("click",()=>u("public")),o.batchSetPrivateBtn&&o.batchSetPrivateBtn.addEventListener("click",()=>u("private")),o.cancelSelectionBtn&&o.cancelSelectionBtn.addEventListener("click",p)}function y(){h(),loadAttachments(),fetch("/api/settings/appearance").then(t=>t.json()).then(t=>{function e(){const e=window.innerWidth<=768&&t.mobile_background_image?t.mobile_background_image:t.background_image;e&&(document.body.style.backgroundImage=`url('${e}')`,document.body.style.backgroundSize=t.background_size||"cover",document.body.style.backgroundPosition=t.background_position||"center",document.body.style.backgroundRepeat=t.background_repeat||"no-repeat",document.body.style.backgroundAttachment=t.background_attachment||"fixed")}localStorage.setItem("appearanceSettings",JSON.stringify(t)),t.dark_mode_enabled&&document.documentElement.classList.add("dark-mode"),(t.navbar_glass_color||t.card_glass_color||t.footer_glass_color||t.navbar_text_color)&&(document.documentElement.style.setProperty("--navbar-glass-color",t.navbar_glass_color||"rgba(255, 255, 255, 0.85)"),document.documentElement.style.setProperty("--navbar-text-color",t.navbar_text_color||"rgba(255, 255, 255, 0.9)"),document.documentElement.style.setProperty("--card-glass-color",t.card_glass_color||"rgba(255, 255, 255, 0.75)"),document.documentElement.style.setProperty("--footer-glass-color",t.footer_glass_color||"rgba(255, 255, 255, 0.9)")),e(),window.addEventListener("resize",e)}).catch(t=>{console.error("Âä†ËΩΩÂ§ñËßÇËÆæÁΩÆÂ§±Ë¥•:",t)})}window.loadAttachments=async function(){try{const d=new URLSearchParams({limit:n,offset:(e-1)*n}),l=o.fileTypeFilter.value,r=o.visibilityFilter.value,m=o.passageFilter.value,u=o.searchInput.value.trim();l&&d.append("file_type",l),r&&d.append("visibility",r),m&&d.append("passage_id",m);const p=await fetch(`/api/admin/attachments?${d.toString()}`),h=await p.json();h.success?(t=h.data||[],a=h.total||0,u&&(t=t.filter(t=>t.file_name.toLowerCase().includes(u.toLowerCase())),a=t.length),c(),function(){o.totalCount.textContent=a;let e=0,n=0,d=0;t.forEach(t=>{e+=t.file_size,"image"===t.file_type&&n++,"document"===t.file_type&&d++}),o.totalSize.textContent=i(e),o.imageCount.textContent=n,o.documentCount.textContent=d}(),s()):g("Âä†ËΩΩÈôÑ‰ª∂ÂàóË°®Â§±Ë¥•: "+h.message,"error")}catch(t){console.error("Âä†ËΩΩÈôÑ‰ª∂ÂàóË°®Â§±Ë¥•:",t),g("Âä†ËΩΩÈôÑ‰ª∂ÂàóË°®Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•","error")}},window.updateBatchActions=function(){const t=selectedAttachments.size;o.selectedCount.textContent=t,o.batchActions.style.display=t>0?"flex":"none"},window.closeUploadModal=function(){const t=document.getElementById("uploadModal");t&&t.remove()},window.viewAttachment=function(e){const n=t.find(t=>t.id===e);n&&window.open(n.file_path,"_blank")},window.editAttachment=async function(t){console.log("ÊâìÂºÄÁºñËæëÊ®°ÊÄÅÊ°ÜÔºåID:",t);const e=document.getElementById("editModal");e&&e.remove();try{const e=await fetch(`/api/admin/attachments/${t}`),n=await e.json();if(n.success&&n.data){const e=Array.isArray(n.data)?n.data[0]:n.data;console.log("‰ªéAPIËé∑ÂèñÁöÑÈôÑ‰ª∂Êï∞ÊçÆ:",e);const a=`\n          <div class="modal active" id="editModal">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h3>ÁºñËæëÈôÑ‰ª∂ÊùÉÈôê</h3>\n                <button class="modal-close" onclick="closeEditModal()">√ó</button>\n              </div>\n              <div class="modal-body">\n                <div class="form-group">\n                  <label>Êñá‰ª∂Âêç</label>\n                  <input type="text" class="form-control" value="${e.file_name}" disabled>\n                </div>\n                <div class="form-group">\n                  <label for="editVisibility">ÂèØËßÅÊÄß</label>\n                  <select id="editVisibility" class="form-control">\n                    <option value="public" ${"public"===(e.visibility||"public")?"selected":""}>ÂÖ¨ÂºÄ</option>\n                    <option value="private" ${"private"===(e.visibility||"public")?"selected":""}>ÁßÅÂØÜ</option>\n                    <option value="protected" ${"protected"===(e.visibility||"public")?"selected":""}>Âèó‰øùÊä§</option>\n                  </select>\n                </div>\n                <div class="form-group">\n                  <label for="editShowInPassage">\n                    <input type="checkbox" id="editShowInPassage" ${e.show_in_passage?"checked":""}>\n                    Âú®ÊñáÁ´†‰∏≠ÊòæÁ§∫\n                  </label>\n                </div>\n              </div>\n              <div class="btn-group" style="padding: 0 30px 30px;">\n                <button class="btn-secondary" onclick="closeEditModal()">ÂèñÊ∂à</button>\n                <button class="btn-primary" onclick="saveAttachmentSettings(${t})">‰øùÂ≠ò</button>\n              </div>\n            </div>\n          </div>\n        `;document.body.insertAdjacentHTML("beforeend",a)}else g("Ëé∑ÂèñÈôÑ‰ª∂‰ø°ÊÅØÂ§±Ë¥•: "+(n.message||"Êú™Áü•ÈîôËØØ"),"error")}catch(t){console.error("Ëé∑ÂèñÈôÑ‰ª∂‰ø°ÊÅØÂ§±Ë¥•:",t),g("Ëé∑ÂèñÈôÑ‰ª∂‰ø°ÊÅØÂ§±Ë¥•","error")}},window.saveAttachmentSettings=async function(t){const e=document.getElementById("editVisibility").value,n=document.getElementById("editShowInPassage").checked;console.log("‰øùÂ≠òÈôÑ‰ª∂ËÆæÁΩÆ:",{id:t,visibility:e,showInPassage:n});try{const a=await fetch(`/api/admin/attachments/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({visibility:e,show_in_passage:n})}),o=await a.json();console.log("‰øùÂ≠òÂìçÂ∫î:",o),o.success?(g("‰øùÂ≠òÊàêÂäü","success"),closeEditModal(),console.log("Ê≠£Âú®ÈáçÊñ∞Âä†ËΩΩÈôÑ‰ª∂ÂàóË°®..."),await loadAttachments(),console.log("ÈôÑ‰ª∂ÂàóË°®ÈáçÊñ∞Âä†ËΩΩÂÆåÊàê")):g("‰øùÂ≠òÂ§±Ë¥•: "+o.message,"error")}catch(t){console.error("‰øùÂ≠òÂ§±Ë¥•:",t),g("‰øùÂ≠òÂ§±Ë¥•","error")}},window.closeEditModal=function(){const t=document.getElementById("editModal");t&&(t.classList.add("closing"),setTimeout(()=>{t.remove()},300))},window.deleteAttachment=async function(t){currentAction="delete-attachment",currentItemId=t;const e=`Á°ÆÂÆöË¶ÅÂà†Èô§ÈôÑ‰ª∂ #${t} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`;document.getElementById("confirmMessage").textContent=e,openModal("confirmModal")},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y()}()</script><link rel="stylesheet" href="/css/music-player.css" media="print" onload='this.media="all"'><script src="/js/music-player.js" defer></script>