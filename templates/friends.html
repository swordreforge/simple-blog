<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
<meta name="description" content="RustBlog å‹é“¾é¡µé¢ - ä¸å¿—åŒé“åˆçš„æœ‹å‹å»ºç«‹è¿æ¥">
<title>{{ title }}</title>
<link rel="stylesheet" href="/css/modal-animations.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="/css/keyboard-shortcuts.css" media="print" onload="this.media='all'">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  width: 100%;
  overflow-x: hidden;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  position: relative;
  background-image: url('{{ settings.background_image | safe }}');
  background-size: {{ settings.background_size }};
  background-position: {{ settings.background_position }};
  background-repeat: {{ settings.background_repeat }};
  background-attachment: {{ settings.background_attachment }};
  background-blend-mode: overlay;
  --global-opacity: {{ settings.global_opacity }};
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(5px);
  z-index: -1;
}

/* å¯¼èˆªæ æ ·å¼ */
nav {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  position: fixed;
  top: env(safe-area-inset-top);
  right: 0;
  padding: 15px env(safe-area-inset-right) 15px env(safe-area-inset-left);
  width: 100%;
  background: var(--navbar-glass-color, rgba(255, 255, 255, 0.85));
  backdrop-filter: blur(10px) saturate(180%);
  -webkit-backdrop-filter: blur(10px) saturate(180%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 100;
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
  transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
              opacity 0.4s ease;
  transform: translateY(0);
  opacity: 1;
}

nav.hidden {
  transform: translateY(-100%);
  opacity: 0;
}

nav a {
  color: var(--navbar-text-color, rgba(255, 255, 255, 0.9));
  text-decoration: none;
  margin: 0 15px;
  font-weight: 500;
  transition: all 0.3s ease;
  position: relative;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

nav button {
  color: var(--navbar-text-color, rgba(255, 255, 255, 0.9));
  text-decoration: none;
  margin: 0 15px;
  font-weight: 500;
  transition: all 0.3s ease;
  position: relative;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
}

nav a:hover {
  color: #fff;
  background: rgba(0, 0, 0, 0);
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

nav a::after {
  display: none;
}

nav a.current {
  color: #fff;
  background: rgba(255, 255, 255, 0.3);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

#loginBtn, #userCenterToggle {
  display: flex;
  align-items: center;
  gap: 8px;
  color: rgba(255, 255, 255, 0.9);
  text-decoration: none;
  margin-left: env(safe-area-inset-left);
  margin-right: 15px;
  font-weight: 500;
  transition: all 0.3s ease;
  position: relative;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#loginBtn:hover, #userCenterToggle:hover {
  color: #fff;
  background: rgba(0, 0, 0, 0);
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

/* ä¸»å®¹å™¨ */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 120px 40px 60px;
  width: 100%;
}

/* é¡µé¢æ ‡é¢˜ */
.page-header {
  text-align: center;
  margin-bottom: 50px;
}

.page-title {
  font-size: 3em;
  color: rgba(255, 255, 255, 0.95);
  margin-bottom: 15px;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  font-weight: 700;
}

.page-subtitle {
  font-size: 1.3em;
  color: rgba(255, 255, 255, 0.8);
}

/* å‹é“¾å¡ç‰‡ç½‘æ ¼ */
.friends-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 25px;
  width: 100%;
}

/* å‹é“¾å¡ç‰‡æ ·å¼ */
.friend-card {
  background: rgba(0, 0, 0, 0);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.3);
  padding: 30px 35px;
  border-radius: 20px;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 20px;
}

.friend-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.friend-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.3);
  object-fit: cover;
  flex-shrink: 0;
  transition: transform 0.3s ease;
}

.friend-card:hover .friend-avatar {
  transform: scale(1.1);
}

.friend-info {
  flex: 1;
}

.friend-name {
  font-size: 1.8em;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 10px;
  font-weight: 600;
}

.friend-motto {
  color: rgba(255, 255, 255, 0.8);
  font-size: 1.1em;
  margin-bottom: 15px;
  line-height: 1.6;
}

.friend-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 24px;
  background: rgba(255, 255, 255, 0.15);
  color: rgba(255, 255, 255, 0.9);
  text-decoration: none;
  border-radius: 30px;
  font-size: 0.95em;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.25);
}

.friend-link:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.loading {
  text-align: center;
  padding: 100px 20px;
  color: rgba(255, 255, 255, 0.85);
  font-size: 1.3em;
}

.empty-state {
  text-align: center;
  padding: 120px 20px;
  color: rgba(255, 255, 255, 0.85);
}

.empty-state svg {
  width: 100px;
  height: 100px;
  margin-bottom: 25px;
  opacity: 0.5;
}

.empty-state p {
  font-size: 1.5em;
  margin-bottom: 10px;
  color: rgba(255, 255, 255, 0.95);
}

.empty-state small {
  font-size: 1.1em;
  opacity: 0.65;
}

@media (max-width: 768px) {
  nav {
    padding: 10px env(safe-area-inset-right) 10px env(safe-area-inset-left);
  }

  nav a, nav button, #loginBtn, #userCenterToggle {
    font-size: 0;
    margin: 0 4px;
    padding: 10px;
    min-width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }

  /* éšè—å¯¼èˆªæ æ–‡å­—ï¼Œåªæ˜¾ç¤ºå›¾æ ‡ */
  nav a span:not(.shortcut-hint),
  nav button span:not(.shortcut-hint),
  #loginBtn span:not(:has(svg)),
  #userCenterToggle span:not(:has(svg)) {
    display: none;
  }

  /* éšè—å¿«æ·é”®æŒ‰é’® */
  .shortcuts-help-btn {
    display: none !important;
  }

  /* éšè—å¿«æ·é”®æç¤º */
  .shortcut-hint {
    display: none !important;
  }

  /* ç¡®ä¿å›¾æ ‡å¯è§ */
  nav a svg,
  nav button svg,
  #loginBtn svg,
  #userCenterToggle svg {
    display: block;
    font-size: initial;
  }

  /* ä¸ºæ²¡æœ‰å›¾æ ‡çš„é“¾æ¥æ·»åŠ é»˜è®¤å›¾æ ‡ */
  nav a[href="/"]::before {
    content: 'ğŸ ';
    font-size: 18px;
  }

  nav a[href="/passage"]::before {
    content: 'ğŸ“';
    font-size: 18px;
  }

  nav a[href="/collect"]::before {
    content: 'ğŸ“';
    font-size: 18px;
  }

  nav a[href="/about"]::before {
    content: 'â„¹ï¸';
    font-size: 18px;
  }

  nav a[href="/friends"]::before {
    content: 'ğŸ”—';
    font-size: 18px;
  }

  nav a[href="/markdown-editor"]::before {
    content: 'âœï¸';
    font-size: 18px;
  }

  nav a[href="/admin"]::before {
    content: 'âš™ï¸';
    font-size: 18px;
  }

  #userCenterToggle::before {
    content: 'ğŸ‘¤';
    font-size: 18px;
  }

  #loginBtn svg {
    width: 20px;
    height: 20px;
  }

  .container {
    padding: 100px 20px 40px;
  }

  .friends-grid {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .friend-card {
    padding: 25px 30px;
    gap: 18px;
  }

  .friend-avatar {
    width: 70px;
    height: 70px;
  }

  .friend-name {
    font-size: 1.5em;
  }

  .friend-motto {
    font-size: 1em;
  }

  .page-title {
    font-size: 2.2em;
  }

  .page-subtitle {
    font-size: 1.1em;
  }
}
</style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav id="navbar">
  <a href="/">é¦–é¡µ</a>
  <a href="/passage">æ–‡ç« </a>
  <a href="/collect">å½’æ¡£</a>
  <a href="/about">å…³äº</a>
  {% if is_logged_in %}
  <button id="userCenterToggle" onclick="openUserCenter()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
      <circle cx="12" cy="7" r="4"></circle>
    </svg>
    <span>{{ username }}</span>
  </button>
  {% else %}
  <a href="#" id="loginBtn" onclick="openLoginModal()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
      <polyline points="10 17 15 12 10 7"></polyline>
      <line x1="15" y1="12" x2="3" y2="12"></line>
    </svg>
    ç™»å½•
  </a>
  {% endif %}
</nav>

<!-- ä¸»å®¹å™¨ -->
<div class="container">
  <div class="page-header">
    <h1 class="page-title">å‹é“¾</h1>
    <p class="page-subtitle">ä¸å¿—åŒé“åˆçš„æœ‹å‹å»ºç«‹è¿æ¥</p>
  </div>
  
  <div id="friendLinksContainer">
    <div class="loading">åŠ è½½ä¸­...</div>
  </div>
</div>

<!-- ç™»å½•æ¨¡æ€æ¡† -->
<div class="modal" id="loginModal">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h3>ç™»å½•</h3>
      <button class="modal-close" onclick="closeLoginModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="loginForm">
        <div class="form-group">
          <label>ç”¨æˆ·å</label>
          <input type="text" id="loginUsername" class="form-control" required>
        </div>
        <div class="form-group">
          <label>å¯†ç </label>
          <input type="password" id="loginPassword" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">ç™»å½•</button>
      </form>
    </div>
  </div>
</div>

<!-- ä¸ªäººä¸­å¿ƒæ¨¡æ€æ¡† -->
<div class="modal user-center-modal" id="userCenterModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ä¸ªäººä¸­å¿ƒ</h3>
      <button class="modal-close" onclick="closeUserCenter()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="user-profile">
        <div class="user-avatar-container">
          <img src="{{ global_avatar }}" alt="Avatar" class="user-avatar-image">
        </div>
        <h3>{{ username }}</h3>
      </div>
      <div class="user-center-menu">
        <a href="/admin" class="user-center-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          ç®¡ç†åå°
        </a>
        <button class="user-center-item" onclick="logout()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          é€€å‡ºç™»å½•
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// åŠ è½½å‹é“¾åˆ—è¡¨
async function loadFriendLinks() {
  const container = document.getElementById('friendLinksContainer');
  
  try {
    const response = await fetch('/api/friend-links');
    const result = await response.json();
    
    if (result.success && result.data && result.data.length > 0) {
      // åˆ›å»º grid å®¹å™¨
      container.innerHTML = '<div class="friends-grid"></div>';
      const grid = container.querySelector('.friends-grid');
      
      result.data.forEach((link, index) => {
        const card = document.createElement('div');
        card.className = 'friend-card';
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        const avatar = link.avatar_url || '/img/avatar.webp';
        const name = link.nickname || 'æœªå‘½å';
        const motto = link.motto || '';
        const url = link.link_url || '#';
        
        card.innerHTML = `
          <img src="${avatar}" alt="${name}" class="friend-avatar" loading="lazy" onerror="this.src='/img/avatar.webp'">
          <div class="friend-info">
            <h2 class="friend-name">${name}</h2>
            ${motto ? `<p class="friend-motto">${motto}</p>` : ''}
            <a href="${url}" target="_blank" rel="noopener noreferrer" class="friend-link">
              è®¿é—®åšå®¢
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
            </a>
          </div>
        `;
        
        grid.appendChild(card);
        
        setTimeout(() => {
          card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, index * 100);
      });
    } else {
      container.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <p>æš‚æ— å‹é“¾</p>
          <small>åšä¸»è¿˜æ²¡æœ‰æ·»åŠ å‹é“¾å“¦~</small>
        </div>
      `;
    }
  } catch (error) {
    console.error('åŠ è½½å‹é“¾å¤±è´¥:', error);
    container.innerHTML = `
      <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p>åŠ è½½å¤±è´¥</p>
        <small>è¯·ç¨åé‡è¯•</small>
      </div>
    `;
  }
}

// ç™»å½•åŠŸèƒ½
function openLoginModal() {
  document.getElementById('loginModal').classList.add('active');
}

function closeLoginModal() {
  document.getElementById('loginModal').classList.remove('active');
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('loginUsername').value;
  const password = document.getElementById('loginPassword').value;
  
  try {
    const response = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    const result = await response.json();
    
    if (result.success) {
      closeLoginModal();
      location.reload();
    } else {
      alert(result.message || 'ç™»å½•å¤±è´¥');
    }
  } catch (error) {
    alert('ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  }
});

// ä¸ªäººä¸­å¿ƒåŠŸèƒ½
function openUserCenter() {
  document.getElementById('userCenterModal').classList.add('active');
}

function closeUserCenter() {
  document.getElementById('userCenterModal').classList.remove('active');
}

async function logout() {
  try {
    const response = await fetch('/api/logout', { method: 'POST' });
    const result = await response.json();
    if (result.success) {
      location.reload();
    }
  } catch (error) {
    console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
  }
}

// å¯¼èˆªæ æ»šåŠ¨éšè—
let lastScroll = 0;
window.addEventListener('scroll', () => {
  const navbar = document.getElementById('navbar');
  const currentScroll = window.pageYOffset;
  
  if (currentScroll > lastScroll && currentScroll > 100) {
    navbar.classList.add('hidden');
  } else {
    navbar.classList.remove('hidden');
  }
  lastScroll = currentScroll;
});

// é¡µé¢åŠ è½½å®ŒæˆååŠ è½½å‹é“¾
document.addEventListener('DOMContentLoaded', () => {
  // è®¾ç½®å¯¼èˆªæ é¢œè‰²å’Œé€æ˜åº¦
  const settings = {
    navbar_glass_color: '{{ settings.navbar_glass_color }}',
    navbar_text_color: '{{ settings.navbar_text_color }}',
    background_image: '{{ settings.background_image | safe }}',
    mobile_background_image: '{{ settings.mobile_background_image | safe }}'
  };
  document.documentElement.style.setProperty('--navbar-glass-color', settings.navbar_glass_color || 'rgba(255, 255, 255, 0.85)');
  document.documentElement.style.setProperty('--navbar-text-color', settings.navbar_text_color || 'rgba(255, 255, 255, 0.9)');
  
  // å“åº”å¼åŠ è½½èƒŒæ™¯å›¾ç‰‡
  function applyBackgroundImage() {
    const isMobile = window.innerWidth <= 768;
    const backgroundImage = isMobile && settings.mobile_background_image ? settings.mobile_background_image : settings.background_image;
    if (backgroundImage) {
      document.body.style.backgroundImage = `url('${backgroundImage}')`;
    }
  }

  // åˆå§‹åº”ç”¨
  applyBackgroundImage();

  // ç›‘å¬çª—å£å¤§å°å˜åŒ–
  window.addEventListener('resize', applyBackgroundImage);

  // åˆå§‹åŒ–å¿«æ·é”®ï¼ˆç­‰è„šæœ¬åŠ è½½å®Œæˆï¼‰
  window.addEventListener('load', () => {
    if (typeof KeyboardShortcuts !== 'undefined' && typeof KeyboardShortcuts.init === 'function') {
      KeyboardShortcuts.init();
    }
  });

  loadFriendLinks();
});
</script>

<!-- é¡µè„šå’Œå¤‡æ¡ˆä¿¡æ¯ -->
<footer style="text-align: center; padding: 12px 20px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-top: 1px solid rgba(255, 255, 255, 0.2); margin-top: auto; position: relative; z-index: 1; color: rgba(255, 255, 255, 0.9); font-size: 0.9em;">
  <div style="margin-bottom: 4px;">&copy; {{ year }} {{ foodes }}</div>
  {% if beian_enabled %}
  <div style="font-size: 0.85em;">
    {% if icp_number %}<a href="http://beian.miit.gov.cn/" target="_blank" style="color: inherit; text-decoration: none;">{{ icp_number }}</a>{% endif %}
    {% if police_record_code %}<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode={{ police_record_code }}" target="_blank" style="color: inherit; text-decoration: none; margin-left: 8px;">{{ police_record_content }}</a>{% endif %}
  </div>{% endif %}
</footer>

<script src="/js/keyboard-shortcuts.js" defer></script>
</body>
</html>